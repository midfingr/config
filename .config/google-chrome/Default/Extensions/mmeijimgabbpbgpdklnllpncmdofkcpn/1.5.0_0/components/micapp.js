!function(){"use strict";angular.module("w69b.promiseTool",[]).factory("promiseTool",["$q","$timeout",function(a,b){var c={};return c.wrapChromeError=function(b,c){return function(){var d=Array.prototype.slice.call(arguments,0),e=a.defer();return d.push(function(a){chrome.runtime.lastError?e.reject(chrome.runtime.lastError):e.resolve(a)}),b.apply(c,d),e.promise}},c.wrapCallbacks=function(b,c){return function(){var d=Array.prototype.slice.call(arguments,0),e=a.defer();return d.push(e.resolve.bind(e)),d.push(e.reject.bind(e)),b.apply(c,d),e.promise}},c.serializer=function(){var b=null;return function(c){var d=a.defer();return(b||a.when())["finally"](function(){var a=c.call();d.resolve(a)}),b=d.promise,b["finally"](function(){b=null}),d.promise}},c.withTimeout=function(c,d,e){e||(e=angular.noop);var f=a.defer(),g=b(function(){var a=e();angular.isDefined(a)?f.resolve(a):f.reject("timeout"),f=null},d),h=c(),i=f.promise;return h["finally"](function(){b.cancel(g),g=null}),h.then(function(){f&&f.resolve.apply(f,arguments)},function(){f&&f.reject.apply(f,arguments)}),i},c}]),angular.module("w69b.webrtc",["w69b.promiseTool"]).factory("webrtc",["promiseTool","$window","$q",function(a,b){var c={},d=b.navigator;return c.getUserMedia=a.wrapCallbacks(d.getUserMedia||d.webkitGetUserMedia||d.mozGetUserMedia||d.msGetUserMedia,d),c.getSources=a.wrapCallbacks(MediaStreamTrack.getSources,MediaStreamTrack),c.getSourcesByKind=function(a){return c.getSources().then(function(b){return b.filter(function(b){return b.kind===a})})},c.getVideoSources=function(){return c.getSourcesByKind("video")},c.getAudioSources=function(){return c.getSourcesByKind("audio")},c.hasCamera=function(){return c.getVideoSources().then(function(a){return a.length>0})},c.hasMicrophone=function(){return c.getAudioSources().then(function(a){return a.length>0})},c}]),angular.module("castifyExt.MicApp",["castifyExt.mic.ui"]),angular.module("castifyExt.mic.ui",["w69b.webrtc"]).controller("MicStreamCtrl",["$scope","webrtc","$window","$log",function(a,b,c,d){function e(){b.hasCamera().then(function(e){b.getUserMedia({audio:!0,video:e}).then(function(b){a.state="success",b.stop(),c.clGotStream&&(c.clGotStream(),c.close())},function(b){d.info(b),a.state="error"})})}a.state="init",a.record=e,e()}])}();