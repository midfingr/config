!function(){!function(a){"use strict";function b(a,b,c){for(var d=[b],e=0;e<c.length;e++)d[e+1]=c[e];var f=A(Function.prototype.bind,a,d);return f}function c(a,c){var d=new(b(a,null,c));return d}function d(){return"__$"+Math.floor(1e9*Math.random())+"$"+ ++B+"$__"}function e(a){return C[a]}function f(){var a=d();return C[a]=!0,a}function g(a,b,c){return[D,a,b,c]}function h(a){return a&&a[0]===D}function i(){E=f(),Function.prototype.call=j(function(){var a=l(function(a){for(var b=[],c=1;c<arguments.length;++c)b[c-1]=arguments[c];var d=g(this,a,b);return d},this,arguments);return a}),Function.prototype.apply=j(function(){var a=l(function(a,b){var c=g(this,a,b);return c},this,arguments);return a})}function j(a){return null===E&&i(),a[E]=!0,a}function k(a){return!!a[E]}function l(a,b,c){var d=c[0];if(h(d))return d=A(a,b,d[3]);for(d=g(a,b,c);;){if(d=k(a)?A(a,d[2],[d]):A(a,d[2],d[3]),!h(d))return d;a=d[1]}}function m(){var a;return a=k(this)?c(this,[g(null,null,arguments)]):c(this,arguments)}if(!a.$traceurRuntime){var n=Object,o=TypeError,p=n.create,q=n.defineProperties,r=n.defineProperty,s=n.freeze,t=n.getOwnPropertyDescriptor,u=n.getOwnPropertyNames,v=n.keys,w=n.prototype.hasOwnProperty,x=(n.prototype.toString,Object.preventExtensions),y=Object.seal,z=Object.isExtensible,A=Function.prototype.call.bind(Function.prototype.apply),B=0,C=p(null),D=Object.create(null),E=null;!function(){function b(a){return{configurable:!0,enumerable:!1,value:a,writable:!0}}function c(a){return"object"==typeof a&&a instanceof k}function h(a){return c(a)?"symbol":typeof a}function i(a){var b=new k(a);if(!(this instanceof i))return b;throw new TypeError("Symbol cannot be new'ed")}function k(a){var b=d();r(this,Z,{value:this}),r(this,X,{value:b}),r(this,Y,{value:a}),B(this),$[b]=this}function A(a){var b=a[_];return b&&b.self===a?b:z(a)?(ba.hash.value=ca++,ba.self.value=a,aa.value=p(null,ba),r(a,_,aa),aa.value):void 0}function B(a){return A(a),s.apply(this,arguments)}function D(a){return A(a),x.apply(this,arguments)}function E(a){return A(a),y.apply(this,arguments)}function F(a){return $[a]||C[a]}function G(a){return c(a)?a[X]:a}function H(a){for(var b=[],c=0;c<a.length;c++)F(a[c])||b.push(a[c]);return b}function I(a){return H(u(a))}function J(a){return H(v(a))}function K(a){for(var b=[],c=u(a),d=0;d<c.length;d++){var e=$[c[d]];e&&b.push(e)}return b}function L(a,b){return t(a,G(b))}function M(a){return w.call(this,G(a))}function N(b){return a.$traceurRuntime.options[b]}function O(a,b,d){return c(b)&&(b=b[X]),r(a,b,d),a}function P(a){r(a,"defineProperty",{value:O}),r(a,"getOwnPropertyNames",{value:I}),r(a,"getOwnPropertyDescriptor",{value:L}),r(a.prototype,"hasOwnProperty",{value:M}),r(a,"freeze",{value:B}),r(a,"preventExtensions",{value:D}),r(a,"seal",{value:E}),r(a,"keys",{value:J})}function Q(a){for(var b=1;b<arguments.length;b++)for(var c=u(arguments[b]),d=0;d<c.length;d++){var e=c[d];F(e)||!function(b,c){r(a,c,{get:function(){return b[c]},enumerable:!0})}(arguments[b],c[d])}return a}function R(a){return null!=a&&("object"==typeof a||"function"==typeof a)}function S(a){if(null==a)throw o();return n(a)}function T(a){if(null==a)throw new TypeError("Value cannot be converted to an Object");return a}function U(a,b){a.Symbol||(a.Symbol=b,Object.getOwnPropertySymbols=K),a.Symbol.iterator||(a.Symbol.iterator=b("Symbol.iterator")),a.Symbol.observer||(a.Symbol.observer=b("Symbol.observer"))}function V(a){U(a,i),a.Reflect=a.Reflect||{},a.Reflect.global=a.Reflect.global||a,P(a.Object)}var W=b,X=d(),Y=d(),Z=d(),$=p(null);r(i.prototype,"constructor",b(i)),r(i.prototype,"toString",W(function(){var a=this[Z];return a[X]})),r(i.prototype,"valueOf",W(function(){var a=this[Z];if(!a)throw TypeError("Conversion from symbol to string");return N("symbols")?a:a[X]})),r(k.prototype,"constructor",b(i)),r(k.prototype,"toString",{value:i.prototype.toString,enumerable:!1}),r(k.prototype,"valueOf",{value:i.prototype.valueOf,enumerable:!1});var _=f(),aa={value:void 0},ba={hash:{value:void 0},self:{value:void 0}},ca=0;B(k.prototype),V(a),a.$traceurRuntime={call:l,checkObjectCoercible:T,construct:m,continuation:g,createPrivateName:f,defineProperties:q,defineProperty:r,exportStar:Q,getOwnHashObject:A,getOwnPropertyDescriptor:t,getOwnPropertyNames:u,initTailRecursiveFunction:j,isObject:R,isPrivateName:e,isSymbolString:F,keys:v,options:{},setupGlobals:V,toObject:S,toProperty:G,"typeof":h}}()}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this),function(){function a(a,b,c,d,e,f,g){var h=[];return a&&h.push(a,":"),c&&(h.push("//"),b&&h.push(b,"@"),h.push(c),d&&h.push(":",d)),e&&h.push(e),f&&h.push("?",f),g&&h.push("#",g),h.join("")}function b(a){return a.match(h)}function c(a){if("/"===a)return"/";for(var b="/"===a[0]?"/":"",c="/"===a.slice(-1)?"/":"",d=a.split("/"),e=[],f=0,g=0;g<d.length;g++){var h=d[g];switch(h){case"":case".":break;case"..":e.length?e.pop():f++;break;default:e.push(h)}}if(!b){for(;f-->0;)e.unshift("..");0===e.length&&e.push(".")}return b+e.join("/")+c}function d(b){var d=b[i.PATH]||"";return d=c(d),b[i.PATH]=d,a(b[i.SCHEME],b[i.USER_INFO],b[i.DOMAIN],b[i.PORT],b[i.PATH],b[i.QUERY_DATA],b[i.FRAGMENT])}function e(a){var c=b(a);return d(c)}function f(a,c){var e=b(c),f=b(a);if(e[i.SCHEME])return d(e);e[i.SCHEME]=f[i.SCHEME];for(var g=i.SCHEME;g<=i.PORT;g++)e[g]||(e[g]=f[g]);if("/"==e[i.PATH][0])return d(e);var h=f[i.PATH],j=h.lastIndexOf("/");return h=h.slice(0,j+1)+e[i.PATH],e[i.PATH]=h,d(e)}function g(a){if(!a)return!1;if("/"===a[0])return!0;var c=b(a);return c[i.SCHEME]?!0:!1}var h=new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),i={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7};$traceurRuntime.canonicalizeUrl=e,$traceurRuntime.isAbsolute=g,$traceurRuntime.removeDotSegments=c,$traceurRuntime.resolveUrl=f}(),function(a){"use strict";function b(a,b){this.url=a,this.value_=b}function c(a,b){this.message=this.constructor.name+": "+this.stripCause(b)+" in "+a,this.stack=b instanceof c||!b.stack?"":this.stripStack(b.stack)}function d(a,b){var c=[],d=b-3;0>d&&(d=0);for(var e=d;b>e;e++)c.push(a[e]);return c}function e(a,b){var c=b+1;c>a.length-1&&(c=a.length-1);for(var d=[],e=b;c>=e;e++)d.push(a[e]);return d}function f(a){for(var b="",c=0;a-1>c;c++)b+="-";return b}function g(a,c){b.call(this,a,null),this.func=c}function h(a){if(a){var b=r.normalize(a);return o[b]}}function i(a){var b=arguments[1],c=Object.create(null);return Object.getOwnPropertyNames(a).forEach(function(d){var e,f;if(b===q){var g=Object.getOwnPropertyDescriptor(a,d);g.get&&(e=g.get)}e||(f=a[d],e=function(){return f}),Object.defineProperty(c,d,{get:e,enumerable:!0})}),Object.preventExtensions(c),c}var j,k=$traceurRuntime,l=k.canonicalizeUrl,m=k.resolveUrl,n=k.isAbsolute,o=Object.create(null);j=a.location&&a.location.href?m(a.location.href,"./"):"",c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c.prototype.stripError=function(a){return a.replace(/.*Error:/,this.constructor.name+":")},c.prototype.stripCause=function(a){return a?a.message?this.stripError(a.message):a+"":""},c.prototype.loadedBy=function(a){this.stack+="\n loaded by "+a},c.prototype.stripStack=function(a){var b=[];return a.split("\n").some(function(a){return/UncoatedModuleInstantiator/.test(a)?!0:void b.push(a)}),b[0]=this.stripError(b[0]),b.join("\n")},g.prototype=Object.create(b.prototype),g.prototype.getUncoatedModule=function(){if(this.value_)return this.value_;try{var b;return void 0!==typeof $traceurRuntime&&$traceurRuntime.require&&(b=$traceurRuntime.require.bind(null,this.url)),this.value_=this.func.call(a,b)}catch(g){if(g instanceof c)throw g.loadedBy(this.url),g;if(g.stack){var h=this.func.toString().split("\n"),i=[];g.stack.split("\n").some(function(a){if(a.indexOf("UncoatedModuleInstantiator.getUncoatedModule")>0)return!0;var b=/(at\s[^\s]*\s).*>:(\d*):(\d*)\)/.exec(a);if(b){var c=parseInt(b[2],10);i=i.concat(d(h,c)),i.push(f(b[3])+"^"),i=i.concat(e(h,c)),i.push("= = = = = = = = =")}else i.push(a)}),g.stack=i.join("\n")}throw new c(this.url,g)}};var p=Object.create(null),q={},r={normalize:function(a,b){if("string"!=typeof a)throw new TypeError("module name must be a string, not "+typeof a);if(n(a))return l(a);if(/[^\.]\/\.\.\//.test(a))throw new Error("module name embeds /../: "+a);return"."===a[0]&&b?m(b,a):l(a)},get:function(a){var b=h(a);if(!b)return void 0;var c=p[b.url];return c?c:(c=i(b.getUncoatedModule(),q),p[b.url]=c)},set:function(a,b){a=String(a),o[a]=new g(a,function(){return b}),p[a]=b},get baseURL(){return j},set baseURL(a){j=String(a)},registerModule:function(a,b,c){var d=r.normalize(a);if(o[d])throw new Error("duplicate module named "+d);o[d]=new g(d,c)},bundleStore:Object.create(null),register:function(a,b,c){b&&(b.length||c.length)?this.bundleStore[a]={deps:b,execute:function(){var a=arguments,d={};b.forEach(function(b,c){return d[b]=a[c]});var e=c.call(this,d);return e.execute.call(this),e.exports}}:this.registerModule(a,b,c)},getAnonymousModule:function(b){return new i(b.call(a),q)},getForTesting:function(a){var b=this;return this.testingPrefix_||Object.keys(p).some(function(a){var c=/(traceur@[^\/]*\/)/.exec(a);return c?(b.testingPrefix_=c[1],!0):void 0}),this.get(this.testingPrefix_+a)}},s=new i({ModuleStore:r});r.set("@traceur/src/runtime/ModuleStore",s),r.set("@traceur/src/runtime/ModuleStore.js",s);var t=$traceurRuntime.setupGlobals;$traceurRuntime.setupGlobals=function(a){t(a)},$traceurRuntime.ModuleStore=r,a.System={register:r.register.bind(r),registerModule:r.registerModule.bind(r),get:r.get,set:r.set,normalize:r.normalize},$traceurRuntime.getModuleImpl=function(a){var b=h(a);return b&&b.getUncoatedModule()}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this),System.registerModule("traceur-runtime@0.0.87/src/runtime/async.js",[],function(){"use strict";function a(){}function b(){}function c(a){return a.prototype=j(b.prototype),a.__proto__=b,a}function d(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];var e=j(b.prototype);return e[k]=this,e[l]=c,e[m]=a,e}function e(a,b){return new Promise(function(c,d){var e=a({next:function(a){return b.call(e,a)},"throw":function(a){d(a)},"return":function(a){c(a)}})})}function f(a){return Promise.resolve().then(a)}function g(a,b){return new q(a,b)}if("object"!=typeof $traceurRuntime)throw new Error("traceur runtime not found.");var h=$traceurRuntime.createPrivateName,i=$traceurRuntime.defineProperty,j=($traceurRuntime.defineProperties,Object.create),k=h(),l=h(),m=h();a.prototype=b,b.constructor=a,i(b,"constructor",{enumerable:!1});var n=function(a){var b=this;this.decoratedObserver=$traceurRuntime.createDecoratedGenerator(a,function(){b.done=!0}),this.done=!1,this.inReturn=!1};$traceurRuntime.createClass(n,{"throw":function(a){if(!this.inReturn)throw a},"yield":function(a){if(this.done)throw void(this.inReturn=!0);var b;try{b=this.decoratedObserver.next(a)}catch(c){throw this.done=!0,c}if(void 0!==b){if(b.done)throw this.done=!0,void(this.inReturn=!0);return b.value}},yieldFor:function(a){var b=this;return $traceurRuntime.observeForEach(a[$traceurRuntime.toProperty(Symbol.observer)].bind(a),function(a){if(b.done)return void this["return"]();var c;try{c=b.decoratedObserver.next(a)}catch(d){throw b.done=!0,d}if(void 0!==c)return c.done&&(b.done=!0),c})}},{}),b.prototype[Symbol.observer]=function(a){var b=this[m],c=new n(a);return $traceurRuntime.schedule(function(){return b(c)}).then(function(a){c.done||c.decoratedObserver["return"](a)})["catch"](function(a){c.done||c.decoratedObserver["throw"](a)}),c.decoratedObserver},i(b.prototype,Symbol.observer,{enumerable:!1});var o=Symbol(),p=Symbol(),q=function(a,b){this[o]=a,this[p]=b};return $traceurRuntime.createClass(q,{next:function(a){var b=this[o].next(a);return void 0!==b&&b.done&&this[p].call(this),b},"throw":function(a){return this[p].call(this),this[o]["throw"](a)},"return":function(a){return this[p].call(this),this[o]["return"](a)}},{}),$traceurRuntime.initAsyncGeneratorFunction=c,$traceurRuntime.createAsyncGeneratorInstance=d,$traceurRuntime.observeForEach=e,$traceurRuntime.schedule=f,$traceurRuntime.createDecoratedGenerator=g,{}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/classes.js",[],function(){"use strict";function a(a,b){var c=n(a);do{var d=m(c,b);if(d)return d;c=n(c)}while(c);return void 0}function b(a){return a.__proto__}function c(b,c,d){var e=a(c,d);return e?e.get?e.get.call(b):e.value:void 0}function d(b,c,d,e){var f=a(c,d);if(f&&f.set)return f.set.call(b,e),e;throw i("super has no setter '"+d+"'.")}function e(a){for(var b={},c=p(a),d=0;d<c.length;d++){var e=c[d];b[e]=m(a,e)}for(var f=q(a),d=0;d<f.length;d++){var g=f[d];b[$traceurRuntime.toProperty(g)]=m(a,$traceurRuntime.toProperty(g))}return b}function f(a,b,c,d){return l(b,"constructor",{value:a,configurable:!0,enumerable:!1,writable:!0}),arguments.length>3?("function"==typeof d&&(a.__proto__=d),a.prototype=j(g(d),e(b))):a.prototype=b,l(a,"prototype",{configurable:!1,writable:!1}),k(a,e(c))}function g(a){if("function"==typeof a){var b=a.prototype;if(h(b)===b||null===b)return a.prototype;throw new i("super prototype must be an Object or null")}if(null===a)return null;throw new i("Super expression must either be null or a function, not "+typeof a+".")}var h=Object,i=TypeError,j=h.create,k=$traceurRuntime.defineProperties,l=$traceurRuntime.defineProperty,m=$traceurRuntime.getOwnPropertyDescriptor,n=($traceurRuntime.getOwnPropertyNames,Object.getPrototypeOf),o=Object,p=o.getOwnPropertyNames,q=o.getOwnPropertySymbols;return $traceurRuntime.createClass=f,$traceurRuntime.superConstructor=b,$traceurRuntime.superGet=c,$traceurRuntime.superSet=d,{}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/destructuring.js",[],function(){"use strict";function a(a){for(var b,c=[],d=0;!(b=a.next()).done;)c[d++]=b.value;return c}return $traceurRuntime.iteratorToArray=a,{}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/generators.js",[],function(){"use strict";function a(a){return{configurable:!0,enumerable:!1,value:a,writable:!0}}function b(a){return new Error("Traceur compiler bug: invalid state in state machine: "+a)}function c(){this.state=0,this.GState=r,this.storedException=void 0,this.finallyFallThrough=void 0,this.sent_=void 0,this.returnValue=void 0,this.oldReturnValue=void 0,this.tryStack_=[]}function d(a,b,c,d){switch(a.GState){case s:throw new Error('"'+c+'" on executing generator');case u:if("next"==c)return{value:void 0,done:!0};if(d===x)return{value:a.returnValue,done:!0};throw d;case r:if("throw"===c){if(a.GState=u,d===x)return{value:a.returnValue,done:!0};throw d}if(void 0!==d)throw q("Sent value to newborn generator");case t:a.GState=s,a.action=c,a.sent=d;var e;try{e=b(a)}catch(f){if(f!==x)throw f;e=a}var g=e===a;return g&&(e=a.returnValue),a.GState=g?u:t,{value:e,done:g}}}function e(){}function f(){}function g(a,b,d){var e=k(a,d),f=new c,g=p(b.prototype);return g[y]=f,g[z]=e,g}function h(a){return a.prototype=p(f.prototype),a.__proto__=f,a}function i(){c.call(this),this.err=void 0;var a=this;a.result=new Promise(function(b,c){a.resolve=b,a.reject=c})}function j(a,b){var c=k(a,b),d=new i;return d.createCallback=function(a){return function(b){d.state=a,d.value=b,c(d)}},d.errback=function(a){l(d,a),c(d)},c(d),d.result}function k(a,b){return function(c){for(;;)try{return a.call(b,c)}catch(d){l(c,d)}}}function l(a,b){a.storedException=b;var c=a.tryStack_[a.tryStack_.length-1];return c?(a.state=void 0!==c["catch"]?c["catch"]:c["finally"],void(void 0!==c.finallyFallThrough&&(a.finallyFallThrough=c.finallyFallThrough))):void a.handleException(b)}if("object"!=typeof $traceurRuntime)throw new Error("traceur runtime not found.");var m=$traceurRuntime.createPrivateName,n=$traceurRuntime.defineProperties,o=$traceurRuntime.defineProperty,p=Object.create,q=TypeError,r=0,s=1,t=2,u=3,v=-2,w=-3,x={};c.prototype={pushTry:function(a,b){if(null!==b){for(var c=null,d=this.tryStack_.length-1;d>=0;d--)if(void 0!==this.tryStack_[d]["catch"]){c=this.tryStack_[d]["catch"];break}null===c&&(c=w),this.tryStack_.push({"finally":b,finallyFallThrough:c})}null!==a&&this.tryStack_.push({"catch":a})},popTry:function(){this.tryStack_.pop()},maybeUncatchable:function(){if(this.storedException===x)throw x},get sent(){return this.maybeThrow(),this.sent_},set sent(a){this.sent_=a},get sentIgnoreThrow(){return this.sent_},maybeThrow:function(){if("throw"===this.action)throw this.action="next",this.sent_},end:function(){switch(this.state){case v:return this;case w:throw this.storedException;default:throw b(this.state)}},handleException:function(a){throw this.GState=u,this.state=v,a},wrapYieldStar:function(a){var b=this;return{next:function(b){return a.next(b)},"throw":function(c){var d;if(c===x){if(a["return"]){if(d=a["return"](b.returnValue),!d.done)return b.returnValue=b.oldReturnValue,d;b.returnValue=d.value}throw c}if(a["throw"])return a["throw"](c);throw a["return"]&&a["return"](),q("Inner iterator does not have a throw method")}}}};var y=m(),z=m();return e.prototype=f,o(f,"constructor",a(e)),f.prototype={constructor:f,next:function(a){return d(this[y],this[z],"next",a)},"throw":function(a){return d(this[y],this[z],"throw",a)},"return":function(a){return this[y].oldReturnValue=this[y].returnValue,this[y].returnValue=a,d(this[y],this[z],"throw",x)}},n(f.prototype,{constructor:{enumerable:!1},next:{enumerable:!1},"throw":{enumerable:!1},"return":{enumerable:!1}}),Object.defineProperty(f.prototype,Symbol.iterator,a(function(){return this})),i.prototype=p(c.prototype),i.prototype.end=function(){switch(this.state){case v:this.resolve(this.returnValue);break;case w:this.reject(this.storedException);break;default:this.reject(b(this.state))}},i.prototype.handleException=function(){this.state=w},$traceurRuntime.asyncWrap=j,$traceurRuntime.initGeneratorFunction=h,$traceurRuntime.createGeneratorInstance=g,{}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/relativeRequire.js",[],function(){"use strict";function a(a,c){function d(a){return"/"===a.slice(-1)}function e(a){return"/"===a[0]}function f(a){return"."===a[0]}return b=b||"undefined"!=typeof require&&require("path"),d(c)||e(c)?void 0:require(f(c)?b.resolve(b.dirname(a),c):c)}var b;return $traceurRuntime.require=a,{}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/spread.js",[],function(){"use strict";function a(){for(var a,b=[],c=0,d=0;d<arguments.length;d++){var e=$traceurRuntime.checkObjectCoercible(arguments[d]);if("function"!=typeof e[$traceurRuntime.toProperty(Symbol.iterator)])throw new TypeError("Cannot spread non-iterable object.");for(var f=e[$traceurRuntime.toProperty(Symbol.iterator)]();!(a=f.next()).done;)b[c++]=a.value}return b}return $traceurRuntime.spread=a,{}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/type-assertions.js",[],function(){"use strict";function a(a){for(var b=[],e=1;e<arguments.length;e++)b[e-1]=arguments[e];var f=d,g=$traceurRuntime.getOwnHashObject(a).hash;f[g]||(f[g]=Object.create(null)),f=f[g];for(var h=0;h<b.length-1;h++)g=$traceurRuntime.getOwnHashObject(b[h]).hash,f[g]||(f[g]=Object.create(null)),f=f[g];var i=b[b.length-1];return g=$traceurRuntime.getOwnHashObject(i).hash,f[g]||(f[g]=new c(a,b)),f[g]}var b={any:{name:"any"},"boolean":{name:"boolean"},number:{name:"number"},string:{name:"string"},symbol:{name:"symbol"},"void":{name:"void"}},c=function(a,b){this.type=a,this.argumentTypes=b};$traceurRuntime.createClass(c,{},{});var d=Object.create(null);return $traceurRuntime.GenericType=c,$traceurRuntime.genericType=a,$traceurRuntime.type=b,{}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/runtime-modules.js",[],function(){"use strict";return System.get("traceur-runtime@0.0.87/src/runtime/relativeRequire.js"),System.get("traceur-runtime@0.0.87/src/runtime/spread.js"),System.get("traceur-runtime@0.0.87/src/runtime/destructuring.js"),System.get("traceur-runtime@0.0.87/src/runtime/classes.js"),System.get("traceur-runtime@0.0.87/src/runtime/async.js"),System.get("traceur-runtime@0.0.87/src/runtime/generators.js"),System.get("traceur-runtime@0.0.87/src/runtime/type-assertions.js"),{}}),System.get("traceur-runtime@0.0.87/src/runtime/runtime-modules.js"),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js",[],function(){"use strict";function a(a){return a>>>0}function b(a){return a&&("object"==typeof a||"function"==typeof a)}function c(a){return"function"==typeof a}function d(a){return"number"==typeof a}function e(a){return a=+a,u(a)?0:0!==a&&t(a)?a>0?s(a):r(a):a}function f(a){var b=e(a);return 0>b?0:w(b,y)}function g(a){return b(a)?a[Symbol.iterator]:void 0}function h(a){return c(a)}function i(a,b){return{value:a,done:b}}function j(a,b,c){b in a||Object.defineProperty(a,b,c)}function k(a,b,c){j(a,b,{value:c,configurable:!0,enumerable:!1,writable:!0})}function l(a,b,c){j(a,b,{value:c,configurable:!1,enumerable:!1,writable:!1})}function m(a,b){for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];k(a,d,e)}}function n(a,b){for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];l(a,d,e)}}function o(a,b,c){c&&c.iterator&&!a[c.iterator]&&(a["@@iterator"]&&(b=a["@@iterator"]),Object.defineProperty(a,c.iterator,{value:b,configurable:!0,enumerable:!1,writable:!0}))}function p(a){z.push(a)}function q(a){z.forEach(function(b){return b(a)})}var r=Math.ceil,s=Math.floor,t=isFinite,u=isNaN,v=Math.pow,w=Math.min,x=$traceurRuntime.toObject,y=v(2,53)-1,z=[];return{get toObject(){return x},get toUint32(){return a},get isObject(){return b},get isCallable(){return c},get isNumber(){return d},get toInteger(){return e},get toLength(){return f},get checkIterable(){return g},get isConstructor(){return h},get createIteratorResultObject(){return i},get maybeDefine(){return j},get maybeDefineMethod(){return k},get maybeDefineConst(){return l},get maybeAddFunctions(){return m},get maybeAddConsts(){return n},get maybeAddIterator(){return o},get registerPolyfill(){return p},get polyfillAll(){return q}}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/Map.js",[],function(){"use strict";function a(a,b){if(e(b)){var c=h(b);return c&&a.objectIndex_[c.hash]}return"string"==typeof b?a.stringIndex_[b]:a.primitiveIndex_[b]}function b(a){a.entries_=[],a.objectIndex_=Object.create(null),a.stringIndex_=Object.create(null),a.primitiveIndex_=Object.create(null),a.deletedCount_=0}function c(a){var b=a,c=b.Object,d=b.Symbol;a.Map||(a.Map=k);var e=a.Map.prototype;void 0===e.entries&&(a.Map=k),e.entries&&(f(e,e.entries,d),f(c.getPrototypeOf((new a.Map).entries()),function(){return this},d))}var d=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js"),e=d.isObject,f=d.maybeAddIterator,g=d.registerPolyfill,h=$traceurRuntime.getOwnHashObject,i=Object.prototype.hasOwnProperty,j={},k=function(){var a,c,d=arguments[0];if(!e(this))throw new TypeError("Map called on incompatible type");if(i.call(this,"entries_"))throw new TypeError("Map can not be reentrantly initialised");if(b(this),null!==d&&void 0!==d){var f=!0,g=!1,h=void 0;try{for(var j=void 0,k=d[$traceurRuntime.toProperty(Symbol.iterator)]();!(f=(j=k.next()).done);f=!0){var l=j.value,m=(a=l[$traceurRuntime.toProperty(Symbol.iterator)](),(c=a.next()).done?void 0:c.value),n=(c=a.next()).done?void 0:c.value;this.set(m,n)}}catch(o){g=!0,h=o}finally{try{f||null==k["return"]||k["return"]()}finally{if(g)throw h}}}};return $traceurRuntime.createClass(k,{get size(){return this.entries_.length/2-this.deletedCount_},get:function(b){var c=a(this,b);return void 0!==c?this.entries_[c+1]:void 0},set:function(b,c){var d=e(b),f="string"==typeof b,g=a(this,b);if(void 0!==g)this.entries_[g+1]=c;else if(g=this.entries_.length,this.entries_[g]=b,this.entries_[g+1]=c,d){var i=h(b),j=i.hash;this.objectIndex_[j]=g}else f?this.stringIndex_[b]=g:this.primitiveIndex_[b]=g;return this},has:function(b){return void 0!==a(this,b)},"delete":function(a){var b,c,d=e(a),f="string"==typeof a;if(d){var g=h(a);g&&(b=this.objectIndex_[c=g.hash],delete this.objectIndex_[c])}else f?(b=this.stringIndex_[a],delete this.stringIndex_[a]):(b=this.primitiveIndex_[a],delete this.primitiveIndex_[a]);return void 0!==b?(this.entries_[b]=j,this.entries_[b+1]=void 0,this.deletedCount_++,!0):!1},clear:function(){b(this)},forEach:function(a){for(var b=arguments[1],c=0;c<this.entries_.length;c+=2){var d=this.entries_[c],e=this.entries_[c+1];d!==j&&a.call(b,e,d,this)}},entries:$traceurRuntime.initGeneratorFunction(function l(){var a,b,c;return $traceurRuntime.createGeneratorInstance(function(d){for(;;)switch(d.state){case 0:a=0,d.state=12;break;case 12:d.state=a<this.entries_.length?8:-2;break;case 4:a+=2,d.state=12;break;case 8:b=this.entries_[a],c=this.entries_[a+1],d.state=9;break;case 9:d.state=b===j?4:6;break;case 6:return d.state=2,[b,c];case 2:d.maybeThrow(),d.state=4;break;default:return d.end()}},l,this)}),keys:$traceurRuntime.initGeneratorFunction(function m(){var a,b,c;return $traceurRuntime.createGeneratorInstance(function(d){for(;;)switch(d.state){case 0:a=0,d.state=12;break;case 12:d.state=a<this.entries_.length?8:-2;break;case 4:a+=2,d.state=12;break;case 8:b=this.entries_[a],c=this.entries_[a+1],d.state=9;break;case 9:d.state=b===j?4:6;break;case 6:return d.state=2,b;case 2:d.maybeThrow(),d.state=4;break;default:return d.end()}},m,this)}),values:$traceurRuntime.initGeneratorFunction(function n(){var a,b,c;return $traceurRuntime.createGeneratorInstance(function(d){for(;;)switch(d.state){case 0:a=0,d.state=12;break;case 12:d.state=a<this.entries_.length?8:-2;break;case 4:a+=2,d.state=12;break;case 8:b=this.entries_[a],c=this.entries_[a+1],d.state=9;break;case 9:d.state=b===j?4:6;break;case 6:return d.state=2,c;case 2:d.maybeThrow(),d.state=4;break;default:return d.end()}},n,this)})},{}),Object.defineProperty(k.prototype,Symbol.iterator,{configurable:!0,writable:!0,value:k.prototype.entries}),g(c),{get Map(){return k},get polyfillMap(){return c}}}),System.get("traceur-runtime@0.0.87/src/runtime/polyfills/Map.js"),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/Set.js",[],function(){"use strict";function a(a){a.map_=new g}function b(a){var b=a,c=b.Object,d=b.Symbol;a.Set||(a.Set=i);var f=a.Set.prototype;f.values&&(e(f,f.values,d),e(c.getPrototypeOf((new a.Set).values()),function(){return this},d))}var c=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js"),d=c.isObject,e=c.maybeAddIterator,f=c.registerPolyfill,g=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/Map.js").Map,h=($traceurRuntime.getOwnHashObject,Object.prototype.hasOwnProperty),i=function(){var b=arguments[0];if(!d(this))throw new TypeError("Set called on incompatible type");if(h.call(this,"map_"))throw new TypeError("Set can not be reentrantly initialised");if(a(this),null!==b&&void 0!==b){var c=!0,e=!1,f=void 0;try{for(var g=void 0,i=b[$traceurRuntime.toProperty(Symbol.iterator)]();!(c=(g=i.next()).done);c=!0){var j=g.value;this.add(j)}}catch(k){e=!0,f=k}finally{try{c||null==i["return"]||i["return"]()}finally{if(e)throw f}}}};return $traceurRuntime.createClass(i,{get size(){return this.map_.size},has:function(a){return this.map_.has(a)},add:function(a){return this.map_.set(a,a),this},"delete":function(a){return this.map_["delete"](a)},clear:function(){return this.map_.clear()},forEach:function(a){var b=arguments[1],c=this;return this.map_.forEach(function(d,e){a.call(b,e,e,c)})},values:$traceurRuntime.initGeneratorFunction(function j(){var a,b;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:a=c.wrapYieldStar(this.map_.keys()[Symbol.iterator]()),c.sent=void 0,c.action="next",c.state=12;break;case 12:b=a[c.action](c.sentIgnoreThrow),c.state=9;break;case 9:c.state=b.done?3:2;break;case 3:c.sent=b.value,c.state=-2;break;case 2:return c.state=12,b.value;default:return c.end()}},j,this)}),entries:$traceurRuntime.initGeneratorFunction(function k(){var a,b;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:a=c.wrapYieldStar(this.map_.entries()[Symbol.iterator]()),c.sent=void 0,c.action="next",c.state=12;break;case 12:b=a[c.action](c.sentIgnoreThrow),c.state=9;break;case 9:c.state=b.done?3:2;break;case 3:c.sent=b.value,c.state=-2;break;case 2:return c.state=12,b.value;default:return c.end()}},k,this)})},{}),Object.defineProperty(i.prototype,Symbol.iterator,{configurable:!0,writable:!0,value:i.prototype.values}),Object.defineProperty(i.prototype,"keys",{configurable:!0,writable:!0,value:i.prototype.values}),f(b),{get Set(){return i},get polyfillSet(){return b}}}),System.get("traceur-runtime@0.0.87/src/runtime/polyfills/Set.js"),System.registerModule("traceur-runtime@0.0.87/node_modules/rsvp/lib/rsvp/asap.js",[],function(){"use strict";function a(a,b){m[h]=a,m[h+1]=b,h+=2,2===h&&g()}function b(){return function(){process.nextTick(f)}}function c(){var a=0,b=new k(f),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function d(){var a=new MessageChannel;return a.port1.onmessage=f,function(){a.port2.postMessage(0)}}function e(){return function(){setTimeout(f,1)}}function f(){for(var a=0;h>a;a+=2){var b=m[a],c=m[a+1];b(c),m[a]=void 0,m[a+1]=void 0}h=0}var g,h=0,i=a,j="undefined"!=typeof window?window:{},k=j.MutationObserver||j.WebKitMutationObserver,l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,m=new Array(1e3);return g="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?b():k?c():l?d():e(),{get default(){return i}}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/Promise.js",[],function(){"use strict";function a(a){return a&&"object"==typeof a&&void 0!==a.status_}function b(a){return a}function c(a){throw a}function d(a){var d=void 0!==arguments[1]?arguments[1]:b,f=void 0!==arguments[2]?arguments[2]:c,g=e(a.constructor);switch(a.status_){case void 0:throw TypeError;case 0:a.onResolve_.push(d,g),a.onReject_.push(f,g);break;case 1:k(a.value_,[d,g]);break;case-1:k(a.value_,[f,g])}return g.promise}function e(a){if(this===t){var b=g(new t(r));return{promise:b,resolve:function(a){h(b,a)},reject:function(a){i(b,a)}}}var c={};return c.promise=new a(function(a,b){c.resolve=a,c.reject=b}),c}function f(a,b,c,d,e){return a.status_=b,a.value_=c,a.onResolve_=d,a.onReject_=e,a}function g(a){return f(a,0,void 0,[],[])}function h(a,b){j(a,1,b,a.onResolve_)}function i(a,b){j(a,-1,b,a.onReject_)}function j(a,b,c,d){0===a.status_&&(k(c,d),f(a,b,c))}function k(a,b){p(function(){for(var c=0;c<b.length;c+=2)l(a,b[c],b[c+1])})}function l(b,c,e){try{var f=c(b);if(f===e.promise)throw new TypeError;a(f)?d(f,e.resolve,e.reject):e.resolve(f)}catch(g){try{e.reject(g)}catch(g){}}}function m(a){return a&&("object"==typeof a||"function"==typeof a)}function n(b,c){if(!a(c)&&m(c)){var d;try{d=c.then}catch(f){var g=u.call(b,f);return c[v]=g,g}if("function"==typeof d){var h=c[v];if(h)return h;var i=e(b);c[v]=i.promise;try{d.call(c,i.resolve,i.reject)}catch(f){i.reject(f)}return i.promise}}return c}function o(a){a.Promise||(a.Promise=s)}var p=System.get("traceur-runtime@0.0.87/node_modules/rsvp/lib/rsvp/asap.js")["default"],q=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js").registerPolyfill,r={},s=function(a){if(a!==r){if("function"!=typeof a)throw new TypeError;var b=g(this);try{a(function(a){h(b,a)},function(a){i(b,a)})}catch(c){i(b,c)}}};$traceurRuntime.createClass(s,{"catch":function(a){return this.then(void 0,a)},then:function(e,f){"function"!=typeof e&&(e=b),"function"!=typeof f&&(f=c);var g=this,h=this.constructor;return d(this,function(b){return b=n(h,b),b===g?f(new TypeError):a(b)?b.then(e,f):e(b)},f)}},{resolve:function(b){return this===t?a(b)?b:f(new t(r),1,b):new this(function(a){a(b)})},reject:function(a){return this===t?f(new t(r),-1,a):new this(function(b,c){
c(a)})},all:function(a){var b=e(this),c=[];try{var d=function(a){return function(d){c[a]=d,0===--f&&b.resolve(c)}},f=0,g=0,h=!0,i=!1,j=void 0;try{for(var k=void 0,l=a[$traceurRuntime.toProperty(Symbol.iterator)]();!(h=(k=l.next()).done);h=!0){var m=k.value,n=d(g);this.resolve(m).then(n,function(a){b.reject(a)}),++g,++f}}catch(o){i=!0,j=o}finally{try{h||null==l["return"]||l["return"]()}finally{if(i)throw j}}0===f&&b.resolve(c)}catch(p){b.reject(p)}return b.promise},race:function(a){var b=e(this);try{for(var c=0;c<a.length;c++)this.resolve(a[c]).then(function(a){b.resolve(a)},function(a){b.reject(a)})}catch(d){b.reject(d)}return b.promise}});var t=s,u=t.reject,v="@@thenable";return q(o),{get Promise(){return s},get polyfillPromise(){return o}}}),System.get("traceur-runtime@0.0.87/src/runtime/polyfills/Promise.js"),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/StringIterator.js",[],function(){"use strict";function a(a){var b=String(a),c=Object.create(j.prototype);return c[f(h)]=b,c[f(i)]=0,c}var b,c=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js"),d=c.createIteratorResultObject,e=c.isObject,f=$traceurRuntime.toProperty,g=Object.prototype.hasOwnProperty,h=Symbol("iteratedString"),i=Symbol("stringIteratorNextIndex"),j=function(){};return $traceurRuntime.createClass(j,(b={},Object.defineProperty(b,"next",{value:function(){var a=this;if(!e(a)||!g.call(a,h))throw new TypeError("this must be a StringIterator object");var b=a[f(h)];if(void 0===b)return d(void 0,!0);var c=a[f(i)],j=b.length;if(c>=j)return a[f(h)]=void 0,d(void 0,!0);var k,l=b.charCodeAt(c);if(55296>l||l>56319||c+1===j)k=String.fromCharCode(l);else{var m=b.charCodeAt(c+1);k=56320>m||m>57343?String.fromCharCode(l):String.fromCharCode(l)+String.fromCharCode(m)}return a[f(i)]=c+k.length,d(k,!1)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(b,Symbol.iterator,{value:function(){return this},configurable:!0,enumerable:!0,writable:!0}),b),{}),{get createStringIterator(){return a}}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/String.js",[],function(){"use strict";function a(a){var b=String(this);if(null==this||"[object RegExp]"==o.call(a))throw TypeError();var c=b.length,d=String(a),e=(d.length,arguments.length>1?arguments[1]:void 0),f=e?Number(e):0;isNaN(f)&&(f=0);var g=Math.min(Math.max(f,0),c);return p.call(b,d,f)==g}function b(a){var b=String(this);if(null==this||"[object RegExp]"==o.call(a))throw TypeError();var c=b.length,d=String(a),e=d.length,f=c;if(arguments.length>1){var g=arguments[1];void 0!==g&&(f=g?Number(g):0,isNaN(f)&&(f=0))}var h=Math.min(Math.max(f,0),c),i=h-e;return 0>i?!1:q.call(b,d,i)==i}function c(a){if(null==this)throw TypeError();var b=String(this);if(a&&"[object RegExp]"==o.call(a))throw TypeError();var c=b.length,d=String(a),e=d.length,f=arguments.length>1?arguments[1]:void 0,g=f?Number(f):0;g!=g&&(g=0);var h=Math.min(Math.max(g,0),c);return e+h>c?!1:-1!=p.call(b,d,g)}function d(a){if(null==this)throw TypeError();var b=String(this),c=a?Number(a):0;if(isNaN(c)&&(c=0),0>c||c==1/0)throw RangeError();if(0==c)return"";for(var d="";c--;)d+=b;return d}function e(a){if(null==this)throw TypeError();var b=String(this),c=b.length,d=a?Number(a):0;if(isNaN(d)&&(d=0),0>d||d>=c)return void 0;var e,f=b.charCodeAt(d);return f>=55296&&56319>=f&&c>d+1&&(e=b.charCodeAt(d+1),e>=56320&&57343>=e)?1024*(f-55296)+e-56320+65536:f}function f(a){var b=a.raw,c=b.length>>>0;if(0===c)return"";for(var d="",e=0;;){if(d+=b[e],e+1===c)return d;d+=arguments[++e]}}function g(){var a,b,c=[],d=Math.floor,e=-1,f=arguments.length;if(!f)return"";for(;++e<f;){var g=Number(arguments[e]);if(!isFinite(g)||0>g||g>1114111||d(g)!=g)throw RangeError("Invalid code point: "+g);65535>=g?c.push(g):(g-=65536,a=(g>>10)+55296,b=g%1024+56320,c.push(a,b))}return String.fromCharCode.apply(null,c)}function h(){var a=$traceurRuntime.checkObjectCoercible(this),b=String(a);return j(b)}function i(i){var j=i.String;l(j.prototype,["codePointAt",e,"endsWith",b,"includes",c,"repeat",d,"startsWith",a]),l(j,["fromCodePoint",g,"raw",f]),m(j.prototype,h,Symbol)}var j=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/StringIterator.js").createStringIterator,k=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js"),l=k.maybeAddFunctions,m=k.maybeAddIterator,n=k.registerPolyfill,o=Object.prototype.toString,p=String.prototype.indexOf,q=String.prototype.lastIndexOf;return n(i),{get startsWith(){return a},get endsWith(){return b},get includes(){return c},get repeat(){return d},get codePointAt(){return e},get raw(){return f},get fromCodePoint(){return g},get stringPrototypeIterator(){return h},get polyfillString(){return i}}}),System.get("traceur-runtime@0.0.87/src/runtime/polyfills/String.js"),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/ArrayIterator.js",[],function(){"use strict";function a(a,b){var c=g(a),d=new m;return d.iteratorObject_=c,d.arrayIteratorNextIndex_=0,d.arrayIterationKind_=b,d}function b(){return a(this,l)}function c(){return a(this,j)}function d(){return a(this,k)}var e,f=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js"),g=f.toObject,h=f.toUint32,i=f.createIteratorResultObject,j=1,k=2,l=3,m=function(){};return $traceurRuntime.createClass(m,(e={},Object.defineProperty(e,"next",{value:function(){var a=g(this),b=a.iteratorObject_;if(!b)throw new TypeError("Object is not an ArrayIterator");var c=a.arrayIteratorNextIndex_,d=a.arrayIterationKind_,e=h(b.length);return c>=e?(a.arrayIteratorNextIndex_=1/0,i(void 0,!0)):(a.arrayIteratorNextIndex_=c+1,d==k?i(b[c],!1):d==l?i([c,b[c]],!1):i(c,!1))},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(e,Symbol.iterator,{value:function(){return this},configurable:!0,enumerable:!0,writable:!0}),e),{}),{get entries(){return b},get keys(){return c},get values(){return d}}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/Array.js",[],function(){"use strict";function a(a){var b,c,d=arguments[1],e=arguments[2],f=this,g=u(a),h=void 0!==d,i=0;if(h&&!n(d))throw TypeError();if(m(g)){b=o(f)?new f:[];var j=!0,k=!1,l=void 0;try{for(var p=void 0,q=g[$traceurRuntime.toProperty(Symbol.iterator)]();!(j=(p=q.next()).done);j=!0){var r=p.value;b[i]=h?d.call(e,r,i):r,i++}}catch(s){k=!0,l=s}finally{try{j||null==q["return"]||q["return"]()}finally{if(k)throw l}}return b.length=i,b}for(c=t(g.length),b=o(f)?new f(c):new Array(c);c>i;i++)b[i]=h?"undefined"==typeof e?d(g[i],i):d.call(e,g[i],i):g[i];return b.length=c,b}function b(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var c=this,d=a.length,e=o(c)?new c(d):new Array(d),f=0;d>f;f++)e[f]=a[f];return e.length=d,e}function c(a){var b=void 0!==arguments[1]?arguments[1]:0,c=arguments[2],d=u(this),e=t(d.length),f=s(b),g=void 0!==c?s(c):e;for(f=0>f?Math.max(e+f,0):Math.min(f,e),g=0>g?Math.max(e+g,0):Math.min(g,e);g>f;)d[f]=a,f++;return d}function d(a){var b=arguments[1];return f(this,a,b)}function e(a){var b=arguments[1];return f(this,a,b,!0)}function f(a,b){var c=arguments[2],d=void 0!==arguments[3]?arguments[3]:!1,e=u(a),f=t(e.length);if(!n(b))throw TypeError();for(var g=0;f>g;g++){var h=e[g];if(b.call(c,h,g,e))return d?g:h}return d?-1:void 0}function g(f){var g=f,h=g.Array,l=g.Object,m=g.Symbol,n=k;m&&m.iterator&&h.prototype[m.iterator]&&(n=h.prototype[m.iterator]),p(h.prototype,["entries",i,"keys",j,"values",n,"fill",c,"find",d,"findIndex",e]),p(h,["from",a,"of",b]),q(h.prototype,n,m),q(l.getPrototypeOf([].values()),function(){return this},m)}var h=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/ArrayIterator.js"),i=h.entries,j=h.keys,k=h.values,l=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js"),m=l.checkIterable,n=l.isCallable,o=l.isConstructor,p=l.maybeAddFunctions,q=l.maybeAddIterator,r=l.registerPolyfill,s=l.toInteger,t=l.toLength,u=l.toObject;return r(g),{get from(){return a},get of(){return b},get fill(){return c},get find(){return d},get findIndex(){return e},get polyfillArray(){return g}}}),System.get("traceur-runtime@0.0.87/src/runtime/polyfills/Array.js"),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/Object.js",[],function(){"use strict";function a(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}function b(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],d=null==c?[]:m(c),e=void 0,f=d.length;for(e=0;f>e;e++){var g=d[e];l(g)||(a[g]=c[g])}}return a}function c(a,b){var c,d,e=k(b),f=e.length;for(c=0;f>c;c++){var g=e[c];l(g)||(d=j(b,e[c]),i(a,e[c],d))}return a}function d(d){var e=d.Object;f(e,["assign",b,"is",a,"mixin",c])}var e=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js"),f=e.maybeAddFunctions,g=e.registerPolyfill,h=$traceurRuntime,i=h.defineProperty,j=h.getOwnPropertyDescriptor,k=h.getOwnPropertyNames,l=h.isPrivateName,m=h.keys;return g(d),{get is(){return a},get assign(){return b},get mixin(){return c},get polyfillObject(){return d}}}),System.get("traceur-runtime@0.0.87/src/runtime/polyfills/Object.js"),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/Number.js",[],function(){"use strict";function a(a){return g(a)&&m(a)}function b(b){return a(b)&&k(b)===b}function c(a){return g(a)&&n(a)}function d(b){if(a(b)){var c=k(b);if(c===b)return l(c)<=o}return!1}function e(e){var f=e.Number;h(f,["MAX_SAFE_INTEGER",o,"MIN_SAFE_INTEGER",p,"EPSILON",q]),i(f,["isFinite",a,"isInteger",b,"isNaN",c,"isSafeInteger",d])}var f=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js"),g=f.isNumber,h=f.maybeAddConsts,i=f.maybeAddFunctions,j=f.registerPolyfill,k=f.toInteger,l=Math.abs,m=isFinite,n=isNaN,o=Math.pow(2,53)-1,p=-Math.pow(2,53)+1,q=Math.pow(2,-52);return j(e),{get MAX_SAFE_INTEGER(){return o},get MIN_SAFE_INTEGER(){return p},get EPSILON(){return q},get isFinite(){return a},get isInteger(){return b},get isNaN(){return c},get isSafeInteger(){return d},get polyfillNumber(){return e}}}),System.get("traceur-runtime@0.0.87/src/runtime/polyfills/Number.js"),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/fround.js",[],function(){"use strict";function a(a,b,c){function d(a){var b=k(a),c=a-b;return.5>c?b:c>.5?b+1:b%2?b+1:b}var e,f,g,h,o,p,q,r=(1<<b-1)-1;for(a!==a?(f=(1<<b)-1,g=n(2,c-1),e=0):a===1/0||a===-(1/0)?(f=(1<<b)-1,g=0,e=0>a?1:0):0===a?(f=0,g=0,e=1/a===-(1/0)?1:0):(e=0>a,a=j(a),a>=n(2,1-r)?(f=m(k(l(a)/i),1023),g=d(a/n(2,f)*n(2,c)),g/n(2,c)>=2&&(f+=1,g=1),f>r?(f=(1<<b)-1,g=0):(f+=r,g-=n(2,c))):(f=0,g=d(a/n(2,1-r-c)))),o=[],h=c;h;h-=1)o.push(g%2?1:0),g=k(g/2);for(h=b;h;h-=1)o.push(f%2?1:0),f=k(f/2);for(o.push(e?1:0),o.reverse(),p=o.join(""),q=[];p.length;)q.push(parseInt(p.substring(0,8),2)),p=p.substring(8);return q}function b(a,b,c){var d,e,f,g,h,i,j,k,l=[];for(d=a.length;d;d-=1)for(f=a[d-1],e=8;e;e-=1)l.push(f%2?1:0),f>>=1;return l.reverse(),g=l.join(""),h=(1<<b-1)-1,i=parseInt(g.substring(0,1),2)?-1:1,j=parseInt(g.substring(1,1+b),2),k=parseInt(g.substring(1+b),2),j===(1<<b)-1?0!==k?0/0:i*(1/0):j>0?i*n(2,j-h)*(1+k/n(2,c)):0!==k?i*n(2,-(h-1))*(k/n(2,c)):0>i?-0:0}function c(a){return b(a,8,23)}function d(b){return a(b,8,23)}function e(a){return 0===a||!f(a)||g(a)?a:c(d(Number(a)))}var f=isFinite,g=isNaN,h=Math,i=h.LN2,j=h.abs,k=h.floor,l=h.log,m=h.min,n=h.pow;return{get fround(){return e}}}),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/Math.js",[],function(){"use strict";function a(a){if(a=x(+a),0==a)return 32;var b=0;return 0===(4294901760&a)&&(a<<=16,b+=16),0===(4278190080&a)&&(a<<=8,b+=8),0===(4026531840&a)&&(a<<=4,b+=4),0===(3221225472&a)&&(a<<=2,b+=2),0===(2147483648&a)&&(a<<=1,b+=1),b}function b(a,b){a=x(+a),b=x(+b);var c=a>>>16&65535,d=65535&a,e=b>>>16&65535,f=65535&b;return d*f+(c*f+d*e<<16>>>0)|0}function c(a){return a=+a,a>0?1:0>a?-1:a}function d(a){return.4342944819032518*F(a)}function e(a){return 1.4426950408889634*F(a)}function f(a){if(a=+a,-1>a||z(a))return 0/0;if(0===a||a===1/0)return a;if(-1===a)return-(1/0);var b=0,c=50;if(0>a||a>1)return F(1+a);for(var d=1;c>d;d++)d%2===0?b-=G(a,d)/d:b+=G(a,d)/d;return b}function g(a){return a=+a,a===-(1/0)?-1:y(a)&&0!==a?D(a)-1:a}function h(a){return a=+a,0===a?1:z(a)?0/0:y(a)?(0>a&&(a=-a),a>21?D(a)/2:(D(a)+D(-a))/2):1/0}function i(a){return a=+a,y(a)&&0!==a?(D(a)-D(-a))/2:a}function j(a){if(a=+a,0===a)return a;if(!y(a))return c(a);var b=D(a),d=D(-a);return(b-d)/(b+d)}function k(a){return a=+a,1>a?0/0:y(a)?F(a+H(a+1)*H(a-1)):a}function l(a){return a=+a,0!==a&&y(a)?a>0?F(a+H(a*a+1)):-F(-a+H(a*a+1)):a}function m(a){return a=+a,-1===a?-(1/0):1===a?1/0:0===a?a:z(a)||-1>a||a>1?0/0:.5*F((1+a)/(1-a))}function n(){for(var a=arguments.length,b=new Array(a),c=0,d=0;a>d;d++){var e=arguments[d];if(e=+e,e===1/0||e===-(1/0))return 1/0;e=B(e),e>c&&(c=e),b[d]=e}0===c&&(c=1);for(var f=0,g=0,d=0;a>d;d++){var e=b[d]/c,h=e*e-g,i=f+h;g=i-f-h,f=i}return H(f)*c}function o(a){return a=+a,a>0?E(a):0>a?C(a):a}function p(a){if(a=+a,0===a)return a;var b=0>a;b&&(a=-a);var c=G(a,1/3);return b?-c:c}function q(q){var s=q.Math;v(s,["acosh",k,"asinh",l,"atanh",m,"cbrt",p,"clz32",a,"cosh",h,"expm1",g,"fround",r,"hypot",n,"imul",b,"log10",d,"log1p",f,"log2",e,"sign",c,"sinh",i,"tanh",j,"trunc",o])}var r,s,t=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/fround.js").fround,u=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js"),v=u.maybeAddFunctions,w=u.registerPolyfill,x=u.toUint32,y=isFinite,z=isNaN,A=Math,B=A.abs,C=A.ceil,D=A.exp,E=A.floor,F=A.log,G=A.pow,H=A.sqrt;return"function"==typeof Float32Array?(s=new Float32Array(1),r=function(a){return s[0]=Number(a),s[0]}):r=t,w(q),{get clz32(){return a},get imul(){return b},get sign(){return c},get log10(){return d},get log2(){return e},get log1p(){return f},get expm1(){return g},get cosh(){return h},get sinh(){return i},get tanh(){return j},get acosh(){return k},get asinh(){return l},get atanh(){return m},get hypot(){return n},get trunc(){return o},get fround(){return r},get cbrt(){return p},get polyfillMath(){return q}}}),System.get("traceur-runtime@0.0.87/src/runtime/polyfills/Math.js"),System.registerModule("traceur-runtime@0.0.87/src/runtime/polyfills/polyfills.js",[],function(){"use strict";var a=System.get("traceur-runtime@0.0.87/src/runtime/polyfills/utils.js").polyfillAll;a(Reflect.global);var b=$traceurRuntime.setupGlobals;return $traceurRuntime.setupGlobals=function(c){b(c),a(c)},{}}),System.get("traceur-runtime@0.0.87/src/runtime/polyfills/polyfills.js"),function(){"use strict";function a(){var a=document.createElement("div");document.body.appendChild(a),angular.bootstrap(a,["castifyExt.bgApp"],{strictDi:!1})}window.angular&&angular.module("w69b.es6",[]),Array.prototype.find||(Array.prototype.find=function(a){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;d>f;f++)if(b=c[f],a.call(e,b,f,c))return b;return void 0}),Array.prototype.contains||Object.defineProperty(Array.prototype,"contains",{enumerable:!1,configurable:!0,writable:!0,value:function(a){if(void 0===this||null===this)throw new TypeError("Cannot convert this value to object");var b=Object(this),c=parseInt(b.length,10)||0;if(0===c)return!1;var d=parseInt(arguments[1],10)||0;if(d>=c)return!1;var e;for(d>=0?e=d:(e=c+d,0>e&&(e=0));c>e;){var f=b[e];if(a===f||a!==a&&f!==f)return!0;e++}return!1}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(a,b){var c=this.toString();(void 0===b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return-1!==d&&d===b}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){return b=b||0,this.lastIndexOf(a,b)===b}}),angular.module("castifyExt.commonConfig",["castifyExt.castifyAuth","w69b.analytics","w69b.chromeRuntime","castifyExt.licensing","castifyExt.helpCenterConfig"]).config(["$compileProvider","$sceDelegateProvider","analyticsProvider",function(a,b,c){c.setTrackingId("UA-23874345-14"),b.resourceUrlWhitelist(["self","http://localhost:9008/**","blob:**","filesystem:chrome-extension://**","https://**"]);var d=/^\s*(https?|mailto|blob|chrome-extension|filesystem:chrome-extension):/;a.aHrefSanitizationWhitelist(d),a.imgSrcSanitizationWhitelist(d)}]).run(["$rootScope","analytics","chromeRuntime","licensing","$location",function(a,b,c,d,e){b.setEnabled(!1),b.loadLib(),b.callInternal(["set","dimension3","ext"]),b.callInternal(["set","dimension2",c.getManifest().version]);var f;a.$on("$viewContentLoaded",function(){var c=e.path();b.set("title",a.pageTitle),b.trackPageView(c),f=c}),a.$watch(function(){return d.hasLicense()?d.isPaid()?"paid":d.isTester()?"tester":"trial":"unknown"},function(a){b.callInternal(["set","dimension1",a])})}]).value("castifyConfig",{API_URL:"https://www.screencastify.com/api"}),angular.module("castifyExt.authConfig",["castifyExt.youtubeAuth","castifyExt.castifyAuth","w69b.chromeRuntime","w69b.googleHttpAuthInterceptor"]).config(["$httpProvider","youtubeAuthProvider","castifyAuthProvider","googleHttpAuthInterceptorProvider",function(a,b,c,d){var e="242262968495-o42n5tqeo08dsa75p3j4dk1k61t05ln3.apps.googleusercontent.com";b.setClientId(e),c.setClientId(e),c.setScopes(chrome.runtime.getManifest().oauth2.scopes),c.useChromeAccount(!0),c.setRedirectUri("https://www.screencastify.com/oauth2postback"),a.interceptors.push("youtubeHttpAuthInterceptor"),a.interceptors.push("googleHttpAuthInterceptor"),d.enableAuthAutoRetry(!0),d.setAuthProvider("castifyAuth")}]).run(["castifyAuth","chromeRuntime","$rootScope",function(a,b,c){a.onSignInChanged.addListener(function(){c.$evalAsync(function(){c.$broadcast("event:signInChanged"),b.sendMessage({type:"event:signInChanged"})})})}]),angular.module("castiy.audioStreamMixer",["castifyExt.audioContextPool"]).factory("audioStreamMixer",["audioContextPool",function(a){function b(){var b=a.acquire(),c=b.createMediaStreamDestination(),d={},e={},f={};return f.addStream=function(a,f){var g=b.createMediaStreamSource(f),h=b.createGain();e[a]=g,d[a]=h,g.connect(h),h.connect(c)},f.replaceStream=function(a,c){var g=e[a];g||f.addStream(a,c),g.disconnect();var h=b.createMediaStreamSource(c);h.connect(d[a])},f.setGain=function(a,b){d[a].gain.value=b},f.outStream=c.stream,f.dispose=function(){f.outStream.stop(),c.disconnect(),angular.forEach(d,function(a){a.disconnect()}),angular.forEach(e,function(a){a.disconnect()}),a.release(b)},f}return b}]),angular.module("castifyExt.chromeVideoRecorder",["w69b.pnaclVideoEncoder","castifyExt.tabMouse","w69b.webrtc","w69b.chromeCapture","castifyExt.resizeTab","w69b.chromeTabs","castiy.audioStreamMixer","castifyExt.requestMicPermission"]).provider("chromeVideoRecorder",function(){var a="/components/castify/pnacl/manifest_pnacl.nmf",b=!0,c=!1;this.setEncoderUrl=function(c,d){a=c,b=!!d},this.$get=["$log","pnaclVideoEncoder","webrtc","chromeCapture","$q","createTabMouse","resizeTab","chromeTabs","audioStreamMixer","$interval","$rootScope","requestMicPermission",function(d,e,f,g,h,i,j,k,l,m,n,o){function p(){d.warn("video stream ended while still recording"),n.$broadcast("chromeVideoRecorder:streamEnded")}function q(){F&&F.dispose(),F=null,G.video&&G.video.removeEventListener("ended",p),angular.forEach(G,function(a){a.stop()}),G={},D&&(I.pause(),I.src="",URL.revokeObjectURL(D),D=null),E&&(URL.revokeObjectURL(E),E=null)}function r(a){G.video&&(G.video.removeEventListener("ended",p),G.video.stop()),G.video=a,a.addEventListener("ended",p),D&&URL.revokeObjectURL(D),D=URL.createObjectURL(a)}function s(a){E&&URL.revokeObjectURL(E),E=URL.createObjectURL(a)}function t(a){function b(b){var c={audio:w(a),video:{mandatory:{minHeight:b.height,maxWidth:e.width,maxHeight:e.height}}};return a.camSourceId&&(c.video.mandatory.sourceId=a.camSourceId),f.getUserMedia(c)}function c(a){var e=g[a];return d.debug("trying webcam resolution ",e),b(e)["catch"](function(b){return d.debug("webcam resolution failed",b),!b||"PermissionDeniedError"!==b.name&&"InvalidStateError"!==b.name?a+1<g.length&&b&&("TrackStartError"===b.name||"ConstraintNotSatisfiedError"===b.name)?(d.debug("webcam resolution not supported, trying next"),c(a+1)):(d.warn("no supported webcam resolution found",b&&b.name),h.reject(b)):o().then(function(){return c(a)})})}var e=a.resolution;e||(e={width:4096,height:4096});var g=J.filter(function(a){return a.height<=e.height});return a.resolution&&(g=g.filter(function(a){return a.height!==e.height}),g.unshift(e)),c(0)}function u(a){return a?a:h.reject("stream is null")}function v(a){var b=a.resolution;b||(b={width:4096,height:4096});var d=a.audio.system;if("desktop"==a.captureSource){c=!0;var e=g.chooseDesktopMedia(["screen","window"]).then(function(c){if(!c)return h.reject("cancelled");var e={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:c,maxWidth:b.width,maxHeight:b.height,maxFrameRate:a.targetFPS}}};return d&&(e.audio={mandatory:{chromeMediaSource:"system"}}),f.getUserMedia(e).then(u)});return e["finally"](function(){c=!1}),e}if("tab"==a.captureSource){var i={video:!0,videoConstraints:{mandatory:{maxWidth:b.width,maxHeight:b.height,maxFrameRate:a.targetFPS}},audio:d};return d&&(i.audioConstraints={mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}}),g.tabCapture(i).then(u)}if("cam"==a.captureSource)return t(a).then(u);throw Error()}function w(a){return a.audio.mic?a.audio.micSourceId?{mandatory:{sourceId:a.audio.micSourceId}}:!0:!1}function x(a){function b(){return f.getUserMedia({audio:w(a),video:c})["catch"](function(a){return d.debug("capture mic failed",a&&a.name),h.reject(a)})}var c=!!a.embedWebcam;return c&&a.camSourceId&&(c={mandatory:{sourceId:a.camSourceId}}),b()["catch"](function(){return d.debug("requesting mic permission"),o().then(b)})}function y(){C&&(C.dispose(),C=null),q()}function z(a){var b=a.audio.system&&"tab"==a.captureSource;b&&(I.src=D,I.volume=1,I.play())}function A(a){var b=a.width%16,c=a.height%16;return b||c?(a.width-=b,a.height-=c,!0):!1}var B,C,D,E,F,G={},H=e(a,b),I=document.createElement("video"),J=[{width:1920,height:1080},{width:1280,height:720},{width:854,height:480},{width:640,height:360},{width:320,height:240},{width:320,height:180}],K={};return H.onCrash=function(a){d.warn("video encoder crashed",a),y(),n.$broadcast("chromeVideoRecorder:crash",a)},H.onError=function(a){"start_timeout"!==a&&(y(),n.$broadcast("chromeVideoRecorder:error",a))},K.start=function(a){function b(){if("tab"===a.captureSource){var b=k.get(a.tabId);return b.then(function(b){return a.resolution||(a.resolution={width:b.width,height:b.height}),A(a.resolution),A(b)?j(a.tabId,b.width,b.height,!1):void 0})}return null}a.mouse=a.mouse||{enable:!0},a.targetFPS=a.targetFPS||25,"cam"===a.captureSource&&(a.audio.system=!1,a.embedWebcam=!1),B=a;var c;if(!a.filename)throw new Error("filename required");a.audio||(a.audio={});var e={};return h.all([H.load(),b()]).then(function(){return d.debug("getting video stream"),v(a)["catch"](function(a){return d.warn("could not get video stream",a),h.reject(a)})}).then(function(a){d.debug("got video stream"),r(a),c=a}).then(function(){return"tab"===a.captureSource?k.get(a.tabId).then(function(a){e.originalMainSize={width:a.width,height:a.height}}):null}).then(function(){return a.audio.mic?"cam"===a.captureSource?c:x(a):null}).then(function(b){d.debug("got all streams"),e.videoTrack=c.getVideoTracks()[0],a.audio.system&&!c.getAudioTracks().length&&(a.audio.system=!1,d.warn("failed to capture system audio - stream has no audio track."),n.$broadcast("chromeVideoRecorder:systemAudioUnsupported")),(a.audio.system||a.audio.mic)&&(F=l(),e.audioTrack=F.outStream.getAudioTracks()[0]),b&&(F.addStream("mic",b),F.setGain("mic",a.audio.micGain||1),G.mic=b),a.audio.system&&F.addStream("system",c),a.embedWebcam&&b&&b.getVideoTracks().length&&(e.camTrack=b.getVideoTracks()[0],e.camPosition=a.camPosition,s(b)),d.debug("staring encoder...");var f=H.start("/html5_persistent/"+a.filename,e);return"tab"==a.captureSource&&a.mouse.enable&&(C=i(a.tabId),C.setMouse(a.mouse)),z(a),f}).then(function(){d.debug("recording started")},function(a){return d.error("recording start error",a),y(),h.reject(a)})},K.stop=function(){return C&&(C.dispose(),C=null),H.stop()["finally"](function(){q()})},K.pause=function(){return H.pause()},K.resume=function(){return H.resume()},K.setMicGain=function(a){F&&F.setGain("mic",a)},K.getState=function(){return H.getState()},K.getStateObj=function(){return angular.extend({},H.getStateObj(),{videoUrl:D,cameraUrl:E,isDesktopDialogShown:c})},K.getCurrentTime=function(){return H.getCurrentTime()},K.getRecordingConfig=function(){return B},K.replaceStream=function(a){var b=B.audio.system,c=angular.extend({},B,a);return v(c).then(function(a){B=c,C&&(C.dispose(),C=i(c.tabId),C.setMouse(c.mouse));var d={videoTrack:a.getVideoTracks()[0]};b&&F.replaceStream("system",a),H.replaceTracks(d).then(function(){r(a),z(c)})},function(a){return d.warn("could not get replacement stream",a),h.reject(a)})},K}]}),angular.module("castifyExt.fileNameGenerator",["w69b.filesHelper","w69b.uuid"]).factory("fileNameGenerator",["uuid","filesHelper",function(a,b){return function(c,d){function e(){return c+a()+d}function f(){var a=e();return b.getFileEntryByPath(a).then(function(){return f()},function(){return a})}return c||(c=""),d||(d=""),f()}}]),angular.module("castifyExt.appOptions",["w69b.chromeStorage","castifyExt.enterprisePolicy"]).factory("appOptions",["chromeStorage","$rootScope","$q","enterprisePolicy",function(a,b,c,d){var e={notifyAudio:!0,notifyFramerate:!1,notifyTabFocus:!0,uploadPrivacy:"public",autoOpen:!0,driveSync:!1,enableDiskSpaceWatcher:!0,notifySyncProgress:!0,notifyEditProgress:!0},f={micGain:1},g=!1,h={},i=angular.copy(e);return h.localValues=angular.copy(f),h.loadedPromise=c.all({sync:a.sync.getSingle("options"),local:a.local.getSingle("options"),managed:d.loadedPromise}).then(function(a){angular.extend(i,a.sync),angular.extend(h.localValues,a.local),g=!0}),h.values={},Object.keys(e).forEach(function(a){Object.defineProperty(h.values,a,{enumerable:!0,get:function(){return d.options&&d.options.hasOwnProperty(a)?d.options[a]:i[a]},set:function(b){i[a]=b}})}),h.save=function(){return a.sync.setSingle("options",i)},h.saveLocal=function(){return a.local.setSingle("options",h.localValues)},h.isLoaded=function(){return g},h.isSetByEnterprisePolicy=function(a){return d.options&&d.options.hasOwnProperty(a)},a.onChanged.addListener(function(a,c){"sync"==c&&a.options&&(angular.extend(i,a.options.newValue),b.$$phase||b.$digest()),"local"==c&&a.options&&(angular.extend(h.localValues,a.options.newValue),b.$$phase||b.$digest())}),h}]),angular.module("castifyExt.bgRecord",["castifyExt.chromeVideoRecorder","w69b.chromeTabs","castifyExt.bgFiles","w69b.analytics","castifyExt.appOptions","castifyExt.recordTool","castifyExt.fileNameGenerator","w69b.chromeCommands","w69b.chromeStorage","w69b.chromeWindows","castifyExt.crashReporter","w69b.chromeNotifications","castifyExt.helpCenter"]).factory("bgRecordService",["chromeVideoRecorder","$rootScope","$q","$log","chromeRuntime","chromeTabs","$window","analytics","appOptions","recordTool","fileNameGenerator","chromeCommands","bgFiles","chromeStorage","chromeWindows","crashReporter","chromeNotifications","helpCenter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(a){return{path:{19:"images/"+a+"19.png",38:"images/"+a+"38.png"}}}function t(a){if(V)throw new Error("already blocked");return V=!0,a["finally"](function(){V=!1}),a}function u(a,b){d.warn("recorder_fatal_error",b),h.trackEvent("recorder","fatal_error",b),A(),"out_of_disk_space"===b?r.setNotifyHelp(q.simple.create({priority:1,title:"Out of disk space",message:"Recording was stopped forcefully. Your recording might be corrupted.",buttons:[{title:"Help"}]},"disk_space")):q.simple.create({priority:1,title:"Ops, something went wrong",message:"Please try to restart Chrome if this problem persists."})}function v(a,b){if("load_timeout"===a)r.setNotifyHelp(q.simple.create({priority:1,title:"Failed to load NaCl module",message:"Click for help",buttons:[{title:"Help"}]}),"load_nacl");else{var c="tab"===b.captureSource?"Please try to re-open the tab you are trying to record.":"Please try to restart your computer if this problem persists";r.setNotifyHelp(q.simple.create({priority:1,title:"Failed to start recording",message:c,buttons:[{title:"Help"}]}),"start_recording")}}function w(a,b){p.report("encoder",b),h.trackEvent("recorder","fatal_error","crash"),A(),q.simple.create({priority:2,title:"Encoder crashed",message:"Ops, the video encoder crashed. This should not have happened. Please submit a bug report."},"crash")}function x(a,b){U.forEach(function(c){c.postMessage({type:a,data:b})})}function y(b){var c;b||(b=a.getState()),c="paused"===b?"icon_paused":"recording"===b?"icon_recording":"icon",chrome.browserAction.setIcon(s(c))}function z(b){if(U.length){var c=angular.copy(a.getStateObj());angular.extend(c,b),c.config=a.getRecordingConfig(),c.previewShown=!!S,c.isBlocked=V,x("stateUpdate",c)}}function A(){d.debug("cleaning up after fatal error stop"),f.onActivated.removeListener(M),P(),V=!1,B()}function B(){d.debug("stopped"),z(),y();var c=a.getRecordingConfig().filename;b.$broadcast("recorder:stopped",m.localFilenameToId(c))}function C(){V||"inactive"===a.getState()||(f.onActivated.removeListener(M),P(),d.debug("stopping..."),t(a.stop())["finally"](B),K(),z(),y(),R.send(),h.trackEvent("recorder","control","stop"))}function D(){if(!V&&"recording"===a.getState()){d.debug("pausing...");var b=a.pause();t(b),b["finally"](function(){d.debug("paused"),z(),y()}),q.clear("activeTab"),z(),h.trackEvent("recorder","control","pause")}}function E(){V||"paused"!==a.getState()||(d.debug("resuming..."),t(a.resume())["finally"](function(){d.debug("resumed"),z(),y()}),f.getActiveTab().then(function(a){M({tabId:a.id,windowId:a.windowId})}),h.trackEvent("recorder","control","resume"))}function F(e){function g(){return e.filename?c.when():k("",".webm").then(function(a){e.filename=a})}if(!V&&"inactive"===a.getState()){f.onActivated.addListener(M),h.trackEvent("recorder","control","start"),h.trackEvent("recorder","captureSource",e.captureSource),R=h.trackTimer("recorder","duration"),e.audio.micGain=i.localValues.micGain,d.debug("starting...",e);var j=g().then(function(){return a.start(e)});t(j),j.then(function(){var a=m.localFilenameToId(e.filename);d.debug("started recording",a),z(),y(),e.showPreview&&Q(),b.$broadcast("recorder:started",a)},function(a){return"cancelled"!==a?(z({startError:a}),h.trackEvent("recorder","startError",a),v(a,e),c.reject(a)):void z()}),z()}}function G(){h.trackEvent("recorder","notify","streamEnded"),q.simple.create({priority:1,title:"Your recording has stopped forcefully",message:"If it was your intention to stop recording, you can safely ignore this warning."}),C()}function H(){h.trackEvent("recorder","notify","streamEnded"),q.simple.create({priority:1,title:"Not recording system audio",message:"Capturing system audio is only supported for full-screen or tab recording."},"noSystemAudio")}function I(b){if(!V){if(d.debug("replacing stream...",b),"inactive"===a.getState())return void d.error("cannot replace tab while not recording");q.clear("activeTab"),h.trackEvent("recorder","control","replaceStream"),t(a.replaceStream(b))["finally"](z),z()}}function J(a){if("recorder"==a.name){U.push(a),z(),a.onDisconnect.addListener(function(){var b=U.indexOf(a);b>=0&&U.splice(b,1)});var c={start:F,stop:C,replaceStream:I,pause:D,resume:E,showPreview:function(a){a?Q():P()}};a.onMessage.addListener(function(a){c.hasOwnProperty(a.type)&&c[a.type](a.data),b.$$phase||b.$digest()})}}function K(){q.clear("audioDropped"),q.clear("lowFrameRate"),q.clear("activeTab"),q.clear("noSystemAudio")}function L(b){if(!V){var d=a.getState();if("toggle-recording"==b)"recording"===d||"paused"===d?C():c.all({
tab:f.getActiveTab(),config:j.getRecordConfig()}).then(function(a){var b=a.config;b.tabId=a.tab.id,b.windowId=a.tab.windowId,b.tabTitle=a.tab.title,b.resolution=j.getResolutionLimit(b,a.tab),F(b)});else if("toggle-pause"==b)"paused"===d?E():"recording"===d&&D();else if("focus-tab"==b){var e=a.getRecordingConfig();if("inactive"===d||"tab"!==e.captureSource)return;f.getActiveTab().then(function(a){e.tabId!=a.id&&I({tabId:a.id,windowId:a.windowId,tabTitle:a.title})})}}}function M(b){var c=a.getRecordingConfig();"recording"===a.getState()&&i.values.notifyTabFocus&&"tab"==c.captureSource&&b.windowId==c.windowId&&(b.tabId!==c.tabId?(d.debug("recording tab lost focus"),l.getAll().then(function(a){for(var b=0;b<a.length;++b)if("focus-tab"==a[b].name)return a[b];return null}).then(function(a){var b="Screencastify is recording a tab in the background. Use the extension icon to switch the record focus to your current tab.";a&&a.shortcut&&(b+=" You can also use the keyboard shortcut "+a.shortcut+"."),q.simple.create({priority:2,title:"Recording a background tab",message:b},"activeTab")})):(d.debug("recording tab got focus"),q.clear("activeTab")))}function N(){var b=!1;T.$watchCollection(a.getStateObj,function(){z()}),T.$watch(function(){return Math.floor(a.getStateObj().droppedAudioTime)},function(a){if(i.values.notifyAudio&&a){var c={type:"basic",priority:2,title:"Dropping Audio Frames",message:"Screencastify dropped "+a+" seconds audio. Audio will be choppy. Try to restart recording with a lower resolution or frame rate.",iconUrl:"images/icon128.png"};b?q.update("audioDropped",c):q.create("audioDropped",c),b=!0}}),T.$watch(function(){return i.localValues.micGain},function(b,c){b!==c&&a.setMicGain(b)}),T.$on("chromeVideoRecorder:streamEnded",G),T.$on("chromeVideoRecorder:crash",w),T.$on("chromeVideoRecorder:error",u),T.$on("chromeVideoRecorder:systemAudioUnsupported",H)}function O(){(V||"inactive"!==a.getState())&&(d.info("onSuspend() while recorder is active, preventing unloading"),e.getBackgroundPage())}function P(){S&&o.remove(S),z()}function Q(){if(!S){d.debug("opening preview window");var a=Math.ceil(g.screen.width/4),b=Math.ceil(g.screen.height/4);o.create({url:"livepreview.html",type:"panel",width:a,height:b,top:g.screen.height-b,left:g.screen.width-a}).then(function(a){S=a.id,z(),o.onRemoved.addListener(function b(c){a.id==c&&(o.onRemoved.removeListener(b),d.debug("closed preview window"),S=null,z())})})}}var R,S,T,U=[],V=!1,W={};return W.install=function(){T=b.$new(!0),N(),y(),e.onConnect.addListener(J),e.onSuspend.addListener(O),chrome.commands.onCommand.addListener(L)},W.uninstall=function(){T.$destroy(),e.onConnect.removeListener(J),chrome.commands.onCommand.removeListener(L)},W.pause=D,W.stop=C,W.getRecorderState=function(){return a.getStateObj()},W.isBlocked=function(){return V},W}]),angular.module("castifyExt.upload.uploadBase",["castifyExt.bgFiles","w69b.filesHelper"]).factory("UploadBase",["$q","$log","bgFiles","filesHelper",function(a,b,c,d){function e(a){return d.getFileByPath(c.idToLocalFilename(a))}function f(a){this.config=a,this.minStartTime=0,this.numErrors=0}f.targetClasses_={},f.register_=function(a,b){f.targetClasses_[a]=b},f.create=function(a){var b=f.targetClasses_[a.target];if(!b)throw new Error("unknown target "+a.target);return new b(a)},f.CancelledError={reason:"cancelled",isCancelled:!0},f.cancelReject=a.reject(f.CancelledError);var g=f.prototype;return f.unserialize=function(a){var b=a[0],c=a[1],d=f.targetClasses_[b];if(!d)throw new Error("unknown target "+b);return d.fromObject(c)},g.serialize=function(){return[this.config.target,this.toObject()]},g.fromObject=function(){throw new Error},g.toObject=function(){throw new Error},g.start=function(){},g.cancel=function(){return!1},g.onProgress=function(){},g.onComplete=function(){},g.onError=function(){},g.handleComplete_=function(a){b.debug("upload complete",a),this.responseData=a},g.handleError_=function(b){return a.reject(b)},g.handleProgress_=function(a){return a},g.loadFile_=function(){var b=this.config,d=e(b.fileId);return a.all({file:d,fileDesc:c.getFileDescriptor(b.fileId)})["catch"](function(c){return b.isSyncUpload?f.cancelReject:a.reject(c)})},g.toString=function(){var a=this.config;return"Upload of file "+a.fileId+" to "+a.target},f}]),angular.module("castifyExt.upload.googleUpload",["castifyExt.upload.uploadBase","castifyExt.driveUtils","w69b.googledrive","w69b.googleUploader","castifyExt.bgFiles","castifyExt.youtubeAuth"]).run(["UploadBase","driveUtils","googledrive","googleUploader","bgFiles","$q","$log","$http","$timeout","youtubeAuth","castifyConfig",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){if(angular.isObject(a)&&angular.isNumber(a.status)){var b=a.status;if(0===b||b>=500&&600>b||a.config&&a.config.authAutoRetry===!1&&401===b)return!0}return!1}function m(a){return{id:a.id}}function n(b,c){a.call(this,b),this.uploadUrl=c,this.cancelled=!1}function o(){n.apply(this,arguments)}function p(){n.apply(this,arguments)}function q(b,c){a.call(this,b),this.pollTimer_=null,this.jobId=c}function r(b,c){if(!b.channelId)throw Error("channelId required");a.call(this,b),c&&this.setupDelegate_(c)}var s="Recorded with ScreenCastify (http://www.screencastify.com), the screen video recorder for Chrome",t=["Screencast","ScreenCastify"],u=k.API_URL+"/upload";n.prototype=Object.create(a.prototype),n.prototype.constructor=a;var v=n.prototype;v.handleProgress_=function(a){a.uploadUrl?this.uploadUrl=a.uploadUrl:(this.loadedBytes_=a.loaded,this.progress=a.loaded/a.total)},v.handleError_=function(b){return b===a.CancelledError||this.cancelled?f.reject(a.CancelledError):(g.debug("googleUploader: handling error",b),f.reject({isTransient:l(b),reason:n.getErrorReason(b)}))},v.resumeUpload_=function(a){return this.uploader_=d.resumeUpload(a,this.uploadUrl),this.uploader_.promise},v.start=function(){this.cancelled=!1;var b=this;this.loadFile_().then(function(c){return b.totalBytes_=c.file.size,b.cancelled?a.cancelReject:b.uploadUrl?b.resumeUpload_(c.file,c.fileDesc):b.startUpload_(c.file,c.fileDesc)}).then(this.handleComplete_.bind(this),this.handleError_.bind(this),this.handleProgress_.bind(this)).then(function(a){b.onComplete(a)},function(a){b.onError(a)},function(a){b.onProgress(a)})},n.getErrorReason=function(a){if(angular.isString(a))return a;if(a&&a.data){var b,c=a.data;if(c.error&&c.error.errors&&c.error.errors.length&&(b=c.error.errors[0]),b)return b.reason}else if(a&&a.message)return a.message;return"unknown"},v.toObject=function(){return{config:this.config,uploadUrl:this.uploadUrl}},v.cancel=function(){return this.cancelled?!0:this.loadedBytes_&&this.totalBytes_-this.loadedBytes_<512e3?(g.debug("googleUploader: refusing to cancel almost complete upload"),!1):(this.cancelled=!0,this.uploader_&&this.uploader_.cancel(),!0)},o.prototype=Object.create(n.prototype),o.prototype.constructor=n,a.register_("drive",o),v=o.prototype,v.handleComplete_=function(a){return n.prototype.handleComplete_.call(this,a),e.updateLocalInfo(this.config.fileId,{driveInfo:a}),this.openLink=a.alternateLink,this.setDrivePrivacy_(a.id,this.config.privacy)},o.doesFileExistInParent=function(a,b){return c.getFile(a).then(function(a){return a.parents&&a.parents.some(function(a){return a.id===b})&&(!a.labels||!a.labels.trashed)},function(a){return 404==a.status?!1:f.reject(a)})},v.startUpload_=function(e,f){function g(){if(j.cancelled)return a.cancelReject;var b={title:k,description:s,mimeType:"video/webm",properties:o.toDrivePropertyList_(m),parents:[{id:l}]};return j.uploader_=d.driveUpload(e,b),j.uploader_.promise}function h(b){return j.cancelled?a.cancelReject:c.patchFile(b,{properties:o.toDrivePropertyList_(m)})}var i=this.config,j=this,k=i.title;/\.webm$/i.test(k)||(k+=".webm");var l,m={duration:f.duration,width:f.width,height:f.height,uuid:f.id,recordingDate:f.createdAt.getTime(),isScreencastifySyncFile:!0};return b.getDriveUploadParentId().then(function(b){if(j.cancelled)return a.cancelReject;if(l=b,f.driveInfo&&f.driveInfo.id){var c=f.driveInfo.id;return o.doesFileExistInParent(c,l).then(function(a){return a?h(c):g()})}return g()})},v.setDrivePrivacy_=function(b,d){if("private"===d)return f.when(null);if(this.cancelled)return a.cancelReject;var e={role:"reader",type:"anyone",withLink:"unlisted"===d};return c.insertPermission(b,e)},o.toDrivePropertyList_=function(a){var b=[];return angular.forEach(a,function(a,c){b.push({key:c,value:a,visibility:"PRIVATE"})}),b},v.toObject=function(){return{config:this.config,uploadUrl:this.uploadUrl}},o.fromObject=function(a){return new o(a.config,a.uploadUrl)},p.prototype=Object.create(n.prototype),p.prototype.constructor=n,a.register_("_youtube_local",p),v=p.prototype,v.handleComplete_=function(a){return n.prototype.handleComplete_.call(this,a),e.updateYoutubeInfo(this.config.fileId,m(a)),this.openLink="http://youtu.be/"+a.id,a},v.startUpload_=function(a){var b=this.config,c={title:b.title,privacy:b.privacy,tags:t,description:s};return this.uploader_=d.youtubeUpload(a,c,{youtubeAuth:b.channelId}),this.uploader_.promise},v.resumeUpload_=function(a){return this.uploader_=d.resumeUpload(a,this.uploadUrl,{youtubeAuth:this.config.channelId}),this.uploader_.promise},v.toObject=function(){return{config:this.config,uploadUrl:this.uploadUrl}},p.fromObject=function(a){return new p(a.config,a.uploadUrl)},q.prototype=Object.create(a.prototype),q.prototype.constructor=a,a.register_("_youtube_remote",q),v=q.prototype,v.start=function(){var a=this,b=this.config;this.jobId?this.pollAndHandle_():e.getFileDescriptor(b.fileId).then(function(a){return h.post(u,{driveId:a.driveInfo.id,privacy:b.privacy,channelId:b.channelId},{googleAuth:!0})}).then(function(b){var c=b.data;g.debug("RemoteYoutubeUpload: job created",c),a.jobId=c.id,a.startPollTimer_()},this.handleError_.bind(this))},v.handleComplete_=function(b){a.prototype.handleComplete_.call(this,b),e.updateYoutubeInfo(this.config.fileId,m(b)),this.openLink="http://youtu.be/"+b.id,this.onComplete()},v.pollJob_=function(){return h.get(u+"/"+this.jobId,{googleAuth:!0}).then(function(a){return a.data})},v.handleError_=function(a){this.onError({isTransient:l(a),reason:n.getErrorReason(a)})},v.pollAndHandle_=function(){var a=this;this.pollJob_().then(function(b){g.debug("remote upload job is ",b);var c=b.state;if("completed"===c)a.handleComplete_(b.result);else if("failed"===c){var d=null;if(b.result&&b.result.error)try{d=JSON.parse(b.result.error)}catch(e){}a.handleError_(d?{data:d}:"remote job failed")}else a.progress=b.progress,a.onProgress(),a.startPollTimer_()},this.handleError_.bind(this))},v.startPollTimer_=function(){var a=this;this.pollTimer_&&i.cancel(this.pollTimer_),i(function(){a.pollTimer_=null,a.pollAndHandle_()},3e3)},v.toObject=function(){return{config:this.config,jobId:this.jobId}},q.fromObject=function(a){return new q(a.config,a.jobId)},r.prototype=Object.create(a.prototype),r.prototype.constructor=a,a.register_("youtube",r),v=r.prototype,v.toObject=function(){var a=null;return this.delegate_&&(a=this.delegate_.serialize()),{config:this.config,serializedDelegate:a}},r.fromObject=function(b){var c=null;return b.serializedDelegate&&(c=a.unserialize(b.serializedDelegate)),new r(b.config,c)},v.start=function(){var b=this;e.getFileDescriptor(this.config.fileId).then(function(c){var d;if(d=c.driveInfo&&c.driveInfo.id?"_youtube_remote":"_youtube_local",!b.delegate_||b.delegate_.config.target===d){var e=angular.copy(b.config);e.target=d,b.setupDelegate_(a.create(e))}b.delegate_.start()})},["progress"].forEach(function(a){Object.defineProperty(v,a,{get:function(){var b=this.delegate_;return b?b[a]:null}})}),v.setupDelegate_=function(a){var b=this;if(b.delegate_){var c=b.delegate_;delete c.onError,delete c.onProgress,delete c.onError}b.delegate_=a,a.onError=function(a){b.onError(a)},a.onProgress=function(){b.onProgress()},a.onComplete=function(){b.onComplete()}},v.cancel=function(){return this.delegate_?this.delegate_.cancel():!1}}]),angular.module("castifyExt.bgUpload",["w69b.chromeStorage","w69b.chromeRuntime","w69b.analytics","castifyExt.upload.uploadBase","castifyExt.upload.googleUpload","w69b.throttle","castifyExt.offline","castifyExt.syncAuthTool"]).factory("bgUploadService",["chromeStorage","chromeRuntime","$log","analytics","$rootScope","UploadBase","throttle","onlineState","syncAuthTool","$timeout",function(a,b,c,d,e,f,g,h,i,j){function k(a){if("uploader"==a.name){R.push(a),V(),a.onDisconnect.addListener(function(){var b=R.indexOf(a);b>=0&&R.splice(b,1)});var b={upload:T.upload,cancel:T.cancel};a.onMessage.addListener(function(a){b.hasOwnProperty(a.type)&&b[a.type](a.data)})}}function l(){P.length&&(c.info("onSuspend() while upload queue is not empty, preventing unloading"),b.getBackgroundPage()),U.flush()}function m(){function a(a,c){var d=a.fileId,e=a.target;c.fileId=d,c.target=e,c.isSyncUpload=a.isSyncUpload,b[d]=b[d]||{},b[d][e]=c}if(R.length){var b={};Q.forEach(function(b){a(b.config,{state:"error",error:b.error,config:b.config})}),P.forEach(function(b){a(b.config,{state:"queued",config:b.config})}),O.forEach(function(b){var c={state:"uploading",progress:b.progress};a(b.config,c)}),n("stateUpdate",b)}}function n(a,b){R.forEach(function(c){c.postMessage({type:a,data:b})})}function o(){var b=O.concat(P).map(function(a){return a.serialize()});a.local.setSingle(I,{queued:b,recentErrors:Q})}function p(){U(),V(),S++}function q(){return a.local.getSingle(I).then(function(a){a&&(Q=a.recentErrors||[],P=(a.queued||[]).map(function(a){return f.unserialize(a)}))})}function r(a){delete a.onProgress,delete a.onComplete,delete a.onError;var b=O.indexOf(a);O.splice(b,1),D(),p()}function s(a){var b=P.indexOf(a);P.splice(b,1)}function t(a,b){Q=Q.filter(function(c){return c.config.target!==b||c.config.fileId!==a})}function u(a,b){for(t(a.fileId,a.target),Q.push({config:a,error:b});Q.length>J;)Q.shift()}function v(a){r(a),e.$broadcast("uploader:complete",{config:a.config,data:a.responseData,link:a.openLink}),d.trackEvent("uploader","complete")}function w(a){c.debug("transient upload error, re-queuing",a.toString()),a.numErrors++;var b=Math.min(M,Math.pow(2,a.numErrors-1)*L);a.minStartTime=Date.now()+b+Math.random()*N,E(a)}function x(a,b){if(c.warn("upload error",b),r(a),b===f.CancelledError)c.debug("upload was cancelled",a.toString());else if(b.isTransient)w(a),h.check();else{i.broadcastIfSyncError(b);var g=a.config;e.$broadcast("uploader:failed",{config:g,error:b}),u(g,b),b.reason&&d.trackEvent("uploader","failed",b.reason)}p()}function y(){p()}function z(a){a.onComplete=v.bind(null,a),a.onError=x.bind(null,a),a.onProgress=y.bind(null,a)}function A(a){return P.filter(function(b){return b.config.fileId===a.fileId&&b.config.target===a.target})[0]}function B(a){return O.filter(function(b){return b.config.fileId===a.fileId&&b.config.target===a.target})[0]}function C(a){return A(a)||B(a)}function D(){if(H&&(j.cancel(H),H=null),h.isOnline()&&P.length)if(P[0].minStartTime<=Date.now()){for(;O.length<K&&P.length&&P[0].minStartTime<=Date.now();){var a=P.shift();c.debug("starting queued upload",a.toString()),z(a),O.push(a),a.start()}p()}else{var b=P[0],d=b.minStartTime-Date.now();c.debug("scheduling upload queue start in "+d),H=j(D,d)}else;}function E(a){c.debug("queuing upload",a.toString()),P.push(a),P.sort(function(a,b){return a.minStartTime-b.minStartTime}),D()}function F(a,b){if(c.debug("online state changed to ",b),b)D();else{for(var d=O.concat([]);d.length;){var e=d.pop();e.cancel()&&(r(e),E(f.unserialize(e.serialize())))}p()}}var G,H,I="uploadsPending",J=5,K=5,L=2e3,M=12e4,N=1e3,O=[],P=[],Q=[],R=[],S=0,T={},U=g(o,2e3,!1),V=g(m,300,!1);return T.upload=function(a){var b=a.fileId;return C(a)?void c.info("upload already pending "+b):(t(a.fileId,a.target),d.trackEvent("uploader","start",a.target),void E(f.create(a)))},T.cancel=function(a){if(!a.fileId||!a.target)throw new Error;var b=A(a);b?s(b):(b=B(a),b&&b.cancel()),b?(c.debug("cancelled upload",b.toString()),p()):c.debug("no queued or active upload found to cancel",a)},T.getTargetFileState=function(a,b){function c(c){return c.config.fileId===a&&c.config.target===b}var d=O.find(c);if(d)return{state:"uploading",config:d.config,progress:d.progress};var e=P.find(c);return e?{state:"queued",config:e.config}:null},T.isOnline=function(){return h.isOnline()},T.getWatcherStateId=function(){return S},T.install=function(){return G=e.$new(!0),q().then(function(){D(),b.onConnect.addListener(k),b.onSuspend.addListener(l),G.$on("onlineState:changed",F)})},T.uninstall=function(){b.onConnect.removeListener(k),b.onSuspend.removeListener(l),G.$destroy()},T.STORAGE_KEY=I,T}]),angular.module("castifyExt.localFileDb",["w69b.chromeStorage","w69b.filesHelper","w69b.chromeRuntime","castifyExt.chromeEventPublisher"]).factory("localFileDb",["$rootScope","chromeStorage","$q","filesHelper",function(a,b,c,d){function e(a){return k+a}function f(a){var b=e(a),c=j.getSingle(b).then(function(a){return a=g(a)});return c}function g(a){return a||(a={}),a.title||(a.title="Untitled Screencast"),a}function h(a){angular.extend(this,a)}var i={},j=b.local,k="filedb_",l=null,m=h.prototype;return h.createFromIdOrFileEntry=function(a){var b,e,g=angular.isString(a)?d.getFileEntryByPath(i.idToFilename(a)):c.when(a);return g.then(function(a){return b=a,e=i.filenameToId(a.name),c.all({metadata:d.getMetadata(b),info:f(e)}).then(function(a){var c=b.toURL(),d={id:e,uuid:e,url:c,createdAt:a.metadata.modificationTime,title:a.info.title,size:a.metadata.size};if(a.info.videoInfo){var f=a.info.videoInfo;angular.extend(d,{duration:f.duration,width:f.size.width,height:f.size.height})}if(a.info.previewImages&&(d.thumbnailUrl=a.info.previewImages[0].url),a.info.driveInfo&&(d.driveInfo=a.info.driveInfo),a.info.youtubeInfo){var g=a.info.youtubeInfo;d.youtubeInfo={id:g.id}}return new h(d)})})},m.rename=function(a){return i.updateInfo(this.id,{title:a})},m.remove=function(){var a=this.id;return c.all({result:d.removeByPath(i.idToFilename(a)),info:f(a)}).then(function(a){return a.info.previewImages?c.all(a.info.previewImages.map(function(a){return d.removeByPath(a.path)})):void 0}).then(function(){return j.remove(e(a))})},m.updateYoutubeInfo=function(a){return i.updateInfo(this.id,{youtubeInfo:a})},i.listFiles=function(){return d.listByPath("/").then(function(a){var b=[];return a.forEach(function(a){a.isFile&&"."!==a.name[0]&&i.filenameToId(a.name)!==l&&b.push(h.createFromIdOrFileEntry(a))}),c.all(b).then(function(a){var b={};return a.forEach(function(a){b[a.id]=a}),b})})},i.filenameToId=function(a){if(/\.webm/i.test(a))return a.slice(0,-5);throw new Error("invalid filename: "+a)},i.idToFilename=function(a){return a+".webm"},i.getFileDescriptor=function(a){return h.createFromIdOrFileEntry(a)},i.updateInfo=function(a,b,d){var f,g=e(a);return f=d?c.when(b):j.get(g).then(function(a){return angular.extend(a[g]||{},b)}),f.then(function(a){var b={};return b[g]=a,j.set(b),a})},i.migrateToUuid_=function(a,b,c){var g=i.idToFilename(c),h=a.name;return d.moveTo(a,b,g).then(function(){f(h).then(function(a){return i.updateInfo(c,a)}).then(function(){return j.remove(e(h))})})},a.$on("recorder:started",function(a,b){l=b}),a.$on("recorder:stopped",function(){l=null}),i}]),angular.module("castifyExt.recordTool",["w69b.chromeStorage","w69b.webrtc"]).factory("recordTool",["chromeStorage","$window","webrtc",function(a,b,c){function d(){return b.navigator.userAgent}function e(){return d().indexOf("CrOS arm")>=0}function f(){return d().indexOf("CrOS x86_64")>=0}function g(){return e()?5:(f(),30)}function h(){return e()?{width:854,height:480}:{width:1280,height:720}}function i(a){return c.getSources().then(function(b){function c(a,c){return b.some(function(b){return b.kind===a&&!c||c===b.id})}return a.audio.mic&&(c("audio")?a.audio.micSourceId&&!c("audio",a.audio.micSourceId)&&delete a.audio.micSourceId:a.audio.mic=!1),c("video")?a.camSourceId&&!c("video",a.camSourceId)&&delete a.camSourceId:("cam"===a.captureSource&&(a.captureSource="tab"),a.embedWebcam&&(a.embedWebcam=!1)),a})}var j={};return j.toResolution=function(a){return{width:a.width,height:a.height}},j.scaleResolution=function(a,b){var c=Math.min(b.height/a.height,b.width/a.width,1);return{width:Math.floor(a.width*c),height:Math.floor(a.height*c)}},j.getResolutionLimit=function(a,b){return a.limitResolution?"tab"===a.captureSource?j.scaleResolution(b,a.maxResolution):a.maxResolution:null},j.canCaptureSystemAudio=function(){return b.navigator.userAgent.indexOf("Windows")>=0},j.getRecordConfig=function(){return a.local.getSingle("recordConfig").then(function(a){return a=a||{},a.limitResolution=angular.isDefined(a.limitResolution)?a.limitResolution:e(),a.maxResolution=a.maxResolution?a.maxResolution:h(),a.audio=angular.isObject(a.audio)?a.audio:{mic:!0,system:!0},a.mouse=a.mouse||{enable:!0},a.embedWebcam=a.embedWebcam||!1,a.camPosition=a.camPosition||"bottomRight",a.captureSource=a.captureSource||"tab",a.targetFPS=a.targetFPS||g(),"desktop"!==a.captureSource||j.canCaptureSystemAudio()||(a.audio.system=!1),a}).then(i)},j}]),angular.module("castifyExt.resizeTab",["w69b.chromeTabs","w69b.chromeWindows"]).factory("resizeTab",["chromeTabs","chromeWindows","$q",function(a,b,c){function d(d,e,f,g){function h(){return a.get(d).then(function(a){return j=a})}function i(){return b.get(j.windowId).then(function(a){if("normal"!==a.state&&g===!1)return c.reject();var d=a.width-j.width,h=a.height-j.height,i=e+d,k=f+h;return b.update(j.windowId,{width:i,height:k,state:"normal"})})}var j;return h().then(i).then(h).then(function(a){return a.width!=e||a.height!=f?i().then(h):a})["catch"](function(){return j})}return d}]),angular.module("castifyExt.tabMouse",["w69b.chromeTabs","w69b.throttle"]).factory("createTabMouse",["chromeTabs","$q","$log","throttle",function(a,b,c,d){function e(e){function f(){return b.all([a.insertCSS(e,{file:"components/castifyExt/content-script.css",allFrames:!0}),a.executeScript(e,{file:"components/castifyExt/content-script.js",allFrames:!0})])}function g(){return l||(l=f().then(function(){return k=a.connect(e,{name:"content"}),k.onDisconnect.addListener(function(){l=null}),k.onMessage.addListener(function(a){p.hasOwnProperty(a.type)&&p[a.type](k,a.data)}),k}),l["catch"](function(a){c.error("tabMouseLoadError:",a)})),l}function h(a){a.tabId==e&&q()}function i(){g(),chrome.webNavigation.onDOMContentLoaded.addListener(h)}function j(a,b){g().then(function(c){c.postMessage({type:a,data:b})})}var k,l,m,n,o={},p={};p.mousePosition=function(a,b){if(n!==b.frameId){n=b.frameId;try{a.postMessage({type:"frameGotMouse",data:b.frameId})}catch(c){}}};var q=d(function(){m&&(k&&k.disconnect(),l=null,j("setMouse",m))},1e3);return o.setMouse=function(a){m=a,j("setMouse",a)},o.dispose=function(){m=null,l&&(l.then(function(a){a.disconnect()}),l=null),chrome.webNavigation.onDOMContentLoaded.removeListener(h)},i(),o}return e}]),angular.module("castifyExt.recordingHooks",["w69b.chromeTabs","castifyExt.videoPreviewRenderer","castifyExt.appOptions","castifyExt.bgUpload","w69b.clipboard","castifyExt.ui.openInAppTab","w69b.chromeRuntime","castifyExt.driveFileWatcher","castifyExt.bgFiles"]).factory("recordingHooks",["$rootScope","videoPreviewRenderer","chromeTabs","appOptions","bgUploadService","bgFiles","clipboard","openInAppTab","chromeRuntime","$q","driveFileWatcher","$log","$timeout","filesHelper",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){h("app.html#/files/"+encodeURIComponent(a))}function p(a){if(0===a.lastIndexOf(v,0)){var b=a.substr(v.length);c.create({url:b}),chrome.notifications.clear(a)}}function q(a,b){if(!b.config.isSyncUpload){var c=b.config,d=b.link;if(/https?:\/\//.test(d)){var e='Your screencast "'+c.title+'" has been uploaded. Click here to open it.';c.copyLinkToClipboard&&(g.copy(d),e+=" The link was copied to your clipboard."),c.autoRemove&&f.remove(c.fileId);var h={type:"basic",priority:0,title:"Upload complete",message:e,iconUrl:"images/icon128.png"};c.showNotification&&chrome.notifications.create(v+d,h,angular.noop)}}}function r(a){return n.getFileEntryByPath(a).then(function(a){return n.getMetadata(a)}).then(function(a){return a.size})}function s(a,c){b.renderPreview(c)["catch"](function(a){l.warn("rendering preview image failed",c);var b=f.idToLocalFilename(c);return r(b).then(function(c){return w>c?(l.warn("file is empty, removing it"),n.removeByPath(b),j.reject(a)):null})}).then(function(){l.debug("recording hooks completed for",c),f.registerLocalFile(c),m(function(){d.values.autoOpen&&o(c)},500)})}var t=[],u={},v="upload:",w=1e4;return u.install=function(){t=[a.$on("recorder:stopped",s),a.$on("uploader:complete",q)],chrome.notifications.onClicked.addListener(p)},u.uninstall=function(){t.forEach(function(a){a()}),t=[],chrome.notifications.onClicked.removeListener(p)},u}]),angular.module("castifyExt.videoPreviewRenderer",["castifyExt.bgFiles","w69b.filesHelper"]).factory("videoPreviewRenderer",["bgFiles","filesHelper","$q",function(a,b,c){function d(a){return b.getFileEntryByPath(k+"/"+a,{create:!0},{create:!0})}function e(a,b){var c=Math.max(b.width/a.width,b.height/a.height);return{width:a.width*c,height:a.height*c}}function f(a){function b(){e.resolve(f)}function d(){e.reject("failed to load video")}var e=c.defer(),f=document.createElement("video");return f.src=a,f.addEventListener("canplay",b),f.addEventListener("error",d),e.promise["finally"](function(){f.removeEventListener("canplay",b),f.removeEventListener("error",d)}),e.promise}function g(a){for(var b=window.atob(a),c=new Uint8Array(new ArrayBuffer(b.length)),d=0;d<b.length;d++)c[d]=b.charCodeAt(d);return c}function h(a){if(a.toBlob)return a.toBlob();var b=a.toDataURL(),c="data:image/png;base64,";if(0!==b.lastIndexOf(c,0))throw Error();var d=b.substring(c.length);return d=new Uint8Array(g(d)),new Blob([d],{type:"image/png"})}function i(a,b){var c=document.createElement("canvas");c.width=b.width,c.height=b.height;var d=c.getContext("2d");return d.drawImage(a,0,0,b.width,b.height),h(c)}function j(a,b){var d=c.defer();return a.onwriteend=d.resolve.bind(d),a.onerror=d.reject.bind(d),a.write(b),d.promise}var k="_previewImages",l={width:640,height:360},m={};return m.renderPreview=function(c){var g,h,m,n=c+".png",o={};return b.getFileEntryByPath(a.idToLocalFilename(c)).then(function(a){return f(a.toURL())}).then(function(a){var b={width:a.videoWidth,height:a.videoHeight};return o.size=b,o.duration=a.duration,m=e(b,l),g=i(a,m),d(n)}).then(function(a){return h=a,b.createWriter(h)}).then(function(a){return j(a,g)}).then(function(){var b={path:k+"/"+n,size:m,url:h.toURL()};return a.updateLocalInfo(c,{previewImages:[b],videoInfo:o})}).then(function(){return h})},m}]),angular.module("castifyExt.updateMigrationService",["w69b.chromeRuntime","w69b.filesHelper","w69b.chromeVersionOrder","w69b.uuid","castifyExt.ui.openInAppTab"]).factory("updateMigrationService",["chromeRuntime","videoPreviewRenderer","$log","filesHelper","chromeVersionOrder","uuid","localFileDb","openInAppTab","chromeTabs",function(a,b,c,d,e,f,g,h,i){function j(a,b){a!==b&&(c.info("updating from "+a+" to "+b),e.isLess(a,"1.5.0")&&i.create({url:"app.html#/update-notice"}))}function k(){h("#/welcome")}function l(b){c.debug("installed",b),"update"===b.reason&&j(b.previousVersion,a.getManifest().version),"install"===b.reason&&k()}var m={};return m.install=function(){a.onInstalled.addListener(l)},m}]),angular.module("castifyExt.diskSpaceWatcher",["castifyExt.bgRecord","w69b.filesHelper","w69b.ui.bytesFilter","castifyExt.appOptions","w69b.chromeNotifications","castifyExt.helpCenter"]).factory("diskSpaceWatcher",["bgRecordService","$timeout","filesHelper","$rootScope","$filter","appOptions","chromeNotifications","helpCenter",function(a,b,c,d,e,f,g,h){function i(){return p}function j(){return c.getPersistentQuota().then(function(a){return a.quota-a.usage})}function k(){var b={priority:2,title:"Critically low disk space",message:"You have less than 1GB left. Recording was paused automatically.",buttons:[{title:"Help"}]};g.clear("diskSpaceCritical")["finally"](function(){h.setNotifyHelp(g.simple.create(b,"diskSpaceCritical"),"disk_space")}),a.pause()}function l(a){a+=1073741824;var b={priority:2,title:"Low disk space",message:"You have only "+e("bytes")(a)+" left. Recording will be paused automatically soon.",buttons:[{title:"Help"}]};h.setNotifyHelp(g.simple.create(b,"diskSpaceLow"),"disk_space")}function m(){n(),f.values.enableDiskSpaceWatcher&&j().then(function(a){a<=i()?k(a):q>=a&&l(a),a>i()&&(o=b(m,r))})}function n(){o&&(b.cancel(o),o=null)}var o,p=0,q=104857600,r=1e4,s={};return s.install=function(){d.$watch(function(){return"recording"===a.getRecorderState().state&&!a.isBlocked()},function(a,b){a!==b&&(a?m():n())}),d.$on("recorder:stopped",function(){g.clear("diskSpaceCritical"),g.clear("diskSpaceLow")})},s.setThresholds=function(a,b){p=b,q=a},s}]),angular.module("castifyExt.audioContextPool",[]).factory("audioContextPool",["$window",function(a){var b=[],c={};return c.acquire=function(){return b.length?b.pop():new a.AudioContext},c.release=function(a){b.push(a)},c}]),angular.module("castifyExt.ui.openInAppTab",["w69b.chromeTabs","w69b.chromeWindows"]).service("openInAppTab",["chromeTabs","chromeRuntime","chromeWindows","$q",function(a,b,c,d){return function(e){var f="chrome-extension://"+b.id+"/app.html";return 0===e.lastIndexOf("#",0)&&(e=f+e),a.query({url:f}).then(function(b){if(b.length){var f=b[0];return d.all([a.update(f.id,{active:!0,url:e}),c.update(f.windowId,{focused:!0})])}a.create({active:!0,url:e})})}}]).directive("openInAppTab",["$window","openInAppTab",function(a,b){return{restrict:"A",link:function(c,d,e){d.bind("click",function(c){var d=angular.element(c.target),f=e.href||d.attr("href");f&&(c.preventDefault(),b(f).then(function(){a.close()}))})}}}]),angular.module("castifyExt.licensing",["castifyExt.castifyAuth","w69b.chromeStorage","w69b.chromeRuntime","castifyExt.signInService","w69b.spawn","w69b.promiseTool"]).factory("licensing",["castifyAuth","$http","chromeRuntime","chromeStorage","$q","$rootScope","$log","signInService","castifyConfig","promiseTool","spawn",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){return h.getToken(a)}function m(){function a(){var a=window.chrome.identity,b=j.wrapChromeError(a.getAuthToken,a);return b({interactive:!1,scopes:["email","https://www.googleapis.com/auth/chromewebstore.readonly"]})}function f(){return k($traceurRuntime.initGeneratorFunction(function d(){var e,f,g,h,i;return $traceurRuntime.createGeneratorInstance(function(d){for(;;)switch(d.state){case 0:e=q+c.id,d.state=17;break;case 17:return d.state=2,a();case 2:f=d.sent,d.state=4;break;case 4:return d.state=6,b.get(e,{headers:{Authorization:"Bearer "+f}});case 6:g=d.sent,d.state=8;break;case 8:h=g.data,d.state=19;break;case 19:d.state=h.result&&h.createdTime?11:10;break;case 11:i=new Date(Number(h.createdTime)),d.state=12;break;case 12:d.returnValue=s>i,d.state=-2;break;case 10:d.returnValue=!1,d.state=-2;break;default:return d.end()}},d,this)}))}return y.isTester()?e.when(!0):d.sync.getSingle(v).then(function(a){return angular.isDefined(a)?a:e.reject()})["catch"](function(){return f().then(function(a){return d.sync.setSingle(v,a),a})})["catch"](function(){return!1})}function n(){return b.get(r+"/license",t).then(function(a){return a.data})}function o(){return!x||p&&"trial"!==p.access}var p,q="https://www.googleapis.com/chromewebstore/v1.1/userlicenses/",r=i.API_URL,s=1413892757176,t=h.AUTH_CONFIG,u="license",v="cws_license",w=600,x=!0,y={};return y.updateLicense=function(){var a=l().then(function(){return e.all([m(),n()])}).then(function(a){var b=a[1],c=a[0];return c&&"full"!==b.access&&(b.access="tester",b.maxAgeSecs=3600),b.validTill=Date.now()+1e3*b.maxAgeSecs,d.sync.setSingle(u,b),b});return a["catch"](function(a){g.debug("update failed",a)}),a},y.shouldLimitLength=function(){return!o()},y.isPaid=function(){return p&&"full"===p.access},y.isTester=function(){return p&&"tester"===p.access},y.getMaxLength=function(){return o()?Number.POSITIVE_INFINITY:w;

},y.getVersionName=function(){var a=o()?"Full":"Free";return p&&(a+=" ("+p.access+")"),a+" v"+c.getManifest().version},y.initialize=function(){return d.sync.getSingle(u).then(function(a){p=a,d.onChanged.addListener(function(a,b){"sync"==b&&a[u]&&(p=a[u].newValue,f.$$phase||f.$digest())}),c.getBackgroundPage()})},y.updateIfNeeded=function(){var a=p;(!a||!a.validTill||a.validTill<Date.now())&&y.updateLicense()},y.getToken=l,y.hasLicense=function(){return x&&!!p},y}]),angular.module("castifyExt.signInService",["castifyExt.castifyAuth"]).factory("signInService",["castifyAuth","chromeRuntime","$rootScope","$log",function(a,b,c,d){var e=["https://www.googleapis.com/auth/plus.me","email"],f={googleAuth:!0,googleAuthScopes:e},g={SCOPES:e,AUTH_CONFIG:f};return g.getToken=function(b,c){var d={interactive:!!b,scopes:e,validate:c};return a.getAuthToken(d)},g.signIn=function(b){var c={interactive:"select_account",scopes:e,validate:!0};b===!1&&(c.useChromeAccount=!1);var f=a.getAuthToken(c);return f["catch"](function(a){d.warn("Sign in failed",a)}),f},g}]),angular.module("castifyExt.bgLicensing",["castifyExt.licensing","w69b.chromeRuntime","castifyExt.chromeEventPublisher","castifyExt.castifyAuth"]).factory("bgLicensing",["licensing","$rootScope","castifyAuth",function(a,b,c){function d(){a.updateLicense()}var e={};return e.install=function(){a.initialize().then(function(){a.updateIfNeeded()}),c.onSignInChanged.addListener(d),b.$on("event:signInChanged",d)},e}]),angular.module("castifyExt.driveFileDb",["castifyExt.driveUtils","castifyExt.offline","w69b.chromeStorage","castifyExt.castifyAuth"]).factory("driveFileDb",["googledrive","driveUtils","castifyAuth","$q","onlineState","chromeStorage",function(a,b,c,d,e,f){function g(a,b){if(a){var c=a.match(/(.*)=s\d+$/);if(c)return c[1]+"=s"+b}return a}function h(a){var b=[];return angular.forEach(a,function(a,c){angular.isObject(a)?angular.forEach(a,function(a,d){b.push({key:c+"_"+d,value:a,visibility:"PRIVATE"})}):b.push({key:c,value:a,visibility:"PRIVATE"})}),b}function i(a){var b={};return a.forEach(function(a){if("PRIVATE"===a.visibility){if(a.key.indexOf("_")>0){var c=a.key.split("_",2),d=c[0],e=c[1];b[d]||(b[d]={}),b[d][e]=a.value}b[a.key]=a.value}}),b}function j(a){this.updateFromDriveResource_(a)}function k(){return d.when(f.local.getSingle(n,[]))}function l(a){a.then(function(a){f.local.setSingle(n,a)})}var m=400,n="drive_files",o={},p=j.prototype;return p.updateFromDriveResource_=function(a){var b=i(a.properties),c={id:b.uuid,driveId:a.id,thumbnailUrl:g(a.thumbnailLink,m),createdAt:new Date(b.recordingDate?Number(b.recordingDate):a.createdDate),url:a.downloadUrl,urlRequiresAccessToken:!0,size:Number(a.fileSize),duration:Number(b.duration),width:Number(b.width),height:Number(b.height),driveInfo:a},d="."+a.fileExtension;c.title=a.fileExtension&&-1!==a.title.indexOf(d,a.title.length-d.length)?a.title.slice(0,-d.length):a.title,b.youtubeInfo&&(c.youtubeInfo=b.youtubeInfo),angular.extend(this,c)},p.remove=function(){return a.trashFile(this.driveId)},p.rename=function(b){var c=this.driveInfo.fileExtension;return c&&(c="."+c,b.indexOf(c,b.length-c.length)<0&&(b+=c)),a.patchFile(this.driveId,{title:b}).then(this.updateFromDriveResource_.bind(this))},p.updateYoutubeInfo=function(b){var c=i(this.driveInfo.properties);return c.youtubeInfo=b,a.patchFile(this.driveId,{properties:h({youtubeInfo:b})})},o.getFileDescriptor=function(b){var c="properties has { key='uuid' and value='"+b+"' and visibility='PRIVATE' }";return a.listFiles({maxResults:1,q:c}).then(function(a){return a.length?a[0]:d.reject()}).then(function(a){return new j(a)})},o.listFiles=function(){var c;return e.isOnline()?(c=b.getDriveUploadParentId().then(function(b){var c="'"+b+"' in parents and trashed = false and properties has { key='isScreencastifySyncFile' and value='true' and visibility='PRIVATE' }";return a.listFiles({maxResults:1e3,q:c})}),l(c)):c=k(),c.then(function(a){var b={};return a.forEach(function(a){var c=new j(a);b[c.id]=c}),b})},o}]),angular.module("castifyExt.bgFiles",["castifyExt.localFileDb","castifyExt.driveFileDb","w69b.chromeRuntime","castifyExt.appOptions","castifyExt.syncAuthTool","castifyExt.offline"]).factory("bgFiles",["localFileDb","driveFileDb","$q","$rootScope","chromeRuntime","appOptions","$log","syncAuthTool","$interval","onlineState",function(a,b,c,d,e,f,g,h,i){function j(a,b){this.$localDesc=a,this.$driveDesc=b,this.ownProperties_={}}function k(a){this.port=a}function l(a){return h.broadcastIfSyncError(a)}function m(){return f.values.driveSync}function n(a){var b={};return I.forEach(function(c){var d=a[c];angular.isDefined(d)&&(d instanceof Date&&(d=d.getTime()),b[c]=d)}),b}function o(a){var b={};return angular.forEach(a,function(a,c){b[c]=n(a)}),b}function p(){G++,E.listFiles().then(function(a){var b={full:o(a)};q("filesUpdate",b)})}function q(a,b){F.forEach(function(c){c.subscribed&&c.postMessage(a,b)})}function r(a){G++;var b=D[a],c={};b?(c.add={},c.add[a]=n(b)):c.remove=[a],q("filesUpdate",c)}function s(a){if("syncManager"==a.name){var b=new k(a);F.push(b),a.onDisconnect.addListener(function(){var a=F.indexOf(b);a>=0&&F.splice(a,1)});var c={remove:E.remove,reload:function(a){E.reload(a).then(function(){b.postMessage("reloadSuccess",a)},function(){b.postMessage("reloadError",a)})},rename:function(a){E.rename(a.id,a.title)},removeAll:E.removeAll,subscribe:function(){b.subscribed=!0,b.postFiles()}};a.onMessage.addListener(function(a){c.hasOwnProperty(a.type)&&c[a.type](a.data)})}}function t(a,c){b.getFileDescriptor(c).then(function(a){var b=new j(null,a);D[b.id]=b,r(c)})}function u(a){c.all({proxy:E.getFileDescriptor(a),drive:b.getFileDescriptor(a)}).then(function(b){b.proxy.$driveDesc=b.drive,r(a)})}function v(a,b){u(b)}function w(a,b){E.getFileDescriptor(b).then(function(a){a.$localDesc=null,a.$driveDesc||(a.deleted=!0,delete D[b]),r(b)})}function x(a,b){E.getFileDescriptor(b).then(function(a){var b=a.id;a.$driveDesc=null,a.$localDesc||(a.deleted=!0,delete D[b]),r(b)})}function y(a,b){u(b)}function z(a){g.debug("bgFiles: sync setting changed to "+a+" clearing cache"),E.clearCache(),F.length&&p()}function A(a){a&&B()}function B(){E.clearCache(),p()}var C,D={},E={},F=[],G=0,H=["id","size","width","height","duration","title","thumbnailUrl","createdAt","url","driveInfo","youtubeInfo","urlRequiresAccessToken"],I=H.concat(["isSynced"]),J=j.prototype;return J.preferDriveDelegate_=function(){return this.$driveDesc?this.$driveDesc:this.$localDesc},J.preferLocalDelegate_=function(){return this.$localDesc?this.$localDesc:this.$driveDesc},J.getDelegate_=function(a){return this.ownProperties_.hasOwnProperty(a)?this.ownProperties_:"thumbnailUrl"===a||"urlRequiresAccessToken"===a||"url"===a?this.preferLocalDelegate_():this.preferDriveDelegate_()},J.callOnBoth_=function(a,b){b=Array.prototype.slice.call(arguments,1);var d,e=this;return d=e.$driveDesc?e.$driveDesc[a].apply(e.$driveDesc,b)["catch"](l):c.when(),d.then(function(){return e.$localDesc?e.$localDesc[a].apply(e.$localDesc,b):void 0})},J.reload=function(){var d=[],e=this;e.$driveDesc&&d.push(b.getFileDescriptor(e.id).then(function(a){e.$driveDesc=a})),e.$localDesc&&d.push(a.getFileDescriptor(e.id).then(function(a){e.$localDesc=a}));var f=c.all(d).then(function(){e.ownProperties_={}});return f["finally"](function(){r(e.id)}),f},J.rename=function(a){var b=this,c=b.title;b.title=a;var d=b.callOnBoth_("rename",a);return d["catch"](function(){b.title=c}),d["finally"](function(){r(b.id)}),d},J.remove=function(){var a=this,b=a.callOnBoth_("remove");return b.then(function(){delete D[a.id],d.$broadcast("bgFiles:fileRemoved",a.id)}),b["finally"](function(){r(a.id)}),b},J.updateYoutubeInfo=function(a){var b=this,c=b.youtubeInfo;b.youtubeInfo=a;var d=b.callOnBoth_("updateYoutubeInfo",a);d["catch"](function(){b.youtubeInfo=c}),d["finally"](function(){r(b.id)})},H.forEach(function(a){Object.defineProperty(J,a,{get:function(){var b=this.getDelegate_(a);return b?b[a]:null},set:function(b){this.ownProperties_[a]=b}})}),Object.defineProperty(J,"isSynced",{get:function(){return!!this.$driveDesc}}),J=k.prototype,J.postMessage=function(a,b){F.indexOf(this)<0||this.port.postMessage({type:a,data:b})},J.postFiles=function(){var a=this;E.listFiles().then(function(b){a.postMessage("filesUpdate",{full:o(b)})},function(b){g.warn("initial MessageClient subscribe postFiles failed",b),a.postMessage("filesUpdate",{error:!0})})},E.getFileDescriptor=function(a){return D[a]?c.when(D[a]):E.listFiles().then(function(b){return b[a]?b[a]:c.reject()})},E.listFiles=function(){if(!C){var d=f.loadedPromise.then(function(){return m()?b.listFiles():c.when({})});C=c.all({local:a.listFiles(),drive:d}).then(function(a){var b=Object.keys(a.local).concat(Object.keys(a.drive));return b.forEach(function(b){var c=a.local[b],d=a.drive[b],e=new j(c,d);D[e.id]=e}),D}),C["catch"](l),C["catch"](function(){C=null})}return C},E.removeAll=function(){var a=E.listFiles().then(function(a){return c.all(Object.keys(a).map(function(a){return E.remove(a)}))});return a["catch"](p),a},E.remove=function(a){return E.getFileDescriptor(a).then(function(a){return a.remove()})},E.rename=function(a,b){return E.getFileDescriptor(a).then(function(a){return a.rename(b)})},E.reload=function(a){return E.getFileDescriptor(a).then(function(a){return a.reload()})},E.clearCache=function(){C=null,angular.copy({},D)},E.idToLocalFilename=function(b){return a.idToFilename(b)},E.localFilenameToId=function(b){return a.filenameToId(b)},E.updateLocalInfo=function(b,c){return a.updateInfo(b,c).then(function(){E.reload(b).then(function(){r(b)})})},E.updateYoutubeInfo=function(a,b){return E.getFileDescriptor(a).then(function(a){return a.updateYoutubeInfo(b)})},E.getListVersionId=function(){return G},E.isSyncEnabled=m,E.registerLocalFile=function(b){return a.getFileDescriptor(b).then(function(a){var c=new j(a,null);D[c.id]=c,r(b),d.$broadcast("event:localFileCreated",b)})},E.install=function(){i(B,3e5),d.$on("event:driveFileCreated",t),d.$on("event:syncUploadComplete",v),d.$on("event:syncLocalFileRemoved",w),d.$on("event:syncDriveFileRemoved",x),d.$on("event:syncDriveFileProcessed",y),d.$on("onlineState:changed",A),d.$on("event:signInChanged",B),f.loadedPromise.then(function(){d.$watch(m,function(a,b){b!==a&&z(a)})}),e.onConnect.addListener(s)},E}]),angular.module("castifyExt.licenseEnforcer",["castifyExt.bgRecord","castifyExt.licensing","w69b.chromeTabs"]).factory("licenseEnforcer",["bgRecordService","$rootScope","licensing","chromeTabs","$log","analytics",function(a,b,c,d,e,f){function g(a){var b="https://www.screencastify.com/buy?utm_source=app&utm_medium="+a+"&utm_campaign=recording_length";d.create({url:b})}function h(){e.debug("recordLimitReached"),f.trackEvent("recording_limit","notify");var b={type:"basic",priority:2,title:"Recording stopped",message:"You have reached the recording limit of Screencastify Lite. Please upgrade to record longer screencasts",iconUrl:"images/icon128.png"};chrome.notifications.clear("recordLimitInfo",angular.noop),chrome.notifications.clear("recordLimitReached",angular.noop),chrome.notifications.create("recordLimitReached",b,angular.noop),a.stop(),g("auto")}function i(a){e.debug("recordLimitApproaching");var b={type:"basic",priority:2,title:"Approaching free recording limit",message:"Recording will be stopped automatically in "+a+" seconds. Please upgrade Screencastify to record longer screencasts.",iconUrl:"images/icon128.png"};chrome.notifications.create("recordLimitInfo",b,angular.noop)}function j(a){("recordLimitReached"===a||"recordLimitInfo"===a)&&(g("notify"),chrome.notifications.clear(a,angular.noop))}var k=30,l={};return l.install=function(){b.$watch(function(){return a.getRecorderState().time>=c.getMaxLength()},function(a){a&&h()}),b.$watch(function(){return c.getMaxLength()-Math.ceil(a.getRecorderState().time)},function(a){a>0&&k>=a&&i(a)}),b.$on("recorder:stopped",function(){chrome.notifications.clear("recordLimitInfo",angular.noop)})},chrome.notifications.onClicked.addListener(j),l}]),angular.module("castifyExt.bgMessages",["castifyExt.ui.openInAppTab","castifyExt.signInService","w69b.webrtc","castifyExt.licensing"]).factory("bgMessages",["chromeRuntime","chromePersistentLogger","openInAppTab","chromeTabs","signInService","webrtc","licensing",function(a,b,c,d,e,f,g){function h(c,h,j){if("bg:load"===c&&i)a.sendMessage("bg:loaded");else{if("bg:flushLogs"===c)return b.save().then(function(){j(!0)}),!0;if("bg:launchApp"===c){var k="chrome-extension://"+a.id+"/app.html";h.tab&&h.tab.id&&d.update(h.tab.id,{url:k})}else if("bg:signIn"===c)e.signIn(),j();else{if("bg:getSignInToken"===c)return e.getToken(!1,!0).then(function(a){j(a)},function(){e.signIn().then(function(a){j(a)},function(){j(!1)})}),!0;if("bg:updateLicense"===c)g.updateLicense();else if("bg:getLicenseInfo"===c)j({isPaid:g.isPaid(),isTester:g.isTester()});else if("bg:hasCamAccess"===c)return f.hasCamera().then(function(a){return f.getUserMedia({audio:!0,video:a})}).then(function(a){a.stop(),j(!0)},function(){j(!1)}),!0}}return!1}var i=!1,j={};return j.install=function(){a.onMessage.addListener(h)},j.initializationCompleted=function(){a.sendMessage("bg:loaded"),i=!0},j}]),angular.module("castifyExt.chromeEventPublisher",[]).run(["chromeRuntime","$rootScope",function(a,b){var c="event:";a.onMessage.addListener(function(a){angular.isObject(a)&&angular.isString(a.type)&&0===a.type.lastIndexOf(c,0)&&b.$broadcast(a.type,a.data),b.$$phase||b.$digest()})}]),angular.module("castifyExt.driveUtils",["w69b.googledrive","castifyExt.castifyAuth"]).factory("driveUtils",["googledrive","$q",function(a,b){function c(){return a.postFile({title:"Screencastify",mimeType:"application/vnd.google-apps.folder",description:"Screencastify uses this folder to store Screencasts that you upload. You may rename or move it, it will upload to this folder.",properties:[{key:"isScreencastifyUploadFolder",value:!0,visibility:"PRIVATE"}]})}function d(){var b="mimeType = 'application/vnd.google-apps.folder' and trashed = false and properties has { key='isScreencastifyUploadFolder' and value='true' and visibility='PRIVATE' }";return a.listFiles({q:b,maxResults:1}).then(function(a){return a.length?a[0]:null})}function e(a){var b=a.filter(function(a){return"anyone"===a.type});return b.length?b[0]:null}function f(b){return a.listPermissions(b).then(e)}function g(a){return a?a.withLink?"unlisted":"public":"private"}var h,i={};return i.getDriveUploadParentId=function(a){return(!h||a)&&(h=d().then(function(a){return a?a:c()}).then(function(a){return a.id}),h["catch"](function(){h=null})),h},i.getSimplePrivacy=function(a){return f(a).then(g)},i.setSimplePrivacy=function(c,d){return f(c).then(function(e){if(g(e)===d)return b.when(null);if(e&&"private"===d)return a.removePermission(c,e.id);var f={role:"reader",type:"anyone",withLink:"unlisted"===d};return e?a.patchPermission(c,e.id,f):a.insertPermission(c,f)})},i}]),angular.module("castifyExt.youtubeUtils",["castifyExt.castifyAuth"]).factory("youtubeUtils",["$http","$q",function(a,b){function c(a){var c=a.data.items;return c.length?c[0]:b.reject("not found")}function d(b,d){return a.get(f,angular.extend({params:{id:b,part:"status,snippet"}},{youtubeAuth:d})).then(c)}function e(b,c,d){return d=angular.extend({id:b},d),a.put(f,d,angular.extend({params:{part:"status"}},{youtubeAuth:c})).then(function(a){return a.data})}var f="https://www.googleapis.com/youtube/v3/videos",g={};return g.getPrivacy=function(a,c){return d(a,c).then(function(a){return c!==a.snippet.channelId?b.reject():a.status.privacyStatus})},g.setPrivacy=function(a,b,c){return e(a,c,{status:{privacyStatus:b}})},g}]),angular.module("castifyExt.driveFileWatcher",["w69b.googledrive","w69b.chromeStorage","w69b.chromeAlarms","castifyExt.castifyAuth"]).factory("driveFileWatcher",["googledrive","chromeStorage","$rootScope","$log","chromeAlarms",function(a,b,c,d,e){function f(){return b.local.setSingle(m,{ids:Object.keys(r),lastCheckedAt:p})}function g(a,b){c.$broadcast("driveFileWatcher:"+a,b)}function h(a){delete r[a]}function i(b){return a.getFile(b).then(function(a){a.labels&&a.labels.trashed?(d.debug("file was trashed",b),g("removed",b),h(b)):a.thumbnailLink&&(d.debug("detected drive processing complete for file",b),g("processed",b),h(b))},function(a){d.debug("failed to check drive file",b,a),404==a.status?(d.debug("file was removed"),g("removed",b),h(b)):d.debug("we will try again later")})}function j(){function a(){return b.length?i(b.pop()).then(a,a):null}var b=Object.keys(r);b.length&&!o&&(d.debug("checking watched drive files",b),o=!0,a()["finally"](function(){o=!1,p=Date.now(),f(),k()}))}function k(a){Object.keys(r).length&&(!a&&Date.now()-p>=6e4*q?j():e.get(n).then(function(a){a||e.create(n,{delayInMinutes:q})}))}function l(a){a.name===n&&k()}var m="driveFileWatcher",n=m,o=!1,p=0,q=2,r={},s={};return s.watchFile=function(a){d.debug("watching drive file",a),r[a]=!0,f(),k(!0)},s.install=function(){b.local.getSingle(m).then(function(a){a&&(a.ids.forEach(function(a){r[a]=!0}),p=a.lastCheckedAt||0),k()}),e.onAlarm.addListener(l)},s}]),angular.module("castifyExt.driveSyncHooks",["castifyExt.appOptions","castifyExt.bgUpload","w69b.chromeRuntime","castifyExt.driveFileWatcher","w69b.googledrive","castifyExt.localFileDb","castifyExt.chromeEventPublisher"]).factory("driveSyncHooks",["$rootScope","appOptions","bgUploadService","localFileDb","googledrive","chromeRuntime","$q","driveFileWatcher","$log",function(a,b,c,d,e,f,g,h,i){function j(a){d.getFileDescriptor(a).then(function(b){return i.debug("staring sync upload",a),c.upload({fileId:a,target:"drive",privacy:"private",title:b.title,isSyncUpload:!0})})}function k(b,c){function f(a){if(a.title!==j.title){i.debug("title changed, applying post-upload changes");var b=a.title;return/\.webm/i.test(b)||(b+=".webm"),e.patchFile(k,{title:b})}return g.when()}if(c.config.isSyncUpload){var j=c.config,k=c.data.id;i.debug("sync upload of file %s complete, driveId %s",j.fileId,k),d.getFileDescriptor(j.fileId).then(function(a){return f(a)})["catch"](function(a){i.warn("sync upload hook failed",a)}).then(function(){a.$broadcast("event:syncUploadComplete",j.fileId),h.watchFile(k)})}}function l(a){return d.listFiles().then(function(b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];if(d.driveInfo&&d.driveInfo.id===a)return d}return g.reject()})}function m(b){return b.remove().then(function(){i.debug("removed local file",b.id),a.$broadcast("event:syncLocalFileRemoved",b.id)})}function n(c,d){b.values.driveSync&&(i.debug("drive file %s processed, removing local file",d),l(d).then(function(b){a.$broadcast("event:syncDriveFileProcessed",b.id),m(b)}))}function o(c,d){b.values.driveSync&&(i.debug("drive file %s remove detected, removing local file",d),l(d).then(function(b){a.$broadcast("event:syncDriveFileRemoved",b.id),m(b)}))}function p(a,c){b.values.driveSync&&j(c)}function q(){b.isLoaded()&&b.values.driveSync&&d.listFiles().then(function(a){angular.forEach(a,function(a){j(a.id)})})}function r(a,d){b.values.driveSync&&c.cancel({target:"drive",fileId:d})}var s={};return s.install=function(){a.$on("uploader:complete",k),a.$on("driveFileWatcher:processed",n),a.$on("driveFileWatcher:removed",o),a.$on("event:localFileCreated",p),a.$on("bgFiles:fileRemoved",r),a.$on("event:syncSetupComplete",q),a.$watch(function(){return b.values.driveSync},q)},s}]),angular.module("castifyExt.offline",[]).factory("onlineState",["$rootScope","$window","$http","$timeout","$log",function(a,b,c,d,e){function f(){if(m)return m;var a=Math.random().toString(36).substr(2,36),b=i+a;return m=c.get(b,{responseType:"arraybuffer",timeout:j}).then(function(){return m=null,e.debug("checkNetwork result is online"),!0},function(){return e.debug("checkNetwork result is offline"),m=null,!1}),m.then(g),m}function g(b){n!==b&&(e.debug("verified network state is ",b),n=b,a.$broadcast("onlineState:changed",b)),!b&&l.isNavigatorOnline()&&h(!0)}function h(a){function b(){return o=d(angular.noop,k),o.then(c)}function c(){return f().then(function(a){return!a&&l.isNavigatorOnline()&&p?b():void 0})}p||(p=!0,(a?b():c())["finally"](function(){p=!1}))}var i="https://www.google.com/images/cleardot.gif?",j=1e4,k=1e4,l={},m=null,n=!0,o=null,p=!1;return l.check=function(){return f()},l.isOnline=function(){return n},l.isNavigatorOnline=function(){return b.navigator.onLine!==!1},b.addEventListener("online",function(){l.check()}),b.addEventListener("offline",function(){g(!1),d.cancel(o),p=!1}),l}]),angular.module("castifyExt.syncAuthTool",["castifyExt.castifyAuth","w69b.chromeRuntime","castifyExt.appOptions","castifyExt.driveUtils"]).factory("syncAuthTool",["castifyAuth","$http","$q","$log","appOptions","chromeRuntime","$rootScope","driveUtils",function(a,b,c,d,e,f,g,h){var i={};return i.broadcastIfSyncError=function(a){return e.values.driveSync&&i.checkSetup()["catch"](function(b){switch(b){case"token":d.debug("syncAuthTool: sync enabled but we do not have a valid token"),g.$broadcast("event:syncAuthError"),f.sendMessage({type:"event:syncAuthError"});break;case"forbidden":d.debug("syncAuthTool: detected drive-forbidden error",a),g.$broadcast("event:syncForbiddenError");break;default:d.warn("syncAuthTool: unhandled sync error detected",a)}}),c.reject(a)},i.isGoogleForbiddenError=function(a){return!!(angular.isObject(a)&&403===a.status&&a.data&&a.data.error)},i.hasValidAuthToken=function(){return a.getAuthToken({interactive:!1,validate:!0})},i.checkSetup=function(){function a(){return h.getDriveUploadParentId()["catch"](function(a){return c.reject(i.isGoogleForbiddenError(a)?"forbidden":"unknown")})}return i.hasValidAuthToken()["catch"](function(){return c.reject("token")}).then(a).then(function(){return!0})},i}]),angular.module("castifyExt.requestMicPermission",[]).factory("requestMicPermission",["$window","$q","$interval",function(a,b,c){return function(){var d=b.defer(),e=a.open("mic.html","mic",""),f=!1;e.clGotStream=function(){f=!0,d.resolve()};var g=c(function(){e.closed&&!f&&d.reject("closed mic permission window without granting permission")},200);return d.promise["finally"](function(){c.cancel(g)}),d.promise}}]),angular.module("castifyExt.bgSyncStatus",["castifyExt.bgFiles","castifyExt.bgUpload","w69b.throttle","castifyExt.syncAuthTool","w69b.chromeRuntime"]).factory("bgSyncStatus",["bgFiles","bgUploadService","$rootScope","$log","throttle","syncAuthTool","chromeRuntime",function(a,b,c,d,e,f,g){function h(a){if("syncStatus"==a.name){I.push(a),j(),a.onDisconnect.addListener(function(){var b=I.indexOf(a);b>=0&&I.splice(b,1)});var b={retry:D.retry};a.onMessage.addListener(function(a){b.hasOwnProperty(a.type)&&b[a.type](a.data)})}}function i(a,b){I.forEach(function(c){c.postMessage({type:a,data:b})})}function j(){i("stateUpdate",F)}function k(a){l({type:"synced",numTotalFiles:a}),j()}function l(a){a.type!==F.type&&d.debug("syncStatus: changing state to ",a.type),F=a,"uploading"!==a.type&&(G={})}function m(){"uploading"!==F.type&&l({type:"uploading"});var a=0,b=0,c=0;angular.forEach(G,function(d){a+=d,++b,d>=1&&++c}),F.progress=a/b,F.numTotalFiles=b,F.numCompleteFiles=c,j()}function n(a){"waiting"!==F.type&&l({type:"waiting"}),F.numTotalFiles=a,j()}function o(a){"offline"!==F.type&&l({type:"offline"}),F.numTotalFiles=a,j()}function p(){l({type:"error",errorReason:"token"}),j()}function q(){l({type:"error",errorReason:"forbidden"}),j()}function r(){l({type:"error",numTotalFiles:H.length}),j()}function s(){f.checkSetup().then(r,function(a){"token"===a?p():"forbidden"===a?q():r()})}function t(a){var c=b.getTargetFileState(a,"drive");return c&&c.config.isSyncUpload?c:null}function u(a){var c=!1,d=!1;angular.forEach(a,function(a,b){G[b]=a&&a.progress||G[b]||0,a&&("uploading"===a.state?++c:"queued"===a.state&&++d)}),c?m():d&&(b.isOnline()?n(d):o(d))}function v(){b.isOnline()?s():o(0)}function w(){return H.length>0?void v():void a.listFiles().then(function(a){if(E){var b={},c=!1,d=0;angular.forEach(a,function(a){a.isSynced?G.hasOwnProperty(a.id)&&(G[a.id]=1):(b[a.id]=t(a.id),c=!0),++d}),angular.forEach(G,function(b,c){a[c]||delete G[c]}),c?u(b):k(d)}},function(){v()})}function x(a,b){var c=b.config,e=b.error;c.isSyncUpload&&(d.debug("sync error detected",e),H.contains(c.fileId)||H.push(c.fileId),w())}function y(){p()}function z(){q()}function A(){H=[],w()}function B(){l({type:"unknown"}),j(),E=c.$new(!0);var d=e(w,300,!1);E.$watchGroup([a.getListVersionId,b.getWatcherStateId,b.isOnline],function(){d()}),E.$on("uploader:failed",x),E.$on("event:syncAuthError",y),E.$on("event:syncForbiddenError",z),E.$on("event:syncSetupComplete",A)}function C(){E&&E.$destroy(),E=null,l({type:"disabled"}),j()}var D={},E=null,F={type:"unknown"},G={},H=[],I=[];return D.retry=function(){H=[],c.$broadcast("event:syncSetupComplete")},D.getState=function(){return F},D.install=function(){c.$watch(a.isSyncEnabled,function(a){a?B():C()}),g.onConnect.addListener(h)},D}]),angular.module("castifyExt.syncNotifications",["castifyExt.bgSyncStatus","w69b.throttle","w69b.chromeNotifications","castifyExt.ui.openInAppTab","castifyExt.appOptions","w69b.promiseTool","castifyExt.helpCenter"]).factory("syncNotifications",["$rootScope","bgSyncStatus","$log","throttle","chromeNotifications","$q","openInAppTab","appOptions","helpCenter","promiseTool",function(a,b,c,d,e,f,g,h,i,j){function k(a,b){v(function(){a=t+a;var c,d=!u;return u&&u!==a?(c=e.clear(u),d=!0):c=f.when(),b=angular.extend({type:"basic",priority:0,eventTime:Date.now(),isClickable:!1,title:"Saving on Drive",iconUrl:"images/icon128.png"},b),u=a,c.then(d?function(){return e.create(a,b)}:function(){return e.update(a,b)})})}function l(a){h.values.notifySyncProgress&&k("progress",{type:"progress",priority:0,message:"Your recording(s) are being saved "+a.numCompleteFiles+" / "+a.numTotalFiles,progress:Math.floor(100*a.progress)})}function m(a){h.values.notifySyncProgress&&k("waiting",{priority:-1,message:a.numTotalFiles+" recording(s) are waiting to get saved on Drive."})}function n(a){k("offline",{title:"You are offline",priority:1,message:a.numTotalFiles+" recording(s) are not saved on Drive yet."})}function o(a){"token"===a.errorReason?k("auth",{priority:2,title:"Drive Authentication Problem",message:"Screencastify cannot save to Drive.",buttons:[{title:"Setup Access"}]}):"forbidden"===a.errorReason?k("forbidden",{priority:2,title:"Drive Access Problem",message:"Drive Apps are probably disabled for your domain.",buttons:[{title:"Help"}]}):k("error",{priority:2,title:"Failed to save recordings on Drive.",message:"We failed to save "+a.numTotalFiles>0?a.numTotalFiles:"some recording(s) on Drive. Please contact support if this problem persists.",buttons:[{title:"Retry"}]})}function p(){v(function(){if(u){var a=e.clear(u);return u=null,a}})}function q(a,c){function d(b,d){return a===t+b&&c===(d||0)}d("error")?b.retry():d("auth")?g("#/sync-setup/"):d("forbidden")&&i.openHelp("drive_apps")}function r(){var a=b.getState(),c=w[a.type];c&&c(a)}var s={},t="sync_state_",u=null,v=j.serializer(),w={uploading:l,waiting:m,offline:n,error:o,synced:p,disabled:p};return s.install=function(){b.install();var c=d(r,1e3,!1);a.$watchCollection(b.getState,function(){c()}),e.onButtonClicked.addListener(q)},s}]),angular.module("castifyExt.youtubeAuth",["w69b.uritool","castifyExt.castifyAuth"]).provider("youtubeAuth",function(){var a,b=["https://www.googleapis.com/auth/youtube"];this.setScopes=function(a){b=a},this.setClientId=function(b){a=b},this.$get=["castifyAuth","$log","uritool","$q","$http","castifyConfig",function(c,d,e,f,g,h){function i(a){return q+"?"+e.encodeQuery(a)}function j(a){return a.data}function k(){var e={redirect_uri:c.getRedirectURL(),scope:b.join(" "),response_type:"code",client_id:a,access_type:"offline",include_granted_scopes:!1,prompt:"select_account consent"},g=i(e),h={url:g,interactive:!0};return c.launchWebAuthFlow(h).then(function(a){return d.debug("youtube oauth result",a),a.code?a.code:f.reject("youtube_flow_returned_no_code")})}function l(a){return g.post(o,{code:a,version:2},{googleAuth:!0}).then(j,function(a){return d.warn("adding youtube code failed",a),f.reject("youtube_add_code_failed")})}function m(a){return g.get(p+"/"+a,{googleAuth:!0}).then(j).then(function(a){return a.expiresAt=Number(new Date(a.expiresAt)),a.issuedAt=Number(new Date(a.issuedAt)),a})}var n=h.API_URL+"/youtube/",o=n+"channels",p=n+"tokens",q="https://accounts.google.com/o/oauth2/auth",r={},s=0,t={};return t.addChannel=function(){return c.getAuthToken({interactive:!0}).then(k).then(l)},t.listChannels=function(){return g.get(o,{googleAuth:!0}).then(j)},t.removeChannel=function(a){return g["delete"](o+"/"+a,{googleAuth:!0}).then(j)},t.getAuthToken=function(a){if(!a.channelId)throw new Error;var b,c=a.channelId,d=Math.floor(Date.now()-s)+12e4,e=r[c];return e&&e.expiresAt>d?b=f.when(e):(b=m(c),b.then(function(a){r[c]=a,a.issuedAt&&(s=Date.now()-Number(a.issuedAt))})),b.then(function(a){return a.accessToken})},t}]}).factory("youtubeHttpAuthInterceptor",["$q","$injector","$log",function(a,b,c){function d(a){var b={channelId:a};return f().getAuthToken(b)}function e(a){return{Authorization:"Bearer "+a}}function f(){return g||(g=b.get("youtubeAuth")),g}var g;return{request:function(b){return b.youtubeAuth?(b.googleAuth&&delete b.googleAuth,d(b.youtubeAuth).then(function(a){return b.headers=angular.extend(b.headers||{},e(a)),b},function(b){return c.warn("youtubeAuth failed",b),a.reject("youtubeAuth failed")})):b}}}]),angular.module("castifyExt.enterprisePolicy",["w69b.chromeStorage"]).factory("enterprisePolicy",["chromeStorage","$rootScope",function(a,b){var c={},d=!1,e={},f=["disableSharing","disableSaveToDisk","options"];return f.forEach(function(a){Object.defineProperty(c,a,{get:function(){return e[a]}})}),c.loadedPromise=a.managed.get(f).then(function(a){angular.extend(e,a),d=!0}),c.isLoaded=function(){return d},c.has=function(a){return e.hasOwnProperty(a)},c.get=function(a){return e[a]},a.onChanged.addListener(function(a,c){"managed"===c&&(angular.forEach(a,function(a,b){e[b]=a.newValue}),b.$$phase||b.$digest())}),c}]),angular.module("castifyExt.crashReporter",["w69b.chromePersistentLogger","w69b.chromeRuntime"]).factory("crashReporter",["castifyConfig","chromeRuntime","$http","chromePersistentLogger",function(a,b,c,d){function e(){return b.getManifest().version}function f(){return d.save().then(function(){return d.getMergedLogs(["popup","background","app"])})}var g=a.API_URL+"/crash",h={};return h.report=function(a,b){f().then(function(d){return c.post(g,{module:a,version:e(),logs:d.join("\n"),core:b})})},h}]),angular.module("castifyExt.helpCenter",["w69b.chromeTabs"]).factory("helpCenter",["chromeTabs",function(a){var b={};return b.tagUrls={},b.registerUrl=function(a,c){b.tagUrls[a]=c},b.openHelp=function(c){var d=b.tagUrls[c];if(!d)throw new Error("No help url registered for "+c);a.create({url:d})},b.setNotifyHelp=function(a,c){a.onButtonClicked=a.onClicked=function(){b.openHelp(c),a.close()}},b}]),angular.module("castifyExt.helpCenterConfig",["castifyExt.helpCenter"]).run(["helpCenter",function(a){a.registerUrl("load_nacl","https://screencastify.uservoice.com/knowledgebase/articles/507908"),a.registerUrl("disk_space","https://screencastify.uservoice.com/knowledgebase/articles/507914"),a.registerUrl("drive_apps","https://screencastify.uservoice.com/knowledgebase/articles/460525"),a.registerUrl("start_recording","https://screencastify.uservoice.com/knowledgebase/articles/448826")}]),angular.module("castifyExt.oauthTokenCache",["w69b.chromeStorage"]).factory("oauthTokenCache",["chromeStorage","$q",function(a,b){function c(c){function d(){return a.local.getSingle(c).then(function(a){return a||{}})}function e(a){var b=f();angular.forEach(a,function(c,d){(!d.expiresAt||d.expiresAt<=b)&&delete a[c]})}function f(){return Math.floor(Date.now()-g)+12e4}var g=0,h={};return h.get=function(a){return d().then(function(c){var d=c[a];return d&&d.expiresAt>f()?b.when(d):b.reject()})},h.put=function(b,f){
return d().then(function(d){return d[b]=f,f.issuedAt&&(g=Date.now()-Number(f.issuedAt)),e(d),a.local.setSingle(c,d)})},h.removeByToken=function(b){return d().then(function(d){return angular.forEach(d,function(a,c){a.accessToken===b&&delete d[c]}),a.local.setSingle(c,d)})},h.remove=function(b){return d().then(function(d){return delete d[b],a.local.setSingle(c,d)})},h.withCache=function(a,b){return h.get(a)["catch"](function(){return b().then(function(b){return h.put(a,b).then(function(){return b})})})},h}return c}]),angular.module("castifyExt.castifyAuth",["w69b.chromeStorage","w69b.uritool","w69b.es6","w69b.chromeRuntime","w69b.uuid","w69b.promiseTool","castifyExt.oauthTokenCache"]).provider("castifyAuth",function(){var a,b=[],c="",d=!1;this.setScopes=function(a){b=a},this.setClientId=function(b){a=b},this.setRedirectUri=function(a){c=a},this.useChromeAccount=function(a){d=a},this.$get=["$q","uritool","$rootElement","$window","chromeRuntime","$interval","castifyConfig","$http","chromeStorage","oauthTokenCache","uuid","promiseTool","$log","$rootScope",function(e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(){var a=h.chrome.identity;return p.wrapChromeError(a.getProfileUserInfo,a)().then(function(a){return a.email?a.email:e.reject()})}function t(){h.chrome.tabs.create({url:"chrome://chrome-signin/"},angular.noop)}function u(a){return l.get("https://www.googleapis.com/oauth2/v1/tokeninfo",{params:{access_token:a.accessToken}}).then(function(){return a},function(b){return 400===b.status?e.reject("invalid token"):a})}function v(a){return l.get(F,{headers:{Authorization:"Bearer "+a}}).then(function(a){return a.data.haveCredentials})["catch"](function(a){return 0===a.status||a.status>=500})}function w(b){return b=angular.extend({redirect_uri:c,response_type:"code",client_id:a,access_type:"offline",include_granted_scopes:"true"},b),E+"?"+f.encodeQuery(b)}function x(a){var b=e.defer(),c=function(c){if("oauth2AuthResult"===c.type){var d=c.data,e=f.parseUrl(d),g=f.parseQuery((e.hash||e.query).substring(1));if(!g||g.state!==a)return;g.error?b.reject({error:g.error||"immediate_failed"}):b.resolve(g)}};return i.onMessage.addListener(c),b.promise["finally"](function(){i.onMessage.removeListener(c)}),b}function y(a,b){var c=angular.element('<iframe src="'+a+'" tabindex="-1" style="display:hidden"></iframe>');g.append(c);var d=x(b);return d.promise["finally"](function(){c.remove()}),p.withTimeout(function(){return d.promise},J,function(){return d.reject(),q.debug("castifyAuth: iframe load timed out"),e.reject(M.NetworkError)})}function z(a){var b=o(),c=w({scope:a.scope,access_type:"online",response_type:"token",login_hint:a.email,state:b,prompt:"none"});return y(c,b).then(function(a){return{expiresAt:Date.now()+1e3*Number(a.expires_in),accessToken:a.access_token}})}function A(a){return l.post(F,{code:a}).then(function(a){return a.data}).then(function(a){return a.expiresAt=Number(new Date(a.expiresAt)),a.issuedAt=Number(new Date(a.issuedAt)),a})}function B(a,b){var c=h.open(a,"castifySignIn","location=no"),d=!1,e=x(b);e.promise.then(function(){d=!0});var f=j(function(){c.closed&&!d&&(q.debug("castifyAuth: user closed oauth window"),e.reject("auth_window_closed"))},200);return e.promise["finally"](function(){j.cancel(f)}),e.promise}function C(b){var c=o(),d={scope:b.scope,response_type:"code",client_id:a,access_type:"offline",state:c},e=[];b.email?d.login_hint=b.email:e.push("select_account"),b.forceConsent&&e.push("consent"),d.prompt=e.join(" ");var f=w(d),g=B(f,c);return g.then(function(a){return a.code})}function D(a){function b(a){return C(a).then(A).then(function(c){return a.email&&c.email!==a.email?b(a):c})}return b(a)["catch"](function(c){return c&&c.data&&"no_refresh_code"===c.data.error?b(angular.extend({},a,{forceConsent:!0})):e.reject(c)})}var E="https://accounts.google.com/o/oauth2/auth",F=k.API_URL+"/auth",G="castifyAuth:account",H="castifyAuth:cache",I=n(H),J=1e4,K=p.serializer(),L=[],M={};return M.NotSignedInError="not_signed_in",M.NetworkError="network_error",M.getAccount=function(){return m.local.getSingle(G).then(function(a){return a?a:e.reject()})},M.setAccount=function(a){return m.local.setSingle(G,a).then(M.onSignInChanged.$fire)},M.getAuthToken=function(a){function c(a){return a+":"+l.scope}function f(b){return v(b.accessToken).then(function(c){if(c)return b;if(a.interactive){q.debug("castifyAuth: token not stored on server, getting code");var d=D(l);return d.then(M.onSignInChanged.$fire),d}return e.reject(M.NotSignedInError)})}function g(b){return l.email=b,I.withCache(c(b),function(){return z(l)["catch"](function(b){if(a.interactive&&b&&"immediate_failed"===b.error){var c=D(l);return c.then(M.onSignInChanged.$fire),c}return e.reject(b)}).then(f)})}function h(){return!a.interactive||a.useChromeAccount?e.reject(M.NotSignedInError):D(l).then(function(a){return e.all([I.put(c(a.email),a),M.setAccount(a.email)]).then(function(){return a})})}function i(b){return g(b).then(function(d){return a.validate?u(d)["catch"](function(){return I.remove(c(b)).then(function(){return g(b).then(u)})}):d})}function j(){return a.useChromeAccount?s()["catch"](M.getAccount):"select_account"===a.interactive?e.reject():M.getAccount()}function k(){var b=j().then(i,h).then(function(a){return a.accessToken});return b["catch"](function(b){b===M.NotSignedInError&&a.useChromeAccount&&a.interactive&&t()}),b}a=angular.extend({interactive:!1,scopes:b,useChromeAccount:d},a),a.scopes||(a.scopes=b);var l={scope:a.scopes.join(" ")};return K(k)},M.removeCachedAuthToken=function(a){return I.removeByToken(a.token)},M.launchWebAuthFlow=function(a){return a.interactive?B(a.url,a.state):B(a.url,a.state)},M.getRedirectURL=function(){return c},M.onSignInChanged={$fire:function(){L.forEach(function(a){a()}),r.$broadcast("castifyAuth:signInChanged")},addListener:function(a){L.push(a)},removeListener:function(a){L=L.filter(function(b){return b!==a})}},d&&h.chrome.identity.onSignInChanged.addListener(M.onSignInChanged.$fire),M}]}).factory("googleauth",["castifyAuth","$q",function(a,b){var c={};return c.loadClient=function(){return b.when()},c.getAuthToken=function(b){a.getAuthToken(angular.isObject(b)?b:{interactive:!!b})},c}]),angular.module("castifyEdit.pnaclVideoEditor",["w69b.pnaclModule","w69b.promiseTool"]).factory("pnaclVideoEditor",["pnaclModule","$q","$log","$rootScope","promiseTool",function(a,b,c,d,e){function f(f,g){function h(){p={state:"inactive",time:0}}function i(){q.unload(),h()}function j(a){p=a,("done"===a.state||"cancelled"===a.state)&&q.unload()}function k(a){i(),r&&r.reject(a),r=null}function l(a){c.error("pnaclVideoEditorError",a),k(a),u.onError&&u.onError(a)}function m(a,b){q.postMessage({type:a,data:b||{}})}function n(a,c){if(r)throw new Error("there is still a pending operation");return r=b.defer(),a&&m(a,c),r.promise}function o(a){if(!/^\/html5_(temporary|persistent)\//.test(a))throw new Error("invalid filename")}var p,q=a(f,g),r=null,s=8e5,t=["start","cancel"],u={};return q.onMessage=function(a){if(a=a.data,t.indexOf(a.type)>=0){if(!r)return;a.data?r.reject(a.data):r.resolve(),r=null}else if("error"==a.type)l(a.data),d.$$phase||d.$digest();else if("state"==a.type)j(a.data),d.$$phase||d.$digest();else{var b;a.data&&(b=a.data,b.trim&&(b=b.trim())),c.debug(a.type,b)}},u.onCrash=void 0,q.onCrash=function(){k(),u.onCrash&&u.onCrash.apply(null,arguments)},u.load=function(){return q.load()},u.getStateObj=function(){return p},u.cancel=function(){return e.withTimeout(function(){return n("cancel")},1e3)["catch"](function(){return null}).then(function(){k()})},u.hasPendingOperation=function(){return!!r},u.start=function(a){return o(a.inFilename),o(a.outFilename),e.withTimeout(function(){return q.load().then(function(){return n("start",{config:JSON.stringify(a)})})},s,function(){return l("start_timeout"),b.reject("start_timeout")})},h(),u}return f}]),angular.module("castifyEdit.localEditJob",["castifyEdit.pnaclVideoEditor","w69b.filesHelper"]).factory("startLocalEditJob",["pnaclVideoEditor","$q","$log","$rootScope",function(a,b,c,d){function e(f){function g(){k=d.$watch(function(){return j.getStateObj().state},function(a){"done"===a?i.resolve():"error"===a&&i.resolve(j.getStateObj().errorReason)})}function h(){return j=a(e.NACL_URL),i=b.defer(),j.start(f).then(g,function(a){c.error("failed to start local edit job",a),i.reject("start_error")}),j.onCrash=function(){i.reject("crash")},j.onError=function(a){c.error("localEditJob error: ",a),i.reject(a)},i.promise["finally"](k),i.promise}var i,j,k=angular.noop,l={};return l.getProgress=function(){var a=j.getStateObj();return a.totalMs&&a.progressMs?a.progressMs/a.totalMs:0},l.cancel=function(){return j.cancel()},l.promise=h(),l}return e}]),angular.module("castifyEdit.remoteEditJob",["castifyEdit.pnaclVideoEditor"]).factory("startRemoteEditJob",["$q","$log","$timeout","$http","castifyConfig",function(a,b,c,d,e){function f(e){function f(){p&&c.cancel(p),c(function(){p=null,l()},h)}function i(){return d.get(g+"/"+o,{googleAuth:!0}).then(function(a){return a.data})}function j(a){n.reject(a)}function k(a){var b;b="gif"===e.outFormat?{url:g+"/export/"+a.id+"/"+a.result.gcsFile}:a.result,n.resolve(b)}function l(){i().then(function(a){var c=a.state;"completed"===c?k(a):"failed"===c?j(a.result&&a.result.error?a.result.error:"remote_failed"):"cancelled"===c?b.debug("remote edit job was cancelled",o):(q=a.progress,f())},function(a){a.status>=400&&a.status<500?j(a):f()})}function m(){return n=a.defer(),d.post(g,{config:e,version:2},{googleAuth:!0}).then(function(a){var c=a.data;b.debug("startRemoteEditJob: job created",c.id),o=c.id,f()},j),n.promise}var n,o,p,q=0,r={};return r.getProgress=function(){return q},r.cancel=function(){return o?d["delete"](g+"/"+o,{googleAuth:!0}):a.reject()},r.promise=m(),r}var g=e.API_URL+"/edit",h=3e3;return f}]),angular.module("castifyEdit.bgEditJobScheduler",["castifyEdit.startEditJob","castifyExt.bgFiles"]).factory("ScheduledEditJob",["startEditJob","bgFiles",function(a,b){function c(a){this.config=a,this.state="queued",this.id=d++,b.getFileDescriptor(a.meta.fileId).then(function(a){this.fileDesc=a}.bind(this))}var d=1,e=c.prototype;return e.start=function(){var b=this;b.state="running";var c=a(b.config);return c=c.then(function(a){return b.editJob=a,a.promise}),c.then(b.onComplete_.bind(b),b.onError_.bind(b)),c},e.getProgress=function(){return"done"===this.state?1:"running"===this.state&&this.editJob?this.editJob.getProgress():0},e.onComplete_=function(a){this.result=a,this.state="done"},e.onError_=function(){this.state="error"},e.cancel=function(){return this.editJob?(this.editJob.cancel(),this.state="cancelled",!0):!1},e.toJSON=function(){var a={id:this.id,fileId:this.config.meta.fileId,result:this.result,state:this.state,progress:this.getProgress()};return this.fileDesc&&(a.fileTitle=this.fileDesc.title),a},c}]).factory("bgEditJobScheduler",["chromeRuntime","$rootScope","ScheduledEditJob","$log",function(a,b,c,d){function e(a){return o.filter(function(b){return b.state===a})}function f(a){return o.find(function(b){return b.id===a})}function g(){return e("running")}function h(){return e("queued")}function i(){if(!(g().length>0)){var a=e("queued");if(a.length){var c=a[0],d=c.start();b.$broadcast("editJob:started",c.id),d.then(k.bind(null,c),j.bind(null,c))}}}function j(a,c){d.warn("scheduled edit job failed",a,c),i(),b.$broadcast("editJob:failed",a.id,c)}function k(a,c){d.debug("scheduled edit job completed",a,c),i(),b.$broadcast("editJob:completed",a.id,c)}function l(){function c(){d("jobsList",n.getJobs())}function d(a,b){h.forEach(function(c){c.postMessage({type:a,data:b})})}function e(){n.clearComplete(),c()}function f(a){if("editor"==a.name){h.push(a),a.onDisconnect.addListener(function(){var b=h.indexOf(a);b>=0&&h.splice(b,1)});var b={addJob:n.addJob,cancel:n.cancel,getJobs:c,clearComplete:e};a.onMessage.addListener(function(a){b.hasOwnProperty(a.type)&&b[a.type](a.data)})}}function g(){b.$on("editJob:completed",c),b.$on("editJob:started",c),b.$on("editJob:failed",c),b.$on("editJob:cancelled",c),a.onConnect.addListener(f)}var h=[];g()}function m(){(h().length||g().length)&&(d.info("onSuspend() while editing is active, preventing unloading"),a.getBackgroundPage())}var n={},o=[];return n.addJob=function(a){var b=new c(a);return o.push(b),i(),b},n.cancel=function(a){d.debug("trying to cancel edit job",a);var c=f(a);c&&c.cancel()&&b.$broadcast("editJob:cancelled",c.id)},n.getJob=function(a){return f(a)},n.getJobs=function(){return o},n.clearComplete=function(){o=o.filter(function(a){return"done"!==a.state})},n.install=function(){l(),a.onSuspend.addListener(m)},n}]),angular.module("castifyEdit.startEditJob",["castifyEdit.localEditJob","castifyEdit.remoteEditJob","castifyExt.bgFiles","w69b.filesHelper","castifyExt.videoPreviewRenderer","castifyExt.fileNameGenerator"]).factory("startEditJob",["startLocalEditJob","startRemoteEditJob","bgFiles","filesHelper","videoPreviewRenderer","$log","fileNameGenerator","$q","$rootScope",function(a,b,c,d,e,f,g,h,i){function j(j){function p(){return d.getDirByPath(l,{create:!0})}function q(){var b="gif"===j.outFormat?n:m;return p().then(function(){var d=angular.extend({inFilename:k+c.idToLocalFilename(C.id),outFilename:k+b},j);return delete d.meta,a(d)})}function r(){return f.debug("running local post edit steps"),"gif"===j.outFormat?s():t()}function s(){return f.info("gif export complete"),d.getFileEntryByPath(n).then(function(a){return{url:a.toURL()}})}function t(){var a;return g("",".webm").then(function(b){return a=c.localFilenameToId(b),d.moveFileByPath(m,b)["catch"](function(a){return f.error("failed to move edited file to ",b),h.reject(a)})}).then(function(){return f.debug("rendering preview"),e.renderPreview(a)["catch"](function(){return f.info("rendering preview image for edit failed"),null})}).then(function(){return c.registerLocalFile(a)}).then(function(){return c.rename(a,C.title+o),{fileId:a}})}function u(a){return f.debug("running local post edit steps"),h.reject(a)}function v(){d.removeByPath(m),d.removeByPath(n)}function w(){var a=angular.extend({},j,{meta:{driveId:C.driveInfo.id}});return b(a)}function x(a){return f.debug("running drive post edit steps for",a),i.$broadcast("event:driveFileCreated",a.id),a.id}function y(a){return a}function z(a){return f.debug("remote edit job completed"),"gif"===j.outFormat?y(a):x(a)}function A(a){return h.reject(a)}function B(){return c.getFileDescriptor(j.meta.fileId).then(function(a){if(C=a,a.isSynced){var b=w();return b.promise=b.promise.then(z,A),b}return q(a).then(function(a){a.promise=a.promise.then(r,u);var b=a.cancel.bind(a);return a.cancel=function(){return b().then(v)},a})})}var C;return B()}a.NACL_URL="manifest_editor.nmf";var k="/html5_persistent/",l="_tmp",m=l+"/edited.webm",n=l+"/exported.gif",o=" - Cropped";return j}]),angular.module("castifyEdit.editNotifications",["castifyEdit.bgEditJobScheduler","w69b.chromeNotifications","castifyExt.ui.openInAppTab","castifyExt.appOptions","w69b.promiseTool"]).factory("editNotifications",["$rootScope","$log","chromeNotifications","$q","openInAppTab","appOptions","chromeTabs","promiseTool","$interval","bgEditJobScheduler",function(a,b,c,d,e,f,g,h,i,j){function k(a){function b(b,e){l(function(){var f,g=s+a+":"+b,h=!k;return k&&k!==g?(f=c.clear(k),h=!0):f=d.when(),e=angular.extend({type:"basic",priority:0,eventTime:Date.now(),isClickable:!1,title:"Processing Video",iconUrl:"images/icon128.png"},e),k=g,f.then(h?function(){return c.create(g,e)}:function(){return c.update(g,e)})})}function e(){b("progress",{type:"progress",message:"We are currently processing your video.",progress:Math.floor(100*n.getProgress())})}var g,k=null,l=h.serializer(),m={},n=j.getJob(a);return m.hide=function(){i.cancel(g),l(function(){if(k){var a=c.clear(k);return k=null,a}})},m.start=function(){f.values.notifyEditProgress&&(e(),g=i(e,1e3))},m.complete=function(a){f.values.notifyEditProgress&&(i.cancel(g),a.fileId?b("complete:"+a.fileId,{type:"basic",title:"Processing Complete",message:"Your video is ready",buttons:[{title:"Show File"}]}):m.hide())},m.failure=function(){i.cancel(g),b("failed",{type:"basic",title:"Failed to process Video",message:"Please contact support if this problem persists"})},m}function l(a){var b=t[a];return b||(b=k(a),t[a]=b),b}function m(a,b){l(b).start()}function n(a,b,c){l(b).failure(c),delete t[b]}function o(a,b,c){l(b).complete(c),delete t[b]}function p(a,b){l(b).hide(),delete t[b]}function q(a,b){function d(c,d){if(a.startsWith(s)){var e=a.split(":").slice(2,3)[0];return e===c&&b===(d||0)}return!1}if(d("complete")){var f=a.split(":").slice(-1)[0];e("app.html#/files/"+encodeURIComponent(f)),c.clear(a)}}var r={},s="edit:",t={};return r.install=function(){a.$on("editJob:started",m),a.$on("editJob:failed",n),a.$on("editJob:completed",o),a.$on("editJob:cancelled",p),c.onButtonClicked.addListener(q)},r}]),angular.module("w69b.analytics",[]).provider("analytics",[function(){var a;this.setTrackingId=function(b){a=b},this.$get=["$document","$window",function(b,c){var d={};return d.trackPageView=function(a){d.callInternal(["send","pageview",a])},d.setEnabled=function(b){c["ga-disable-"+a]=!b},d.loadLib=function(){!function(a,b,c,d,e){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date;var f=b.createElement(c),g=b.getElementsByTagName(c)[0];f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(c,b[0],"script","https://www.google-analytics.com/analytics.js","ga"),d.callInternal(["create",a,"auto"]),d.callInternal(["set","forceSSL",!0])},d.set=function(a,b){d.callInternal(["set",a,b])},d.trackEvent=function(){var a=Array.prototype.slice.call(arguments);d.callInternal(["send","event"].concat(a))},d.sendTiming=function(){var a=Array.prototype.slice.call(arguments);d.callInternal(["send","timing"].concat(a))},d.callInternal=function(a){c.ga&&c.ga.apply(null,a)},d.trackTimer=function(a,b,c){var e,f={};return f.start=function(){return e=(new Date).getTime(),f},f.send=function(g,h,i){var j=(new Date).getTime();return d.sendTiming(g||a,h||b,j-e,i||c),f},f.start(),f},d}]}]).directive("analyticsEvent",["analytics",function(a){return{restrict:"A",link:function(b,c,d){var e=d.analyticsEvent;if(!e)throw new Error;var f=e.split(",");c.bind("click",function(){a.trackEvent.apply(a,f)})}}}]),angular.module("w69b.chromeCapture",["w69b.promiseTool","w69b.webrtc"]).factory("chromeCapture",["promiseTool","webrtc",function(a,b){var c={};return chrome.tabCapture&&(c.tabCapture=a.wrapChromeError(chrome.tabCapture.capture,chrome.tabCapture)),chrome.desktopCapture&&(c.chooseDesktopMedia=a.wrapChromeError(chrome.desktopCapture.chooseDesktopMedia,chrome.desktopCapture)),c.desktopCapture=function(a){var c={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxWidth:1920,maxHeight:1200}}};return b.getUserMedia(c)},c}]),angular.module("w69b.chromeCommands",["w69b.promiseTool"]).factory("chromeCommands",["promiseTool",function(a){var b={};return b.getAll=a.wrapChromeError(chrome.commands.getAll,chrome.commands),b.onCommand=chrome.commands.onCommand,b}]),angular.module("w69b.chromePersistentLogger",["w69b.chromeStorage","w69b.logging","w69b.structs.CircularBuffer"]).provider("chromePersistentLogger",["$logProvider",function(a){function b(a,b){var d={level:a,args:b,timestamp:(new Date).getTime()};return c?c.add(d):e.push(d),!0}var c,d="logs",e=[],f=!1,g=1e3,h="logs_",i=!1,j=!0;this.setStorageKey=function(a){d=a},this.setMaxNumLogs=function(a){g=a},this.enableAutoLoad=function(a){f=a},this.enableAutoSave=function(a){j=a},this.enableGlobalHandler=function(a){i=a},this.install=function(){this.enableAutoLoad(!0),a.setCustomHook(b)},this.$get=["$window","$q","chromeStorage","CircularBuffer","$log",function(a,k,l,m,n){function o(a){var b=a.args.map(function(a){if(!angular.isObject(a))return a;try{return angular.toJson(a)}catch(b){return a}});return[new Date(a.timestamp).toISOString(),a.level.toUpperCase(),b.join(", ")].join(" ")}function p(a){var b=new m(g);return a.forEach(function(a){b.add(a)}),b}var q={};return q.load=function(){return l.local.getSingle(h+d).then(function(a){a&&a.length&&(c=p(a.concat(q.getEntries())))})},q.save=function(a){return l.local.setSingle(h+(a||d),q.getEntries())},q.clear=function(){c.clear()},q.getEntries=function(){return c.getValues()},q.getLogs=function(){return q.getEntries().map(o)},q.getMergedLogs=function(a){return a=a.map(function(a){return h+a}),l.local.get(a).then(function(a){var b=[];return angular.forEach(a,function(a,c){a&&a.length&&a.forEach(function(a){a.storageKey=c.substr(h.length),b.push(a)})}),b.sort(function(a,b){return a.timestamp-b.timestamp}),b.map(function(a){return"["+a.storageKey+"] "+o(a)})})},q.hookFn=b,c=p(e),e=null,f&&q.load(),i&&(a.onerror=function(a,b,c){n.error("global error",a,b,c)}),j&&a.addEventListener("unload",function(){q.save()}),q}]}]).run(["chromePersistentLogger",angular.noop]),angular.module("w69b.chromeRuntime",["w69b.promiseTool"]).factory("chromeRuntime",["promiseTool",function(a){var b={};return b.sendMessage=a.wrapChromeError(chrome.runtime.sendMessage,chrome.runtime),b.getBackgroundPage=a.wrapChromeError(chrome.runtime.getBackgroundPage,chrome.runtime),b.connect=chrome.runtime.connect.bind(chrome.runtime),b.getManifest=chrome.runtime.getManifest.bind(chrome.runtime),b.id=chrome.runtime.id,["onMessage","onConnect","onConnectExternal","onInstalled","onSuspend"].forEach(function(a){b[a]={addListener:function(b){chrome.runtime[a].addListener(b)},removeListener:function(b){chrome.runtime[a].removeListener(b)}}}),b}]),angular.module("w69b.chromeStorage",["w69b.promiseTool"]).factory("chromeStorage",["promiseTool",function(a){var b=chrome.storage,c={};return["local","sync","managed"].forEach(function(d){c[d]={},["set","get","remove","clear"].forEach(function(e){c[d][e]=a.wrapChromeError(b[d][e],b[d])}),c[d].setSingle=function(a,b){var e={};return e[a]=b,c[d].set(e)},c[d].getSingle=function(a,b){return c[d].get(a).then(function(c){return c.hasOwnProperty(a)?c[a]:b})}}),c.onChanged=b.onChanged,c}]),angular.module("w69b.chromeTabs",["w69b.promiseTool"]).factory("chromeTabs",["$window","promiseTool","$q",function(a,b,c){if(!a.chrome||!a.chrome.tabs)return null;var d=a.chrome,e={};return e.query=b.wrapChromeError(d.tabs.query,d.tabs),e.getActiveTab=function(){return e.query({active:!0,windowId:d.windows.WINDOW_ID_CURRENT}).then(function(a){return a.length?a[0]:c.reject()})},e.get=b.wrapChromeError(d.tabs.get,d.tabs),e.update=b.wrapChromeError(d.tabs.update,d.tabs),e.remove=b.wrapChromeError(d.tabs.remove,d.tabs),e.create=b.wrapChromeError(d.tabs.create,d.tabs),e.connect=d.tabs.connect.bind(d.tabs),e.executeScript=b.wrapChromeError(d.tabs.executeScript,d.tabs),e.insertCSS=b.wrapChromeError(d.tabs.insertCSS,d.tabs),e.sendMessage=b.wrapChromeError(d.tabs.sendMessage,d.tabs),e.onUpdated=d.tabs.onUpdated,e.onActivated=d.tabs.onActivated,e.sendMessageActive=function(a,b){return e.getActiveTab().then(function(c){return e.sendMessage(c.id,a,b)})},e}]).directive("newTab",["chromeTabs",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(b){b.preventDefault(),a.create({url:d.href}).then(function(a){chrome.windows.update(a.windowId,{focused:!0},angular.noop)})})}}}]),angular.module("w69b.chromeWindows",[]).factory("chromeWindows",["promiseTool",function(a){var b={};return b.get=a.wrapChromeError(chrome.windows.get,chrome.windows),b.create=a.wrapChromeError(chrome.windows.create,chrome.windows),b.update=a.wrapChromeError(chrome.windows.update,chrome.windows),b.getCurrent=a.wrapChromeError(chrome.windows.getCurrent,chrome.windows),b.remove=a.wrapChromeError(chrome.windows.remove,chrome.windows),b.onRemoved=chrome.windows.onRemoved,b}]),angular.module("w69b.filesHelper",["w69b.promiseTool"]).factory("filesHelper",["$window","promiseTool","$q",function(a,b,c){function d(a){var b=a.split("/"),c=b.slice(0,-1).join("/"),d=b.slice(-1)[0];return[c,d]}a.requestFileSystem=a.requestFileSystem||a.webkitRequestFileSystem;var e=window.PERSISTENT,f=104857600,g={},h=["readEntries","remove","getFile","getMetadata","moveTo","file","getDirectory","createWriter"];return h.forEach(function(a){g[a]=function(c){var d=[].slice.call(arguments,1);return b.wrapCallbacks(c[a],c).apply(null,d)}}),g.getFileSystem=function(c,d){return angular.isUndefined(c)&&(c=e),d=d||f,b.wrapCallbacks(a.requestFileSystem,a)(c,d)},g.getPersistentQuota=function(){var b=c.defer();return a.navigator.webkitPersistentStorage.queryUsageAndQuota(function(a,c){b.resolve({usage:a,quota:c})},function(a){b.reject(a)}),b.promise},chrome.system&&chrome.system.storage&&(g.getStorageInfo=b.wrapChromeError(chrome.system.storage.getInfo,chrome.system.storage)),g.getDirByPath=function(a,b){function d(a,e){return e.length?g.getDirectory(a,e[0],b||{}).then(function(a){return d(a,e.slice(1))}):c.when(a)}var e=a.split("/");return""===e[0]&&e.splice(0,1),g.getFileSystem().then(function(a){return d(a.root,e,b)})},g.moveFileByPath=function(a,b){var e=d(b),f=e[0],h=e[1];return c.all({file:g.getFileEntryByPath(a),targetDir:g.getDirByPath(f)}).then(function(a){return g.moveTo(a.file,a.targetDir,h)})},g.getFileEntryByPath=function(a,b,c){var e=d(a),f=e[0],h=e[1];return g.getDirByPath(f,c).then(function(a){return g.getFile(a,h,b||{})})},g.getFileByPath=function(a){return g.getFileEntryByPath(a).then(function(a){return g.file(a)})},g.removeByPath=function(a){return g.getFileEntryByPath(a).then(function(a){return g.remove(a)})},g.listByPath=function(a){return g.getDirByPath(a).then(function(a){var b=a.createReader();return g.readEntries(b)})},g.requestPersistentQuota=function(a){return b.wrapCallbacks(navigator.webkitPersistentStorage.requestQuota,navigator.webkitPersistentStorage)(a||f)},g.requestTemporaryQuota=function(a){return b.wrapCallbacks(navigator.webkitTemporaryStorage.requestQuota,navigator.webkitTemporaryStorage)(a||f)},g}]),angular.module("w69b.googleHttpAuthInterceptor",[]).provider("googleHttpAuthInterceptor",function(){var a=0,b="googleauth";this.enableAuthAutoRetry=function(b){a=b?1:0},this.setAuthProvider=function(a){b=a},this.$get=["$q","$log","$injector",function(c,d,e){function f(){return l||(l=e.get(b)),l}function g(a){return f().getAuthToken(a)}function h(a){return{Authorization:"Bearer "+a}}function i(){return k||(k=e.get("$http")),k}function j(b){var e=b.status;if(401==e&&b.config.googleAuth&&b.config.authAutoRetry!==!1){d.debug("auth error detected",b);var f=angular.copy(b.config);if(f.authRetryCount?f.authRetryCount++:f.authRetryCount=1,f.authRetryCount<=a)return g({scopes:f.googleAuthScopes,validate:!0}).then(function(){return d.debug("googleAuthHttpInterceptor: auto-retrying with validated token"),i()(f)})}return c.reject(b)}var k,l;return{request:function(a){return a.googleAuth?g({scopes:a.googleAuthScopes}).then(function(b){return a.headers=angular.extend(a.headers||{},h(b)),a},function(a){return d.warn("googleAuthHttpInterceptor: no token, aborting request",a),c.reject("googleAuthFailed")}):a},responseError:j}}]}),angular.module("w69b.uuid",[]).factory("uuid",["$window",function(a){function b(a){for(var b=a.toString(16);b.length<4;)b="0"+b;return b}function c(){var c=new Uint16Array(8);return a.crypto.getRandomValues(c),b(c[0])+b(c[1])+"-"+b(c[2])+"-4"+b(c[3]).substring(1)+"-y"+b(c[4]).substring(1)+"-"+b(c[5])+b(c[6])+b(c[7])}return c}]),angular.module("w69b.uritool",[]).factory("uritool",function(){function a(a){return decodeURIComponent(a.replace(b," "))}var b=/\+/g,c={};return c.parseQuery=function(b,c){"?"==b[0]&&(b=b.substring(1));for(var d,e=/([^&=]+)=?([^&]*)/g,f={};d=e.exec(b);){var g=a(d[1]),h=a(d[2]);c&&f.hasOwnProperty(g)?f[g].push(h):f[g]=c?[h]:h}return f},c.parseUrl=function(a){var b=document.createElement("a");return b.href=a,{protocol:b.protocol.replace(":",""),host:b.hostname,port:b.port,query:b.search,hash:b.hash,path:b.pathname}},c.encodeQuery=function(a){var b=[];return angular.forEach(a,function(a,c){angular.isArray(a)?angular.forEach(a,function(a){b.push(encodeURIComponent(c)+(a===!0?"":"="+encodeURIComponent(a)))}):b.push(encodeURIComponent(c)+(a===!0?"":"="+encodeURIComponent(a)))}),b.length?b.join("&"):""},c}),angular.module("w69b.googleUploader",["w69b.ngProgressHttp"]).factory("googleUploader",["$progressHttp","$http","$q","$timeout","$log",function(a,b,c,d){function e(a,b){var e=a.headers("Retry-After");if(e&&l)e=Math.min(j,1e3*Number(e));else{if(!b)return c.when(a);e=b}return d(angular.noop,e).then(function(){return a})}function f(a){return a.data}function g(d,g){function h(a){return!p&&l&&308===a.status?j():k&&!p&&l&&(0===a.status||a.status>=500&&a.status<=599||a.config&&a.config.authAutoRetry===!1&&401===a.status)?e(a,2e3).then(j):c.reject(a)}function i(b){if(308==b.status){var e,f=b.headers("Range");e=f?Number(f.match(/bytes=0-(\d+)/)[1])+1:0;var h=Math.min(d.size,n),i=Math.min(e+h,d.size)-1,j="bytes "+e+"-"+i+"/"+d.size,k=angular.extend({},g,{url:l,method:"PUT",progressEvents:"upload",transformRequest:null,data:d.slice(e,i+1),googleAuth:!0,authAutoRetry:!1,timeout:o});return k.headers=angular.extend({},k.headers,{"Content-Type":d.type,"Content-Range":j}),a(k).then(null,null,function(a){return a=a.event,{loaded:a.loaded+e,total:d.size}})}return 200==b.status?b:c.reject(b)}function j(){var a=angular.extend({},g,{timeout:o,googleAuth:!0});return a.headers=angular.extend({},a.headers,{"Content-Range":"bytes */"+d.size}),b.put(l,"",a).then(e,e).then(i)["catch"](h)}var l=null,m=c.defer(),o=m.promise,p=!1,q={};return q.start=function(a,e,i){i=angular.extend({},g,i),angular.extend(i.headers||{},{"X-Upload-Content-Length":d.size,"X-Upload-Content-Type":"video/*"}),i.googleAuth=!0,i.timeout=o;var k=c.defer();return b.post(a,e,i).then(function(a){return l=a.headers("Location"),k.notify({uploadUrl:l}),j()})["catch"](h).then(k.resolve.bind(k),k.reject.bind(k),k.notify.bind(k)),q.promise=k.promise.then(f),q.promise},q.resume=function(a){return l=a,q.promise=j().then(f),q.promise},q.cancel=function(){p=!0,m.resolve()},q}var h="https://www.googleapis.com/upload/youtube/v3/videos",i="https://www.googleapis.com/upload/drive/v2/files?uploadType=resumable",j=6e4,k=!0,l=!0,m=1073741824,n=1*m,o={};return o.setAutoResumeEnabled=function(a){k=a},o.setRespectRetryAfterHeader=function(a){l=a},o.setMaxChunkSize=function(a){n=a},o.resumeUpload=function(a,b,c){var d=g(a,c);return d.resume(b),d},o.youtubeUpload=function(a,b,c){b=b||{},b.privacy||(b.privacy="public");var d={snippet:{title:b.title||a.name,description:b.description||""},status:{privacyStatus:b.privacy}},e={params:{part:Object.keys(d).join(","),uploadType:"resumable"}};return o.upload(h,a,d,c,e)},o.driveUpload=function(a,b,c){return o.upload(i,a,b,c)},o.upload=function(a,b,c,d,e){var f=g(b,d);return f.start(a,c,e),f},o}]),angular.module("w69b.logging",[]).provider("$log",function(){var a=!0,b=this,c=!1;this.debugEnabled=function(b){return angular.isDefined(b)?(a=b,this):a},this.setCustomHook=function(a){c=a},this.$get=["$window",function(d){function e(a){return a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line)),a}function f(a){var b=d.console||{},f=b[a]||b.log||angular.noop,g=!1;try{g=!!f.apply}catch(h){}return g?function(){var d=[];return angular.forEach(arguments,function(a){d.push(e(a))}),c&&c(a,d)?f.apply(b,d):void 0}:function(b,d){c&&c(a,[b,d])&&f(b,null===d?"":d)}}return{log:f("log"),info:f("info"),warn:f("warn"),error:f("error"),debug:function(){var c=f("debug");return function(){a&&c.apply(b,arguments)}}()}}]}),angular.module("w69b.ngProgressHttp",[]).service("$progressHttp",["$http","$q",function(a,b){function c(c){c.headers=c.headers||{},c.method=c.method||"POST";var d,e=b.defer();c.headers.__setXHR__=function g(){return function(a){return a?(d=a,c.progressEvents&&"download"!==c.progressEvents||(d.addEventListener("progress",function(a){e.notify({type:"download",event:a
})},!1),d.addEventListener("load",function(a){a.lengthComputable&&e.notify({type:"download",event:a})},!1)),void(c.progressEvents&&"upload"!==c.progressEvents||(d.upload.addEventListener("progress",function(a){e.notify({type:"upload",event:a})},!1),d.upload.addEventListener("load",function(a){a.lengthComputable&&e.notify({type:"upload",event:a})},!1)))):g()}},a(c).then(e.resolve.bind(e),e.reject.bind(e),e.notify.bind(e));var f=e.promise;return f.abort=function(){return d&&d.abort(),f},f}return c}]).config(function(){window.XMLHttpRequest=function(a){return function(){var b=new a;return b.setRequestHeader=function(a){return function(c,d){"__setXHR__"===c?d(b):a.apply(b,arguments)}}(b.setRequestHeader),b}}(window.XMLHttpRequest)}),angular.module("w69b.pnaclModule",[]).factory("pnaclModule",["$q","$log","$timeout",function(a,b,c){function d(d,f,g){function h(){p.addEventListener("crash",j,!0),p.addEventListener("message",k,!0)}function i(){p.removeEventListener("message",k,!0),p.removeEventListener("crash",j,!0)}function j(){b.error("pnacl module crashed",r.lastError),q.onCrash&&q.onCrash(r.lastError)}function k(a){q.onMessage&&q.onMessage(a)}var l=f?"pnacl":"nacl",m=["<embed ","width=0 height=0 ",'src="'+d+'" ','ps_tty_prefix="ps:" ps_stdout="/dev/tty" ps_stderr="/dev/tty" type="application/x-'+l+'" />'].join("");g||(g=document.body);var n,o,p=document.createElement("div"),q={isLoaded:!1};q.onMessage=void 0,q.onCrash=void 0;var r;return q.load=function(){function b(){p.removeEventListener("load",d,!0),p.removeEventListener("error",f,!0)}function d(){b(),i.resolve()}function f(){b(),i.reject(r.lastError)}if(n)return n;var i=a.defer();p.addEventListener("load",d,!0),p.addEventListener("error",f,!0),h(),o=c(function(){i.reject("load_timeout")},e),p.innerHTML=m,r=p.children[0],g.appendChild(p),p.focus(),n=i.promise,n["finally"](function(){c.cancel(o),o=null});var j=n;return n["catch"](function(){q.unload()}),j},q.unload=function(){q.isLoaded=!1,i(),p.innerHTML="",g.removeChild(p),r=null,n=null},q.getElement=function(){return r},q.postMessage=function(a){if(!r)throw new Error("not loaded");r.postMessage(a)},q}var e=15e3;return d}]),angular.module("w69b.pnaclVideoEncoder",["w69b.pnaclModule"]).factory("pnaclVideoEncoder",["pnaclModule","$q","$log","$rootScope","$timeout",function(a,b,c,d,e){function f(f,g){function h(){p={state:"inactive",time:0}}function i(){r.unload(),h()}function j(a){p=a}function k(a){i(),s&&s.reject(a),s=null}function l(a){c.error("pnaclVideoEncoderError",a),k(a),v.onError&&v.onError(a)}function m(a){k(),v.onCrash&&v.onCrash(a)}function n(a,b){r.postMessage({type:a,data:b||{}})}function o(a,c){if(s)throw new Error("there is still a pending operation");return s=b.defer(),a&&n(a,c),s.promise}var p,q,r=a(f,g),s=null,t=8e3,u=["start","stop","pause","resume","replaceTracks"],v={};return r.onMessage=function(a){if(a=a.data,u.indexOf(a.type)>=0){if(!s)return;a.data?s.reject(a.data):s.resolve(),s=null}else if("error"==a.type)l(a.data),d.$$phase||d.$digest();else if("state"==a.type)j(a.data),d.$$phase||d.$digest();else if("stack_trace"==a.type)m(a.data);else{var b;a.data&&(b=a.data,b.trim&&(b=b.trim())),c.debug(a.type,b)}},v.onCrash=void 0,r.onCrash=m,v.stop=function(){return o("stop").then(function(){i()})},v.load=function(){return r.load()},v.getState=function(){return p.state},v.getStateObj=function(){return p},v.getFPS=function(){return p.fps},v.getCurrentTime=function(){return p.time},v.replaceTracks=function(a){return o("replaceTracks",a)},v.pause=function(){return o("pause")},v.resume=function(){return o("resume")},v.hasPendingOperation=function(){return!!s},v.start=function(a,b){if(!/^\/html5_(temporary|persistent)\//.test(a))throw new Error("invalid filename");var c=o();return q=e(function(){l("start_timeout")},t),r.load().then(function(){var d=angular.extend({},b,{filename:a});return n("start",d),c})["finally"](function(){e.cancel(q),q=null})},h(),v}return f}]),angular.module("w69b.promiseTool",[]).factory("promiseTool",["$q","$timeout",function(a,b){var c={};return c.wrapChromeError=function(b,c){return function(){var d=Array.prototype.slice.call(arguments,0),e=a.defer();return d.push(function(a){chrome.runtime.lastError?e.reject(chrome.runtime.lastError):e.resolve(a)}),b.apply(c,d),e.promise}},c.wrapCallbacks=function(b,c){return function(){var d=Array.prototype.slice.call(arguments,0),e=a.defer();return d.push(e.resolve.bind(e)),d.push(e.reject.bind(e)),b.apply(c,d),e.promise}},c.serializer=function(){var b=null;return function(c){var d=a.defer();return(b||a.when())["finally"](function(){var a=c.call();d.resolve(a)}),b=d.promise,b["finally"](function(){b=null}),d.promise}},c.withTimeout=function(c,d,e){e||(e=angular.noop);var f=a.defer(),g=b(function(){var a=e();angular.isDefined(a)?f.resolve(a):f.reject("timeout"),f=null},d),h=c(),i=f.promise;return h["finally"](function(){b.cancel(g),g=null}),h.then(function(){f&&f.resolve.apply(f,arguments)},function(){f&&f.reject.apply(f,arguments)}),i},c}]),angular.module("w69b.streamedVideo",[]).factory("streamedVideo",["$q",function(a){return function(){function b(){g.onEnded&&g.onEnded()}var c,d,e,f=document.createElement("video"),g={onEnded:null};return g.stop=function(){d&&(f.pause(),f.src="",window.URL.revokeObjectURL(c),d.removeEventListener("ended",b),d.stop(),d=null,e=!1)},g.load=function(h){if(d)throw new Error;d=h;var i=a.defer();return h.addEventListener("ended",b),c=window.URL.createObjectURL(h),f.addEventListener("canplay",function j(){f.removeEventListener("canplay",j),f.play(),0===f.videoHeight||0===f.videoWidth?(g.stop(),i.reject("loading video failed")):(e=!0,i.resolve())}),f.addEventListener("error",function k(){f.removeEventListener("error",k),g.stop(),i.reject(f.error)}),f.src=c,f.volume=0,i.promise},g.isLoaded=function(){return e},g.getVideoElement=function(){return f},g}}]),angular.module("w69b.structs.CircularBuffer",[]).factory("CircularBuffer",function(){var a=function(a){this.maxSize_=a||100,this.buff_=[]},b=a.prototype;return b.nextPtr_=0,b.add=function(a){this.buff_[this.nextPtr_]=a,this.nextPtr_=(this.nextPtr_+1)%this.maxSize_},b.get=function(a){return a=this.normalizeIndex_(a),this.buff_[a]},b.set=function(a,b){a=this.normalizeIndex_(a),this.buff_[a]=b},b.getCount=function(){return this.buff_.length},b.isEmpty=function(){return 0===this.buff_.length},b.clear=function(){this.buff_.length=0,this.nextPtr_=0},b.getValues=function(){return this.getNewestValues(this.getCount())},b.getNewestValues=function(a){for(var b=this.getCount(),c=this.getCount()-a,d=[],e=c;b>e;e++)d.push(this.get(e));return d},b.getKeys=function(){for(var a=[],b=this.getCount(),c=0;b>c;c++)a[c]=c;return a},b.containsKey=function(a){return a<this.getCount()},b.containsValue=function(a){for(var b=this.getCount(),c=0;b>c;c++)if(this.get(c)==a)return!0;return!1},b.getLast=function(){return 0===this.getCount()?null:this.get(this.getCount()-1)},b.normalizeIndex_=function(a){if(a>=this.buff_.length)throw Error("Out of bounds exception");return this.buff_.length<this.maxSize_?a:(this.nextPtr_+Number(a))%this.maxSize_},a}),angular.module("w69b.spawn",[]).factory("spawn",["$q",function(a){return function(b){function c(b,c){var d;try{d=b(c)}catch(g){return a.reject(g)}return d.done?d.value:a.when(d.value).then(e,f)}var d=b(),e=c.bind(null,d.next.bind(d)),f=c.bind(null,d["throw"].bind(d));return e()}}]),angular.module("w69b.throttle",[]).factory("throttle",["$timeout",function(a){function b(b,c,d){var e,f,g;d=d!==!1;var h=function(){g=angular.copy(arguments,[]),f=function(){return e=null,f=null,b.apply(null,g)},d?(e&&a.cancel(e),e=a(f,c)):e||(e=a(f,c))};return h.flush=function(){e&&(a.cancel(e),f())},h}return b}]),angular.module("w69b.webrtc",["w69b.promiseTool"]).factory("webrtc",["promiseTool","$window","$q",function(a,b){var c={},d=b.navigator;return c.getUserMedia=a.wrapCallbacks(d.getUserMedia||d.webkitGetUserMedia||d.mozGetUserMedia||d.msGetUserMedia,d),c.getSources=a.wrapCallbacks(MediaStreamTrack.getSources,MediaStreamTrack),c.getSourcesByKind=function(a){return c.getSources().then(function(b){return b.filter(function(b){return b.kind===a})})},c.getVideoSources=function(){return c.getSourcesByKind("video")},c.getAudioSources=function(){return c.getSourcesByKind("audio")},c.hasCamera=function(){return c.getVideoSources().then(function(a){return a.length>0})},c.hasMicrophone=function(){return c.getAudioSources().then(function(a){return a.length>0})},c}]),angular.module("w69b.clipboard",[]).factory("clipboard",["$document",function(a){var b={};return b.copy=function(b){var c=angular.element("<textarea></textarea>");c.text(b),a.find("body").append(c),c[0].select(),a[0].execCommand("copy"),c.remove()},b}]),angular.module("w69b.googledrive",[]).factory("googledrive",["$q","googleauth","$location","$interval","$http",function(a,b,c,d,e){function f(a){return a.data}function g(a,b){return e.get(k+a,{googleAuth:!0,params:b}).then(f)}function h(a,b){return e.post(k+a,b,{googleAuth:!0}).then(f)}function i(a,b){return e({method:"PATCH",url:k+a,data:b,googleAuth:!0}).then(f)}var j=!1,k="https://www.googleapis.com/drive/v2/",l={};return l.isLoaded=function(){return j},l.loadLibs=function(){if(j)return a.when(null);var c=b.loadClient().then(function(){return a.all([b.gapiLoad("picker")])});return c.then(function(){j=!0})},l.getFile=function(a){return g("files/"+a)},l.listFiles=function(a){return g("files/",a).then(function(a){return a.items})},l.postFile=function(a){return h("files",a)},l.patchFile=function(a,b){return i("files/"+a,b)},l.trashFile=function(a){return h("files/"+a+"/trash")},l.getAbout=function(){return g("about")},l.showShareSettings=function(c){return b.gapiLoad("drive-share").then(function(){var e=new gapi.drive.share.ShareClient(b.getAppId());e.setItemIds([c]),e.showSettingsDialog();var f=a.defer(),g=d(function(){for(var a=!1,b=document.activeElement;b!==document.documentElement;){if(b.classList.contains("dcs-ad-dcs-c")){a=!0;break}b=b.parentNode}a||(d.cancel(g),f.resolve())},300);return f.promise})},l.listPermissions=function(a){return g("files/"+a+"/permissions").then(function(a){return a.items})},l.insertPermission=function(a,b){e.post(k+"files/"+a+"/permissions",b,{googleAuth:!0}).then(f)},l.patchPermission=function(a,b,c){return i(k+"files/"+a+"/permissions/"+b,c)},l.removePermission=function(a,b){e["delete"](k+"files/"+a+"/permissions/"+b,{googleAuth:!0}).then(f)},l.getContextAction=function(){var a=c.search().state,b=null;if(angular.isString(a))try{b=JSON.parse(a)}catch(d){}if(b){var e=b.ids||[],f=b.exportIds||[];return{action:b.action,ids:e.concat(f),parentId:b.parentId,userId:b.userId}}return null},l}]),angular.module("w69b.chromeVersionOrder",[]).factory("chromeVersionOrder",function(){var a=[];return a.isLess=function(a,b){function c(a){return a.split(".").map(function(a){return Number(a)})}for(var d=c(a),e=c(b),f=0;f<Math.max(d.length,e.length);++f){if((d[f]||0)<(e[f]||0))return!0;if((d[f]||0)>(e[f]||0))return!1}return!1},a.isEqual=function(b,c){return!a.isLess(b,c)&&!a.isLess(c,b)},a.isLessOrEqual=function(b,c){return a.isLess(b,c)||a.isEqual(b,c)},a}),angular.module("w69b.chromeAlarms",["w69b.promiseTool"]).factory("chromeAlarms",["promiseTool",function(a){var b={};return b.create=chrome.alarms.create.bind(chrome.alarms),["get","getAll","clear","clearAll"].forEach(function(c){b[c]=a.wrapChromeError(chrome.alarms[c],chrome.alarms)}),b.onAlarm=chrome.alarms.onAlarm,b}]),angular.module("w69b.chromeNotifications",["w69b.promiseTool"]).factory("chromeNotifications",["promiseTool",function(a){function b(a){var b=h[a];b&&b.onClicked&&b.onClicked()}function c(a,b){var c=h[a];c&&c.onButtonClicked&&c.onButtonClicked(b)}function d(a,b){var c=h[a];c&&(c.onClosed&&c.onClosed(b),delete h[a],Object.keys(h).length||f())}function e(){g.onClicked.addListener(b),g.onButtonClicked.addListener(c),g.onClosed.addListener(d)}function f(){g.onClicked.removeListener(b),g.onButtonClicked.removeListener(c),g.onClosed.removeListener(d)}var g={},h={};return g.simple={},g.simple.defaultOptions={},g.simple.create=function(b,c){var d=a.serializer(),f={};return b=angular.extend({},g.simple.defaultOptions,b),d(function(){return g.create(c||"",b).then(function(a){f.id=a,Object.keys(h).length||e(),h[a]=f})}),f.clear=function(){d(function(){return g.clear(f.id)})},f.update=function(a){d(function(){return g.update(f.id,a)})},f.onClicked=angular.noop,f.onButtonClicked=angular.noop,f.onClosed=angular.noop,f},["clear","create","update","getAll","getPermissionLevel"].forEach(function(b){g[b]=a.wrapChromeError(chrome.notifications[b],chrome.notifications)}),["onClosed","onClicked","onButtonClicked","onPermissionLevelChanged","onShowSettings"].forEach(function(a){g[a]=chrome.notifications[a]}),g}]),angular.module("w69b.ui.bytesFilter",[]).filter("bytes",["$injector",function(a){function b(b,d){return c||(c=a.get("$filter")("number")),c(b,d)}var c;return function(a,c){if(!angular.isNumber(a))return"-";if(angular.isUndefined(c)&&(c=1),0>=a)return"0 B";var d=["B","KB","MB","GB","TB","PB"],e=Math.floor(Math.log(a)/Math.log(1024));return b(a/Math.pow(1024,Math.floor(e)),c)+" "+d[e]}}]),angular.module("castifyExt.bgApp",["w69b.es6","castifyExt.commonConfig","castifyExt.bgRecord","castifyExt.bgUpload","w69b.chromePersistentLogger","castifyExt.recordingHooks","castifyExt.updateMigrationService","castifyExt.diskSpaceWatcher","castifyExt.bgLicensing","castifyExt.licenseEnforcer","castifyExt.bgMessages","castifyExt.driveFileWatcher","castifyExt.bgFiles","castifyExt.driveSyncHooks","castifyExt.syncNotifications","castifyExt.authConfig","castifyEdit.bgEditJobScheduler","castifyEdit.editNotifications","w69b.chromeNotifications"]).config(["analyticsProvider","$locationProvider","chromePersistentLoggerProvider","chromeVideoRecorderProvider",function(a,b,c,d){d.setEncoderUrl("manifest_encoder.nmf",!1),c.setStorageKey("background"),c.enableGlobalHandler(!0),c.enableAutoSave(!1),c.install()}]).run(["bgRecordService","bgUploadService","analytics","$log","bgMessages","$q","recordingHooks","updateMigrationService","diskSpaceWatcher","bgLicensing","licenseEnforcer","driveFileWatcher","bgFiles","googleUploader","chromePersistentLogger","chromeRuntime","driveSyncHooks","syncNotifications","onlineState","bgEditJobScheduler","editNotifications","chromeNotifications",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){v.simple.defaultOptions={type:"basic",priority:2,iconUrl:"images/icon128.png"},n.setAutoResumeEnabled(!1),n.setRespectRetryAfterHeader(!1),g.install(),f.all([q.install(),a.install(),b.install(),h.install(),i.install(),j.install(),k.install(),e.install(),l.install(),m.install(),r.install(),t.install(),u.install()])["finally"](function(){e.initializationCompleted()}),s.check(),p.onSuspend.addListener(function(){"inactive"===a.getRecorderState().state&&o.save()}),c.setEnabled(!0)}]),a()}()}();