define("flight/lib/registry",[],function(){"use strict";function t(t,e){var i,n,s,r=e.length;return"function"==typeof e[r-1]&&(r-=1,s=e[r]),"object"==typeof e[r-1]&&(r-=1),2==r?(i=e[0],n=e[1]):(i=t.node,n=e[0]),{element:i,type:n,callback:s}}function e(t,e){return t.element==e.element&&t.type==e.type&&(null==e.callback||t.callback==e.callback)}function i(){function i(t){this.component=t,this.attachedTo=[],this.instances={},this.addInstance=function(t){var e=new n(t);return this.instances[t.identity]=e,this.attachedTo.push(t.node),e},this.removeInstance=function(t){delete this.instances[t.identity];var e=this.attachedTo.indexOf(t.node);e>-1&&this.attachedTo.splice(e,1),Object.keys(this.instances).length||s.removeComponentInfo(this)},this.isAttachedTo=function(t){return this.attachedTo.indexOf(t)>-1}}function n(t){this.instance=t,this.events=[],this.addBind=function(t){this.events.push(t),s.events.push(t)},this.removeBind=function(t){for(var i,n=0;i=this.events[n];n++)e(i,t)&&this.events.splice(n,1)}}var s=this;(this.reset=function(){this.components=[],this.allInstances={},this.events=[]}).call(this),this.addInstance=function(t){var e=this.findComponentInfo(t);e||(e=new i(t.constructor),this.components.push(e));var n=e.addInstance(t);return this.allInstances[t.identity]=n,e},this.removeInstance=function(t){var e=this.findComponentInfo(t);e&&e.removeInstance(t),delete this.allInstances[t.identity]},this.removeComponentInfo=function(t){var e=this.components.indexOf(t);e>-1&&this.components.splice(e,1)},this.findComponentInfo=function(t){for(var e,i=t.attachTo?t:t.constructor,n=0;e=this.components[n];n++)if(e.component===i)return e;return null},this.findInstanceInfo=function(t){return this.allInstances[t.identity]||null},this.getBoundEventNames=function(t){return this.findInstanceInfo(t).events.map(function(t){return t.type})},this.findInstanceInfoByNode=function(t){var e=[];return Object.keys(this.allInstances).forEach(function(i){var n=this.allInstances[i];n.instance.node===t&&e.push(n)},this),e},this.on=function(e){for(var i,n=s.findInstanceInfo(this),r=arguments.length,o=1,a=new Array(r-1);r>o;o++)a[o-1]=arguments[o];if(n){i=e.apply(null,a),i&&(a[a.length-1]=i);var c=t(this,a);n.addBind(c)}},this.off=function(){var i=t(this,arguments),n=s.findInstanceInfo(this);n&&n.removeBind(i);for(var r,o=0;r=s.events[o];o++)e(r,i)&&s.events.splice(o,1)},s.trigger=function(){},this.teardown=function(){s.removeInstance(this)},this.withRegistration=function(){this.after("initialize",function(){s.addInstance(this)}),this.around("on",s.on),this.after("off",s.off),window.DEBUG&&DEBUG.enabled&&this.after("trigger",s.trigger),this.after("teardown",{obj:s,fnName:"teardown"})}}return new i}),define("flight/lib/debug",["./registry"],function(t){"use strict";function e(t,i,n){n=n||{};var s=n.obj||window,r=n.path||(s==window?"window":""),o=Object.keys(s);o.forEach(function(n){(p[t]||t)(i,s,n)&&console.log([r,".",n].join(""),"->",["(",typeof s[n],")"].join(""),s[n]),"[object Object]"==Object.prototype.toString.call(s[n])&&s[n]!=s&&-1==r.split(".").indexOf(n)&&e(t,i,{obj:s[n],path:[r,n].join(".")})})}function i(t,i,n,s){i&&typeof n!=i?console.error([n,"must be",i].join(" ")):e(t,n,s)}function n(t,e){i("name","string",t,e)}function s(t,e){i("nameContains","string",t,e)}function r(t,e){i("type","function",t,e)}function o(t,e){i("value",null,t,e)}function a(t,e){i("valueCoerced",null,t,e)}function c(t,i){e(t,null,i)}function u(){var t=[].slice.call(arguments);w.eventNames.length||(w.eventNames=f),w.actions=t.length?t:f,m()}function h(){var t=[].slice.call(arguments);w.actions.length||(w.actions=f),w.eventNames=t.length?t:f,m()}function l(){w.actions=[],w.eventNames=[],m()}function d(){w.actions=f,w.eventNames=f,m()}function m(){try{window.localStorage&&(localStorage.setItem("logFilter_eventNames",w.eventNames),localStorage.setItem("logFilter_actions",w.actions))}catch(t){}}function g(){var t,e;try{t=window.localStorage&&localStorage.getItem("logFilter_eventNames"),e=window.localStorage&&localStorage.getItem("logFilter_actions")}catch(i){return}t&&(w.eventNames=t),e&&(w.actions=e),Object.keys(w).forEach(function(t){var e=w[t];"string"==typeof e&&e!==f&&(w[t]=e?e.split(","):[])})}var p={name:function(t,e,i){return t==i},nameContains:function(t,e,i){return i.indexOf(t)>-1},type:function(t,e,i){return e[i]instanceof t},value:function(t,e,i){return e[i]===t},valueCoerced:function(t,e,i){return e[i]==t}},f="all",w={eventNames:[],actions:[]};return{enable:function(t){this.enabled=!!t,t&&window.console&&(console.info("Booting in DEBUG mode"),console.info("You can configure event logging with DEBUG.events.logAll()/logNone()/logByName()/logByAction()")),g(),window.DEBUG=this},warn:function(t){if(window.console){var e=console.warn||console.log;e.call(console,this.toString()+": "+t)}},registry:t,find:{byName:n,byNameContains:s,byType:r,byValue:o,byValueCoerced:a,custom:c},events:{logFilter:w,logByAction:u,logByName:h,logAll:d,logNone:l}}}),define("flight/lib/utils",["./debug"],function(t){"use strict";function e(){var e=t.enabled&&!Object.propertyIsEnumerable("getOwnPropertyDescriptor");if(e)try{Object.getOwnPropertyDescriptor(Object,"keys")}catch(i){return!1}return e}var i=100,n={isDomObj:function(t){return!!t.nodeType||t===window},toArray:function(t,e){e=e||0;for(var i=t.length,n=new Array(i-e),s=e;i>s;s++)n[s-e]=t[s];return n},merge:function(){var t=arguments.length,e=new Array(t+1);if(0===t)return{};for(var i=0;t>i;i++)e[i+1]=arguments[i];return e[0]={},e[e.length-1]===!0&&(e.pop(),e.unshift(!0)),$.extend.apply(void 0,e)},push:function(t,e,i){return t&&Object.keys(e||{}).forEach(function(n){if(t[n]&&i)throw new Error('utils.push attempted to overwrite "'+n+'" while running in protected mode');"object"==typeof t[n]&&"object"==typeof e[n]?this.push(t[n],e[n]):t[n]=e[n]},this),t},getEnumerableProperty:function(t,e){return t.propertyIsEnumerable(e)?t[e]:void 0},compose:function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},uniqueArray:function(t){for(var e={},i=[],n=0,s=t.length;s>n;++n)e.hasOwnProperty(t[n])||(i.push(t[n]),e[t[n]]=1);return i},debounce:function(t,e,n){"number"!=typeof e&&(e=i);var s,r;return function(){var i=this,o=arguments,a=function(){s=null,n||(r=t.apply(i,o))},c=n&&!s;return s&&clearTimeout(s),s=setTimeout(a,e),c&&(r=t.apply(i,o)),r}},throttle:function(t,e){"number"!=typeof e&&(e=i);var n,s,r,o,a,c,u=this.debounce(function(){a=o=!1},e);return function(){n=this,s=arguments;var i=function(){r=null,a&&(c=t.apply(n,s)),u()};return r||(r=setTimeout(i,e)),o?a=!0:(o=!0,c=t.apply(n,s)),u(),c}},countThen:function(t,e){return function(){return--t?void 0:e.apply(this,arguments)}},delegate:function(t){return function(e,i){var n,s=$(e.target);Object.keys(t).forEach(function(r){return!e.isPropagationStopped()&&(n=s.closest(r)).length?(i=i||{},e.currentTarget=i.el=n[0],t[r].apply(this,[e,i])):void 0},this)}},once:function(t){var e,i;return function(){return e?i:(e=!0,i=t.apply(this,arguments))}},propertyWritability:function(t,i,n){e()&&t.hasOwnProperty(i)&&Object.defineProperty(t,i,{writable:n})},mutateProperty:function(t,i,n){var s;return e()&&t.hasOwnProperty(i)?(s=Object.getOwnPropertyDescriptor(t,i).writable,Object.defineProperty(t,i,{writable:!0}),n.call(t),Object.defineProperty(t,i,{writable:s}),void 0):void n.call(t)}};return n}),define("flight/lib/advice",["./utils"],function(t){"use strict";var e={around:function(t,e){return function(){var i=0,n=arguments.length,s=new Array(n+1);for(s[0]=t.bind(this);n>i;i++)s[i+1]=arguments[i];return e.apply(this,s)}},before:function(t,e){var i="function"==typeof e?e:e.obj[e.fnName];return function(){return i.apply(this,arguments),t.apply(this,arguments)}},after:function(t,e){var i="function"==typeof e?e:e.obj[e.fnName];return function(){var e=(t.unbound||t).apply(this,arguments);return i.apply(this,arguments),e}},withAdvice:function(){["before","after","around"].forEach(function(i){this[i]=function(n,s){var r=n.trim().split(" ");r.forEach(function(n){t.mutateProperty(this,n,function(){return this[n]="function"==typeof this[n]?e[i](this[n],s):s,this[n]})},this)}},this)}};return e}),define("flight/lib/compose",["./utils"],function(t){"use strict";function e(e,i){Object.keys(e).forEach(function(s){n.indexOf(s)<0&&t.propertyWritability(e,s,i)})}function i(t,i){t.mixedIn=Object.prototype.hasOwnProperty.call(t,"mixedIn")?t.mixedIn:[];for(var n=0;n<i.length;n++)-1==t.mixedIn.indexOf(i[n])&&(e(t,!1),i[n].call(t),t.mixedIn.push(i[n]));e(t,!0)}var n=["mixedIn","attrDef"];return{mixin:i}}),define("flight/lib/base",["./utils","./registry","./debug"],function(t,e,i){"use strict";function n(t){t.events.slice().forEach(function(t){var e=[t.type];t.element&&e.unshift(t.element),"function"==typeof t.callback&&e.push(t.callback),this.off.apply(this,e)},t.instance)}function s(t,e){try{window.postMessage(e,"*")}catch(n){i.warn.call(this,['Event "',t,'" was triggered with non-serializable data. ',"Flight recommends you avoid passing non-serializable data in events."].join(""))}}function r(t){i.warn.call(this,['Attribute "',t,'" defaults to an array or object. ',"Enclose this in a function to avoid sharing between component instances."].join(""))}function o(t){var e,n=[];if(this.attr=new this.attrDef,i.enabled&&window.console){for(var s in this.attrDef.prototype)n.push(s);e=Object.keys(t);for(var o=e.length-1;o>=0;o--)if(-1==n.indexOf(e[o])){i.warn.call(this,'Passed unused attribute "'+e[o]+'".');break}}for(var s in this.attrDef.prototype){if("undefined"==typeof t[s]){if(null===this.attr[s])throw new Error('Required attribute "'+s+'" not specified in attachTo for component "'+this.toString()+'".');i.enabled&&"object"==typeof this.attr[s]&&r.call(this,s)}else this.attr[s]=t[s];"function"==typeof this.attr[s]&&(this.attr[s]=this.attr[s].call(this))}}function a(t){var e=Object.create(t);for(var n in this.defaults)t.hasOwnProperty(n)||(e[n]=this.defaults[n],i.enabled&&"object"==typeof this.defaults[n]&&r.call(this,n));this.attr=e,Object.keys(this.defaults||{}).forEach(function(t){if(null===this.defaults[t]&&null===this.attr[t])throw new Error('Required attribute "'+t+'" not specified in attachTo for component "'+this.toString()+'".')},this)}function c(t){return function(e,i){$(e.target).trigger(t,i)}}function u(){this.trigger=function(){var t,e,n,r,o,a=arguments.length-1,c=arguments[a];return"string"!=typeof c&&(!c||!c.defaultBehavior)&&(a--,n=c),1==a?(t=$(arguments[0]),r=arguments[1]):(t=this.$node,r=arguments[0]),r.defaultBehavior&&(o=r.defaultBehavior,r=$.Event(r.type)),e=r.type||r,i.enabled&&window.postMessage&&s.call(this,e,n),"object"==typeof this.attr.eventData&&(n=$.extend(!0,{},this.attr.eventData,n)),t.trigger(r||e,n),o&&!r.isDefaultPrevented()&&(this[o]||o).call(this,r,n),t},this.on=function(){var e,i,n,s,r=arguments.length-1,o=arguments[r];if(s="object"==typeof o?t.delegate(this.resolveDelegateRules(o)):"string"==typeof o?c(o):o,2==r?(e=$(arguments[0]),i=arguments[1]):(e=this.$node,i=arguments[0]),"function"!=typeof s&&"object"!=typeof s)throw new Error('Unable to bind to "'+i+'" because the given callback is not a function or an object');return n=s.bind(this),n.target=s,n.context=this,e.on(i,n),s.bound||(s.bound=[]),s.bound.push(n),n},this.off=function(){var t,i,n,s=arguments.length-1;if("function"==typeof arguments[s]&&(n=arguments[s],s-=1),1==s?(t=$(arguments[0]),i=arguments[1]):(t=this.$node,i=arguments[0]),n){var r=n.target?n.target.bound:n.bound||[];r&&r.some(function(t,e,i){return t.context&&this.identity==t.context.identity?(i.splice(e,1),n=t,!0):void 0},this),t.off(i,n)}else e.findInstanceInfo(this).events.forEach(function(e){i==e.type&&t.off(i,e.callback)});return t},this.resolveDelegateRules=function(t){var e={};return Object.keys(t).forEach(function(i){if(!(i in this.attr))throw new Error('Component "'+this.toString()+'" wants to listen on "'+i+'" but no such attribute was defined.');e[this.attr[i]]="string"==typeof t[i]?c(t[i]):t[i]},this),e},this.select=function(t){return this.$node.find(this.attr[t])},this.attributes=function(t){var e=function(){};this.attrDef&&(e.prototype=new this.attrDef);for(var i in t)e.prototype[i]=t[i];this.attrDef=e},this.defaultAttrs=function(e){t.push(this.defaults,e,!0)||(this.defaults=e)},this.initialize=function(t,e){if(e=e||{},this.identity||(this.identity=h++),!t)throw new Error("Component needs a node");return t.jquery?(this.node=t[0],this.$node=t):(this.node=t,this.$node=$(t)),this.attrDef?o.call(this,e):a.call(this,e),this},this.teardown=function(){n(e.findInstanceInfo(this))}}var h=0;return u}),define("flight/lib/logger",["./utils"],function(t){"use strict";function e(t){var e=t.tagName?t.tagName.toLowerCase():t.toString(),i=t.className?"."+t.className:"",n=e+i;return t.tagName?["'","'"].join(n):n}function i(t,i,n){if(window.DEBUG&&window.DEBUG.enabled){var r,o,a,c,u,h,l,d,m,g;"function"==typeof n[n.length-1]&&(c=n.pop(),c=c.unbound||c),1==n.length?(a=i.$node[0],o=n[0]):2!=n.length||"object"!=typeof n[1]||n[1].type?(a=n[0],o=n[1],"trigger"==t&&(u=n[2])):(a=i.$node[0],o=n[0],"trigger"==t&&(u=n[1])),r="object"==typeof o?o.type:o,h=DEBUG.events.logFilter,d="all"==h.actions||h.actions.indexOf(t)>-1,l=function(t){return t.test?t:new RegExp("^"+t.replace(/\*/g,".*")+"$")},m="all"==h.eventNames||h.eventNames.some(function(t){return l(t).test(r)}),d&&m&&(g=[s[t],t,"["+r+"]"],u&&g.push(u),g.push(e(a)),g.push(i.constructor.describe.split(" ").slice(0,3).join(" ")),console.groupCollapsed&&"trigger"==t&&console.groupCollapsed(t,r),Function.prototype.apply.call(console.info,console,g))}}function n(){this.before("trigger",function(){i("trigger",this,t.toArray(arguments))}),console.groupCollapsed&&this.after("trigger",function(){console.groupEnd()}),this.before("on",function(){i("on",this,t.toArray(arguments))}),this.before("off",function(){i("off",this,t.toArray(arguments))})}var s={on:"<-",trigger:"->",off:"x "};return n}),define("flight/lib/component",["./advice","./utils","./compose","./base","./registry","./logger","./debug"],function(t,e,i,n,s,r,o){"use strict";function a(){var t=s.findComponentInfo(this);t&&Object.keys(t.instances).forEach(function(e){var i=t.instances[e];i&&i.instance&&i.instance.teardown()})}function c(t){for(var i=arguments.length,n=new Array(i-1),r=1;i>r;r++)n[r-1]=arguments[r];if(!t)throw new Error("Component needs to be attachTo'd a jQuery object, native node or selector string");var o=e.merge.apply(e,n),a=s.findComponentInfo(this);$(t).each(function(t,e){a&&a.isAttachedTo(e)||(new this).initialize(e,o)}.bind(this))}function u(){var t=this.mixedIn||this.prototype.mixedIn||[];return t.map(function(t){if(null==t.name){var e=t.toString().match(l);return e&&e[1]?e[1]:""}return d[t.name]?"":t.name}).filter(Boolean).join(", ")}function h(){for(var l=arguments.length,d=new Array(l),m=0;l>m;m++)d[m]=arguments[m];var g=function(){};return g.toString=g.prototype.toString=u,o.enabled&&(g.describe=g.prototype.describe=g.toString()),g.attachTo=c,g.mixin=function(){var t=h(),n=Object.create(g.prototype);return n.mixedIn=[].concat(g.prototype.mixedIn),n.defaults=e.merge(g.prototype.defaults),n.attrDef=g.prototype.attrDef,i.mixin(n,arguments),t.prototype=n,t.prototype.constructor=t,t},g.teardownAll=a,o.enabled&&d.unshift(r),d.unshift(n,t.withAdvice,s.withRegistration),i.mixin(g.prototype,d),g}var l=/function (.*?)\s?\(/,d={withBase:!0,withLogging:!0};return h.teardownAll=function(){s.components.slice().forEach(function(t){t.component.teardownAll()}),s.reset()},h}),function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function i(t){return"object"==typeof t&&null!==t}function n(){}function s(){return function(){process.nextTick(c)}}function r(){var t=0,e=new U(c),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function o(){var t=new MessageChannel;return t.port1.onmessage=c,function(){t.port2.postMessage(0)}}function a(){return function(){setTimeout(c,1)}}function c(){for(var t=0;$>t;t+=2){var e=N[t],i=N[t+1];e(i),N[t]=void 0,N[t+1]=void 0}$=0}function u(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function l(){return new TypeError("A promises callback cannot return that same promise.")}function d(t){try{return t.then}catch(e){return K.error=e,K}}function m(t,e,i,n){try{t.call(e,i,n)}catch(s){return s}}function g(t,e,i){O(function(t){var n=!1,s=m(i,e,function(i){n||(n=!0,e!==i?w(t,i):C(t,i))},function(e){n||(n=!0,b(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&s&&(n=!0,b(t,s))},t)}function p(t,e){e._state===q?C(t,e._result):t._state===B?b(t,e._result):S(e,void 0,function(e){w(t,e)},function(e){b(t,e)})}function f(t,i){if(i.constructor===t.constructor)p(t,i);else{var n=d(i);n===K?b(t,K.error):void 0===n?C(t,i):e(n)?g(t,i,n):C(t,i)}}function w(e,i){e===i?b(e,h()):t(i)?f(e,i):C(e,i)}function v(t){t._onerror&&t._onerror(t._result),T(t)}function C(t,e){t._state===j&&(t._result=e,t._state=q,0!==t._subscribers.length&&O(T,t))}function b(t,e){t._state===j&&(t._state=B,t._result=e,O(v,t))}function S(t,e,i,n){var s=t._subscribers,r=s.length;t._onerror=null,s[r]=e,s[r+q]=i,s[r+B]=n,0===r&&t._state&&O(T,t)}function T(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n,s,r=t._result,o=0;o<e.length;o+=3)n=e[o],s=e[o+i],n?D(i,n,s,r):s(r);t._subscribers.length=0}}function y(){this.error=null}function _(t,e){try{return t(e)}catch(i){return H.error=i,H}}function D(t,i,n,s){var r,o,a,c,u=e(n);if(u){if(r=_(n,s),r===H?(c=!0,o=r.error,r=null):a=!0,i===r)return void b(i,l())}else r=s,a=!0;i._state===j&&(u&&a?w(i,r):c?b(i,o):t===q?C(i,r):t===B&&b(i,r))}function A(t,e){try{e(function(e){w(t,e)},function(e){b(t,e)})}catch(i){b(t,i)}}function I(t,e,i,n){this._instanceConstructor=t,this.promise=new t(u,n),this._abortOnReject=i,this._validateInput(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._init(),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&C(this.promise,this._result))):b(this.promise,this._validationError())}function k(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function E(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function R(t){this._id=Q++,this._state=void 0,this._result=void 0,this._subscribers=[],u!==t&&(e(t)||k(),this instanceof R||E(),A(this,t))}var F;F=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var M,x=F,$=(Date.now||function(){return(new Date).getTime()},Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return n.prototype=t,new n},0),O=function(t,e){N[$]=t,N[$+1]=e,$+=2,2===$&&M()},P="undefined"!=typeof window?window:{},U=P.MutationObserver||P.WebKitMutationObserver,L="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,N=new Array(1e3);M="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?s():U?r():L?o():a();var j=void 0,q=1,B=2,K=new y,H=new y;I.prototype._validateInput=function(t){return x(t)},I.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},I.prototype._init=function(){this._result=new Array(this.length)};var z=I;I.prototype._enumerate=function(){for(var t=this.length,e=this.promise,i=this._input,n=0;e._state===j&&t>n;n++)this._eachEntry(i[n],n)},I.prototype._eachEntry=function(t,e){var n=this._instanceConstructor;i(t)?t.constructor===n&&t._state!==j?(t._onerror=null,this._settledAt(t._state,e,t._result)):this._willSettleAt(n.resolve(t),e):(this._remaining--,this._result[e]=this._makeResult(q,e,t))},I.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===j&&(this._remaining--,this._abortOnReject&&t===B?b(n,i):this._result[e]=this._makeResult(t,e,i)),0===this._remaining&&C(n,this._result)},I.prototype._makeResult=function(t,e,i){return i},I.prototype._willSettleAt=function(t,e){var i=this;S(t,void 0,function(t){i._settledAt(q,e,t)},function(t){i._settledAt(B,e,t)})};var W=function(t,e){return new z(this,t,!0,e).promise},V=function(t,e){function i(t){w(r,t)}function n(t){b(r,t)}var s=this,r=new s(u,e);if(!x(t))return b(r,new TypeError("You must pass an array to race.")),r;for(var o=t.length,a=0;r._state===j&&o>a;a++)S(s.resolve(t[a]),void 0,i,n);return r},G=function(t,e){var i=this;if(t&&"object"==typeof t&&t.constructor===i)return t;var n=new i(u,e);return w(n,t),n},Y=function(t,e){var i=this,n=new i(u,e);return b(n,t),n},Q=0,X=R;R.all=W,R.race=V,R.resolve=G,R.reject=Y,R.prototype={constructor:R,then:function(t,e){var i=this,n=i._state;if(n===q&&!t||n===B&&!e)return this;var s=new this.constructor(u),r=i._result;if(n){var o=arguments[n-1];O(function(){D(n,s,o,r)})}else S(i,s,t,e);return s},"catch":function(t){return this.then(null,t)}};var J=function(){var t;t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var i="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var i;return new t.Promise(function(t){i=t}),e(i)}();i||(t.Promise=X)},Z={Promise:X,polyfill:J};"function"==typeof define&&define.amd?define("es6-promise",[],function(){return Z}):"undefined"!=typeof module&&module.exports?module.exports=Z:"undefined"!=typeof this&&(this.ES6Promise=Z)}.call(this),function(t){if(!Array.prototype.find){var e=function(t){var e=Object(this),i=e.length<0?0:e.length>>>0;if(0===i)return void 0;if("function"!=typeof t||"[object Function]"!==Object.prototype.toString.call(t))throw new TypeError("Array#find: predicate must be a function");for(var n,s=arguments[1],r=0;i>r;r++)if(n=e[r],t.call(s,n,r,e))return n;return void 0};if(Object.defineProperty)try{Object.defineProperty(Array.prototype,"find",{value:e,configurable:!0,enumerable:!1,writable:!0})}catch(i){}Array.prototype.find||(Array.prototype.find=e)}}(this),define("array.prototype.find",function(){}),function(t,e){"function"==typeof define&&define.amd?define("scripts/storage/memory_storage",[],e):t.TD.storage.MemoryStorage=e()}(this,function(){"use strict";function t(){this.data={},this.length=0}return t.prototype.clear=function(){this.data={},this.length=0},t.prototype.getItem=function(t){var e=this.data[t];return void 0!==e?e:null},t.prototype.key=function(t){throw new Error("MemoryStore.key not implemented.")},t.prototype.removeItem=function(t){null!==this.getItem(t)&&(delete this.data[t],this.length--)},t.prototype.setItem=function(t,e){null===this.getItem(t)&&this.length++,this.data[t]=""+e},t}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("scripts/sync/util",[],e):t.TD.sync.util=e()}(this,function(){var t={},e=0,i=2,n=4,s=8;t.maybe_log=function(t,e){var i=_.isUndefined(e)?1:e;TD.config.debug_level>=i&&console.log(t)},t.NotJsonable=function(t){_.extend(this,t),this.___=t.toString()},t.NotJsonable.prototype={};var r=function(e){console.log.apply(console,_.map(e,function(e){if(!_.isUndefined(e))try{return JSON.parse(JSON.stringify(e))}catch(i){return new t.NotJsonable(e)}}))};return t.stateLog=function(){TD.config.debug_level>=i&&r(arguments)},t.verboseLog=function(){TD.config.debug_level>=n&&r(_.toArray(arguments))},t.warn=function(){TD.config.debug_level>=e&&console.log.apply(console,_.toArray(arguments))},t.trace=function(e,i){t.maybe_log("TRACE: "+e+": "+(i||""),1)},t.printStacktrace=function(){if(TD.config.debug_menu)try{throw new Error("stack trace or gtfo")}catch(t){console.log(t.stack)}},t.getStack=function(){try{throw new Error("stack trace or gtfo")}catch(t){return TD.util.isChromeApp()?t.stack.split("\n").slice(2).join("\n"):""}},t.errmark=function(e,i){return e||(e=i,i="missing message"),console.log("---ERROR--->>>>>->>>>->>>->>->--"+i+"--<-<<--"),t.maybe_log(e),console.log(e.stack),e},t.assert=function(e,i,n){if(!e)throw console.log("------------------------------------------"),console.log(["ASSERT FAILURE",i,n]),t.printStacktrace(),console.log("------------------------------------------"),TD.sync.trace&&TD.sync.trace.assert(i,n),"AssertionError"},t.precondition=function(e,i,n){if(!e)throw console.log("------------------------------------------"),console.log(["PRECONDITION FAILURE",i,n]),t.printStacktrace(),console.log("------------------------------------------"),TD.sync.trace&&TD.sync.trace.assert("PRECONDITION "+i,n),"PreconditionAssertionError"},t._break=function(){console.log("you might want to set a breakpoint here ;-)")},t.warning=function(e){data=_.toArray(arguments).slice(1),console.log(["WARNING",e,t.pformat(data)])},t.error=function(e){data=_.toArray(arguments).slice(1),console.log(["ERROR",e,t.pformat(data)])},t.list_to_set=function(t){var e={};return _.each(t,function(t){e[t]=!0}),e},t.pprint=function(e){return t.maybe_log(JSON.stringify(e,null,"  "),i),e},t.pformat=function(t){return JSON.stringify(t,null,"  ")},t.repr=function(t){return JSON.stringify(t)},t.clone=function(e){if(null===e||_.isUndefined(e))return e;try{return JSON.parse(JSON.stringify(e))}catch(i){return t.stateLog("util.clone couldn't parse object",e,i),["<not jsonable>",e]}},t.dictMap=function(t,e,i){var n={};return _.each(_.map(t,e,i),function(t){n[t[0]]=t[1]}),n},t.stall=function(t,e){_.isUndefined(e)&&(e=0);var i=new TD.core.defer.Deferred;return _.delay(_.bind(i.callback,i),1e3*e,t),i},t.autoRetry=function(t,e,i){var n=t();return e.forEach(function(e){n.addErrback(function(n){if(!i||i(n)){var s=new TD.core.defer.Deferred;return s.addCallback(t),setTimeout(function(){s.callback()},e),s}return n})}),n},t.makeThingScheduler=function(e,i,n,r,o){var a=!1,c=!1;r=r||function(){return!0},o=_.isUndefined(o)?1:o;var u=[],h=function(){if(t.maybe_log(["_maybe_do_stuff",n,"want stuff done:",a,"am doing stuff:",c],s),!a)return void t.maybe_log("not doing stuff; someone else did stuff before us",s);if(c)return void t.maybe_log("am already doing stuff",s);c=!0,a=!1;var r=TD.controller.progressIndicator;if(i)var o=r.addTask(i);var l=TD.core.defer.maybeDeferred(e);l.addCallback(function(t){if(c=!1,i&&r.deleteTask(o),a)h();else{var e=u;u=[];for(var n=0;n<e.length;n++)try{e[n].callback(t)}catch(s){_.defer(_.bind(e[n].errback,e[n]),s)}}}),l.addErrback(function(s){t.errmark(s,'do_stuff for "'+n+'" yielded error when calling; '+e),c=!1,i&&r.taskFailed(o);var a=u;u=[];for(var h=0;h<a.length;h++)try{a[h].errback(s)}catch(l){_.defer(_.bind(a[h].errback,a[h]),l)}})};return function(e){if(!r())return t.maybe_log("not triggering (guarded): "+n,s),TD.core.defer.succeed();e=_.isUndefined(e)?o:e,t.maybe_log('trigger func called "'+n+'"',s),a=!0;var i=new TD.core.defer.Deferred;return u.push(i),setTimeout(h,1e3*e),i}},t}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("scripts/storage/store",["scripts/storage/memory_storage","scripts/sync/util"],e):_.extend(t.TD.storage,e(t.TD.storage.MemoryStorage,t.TD.sync.util))}(this,function(t,e){"use strict";function i(e){e?this._initBackend(e):this._backend=new t}var n="tweetdeckAccount",s="currentAuthType",r="staySignedIn",o="__hasAlreadyReloaded",a="_session",c="sessionMigratedToWeb",u="migrate",h="accountsLastVerified",l="__version__",d="ScribeTransport",m="guestID",g=[d],p=g.concat([l,"previousMultiUserAccount",r,s,m,u,d]),f={local:localStorage,session:sessionStorage};return i.getPreviousStorage=function(){var t=_.pairs(f),e=_.find(t,function(t){return t[1].getItem(n)||t[1].getItem(s)||t[1].getItem(r)});return e?e[0]:null},i._testStore=function(t,n){e.stateLog("_testStore()");for(var s=!1,r=!1,o="__test__",a="test",c=1024;a.length<c;)a+=a;try{t.setItem(o,a),s=t.getItem(o)===a,t.removeItem(o)}catch(u){s=!1,r=u.code===window.DOMException.QUOTA_EXCEEDED_ERR,r&&0===t.length&&TD.sync.util.warn(u,"In Safari private browsing mode")}if(n&&r)try{i.flushDataFromStore(t),s=i._testStore(t,!1)}catch(u){s=!1}return s},i.flushDataFromStore=function(t,e){e=(e||[]).concat(p),i.wipe(t,e)},i.flushBackend=function(t,e){return i.flushDataFromStore(f[t],e)},i.wipeAll=function(){[localStorage,sessionStorage].forEach(i.wipe)},i.wipe=function(t,e){var i={};e=_.uniq((e||[]).concat(g)),e.forEach(function(e){var n=t.getItem(e);n&&(i[e]=n)});try{t.clear()}catch(n){console.warn("Clearing",t,"failed:",n)}_.each(i,function(e,i){t.setItem(i,e)})},i.shouldTryReload=function(){var t;try{t=!!sessionStorage.getItem(o),sessionStorage.setItem(o,!0)}catch(e){t=!0}return!t},i.removeReloadedFlag=function(){sessionStorage.removeItem(o)},i.flushWebstorage=function(t){TD.sync.util.trace("clearing web storage");try{Object.keys(f).forEach(function(e){i.flushDataFromStore(f[e],t)})}catch(e){console.error("Unable to clear webstorage.",e)}},i.clearOtherBackends=function(t){Object.keys(f).forEach(function(e){e!==t&&i.wipe(f[e])})},i.prototype.init=function(t,n){this._initBackend(t),n&&n.uid!==this.getTweetdeckAccount()&&(e.stateLog("New login. Clearing previous webstorage."),i.flushBackend(t),i.clearOtherBackends(t))},i.prototype._initBackend=function(n){this._backendType="unknown",e.stateLog("Initializing backend with",n),_.isFunction(n.getItem)&&i._testStore(n)?this._backend=n:"local"===n&&i._testStore(window.localStorage,!0)?(this._migrateBackend(window.localStorage),this._backend=window.localStorage,this._backendType="local"):"session"===n&&i._testStore(window.sessionStorage,!0)?(this._migrateBackend(window.sessionStorage),this._backend=window.sessionStorage,this._backendType="session"):(e.stateLog("store._initBackend(): Falling back to MemoryStorage."),this._backend=new t,this._backendType="memory"),this._tryUpgrade()},i.prototype._migrateBackend=function(t,e){if(e=e||this._getPersistentBackend(),e!==t)for(var i in e)if(e.hasOwnProperty(i)){try{t.setItem(i,e.getItem(i))}catch(n){if(n.code===window.DOMException.QUOTA_EXCEEDED_ERR)return void TD.sync.util.warn("Migration failed due to quota limits.",n);throw n}e.removeItem(i)}},i.prototype._getPersistentBackend=function(){return this._backend instanceof t?localStorage:this._backend},i.prototype._tryUpgrade=function(){try{TD.storage.upgrade.doUpgrade(this._backend)}catch(t){TD.sync.util.warn("Error during store upgrade:",t),i.flushWebstorage()}},i.prototype._upgradeTweetdeckAccountSession=function(){var t=this._backend.getItem("tweetdeck_account");if(t&&(this._backend.setItem("tweetdeckAccount",t),this._backend.removeItem("tweetdeck_account")),t=this._backend.getItem("tweetdeckAccount"),t&&"{"===t.charAt(0))try{t=JSON.parse(t).email,this._backend.setItem("tweetdeckAccount",t)}catch(e){console.warn("Upgrading TweetDeck account session failed.",e)}},i.prototype.getTweetdeckAccount=function(){var t=this._backend.getItem(n);return t?t:void e.stateLog("store.getTweetdeckAccount(): tdacct invalid",t)},i.prototype.setTweetdeckAccount=function(t){TD.sync.util.assert(t,"user identifer must be given to set tweetdeck account"),this._backend.setItem(n,t)},i.prototype.getTwitterLoginAccount=function(){var t,e;return"twitter"===this.getCurrentAuthType()?(t=this.getTweetdeckAccount(),e=TD.storage.accountController.getAccountFromId(t)):void 0},i.prototype.getOrCreateGuestID=function(){var t=this._backend.getItem(m);return t||(t=this.createGuestID(),this._backend.setItem(m,t)),t},i.prototype.createGuestID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)})},i.prototype.getCurrentAuthType=function(){var t=this._getPersistentBackend().getItem(s)||"twitter";return"{"===t.charAt(0)&&(t="tweetdeck"),e.stateLog("getCurrentAuthType(): ",t),t},i.prototype.setCurrentAuthType=function(t){this._getPersistentBackend().setItem(s,t)},i.prototype.setStaySignedIn=function(t){
this._getPersistentBackend().setItem(r,t)},i.prototype.getSessionMigratedToWeb=function(){return this._getPersistentBackend().getItem(c)},i.prototype.setSessionMigratedToWeb=function(){this._getPersistentBackend().setItem(c,!0)},i.prototype.removeSessionMigratedToWeb=function(){this._getPersistentBackend().removeItem(c)},i.prototype._getLastVerifiedTimestamps=function(){var t={};try{t=this.getJSON(h)}catch(i){e.stateLog("_getLastVerifiedTimestamps(): failed",i)}return t},i.prototype.getMigrateData=function(){var t;try{t=JSON.parse(sessionStorage.getItem(u))}catch(e){}return t||{}},i.prototype.getLastVerifiedTimestamp=function(t){var e,i,n=this._getLastVerifiedTimestamps();return e=n[t.getKey()]||0,i=t.getUpdated()||0,Math.max(e,i)},i.prototype.setLastVerifiedTimestamp=function(t){var e=this._getLastVerifiedTimestamps(),i=e[t.getKey()]||0,n=t.getUpdated()||0,s=Math.max(i,n);s!==i&&(e[t.getKey()]=s,this.setJSON(h,e))},i.prototype.removeLastVerifiedTimestamp=function(t){var e=this._getLastVerifiedTimestamps();delete e[t.getKey()],this.setJSON(h,e)},i.prototype.getSessionData=function(){this._upgradeTweetdeckAccountSession();var t={authType:this.getCurrentAuthType(),uid:this._backend.getItem(n),migrate:this.getMigrateData(),session:null,sessionExists:!1,staySignedIn:!!this.getJSON(r)};return t.uid&&(t.session=this._backend.getItem(a),TD.sync.tdapi.setSession(t.session),t.sessionExists=TD.sync.tdapi.isLoggedIn()),t},i.prototype.setSessionData=function(t){this._backend.setItem(a,JSON.stringify(t))},i.prototype.getSessionMigrationData=function(){var t=["__version__","previousMultiUserAccount","staySignedIn","currentAuthType","guestID","migrate","tweetdeckAccount","_session","accountsLastVerified"];return{local:t.reduce(function(t,e){var i=localStorage.getItem(e);return null!==i&&(t[e]=i),t},{}),session:t.reduce(function(t,e){var i=sessionStorage.getItem(e);return null!==i&&(t[e]=i),t},{})}},i.prototype.checkVersion=function(t){var e=this._backend.getItem(l);if(null!==e&&~e!==~t)throw new Error("Wrong version number in store. (saved) %s != (given) %s",e,t)},i.prototype.setVersion=function(t){this._backend.setItem(l,t)},i.prototype.getJSON=function(t){return JSON.parse(this._backend.getItem(t)||"{}")},i.prototype.setJSON=function(t,e){this._backend.setItem(t,JSON.stringify(e))},i.prototype.setJSONCritical=function(t,e,i){try{this._backend.setItem(t,JSON.stringify(e))}catch(n){if(n.code!==window.DOMException.QUOTA_EXCEEDED_ERR||i)throw n;$(document).trigger("dataStorageFull"),this.setJSONCritical(t,e,!0)}},{Store:i,store:new i}}),define("data/storage",["flight/lib/component","scripts/storage/store"],function(t,e){var i=e.store,n=function(){function t(t){var e;try{e=i.getJSON(name)}catch(n){return void TD.sync.util.stateLog("Error parsing JSON for storage key",t)}this.trigger(document,"dataStorageItem",{name:t,value:e})}this.get=function(e,i){i.names&&i.names.forEach(t.bind(this)),i.name&&t.call(this,i.name)},this.set=function(t,e){for(var n in e)if(e.hasOwnProperty(n))try{i.setJSON(n,e[n])}catch(s){s.code===DOMException.QUOTA_EXCEEDED_ERR?this.trigger(document,"dataStorageFull",{name:n,value:e[n]}):this.trigger(document,"dataStorageSetError",{name:n,value:e[n]})}},this.after("initialize",function(){this.on("dataStorageSet",this.set),this.on("dataStorageGet",this.get)})};return t(n)}),define("data/with_client",[],function(){function t(){this.getClientByAccountKey=function(t){var e;return e=t?TD.controller.clients.getClient(t):this.getTwitterClient("twitter")},this.getClientByAccount=function(t){return this.getClientByAccountKey(t.getKey())},this.getPreferredClient=function(t){return TD.controller.clients.getPreferredClient(t)},this.getTwitterClient=function(){return this.getPreferredClient("twitter")},this.getTweetDeckClient=function(){return this.getClientsByService("tweetdeck")[0]},this.getClientsByService=function(t){return TD.controller.clients.getClientsByService(t)},this.getAccountData=function(t){var e=this.getClientByAccountKey(t);if(!e)return null;var i=e.oauth.account;return{accountKey:t,id:i.getUserID(),screenName:i.getUsername(),profileImageURL:i.getProfileImageURL()}}}return t}),define("data/with_accounts",[],function(){function t(){this.attributes({service:"twitter",twitterUrlForOAuthEcho:"https://api.twitter.com/1.1/account/verify_credentials.json"}),this.getCurrentAuthType=function(){return TD.storage.store.getCurrentAuthType()},this.isTwogin=function(){return"twitter"===this.getCurrentAuthType()},this.getTwitterLoginAccount=function(){var t=TD.storage.store.getTwitterLoginAccount();return t&&this.serializeAccount(t)},this.getTweetdeckLoginEmail=function(){return TD.storage.store.getTweetdeckAccount()},this.getDefaultAccount=function(){var t=TD.storage.accountController.getDefault();return null===t?null:this.serializeAccount(t)},this.setDefaultAccount=function(t){TD.storage.accountController.setDefault(t)},this.getAccount=function(t){return this.serializeAccount(TD.storage.accountController.get(t))},this.removeAccount=function(t){TD.controller.clients.removeClient(t)},this.getAccountsForService=function(t){var e=TD.storage.accountController.getAccountsForService(t);return this.serializeAccounts(e).sort(this.sortAccounts)},this.getAccountFromId=function(t){var e=TD.storage.accountController.getAccountFromId(t);return e?this.serializeAccount(e):void 0},this.serializeAccount=function(t){var e=TD.storage.accountController.getDefault(),i=TD.storage.store.getTwitterLoginAccount();return{name:t.getName(),accountKey:t.getKey(),profileImageURL:t.getProfileImageURL(),userId:t.getUserID(),screenName:t.getUsername(),isProtected:t.getIsPrivate(),isDefault:t===e,isTwoginAccount:t===i,isAdmin:t.getIsAdmin()}},this.serializeAccounts=function(t){return t.map(this.serializeAccount.bind(this))},this.sortAccounts=function(t,e){var i,n;if(TD.storage.store.getTwitterLoginAccount()){if(t.isTwoginAccount)return-1;if(e.isTwoginAccount)return 1}else{if(t.isDefault)return-1;if(e.isDefault)return 1}return i=t.screenName.toLowerCase(),n=e.screenName.toLowerCase(),n>i?-1:i>n?1:0},this.reauthorizeAccount=function(t){var e=TD.storage.accountController.get(t);TD.controller.clients.addClient(this.attr.service,e,!0)},this.addAccount=function(){TD.controller.clients.addClient(this.attr.service)},this.resetTweetdeckPassword=function(){var t=TD.storage.store.getTweetdeckAccount();return TD.controller.clients.getTDClient().forgotPassword(t)},this.setIsAdmin=function(t,e){var i=TD.storage.accountController.get(t);i.setIsAdmin(e)},this.getHttpHeadersForOAuthEcho=function(){return TD.net.ajax.signRequest(TD.storage.store.getTwitterLoginAccount(),this.attr.twitterUrlForOAuthEcho,"GET").addCallback(function(t){return{"X-Auth-Service-Provider":t.data.url,"X-Verify-Credentials-Authorization":t.data.headers.Authorization}})}}return t}),define("data/accounts",["require","flight/lib/component","data/with_client","data/with_accounts"],function(t){"use strict";function e(){this.after("initialize",function(){this.on(document,"uiNeedsAccounts",this.handleUiNeedsAccounts),this.on(document,"uiNeedsAccount",this.handleUiNeedsAccount),this.on(document,"uiNeedsDefaultAccount",this.handleNeedsDefaultAccount),this.on(document,"uiNeedsSingleAccountStatus",this.handleNeedsSingleAccountStatus),this.subscription=$.subscribe("/storage/client/default_account_changed",this.handleDefaultAccountChanged.bind(this)),this.subscriptionToAccountChange=$.subscribe("/storage/account/change",_.debounce(this.getAndSendAccounts.bind(this),50)),this.on(document,"dataAccountWhitelist",this.handleAccountWhitelist),this.on(document,"uiAccountAction",this.handleAccountAction),this.on(document,"dataContributorActionSuccess",this.handleContributorActionSuccess),this.on(document,"dataTwitterAccountAccessDenied",this.handleTwitterAccountAccessDenied),this.on(document,"dataTwitterAccountAccessSuccess",this.handleTwitterAccountAccessSuccess)}),this.before("teardown",function(){$.unsubscribe(this.subscription),$.unsubscribe(this.subscriptionToAccountChange)}),this.sendAccounts=function(t){this.trigger("dataAccounts",{accounts:t})},this.sendAccount=function(t){this.trigger("dataAccount",{account:t})},this.getAndSendAccounts=function(){var t=this.getAccountsForService("twitter");this.sendAccounts(t)},this.getAndSendAccount=function(t){var e=this.getAccount(t);this.sendAccount(e)},this.handleDefaultAccountChanged=function(){this.trigger("dataDefaultAccount",{accountKey:this.getDefaultAccount().accountKey}),this.getAndSendAccounts(),this.trigger("dataTwitterClientChanged",{client:this.getTwitterClient()})},this.handleUiNeedsAccounts=function(){this.getAndSendAccounts()},this.handleUiNeedsAccount=function(t,e){this.getAndSendAccount(e.accountKey)},this.handleAccountWhitelist=function(t,e){this.getAndSendAccounts()},this.handleNeedsDefaultAccount=function(){var t=this.getDefaultAccount();t&&this.trigger("dataDefaultAccount",t)},this.handleAccountAction=function(t,e){switch(e.action){case"reauthorize":this.reauthorizeAccount(e.accountKey);break;case"rewriteColumns":if(!TD.decider.get("enable_rewrite_columns"))break;var i=this.chooseNextAvailableAccount(this.getAccountsForService("twitter"),e.accountKey);this.getDefaultAccount().accountKey===e.accountKey&&this.setDefaultAccount(i.accountKey),this.rewriteColumns(e.accountKey,i.accountKey),this.removeAccount(e.accountKey);break;case"remove":this.removeAccount(e.accountKey);break;case"setDefault":this.setDefaultAccount(e.accountKey);break;case"add":this.addAccount();break;case"passwordReset":var n=this.resetTweetdeckPassword();n.addCallbacks(function(t){this.trigger("dataForgotPasswordSuccess",{request:e,response:t})}.bind(this),function(t){this.trigger("dataForgotPasswordError",{request:e,response:t})}.bind(this))}},this.handleContributorActionSuccess=function(t,e){var i=this.getTwitterLoginAccount();if(i)switch(e.request.action){case"remove":e.request.userId===i.userId&&this.removeAccount(e.request.accountKey);break;case"update":e.request.userId===i.userId&&this.setIsAdmin(e.request.accountKey,e.request.isAdmin)}},this.handleNeedsSingleAccountStatus=function(){this.trigger("dataSingleAccountStatus",{isSingleAccount:1===this.getAccountsForService("twitter").length})},this.handleTwitterAccountAccessDenied=function(t,e){var i=e.account;i&&i.setPrivate("isAccessDenied",!0)},this.handleTwitterAccountAccessSuccess=function(t,e){var i=e.account;i&&i.getPrivate("isAccessDenied")&&(i.setPrivate("isAccessDenied",!1),this.trigger("dataTwitterAccountAccessEnabled",{accountKey:i.getKey()}))},this.rewriteColumns=function(t,e){this.trigger("dataAccountsRewriteColumns",{sourceAccountKey:t,targetAccountKey:e})},this.chooseNextAvailableAccount=function(t,e){return t.find(function(t){return t.accountKey!==e})}}var i=t("flight/lib/component"),n=t("data/with_client"),s=t("data/with_accounts");return i(e,n,s)}),define("data/column_manager",["require","flight/lib/component"],function(t){var e=t("flight/lib/component"),i=function(){this.deleteColumn=function(t,e){var i=e.columnId;i&&TD.controller.columnManager.deleteColumn(i)},this.moveColumn=function(t,e){var i=e.columnId,n=e.action;i&&n&&TD.controller.columnManager.move(i,n)},this.handleUiNeedsSerializedColumn=function(t,e){var i=TD.controller.columnManager.get(e.columnId),n={feeds:_.map(i.getFeeds(),function(t){return t.state}),filters:i.getSearchFilter().toJSONObject()};this.trigger("dataSerializedColumn",{columnId:e.columnId,column:n,url:"https://tweetdeck.twitter.com/#column="+TD.core.base64.encode(JSON.stringify(n))})},this.after("initialize",function(){this.on(document,"uiDeleteColumnAction",this.deleteColumn),this.on(document,"uiMoveColumnAction",this.moveColumn),this.on(document,"uiNeedsSerializedColumn",this.handleUiNeedsSerializedColumn)})};return e(i)}),define("data/with_twitter_api",["flight/lib/compose","data/with_client"],function(t,e){return function(){t.mixin(this,[e]),this.after("initialize",function(){this.attr.baseUrl=this.attr.baseUrl||TD.config.twitter_api_base,this.attr.apiVersion=this.attr.apiVersion||TD.config.twitter_api_version}),this.wrapTwitterApiErrback=function(t){return function(e){var i={request:t.request,response:e};"function"==typeof t.error?t.error(i):"string"==typeof t.error?this.trigger(t.error,i):this.trigger("dataTwitterApiError",{error:"Unknown error"})}.bind(this)},this.wrapTwitterApiCallback=function(t,e){return function(i){var n={request:t.request,response:i};"function"==typeof t.success?t.success(n):"string"==typeof t.success?this.trigger(t.success,n):this.trigger("dataTwitterApiSuccess",n),t.processAsStreamData&&e.processStreamData(i)}.bind(this)},this.makeTwitterApiCall=function(t){t=t||{};var e,i,n=this.getClientByAccountKey(t.request.accountKey),s=this.wrapTwitterApiErrback(t,n),r=this.wrapTwitterApiCallback(t,n);e=this.withTwitterApiUrl(t),i=t.method||"GET";try{return n.makeTwitterCall(e,t.params,i,t.dataProcessor,r,s,t.feedType)}catch(o){s()}},this.makeTwitterRequest=function(t,e,i){var n=this.getClientByAccountKey(t),s=this.withTwitterApiUrl({resource:e});return n.request(s,i)},this.withTwitterApiUrl=function(t){var e=[];return e.push(t.baseUrl||this.attr.baseUrl),e.push(t.apiVersion||this.attr.apiVersion),e.push(t.resource),e.join("/")}}}),define("data/contributors",["require","flight/lib/component","data/with_accounts","data/with_twitter_api"],function(t){function e(){this.attributes({}),this.after("initialize",function(){this.on(document,"uiNeedsContributees",this.handleUiNeedsContributees),this.on(document,"uiRemoveContributee",this.handleUiRemoveContributee),this.on(document,"uiNeedsContributors",this.handleUiNeedsContributors),this.on(document,"uiContributorAction",this.handleUiContributorAction),this.on(document,"dataContributeeInviteSuccess",this.handleDataContributeeInviteSuccess)}),this.triggerResult=function(t,e,i){this.trigger(t,{request:e,response:i})},this.handleDataContributeeInviteSuccess=function(){this.trigger("dataAccounts",{accounts:this.getAccountsForService("twitter")})},this.handleUiNeedsContributees=function(t,e){if(this.isTwogin()&&!TD.decider.get("disable_contributors_contributees_fetch")){var i=this.makeTwitterRequest(e.accountKey,"users/contributees.json",{});i.addCallback(function(t){var i=t.data.map(function(t){return{id:t.user.id_str,isAdmin:!!t.admin}});this.trigger("dataContributees",{accountKey:e.accountKey,contributees:i})}.bind(this))}},this.handleUiRemoveContributee=function(t,e){var i=this.makeTwitterRequest(e.accountKey,"users/contributees/destroy.json",{method:"POST",params:{user_id:e.userId}});i.addCallbacks(this.triggerResult.bind(this,"dataContributeeRemoveSuccess",e),this.triggerResult.bind(this,"dataContributeeRemoveError",e))},this.handleUiNeedsContributors=function(t,e){if(!this.isTwogin()||TD.decider.get("disable_contributors_contributors_fetch"))return this.triggerResult("dataContributorsError",e);var i=this.makeTwitterRequest(e.accountKey,"users/contributors.json",{});i.addCallback(function(t){var i=this.processContributorsData(t.data,e.accountKey);this.trigger("dataContributors",{accountKey:e.accountKey,contributors:i})}.bind(this)),i.addErrback(this.triggerResult.bind(this,"dataContributorsError",e))},this.processContributorsData=function(t,e){var i=TD.storage.accountController.get(e);return t.map(function(t){return{user:new TD.services.TwitterUser(i).fromJSONObject(t.user,{isContributor:!0}),isAdmin:t.admin}})},this.handleUiContributorAction=function(t,e){var i;e.userId?i=TD.core.defer.succeed():(i=TD.cache.twitterUsers.getByScreenName(e.screenName),i.addCallback(function(t){e.userId=t.id})),i.addCallback(this.performContributorAction.bind(this,e)),i.addCallbacks(this.triggerResult.bind(this,"dataContributorActionSuccess",e),this.triggerResult.bind(this,"dataContributorActionError",e))},this.updateContributor=function(t){var e=this.makeTwitterRequest(t.accountKey,"users/contributors/update.json",{method:"POST",params:{user_id:t.userId,admin:!!t.isAdmin}});return e.addCallbackWith(this,function(e){var i=this.processContributorsData(e.data,t.accountKey);return this.trigger("dataContributor",{accountKey:t.accountKey,contributor:i[0]}),e}),e},this.removeContributor=function(t){return this.makeTwitterRequest(t.accountKey,"users/contributors/destroy.json",{method:"POST",params:{user_id:t.userId}})},this.performContributorAction=function(t){var e;switch(t.action&&this.trigger("metric",{key:"contributors:data:action:"+t.action}),t.action){case"add":case"update":e=this.updateContributor(t);break;case"remove":e=this.removeContributor(t);break;default:e=TD.core.defer.fail()}return e}}var i=t("flight/lib/component"),n=t("data/with_accounts"),s=t("data/with_twitter_api");return i(e,n,s)}),define("data/embed_timeline",["flight/lib/component","data/with_client"],function(t,e){function i(){this.checkListSubscription=function(t,e,i){var n=_.uniqueId(),s={id:n,title:TD.i("Subscribe to this list?"),message:[TD.i("To share this list, we need to subscribe you to it."),TD.i("Subscribe and share?")].join("\n"),okLabel:TD.i("OK"),cancelLabel:TD.i("Cancel")},r=function(){TD.util.openURL(e,i)},o=function(e,i){var s;i.id===n&&(this.off(document,"uiConfirmationAction",o),i.result&&(s=this.getTwitterClient(),s.subscribeToList(t,r)))},a=this.getTwitterClient().oauth.account.getKey(),c=TD.cache.lists.find(t,null,null,!1,a);c?r():(this.on(document,"uiConfirmationAction",o.bind(this)),this.trigger("uiShowConfirmationDialog",s))},this.openEmbedTimeline=function(t,e){var i,n,s,r="https://twitter.com/settings/widgets/new/",o={};if(e&&e.column&&e.column.isEmbeddable()){switch(i=e.column.getFeeds()[0],n=i.getMetadata(),e.column.getColumnType()){case TD.util.columnUtils.columnMetaTypes.USERTWEETS:r+="user",o.user_id=n.id?n.id:TD.storage.accountController.get(i.getAccountKey()).getUserID();break;case TD.util.columnUtils.columnMetaTypes.FAVORITES:r+="favorites",o.user_id=n.id?n.id:TD.storage.accountController.get(i.getAccountKey()).getUserID();break;case TD.util.columnUtils.columnMetaTypes.LIST:return r+="list",o.list_id=n.listId,this.checkListSubscription(n.listId,r,o),void 0;case TD.util.columnUtils.columnMetaTypes.SEARCH:r+="search",n.baseQuery&&n.searchFilterData?(s=new TD.vo.SearchFilter(n.searchFilterData),o.query=[n.baseQuery,s.getQueryString()].join(" ").trim()):o.query=n.term;break;case TD.util.columnUtils.columnMetaTypes.CUSTOMTIMELINE:r+="custom",o.timeline_id=n.id.replace(/[^\d]*/,"")}TD.util.openURL(r,o)}},this.after("initialize",function(){this.on(document,"uiEmbedTimelineAction",this.openEmbedTimeline)})}return t(i,e)}),define("data/embed_tweet",["flight/lib/component","data/with_client"],function(t,e){function i(){this.handleEmbeddedTweetFactory=function(t){return function(e){e.request=t,this.trigger(document,"dataEmbeddedTweet",e)}},this.handleErrorFactory=function(t){return function(){var e={request:t};this.trigger(document,"dataEmbeddedTweetError",e)}},this.getEmbeddedTweet=function(t,e){if(e&&e.tweetID){var i=this.getTwitterClient();i.getEmbeddedTweet(e.tweetID,e.hideThread,e.hideMedia,e.maxWidth,this.handleEmbeddedTweetFactory(e).bind(this),this.handleErrorFactory(e).bind(this))}},this.after("initialize",function(){this.on(document,"uiNeedsEmbeddedTweet",this.getEmbeddedTweet)})}return t(i,e)}),define("util/with_version_comparator",[],function(){var t=function(){this.appSatisfiesVersionRequirements=function(t){var e=TD.version,i=t.split(" ");return _.all(i,function(t){var i,n=t.match(/[<=>]*/)[0],s=t.substr(n.length),r=[];return _.contains(n,">")?r.push(1):_.contains(n,"<")&&r.push(-1),(_.contains(n,"=")||0===n.length)&&r.push(0),i=TD.util.versionComparator(e,s),_.contains(r,i)})}};return t}),define("data/message_banner",["require","flight/lib/component","util/with_version_comparator"],function(t){function e(){this.after("initialize",function(){this.on(document,"uiHidingMessageBanner",this.dismissMessage),this.on(document,"dataMessages",this.handleMessages)}),this.handleMessages=function(t,e){var i=e.messages;i&&(i=i.filter(this.satisfiesPlatformRequirements,this),i=i.filter(this.satisfiesVersionRequirements,this),i=i.filter(this.hasNotBeenDismissed,this),i.length&&this.trigger("dataMessage",i[0]))},this.dismissMessage=function(t,e){this.updateIdsForSeenMessages(),this.idsForSeenMessages.push(e.id),TD.settings.setIdsForSeenMessages(this.idsForSeenMessages)},this.satisfiesPlatformRequirements=function(t){if(t.target&&t.target.platform){var e=TD.util.getAppEnv();return _.include(t.target.platform,e)}return!0},this.satisfiesVersionRequirements=function(t){return t.target&&t.target.version?this.appSatisfiesVersionRequirements(t.target.version):!0},this.hasNotBeenDismissed=function(t){if(t.message){this.updateIdsForSeenMessages();var e=this.idsForSeenMessages.every(function(e){return t.message.id!==e});return e}return!1},this.updateIdsForSeenMessages=function(){var t=TD.settings.getIdsForSeenMessages();this.idsForSeenMessages=_.union(this.idsForSeenMessages,t)}}var i=t("flight/lib/component"),n=t("util/with_version_comparator");return i(e,n)}),define("data/preferred_account",["flight/lib/component"],function(t){function e(){this.send=function(t){this.trigger(document,"dataPreferredAccount",{account:t})},this.getPreferredTwitterAccount=function(){this.ready&&this.send(TD.storage.accountController.getPreferredAccount("twitter"))},this.tdReady=function(){this.ready=!0,this.getPreferredTwitterAccount(),this.off(document,"TD.ready",this.tdReady)},this.after("initialize",function(){this.on(document,"uiNeedsPreferredAccount",this.getPreferredTwitterAccount),this.on(document,"TD.ready",this.tdReady),$.subscribe("/storage/account/new",this.getPreferredTwitterAccount.bind(this)),$.subscribe("/storage/client/default_account_changed",this.getPreferredTwitterAccount.bind(this))})}return t(e)}),define("data/relationship",["flight/lib/component","data/with_client"],function(t,e){function i(){this.handleRelationship=function(t){this.trigger(document,"dataRelationship",t)},this.handleError=function(t){return function(){this.trigger(document,"dataRelationshipError",t)}},this.getRelationship=function(t,e){if(e&&e.account&&e.screenName){var i=this.getClientByAccount(e.account);i.showFriendship(e.account.getUserID(),null,e.screenName,this.handleRelationship.bind(this),this.handleError(e).bind(this))}},this.after("initialize",function(){this.on(document,"uiNeedsRelationship",this.getRelationship)})}return t(i,e)}),define("data/favorite",["require","flight/lib/component","data/with_client"],function(t){function e(){this.after("initialize",function(){this.on("uiNeedsFavoriteState",this.getFavoriteState),this.on("uiFavoriteTweet",this.handleFavoriteTweet),this.on("uiUnfavoriteTweet",this.handleUnfavoriteTweet)}),this.handleErrorFactory=function(t,e){return function(i){this.trigger(document,e,{request:t,error:i})}.bind(this)},this.handleFavoriteState=function(t){this.trigger("dataFavoriteState",{tweetId:t.id,isFavorite:t.isFavorite,accountKey:t.account.getKey()})},this.handleFavoriteTweet=function(t,e){var i=this.getClientByAccountKey(e.accountKey);i.favorite(e.tweetId,this.handleFavoriteSuccessFactory(e,!0),this.handleErrorFactory(e,"dataFavoriteError"))},this.handleUnfavoriteTweet=function(t,e){var i=this.getClientByAccountKey(e.accountKey);i.unfavorite(e.tweetId,this.handleFavoriteSuccessFactory(e,!1),this.handleErrorFactory(e,"dataFavoriteError"))},this.handleFavoriteSuccessFactory=function(t,e){return function(){this.trigger("dataFavoriteState",{tweetId:t.tweetId,accountKey:t.accountKey,isFavorite:e})}.bind(this)},this.getFavoriteState=function(t,e){var i=this.getClientByAccountKey(e.accountKey);i.show(e.tweetId,this.handleFavoriteState.bind(this),this.handleErrorFactory(e,"dataFavoriteStateError").bind(this))}}var i=t("flight/lib/component"),n=t("data/with_client");return i(e,n)}),define("data/twitter_user",["flight/lib/component"],function(t){function e(){this.getTwitterUser=function(t,e){var i;e&&(i=e.id?TD.cache.twitterUsers.getById(e.id):TD.cache.twitterUsers.getByScreenName(e.screenName),i.addCallbacks(this.handleTwitterUser,this.errorHandlerFactory(e.screenName),null,null,this,this))},this.errorHandlerFactory=function(t){var e=function(e){var i=e.req.errors,n=TD.i("Sorry, we couldn't retrieve user @{{1}}",{1:t}),s=!1;i&&i.forEach(function(t){63===t.twitterErrorCode?s=!0:t.message&&(n+=" - "+t.message)}),s||TD.controller.progressIndicator.addMessage(n),this.trigger("dataTwitterUserError",{screenName:t})};return e.bind(this)},this.handleTwitterUser=function(t){t&&t.account&&this.trigger(document,"dataTwitterUser",t)},this.after("initialize",function(){this.on(document,"uiNeedsTwitterUser",this.getTwitterUser)})}return t(e)}),define("data/user_actions",["flight/lib/component","data/with_client"],function(t,e){var i=function(){this.attributes({actions:{follow:{userAction:"follow",errorEvent:"dataFollowActionError"},unfollow:{userAction:"unfollow",errorEvent:"dataUnfollowActionError"},block:{userAction:"block",errorEvent:"dataBlockActionError"},unblock:{userAction:"unblock",errorEvent:"dataUnblockActionError"},report:{userAction:"report",errorEvent:"dataReportActionError"},reportSpam:{userAction:"reportSpam",errorEvent:"dataReportSpamActionError"},reportCompromised:{userAction:"reportCompromised",errorEvent:"dataReportCompromisedActionError"}}}),this.error=function(t,e){return function(i){var n;n={request:e,response:i},this.trigger(document,t.errorEvent,n)}},this.success=function(t,e){return function(i){this.trigger("dataFollowStateChange",{action:t,request:e,response:i})}},this.takeAction=function(t,e,i){var n=!1,s=this.success(t,i).bind(this),r=this.error(t,i).bind(this),o=t.userAction;try{switch(o){case"block":i.twitterUser.block(i.account,!1,s,r,n);break;case"reportSpam":i.twitterUser.block(i.account,!0,s,r,n);break;case"unblock":i.twitterUser.unblock(i.account,s,r);break;case"follow":i.twitterUser.follow(i.account,s,r,!0);break;case"unfollow":i.twitterUser.unfollow(i.account,s,r,n)}}catch(a){this.error()}},this.bindAction=function(t){return this.takeAction.bind(this,t)},this.after("initialize",function(){this.on(document,"uiFollowAction",this.bindAction(this.attr.actions.follow)),this.on(document,"uiUnfollowAction",this.bindAction(this.attr.actions.unfollow)),this.on(document,"uiBlockAction",this.bindAction(this.attr.actions.block)),this.on(document,"uiUnblockAction",this.bindAction(this.attr.actions.unblock)),this.on(document,"uiReportSpamAction",this.bindAction(this.attr.actions.reportSpam)),this.on(document,"uiReportCompromisedAction",this.bindAction(this.attr.actions.reportCompromised))})};return t(i,e)}),define("data/settings",["flight/lib/component"],function(t){function e(){this.after("initialize",function(){this.on(document,"uiNeedsSettings",this.handleUiNeedsSettings),this.on(document,"uiToggleTheme",this.toggleTheme),this.on(document,"uiNavbarWidthChangeAction",this.handleNavbarWidthChange),this.on(document,"uiChangeComposeStayOpen",this.handleComposeStayOpen)}),this.handleUiNeedsSettings=function(){this.settings={theme:TD.settings.getTheme(),navbarWidth:TD.settings.getNavbarWidth(),composeStayOpen:TD.settings.getComposeStayOpen()},this.trigger(document,"dataSettings",this.settings)},this.toggleTheme=function(){var t=this.settings.theme;t="light"===t?"dark":"light",TD.settings.setTheme(t),this.settings.theme=t,this.trigger(document,"dataSettings",this.settings)},this.handleNavbarWidthChange=function(t,e){TD.settings.setNavbarWidth(e.navbarWidth),this.settings.navbarWidth=e.navbarWidth,this.trigger(document,"dataSettings",this.settings)},this.handleComposeStayOpen=function(t,e){TD.settings.setComposeStayOpen(e.composeStayOpen),this.settings.composeStayOpen=e.composeStayOpen,this.trigger(document,"dataSettings",this.settings)}}return t(e)}),define("data/stream_counter",["flight/lib/component"],function(t){var e=function(){this.attributes({updatePeriod:500,aggregationPeriod:1e4}),this.updateStreamCount=function(t,e){this.streamCounter.incrementCounter(e.numStreamItems)},this.after("initialize",function(){this.on(document,"dataReceivedStreamData",this.updateStreamCount),this.streamCounter=new TD.util.TpmCounter(this.attr.updatePeriod,this.attr.aggregationPeriod,"dataStreamRate")})};return t(e)}),define("data/user_search",["flight/lib/component","data/with_client"],function(t,e){function i(){this.handleResponseFactory=function(t,e){return function(i){this.trigger(document,t,{request:e,result:i})}.bind(this)},this.doUserSearch=function(t,e){var i=this.getPreferredClient("twitter"),n=e.query;i?i.userSearch(n,this.handleResponseFactory("dataUserSearch",e),this.handleResponseFactory("dataUserSearchError",e)):this.handleResponseFactory("dataUserSearchError",e)()},this.after("initialize",function(){this.on(document,"uiNeedsUserSearch",this.doUserSearch)})}return t(i,e)}),define("data/recent_searches",["flight/lib/component"],function(t){var e=function(){this.saveRecentSearch=function(t,e){TD.storage.clientController.client.addRecentSearch(e.query)},this.getRecentSearches=function(t){var e={recentSearches:TD.storage.clientController.client.getRecentSearches()};this.trigger("dataRecentSearches",e)},this.clearRecentSearches=function(t){TD.storage.clientController.client.clearRecentSearches()},this.after("initialize",function(){this.on(document,"uiSearch",this.saveRecentSearch),this.on(document,"uiRecentSearchClearAction",this.clearRecentSearches),this.on(document,"uiNeedsRecentSearches",this.getRecentSearches)})};return t(e)}),define("data/typeahead/with_users_datasource",["require"],function(t){"use strict";function e(t){this.attributes({usersStorageLimit:2500,storageUserHash:"typeaheadUserHash",storageUserLastPrefetch:"typeaheadUserLastPrefetch"}),this.after("initialize",function(){this.userAdjacencyList={},this.userHash={},this.blockedUserIds={},this.datasources=this.datasources||{},this.datasources.users={processData:this.processUserData.bind(this),getSuggestions:this.getUserSuggestions.bind(this)},this.on(document,"dataStorageItem",this.processUserStorageItem),this.on(document,"TD.ready",this.loadUserData),this.on(document,"dataTwitterClientChanged",this.resetUserData),this.on(document,"dataStorageFull",this.pruneUsers)}),this.tokenize=function(t){return t.trim().toLowerCase().split(TD.constants.regexps.tokenSeparator)},this.overwriteUserdata=function(t){this.userHash={},this.userAdjacencyList={},this.processUserData(t)},this.processUserData=function(t){_.each(t,function(t){t.tokens=t.tokens.map(function(t){return t="string"==typeof t?t:t.token,t.toLowerCase()}),0===t.tokens.length&&(t.tokens=this.tokenize(t.name),t.tokens.push(t.screen_name),t.tokens.push(TD.util.atMentionify(t.screen_name)),t.tokens=t.tokens.map(function(t){return t.toLowerCase()})),delete t.location,delete t.connecting_user_ids,this.userHash[t.id]=t,t.tokens.forEach(function(e){var i=e.charAt(0);void 0===this.userAdjacencyList[i]&&(this.userAdjacencyList[i]=[]),-1===this.userAdjacencyList[i].indexOf(t.id)&&this.userAdjacencyList[i].push(t.id)},this)},this);var e={};e[this.attr.storageUserHash]=this.userHash,this.trigger("dataStorageSet",e)},this.processPrefetchUserData=function(t){this.processUserData(t.users);var e={};e[this.attr.storageUserLastPrefetch]=Date.now(),this.trigger("dataStorageSet",e),this.trigger("dataTypeaheadUserPrefetchComplete")},this.prefetchUserSuggestions=function(){var t=this.getTwitterClient();t&&t.typeaheadSearch({prefetch:!0,count:this.attr.usersStorageLimit},this.processPrefetchUserData.bind(this),this.handleGetSuggestionsError.bind(this))},this.pruneUsers=function(){var t=_.values(this.userHash);t.sort(this.userSortComparator),t=t.slice(0,Math.floor(t.length/2)),this.overwriteUserdata(t)},this.getUserSuggestions=function(t,e){var i,n,s,r=[];return i=this.tokenize(t.query),n=this.getPotentiallyMatchingUserIds(i),s=this.getUsersFromIds(n),r=s.filter(this.matchUsers(i)),r.sort(this.userSortComparator),r=r.slice(0,e)},this.getPotentiallyMatchingUserIds=function(t){var e=[];return t.map(function(t){var i=this.userAdjacencyList[t.charAt(0)];

i&&(e=e.concat(i))},this),e=_.uniq(e)},this.getUsersFromIds=function(t){var e=[];return t.forEach(function(t){var i=this.userHash[t];i&&!this.isUserBlocked(t)&&e.push(i)},this),e},this.matchUsers=function(t){return function(e){var i=e.tokens,n=t.every(function(t){var e=i.filter(function(e){return 0===e.indexOf(t)});return e.length});return n?e:void 0}},this.userSortComparator=function(t,e){var i=0!==t.rounded_graph_weight,n=0!==e.rounded_graph_weight;return i&&!n?-1:n&&!i?1:i&&n?e.rounded_graph_weight-t.rounded_graph_weight:e.rounded_score-t.rounded_score},this.isUserBlocked=function(t){return this.blockedUserIds[t]?!0:!1},this.processUserStorageItem=function(t,e){switch(e.name){case this.attr.storageUserHash:this.processUserData(e.value);break;case this.attr.storageUserLastPrefetch:("number"!=typeof e.value||Date.now()-e.value>TD.constants.time.oneDay)&&this.prefetchUserSuggestions()}},this.loadUserData=function(){this.trigger("dataStorageGet",{names:[this.attr.storageUserHash,this.attr.storageUserLastPrefetch]});var t=this.getTwitterClient();t&&(this.blockedUserIds=t.blocks)},this.resetUserData=function(t,e){e.client&&(this.overwriteUserdata([]),this.blockedUserIds=e.client.blocks,this.prefetchUserSuggestions())}}return e}),define("data/typeahead/with_topics_datasource",[],function(){var t=function(){this.attributes({storageTopicsHash:"typeaheadTopicsHash",storageTopicsLastPrefetch:"typeaheadTopicsLastPrefetch"}),this.tokenize=function(t){return t.trim().toLowerCase().split(TD.constants.regexps.tokenSeparator)},this.topicSortComparator=function(t,e){return e.rounded_score-t.rounded_score},this.overwriteTopics=function(t){this.topicsHash={},this.topicsAdjacencyList={},this.processTopicData(t)},this.processTopicData=function(t){_.each(t,function(t){var e,i=t.topic;this.topicsHash[i]=t,0===t.tokens.length&&(e=this.tokenize(t.topic),t.tokens=e.map(function(t){return{token:t.toLowerCase()}})),t.tokens.forEach(function(t){var e=t.token.charAt(0).toLowerCase(),n=this.topicsAdjacencyList[e]||[];-1===n.indexOf(i)&&n.push(i),this.topicsAdjacencyList[e]=n},this)},this);var e={};e[this.attr.storageTopicsHash]=this.topicsHash,this.trigger("dataStorageSet",e)},this.processPrefetchTopicData=function(t){this.processTopicData(t.topics),this.topicsLastPrefetch=Date.now();var e={};e[this.attr.storageTopicsLastPrefetch]=this.topicsLastPrefetch,this.trigger("dataStorageSet",e)},this.pruneTopics=function(){var t=_.values(this.topicsHash);t.sort(this.topicSortComparator),t=t.slice(0,Math.floor(t.length/2)),this.overwriteTopics(t)},this.getTopicSuggestions=function(t,e){var i=t.query.toLowerCase(),n=this.topicsAdjacencyList[i.charAt(0)]||[],s=n.filter(function(t){return 0===t.toLowerCase().indexOf(i)},this);return s=this.getTopicObjectsFromStrings(s),s.sort(this.topicSortComparator),s=s.slice(0,e)},this.getTopicObjectsFromStrings=function(t){var e=[];return t.forEach(function(t){var i=this.topicsHash[t];i&&e.push(i)},this),e},this.prefetchTopicsSuggestions=function(){var t=this.getTwitterClient();t.typeaheadSearch({query:"",prefetch:!0,limit:200,datasources:["topics"]},this.processPrefetchTopicData.bind(this),this.handleGetSuggestionsError.bind(this))},this.processTopicStorageItem=function(t,e){switch(e.name){case this.attr.storageTopicsHash:this.processTopicData(e.value);break;case this.attr.storageTopicsLastPrefetch:this.topicsLastPrefetch=e.value,(!this.topicsLastPrefetch||Date.now()-this.topicsLastPrefetch>TD.constants.time.oneDay)&&this.prefetchTopicsSuggestions()}},this.loadTopicsData=function(){this.trigger("dataStorageGet",{names:[this.attr.storageTopicsHash,this.attr.storageTopicsLastPrefetch]})},this.resetTopicData=function(t,e){e.client&&(this.overwriteTopics([]),this.prefetchTopicsSuggestions())},this.after("initialize",function(){this.topicsHash={},this.topicsAdjacencyList={},this.datasources=this.datasources||{},this.datasources.topics={getSuggestions:this.getTopicSuggestions.bind(this),processData:this.processTopicData.bind(this)},this.on(document,"dataStorageItem",this.processTopicStorageItem),this.on(document,"TD.ready",this.loadTopicsData),this.on(document,"dataTwitterClientChanged",this.resetTopicData),this.on(document,"dataStorageFull",this.pruneTopics)})};return t}),define("data/typeahead/with_recent_searches_datasource",[],function(){var t=function(){this.tokenize=function(t){return t.trim().toLowerCase().split(TD.constants.regexps.tokenSeparator)},this.getRecentSearchSuggestions=function(t,e){if(this.trigger("uiNeedsRecentSearches"),!this.recentSearches)return[];var i=this.recentSearches,n=this.tokenize(t.query),s=i.filter(function(t){var e=this.tokenize(t),i=this.recentSearchMatchesQuery(e,n);return i},this);return s.slice(0,e)},this.recentSearchMatchesQuery=function(t,e){var i=e.every(function(e){return t.some(function(t){return 0===t.indexOf(e)})});return i},this.handleRecentSearches=function(t,e){e&&e.recentSearches&&(this.recentSearches=e.recentSearches)},this.processRecentSearchData=function(){},this.after("initialize",function(){this.datasources=this.datasources||{},this.datasources.recentSearches={getSuggestions:this.getRecentSearchSuggestions.bind(this),processData:this.processRecentSearchData.bind(this)},this.on(document,"dataRecentSearches",this.handleRecentSearches)})};return t}),define("data/typeahead/with_saved_searches_datasource",[],function(){var t=function(){this.tokenize=function(t){return t.trim().toLowerCase().split(TD.constants.regexps.tokenSeparator)},this.savedSearchesComparator=function(t,e){var i=t.query.toLowerCase(),n=e.query.toLowerCase();return(i>n)-(n>i)},this.updateSavedSearches=function(){var t=Date.now()-TD.constants.time.oneHour;if(!this.savedSearchesLastFetch||this.savedSearchesLastFetch<t){var e=this.getClientsByService("twitter");this.savedSearches=[],e.forEach(function(t){this.savedSearches=this.savedSearches.concat(t.searches)},this),this.savedSearchesLastFetch=Date.now()}},this.getSavedSearchSuggestions=function(t){if(""===t.query.trim())return[];var e=t.datasources&&t.datasources.some(function(t){return"savedSearches"===t});if(!e)return[];var i=[],n=this.tokenize(t.query);return this.updateSavedSearches(),this.savedSearches.forEach(function(t){var e=this.tokenize(t.query),s=this.savedSearchMatchesQuery(e,n);s&&i.push(t)},this),i.sort(this.savedSearchesComparator),i.splice(this.attr.limit),i},this.savedSearchMatchesQuery=function(t,e){return e.every(function(e){return t.some(function(t){return 0===t.indexOf(e)})})},this.processSavedSearchData=function(){},this.after("initialize",function(){this.savedSearches=[],this.savedSearchesLastFetch=!1,this.datasources=this.datasources||{},this.datasources.savedSearches={getSuggestions:this.getSavedSearchSuggestions.bind(this),processData:this.processSavedSearchData.bind(this)}})};return t}),define("data/typeahead/with_lists_datasource",[],function(){var t=function(){this.getListSuggestions=function(t,e){var i=t.query.trim().toLowerCase();if(this.trigger("uiNeedsSubscribedLists"),!this.lists)return[];var n=this.lists.filter(function(t){var e=-1!==t.user.screenName.toLowerCase().indexOf(i)||-1!==t.name.toLowerCase().indexOf(i);return e},this);return n.slice(0,e)},this.handleSubscribedLists=function(t,e){e&&e.lists&&(this.lists=e.lists)},this.processListData=function(){},this.after("initialize",function(){this.datasources=this.datasources||{},this.datasources.lists={getSuggestions:this.getListSuggestions.bind(this),processData:this.processListData.bind(this)},this.on(document,"dataSubscribedLists",this.handleSubscribedLists)})};return t}),define("data/typeahead/with_conversations_datasource",[],function(){"use strict";function t(){this.getConversationsSuggestions=function(t,e){function i(t){return r.test(t.name)}function n(t){return r.test(t.screenName)}if(t.accountKey){var s=TD.controller.clients.getClient(t.accountKey).conversations.getAllConversations(),r=new RegExp(TD.util.quotedForRegExp(t.query.trim()),"i"),o=s.filter(function(t){return"GROUP_DM"===t.type&&(r.test(t.name||"")||t.participants.some(i)||t.participants.some(n))},this);return o.sort(function(t,e){var s=t.participants.some(i),r=t.participants.some(n),o=e.participants.some(i),a=e.participants.some(n),c=!!t.name&&i(t),u=!!e.name&&i(e);return s&&!o?-1:!s&&o?1:r&&!a?-1:!r&&a?1:c&&!u?-1:!c&&u?1:0}).slice(0,e)}},this.processConversationsData=function(){},this.after("initialize",function(){this.datasources=this.datasources||{},this.datasources.conversations={getSuggestions:this.getConversationsSuggestions.bind(this),processData:this.processConversationsData.bind(this)}})}return t}),define("data/typeahead",["require","flight/lib/component","data/with_client","data/typeahead/with_users_datasource","data/typeahead/with_topics_datasource","data/typeahead/with_recent_searches_datasource","data/typeahead/with_saved_searches_datasource","data/typeahead/with_lists_datasource","data/typeahead/with_conversations_datasource"],function(t){"use strict";function e(){this.attributes({count:5,limits:{"default":5,lists:2},recentSearchOnlyLimit:10,timing:{"default":150,search:150,compose:300}}),this.after("initialize",function(){this.currentRequest={},this.datasources={},this.suggestions={},this.userPrefetchComplete=!1,this.getRemoteSuggestionsByType=_.reduce(this.attr.timing,function(t,e,i){return t[i]=_.throttle(this._getRemoteSuggestions.bind(this),e,{leading:!1}),t},{},this),this.on("uiNeedsTypeaheadSuggestions",this.getSuggestions),this.on("uiRecentSearchClearAction",this.updateSuggestions),this.on("dataTypeaheadQueryReset",this.queryReset),this.on("dataTypeaheadUserPrefetchComplete",this.handleUserPrefetchComplete)}),this.handleUserPrefetchComplete=function(){this.userPrefetchComplete=!0},this.getLimit=function(t){return this.currentRequest.limits[t]||this.currentRequest.limits["default"]},this.sendSuggestions=function(){this.trigger("dataTypeaheadSuggestions",{query:this.currentRequest.query,suggestions:this.dedupeSuggestions(this.suggestions),datasources:this.currentRequest.datasources,dropdownId:this.currentRequest.dropdownId})},this.dedupeSuggestions=function(t){var e={};return t=_.clone(t),t.recentSearches=this.dedupeArray(t.recentSearches,null,e),t.savedSearches=this.dedupeArray(t.savedSearches,"query",e),t.topics=this.dedupeArray(t.topics,"topic",e),t},this.dedupeArray=function(t,e,i){return t&&0!==t.length?_.filter(t,function(t){var n=e?t[e]:t,s=n.toLowerCase(),r=!i[s];return i[s]=!0,r}):t},this.processTypeaheadData=function(t,e){e.query===this.currentRequest.query&&(e.datasources.forEach(function(e){var i=this.datasources[e],n=t[e],s=this.getLimit(e);i&&n&&(i.processData(n),this.suggestions[e]=i.getSuggestions(this.currentRequest,s))},this),this.sendSuggestions())},this.updateSuggestions=function(){var t=new Promise(function(t){this.userPrefetchComplete?t():this.$node.one("dataTypeaheadUserPrefetchComplete",t)}.bind(this));this.currentRequest&&this.currentRequest.datasources&&t.then(this.actuallyUpdateSuggestions.bind(this))},this.actuallyUpdateSuggestions=function(){this.currentRequest.datasources.forEach(function(t){var e=this.datasources[t],i=this.getLimit(t);if(e){var n=e.getSuggestions(this.currentRequest,i);n&&n.length>0&&(this.suggestions[t]=n)}},this),this.sendSuggestions()},this.handleGetSuggestionsError=function(){this.trigger("dataTypeaheadSuggestionsError")},this._getRemoteSuggestions=function(){var t=this.getTwitterClient();this.currentRequest.query&&""!==this.currentRequest.query.trim()&&void 0!==t&&t.typeaheadSearch(this.currentRequest,this.processTypeaheadData.bind(this),this.handleGetSuggestionsError.bind(this))},this.getSuggestions=function(t,e){if(e.query!==this.currentRequest.query){var i=$.extend({},this.attr.limits,e.limits);this.currentRequest={accountKey:e.accountKey,query:e.query,datasources:e.datasources,count:this.attr.count,dropdownId:e.dropdownId,limits:i},this.suggestions={},this.updateSuggestions(),e.onlyLocalData||this.getRemoteSuggestions(e.type)}},this.queryReset=function(){this.currentRequest={}},this.getRemoteSuggestions=function(t){t=t||"default",this.attr.timing[t]||(t="default");var e=this.getRemoteSuggestionsByType[t];if(!e)throw new Error("No matching remote suggestion debounce type.");return e()}}var i=t("flight/lib/component"),n=t("data/with_client"),s=t("data/typeahead/with_users_datasource"),r=t("data/typeahead/with_topics_datasource"),o=t("data/typeahead/with_recent_searches_datasource"),a=t("data/typeahead/with_saved_searches_datasource"),c=t("data/typeahead/with_lists_datasource"),u=t("data/typeahead/with_conversations_datasource");return i(e,n,s,r,o,a,c,u)}),define("data/user_profile_social_proof",["flight/lib/component","data/with_client"],function(t,e){function i(){this.handleUserProfileSocialProofFactory=function(t){return function(e){e.request=t,this.trigger(document,"dataUserProfileSocialProof",e)}},this.handleErrorFactory=function(t){return function(){var e={request:t};this.trigger(document,"dataUserProfileSocialProofError",e)}},this.getUserProfileSocialProofData=function(t,e){if(e&&e.screenName){var i=this.getTwitterClient();i.getFollowingFollowersOf(e.screenName,this.handleUserProfileSocialProofFactory(e).bind(this),this.handleErrorFactory(e).bind(this))}},this.after("initialize",function(){this.on(document,"uiNeedsUserProfileSocialProof",this.getUserProfileSocialProofData)})}return t(i,e)}),define("data/twitter_users",["flight/lib/component","data/with_client"],function(t,e){var i=function(){this.handleTwitterUsersFactory=function(t){var e=function(e){this.trigger("dataTwitterUsers",{requestId:t,users:e})};return e.bind(this)},this.handleTwitterUsersErrorFactory=function(t){var e=function(){this.trigger("dataTwitterUsersError",{requestId:t})};return e.bind(this)},this.getTwitterUsers=function(t,e){this.twitterClient=this.twitterClient||this.getTwitterClient(),this.twitterClient.getUsersByIds(e.userIds,this.handleTwitterUsersFactory(e.requestId),this.handleTwitterUsersErrorFactory(e.requestId))},this.after("initialize",function(){this.on("uiNeedsTwitterUsers",this.getTwitterUsers)})};return t(i,e)}),define("data/lists",["flight/lib/component"],function(t){var e=function(){this.getLists=function(t){var e=TD.cache.lists.getAll();this.trigger(document,"dataSubscribedLists",{lists:e})},this.after("initialize",function(){this.on(document,"uiNeedsSubscribedLists",this.getLists)})};return t(e)}),define("data/tweet",["require","flight/lib/component","data/with_twitter_api"],function(t){"use strict";function e(){this.attributes({resources:{show:{method:"GET",url:"statuses/show/:id.json"},destroy:{method:"POST",url:"statuses/destroy/:id.json"},message:{method:"POST",url:"direct_messages/new.json"},reply:{method:"POST",url:"statuses/update.json"},tweet:{method:"POST",url:"statuses/update.json"},retweet:{method:"POST",url:"statuses/retweet/:id.json"}}}),this.after("initialize",function(){this.on(document,"uiSendTweet",this.handleSendTweet),this.on(document,"uiRetweet",this.handleRetweet),this.on(document,"uiUndoRetweet",this.handleUndoRetweet)}),this.getTweet=function(t){var e,i=new TD.core.defer.Deferred;try{e=this.attr.resources.show,this.makeTwitterApiCall({request:{accountKey:t.accountKey},params:t.params,resource:e.url.replace(":id",t.id),method:e.method,success:function(t){i.callback(t)},error:function(t){i.errback(t)}})}catch(n){i.errback({request:t})}return i},this.sendTweet=function(t){var e,i,n;try{switch(e=this.attr.resources[t.type],t.type){case"message":var s=t.messageRecipients&&t.messageRecipients[0]&&t.messageRecipients[0].id;i={text:t.text,user_id:s},n=function(t){return{direct_message:t}};break;case"reply":i={status:t.text,in_reply_to_status_id:t.inReplyToStatusId};break;case"tweet":i={status:t.text}}var r="message"===t.type?"media_id":"media_ids";t.mediaId&&(i[r]=t.mediaId),this.makeTwitterApiCall({request:t,resource:e.url,method:e.method,params:i,success:"dataTweetSent",error:"dataTweetError",dataProcessor:n,processAsStreamData:!0})}catch(o){this.trigger("dataTweetError",{request:t})}},this.sendRetweet=function(t,e){var i;try{i=this.attr.resources.retweet,this.makeTwitterApiCall({request:{accountKey:t},resource:i.url.replace(":id",e.id),method:i.method,success:"dataRetweetSuccess",error:"dataRetweetError",processAsStreamData:!0})}catch(n){this.trigger("dataRetweetError",{request:e})}},this.handleRetweet=function(t,e){e.from.forEach(function(t){this.sendRetweet(t,e)}.bind(this))},this.handleUndoRetweet=function(t,e){var i=e.tweetId,n=e.from,s=this.getTweet({id:i,accountKey:n,params:{include_my_retweet:!0}});s.addCallback(function(t){var e;return e=t.response.current_user_retweet?this.destroyTweet({accountKey:n,tweetId:t.response.current_user_retweet.id_str}):TD.core.defer.succeed()}.bind(this)),s.addCallbacks(function(){$(document).trigger("dataUndoRetweetSuccess",{tweetId:i,from:n})},function(){$(document).trigger("dataUndoRetweetError",{tweetId:i,from:n})})},this.destroyTweet=function(t){var e,i=new TD.core.defer.Deferred;try{e=this.attr.resources.destroy,this.makeTwitterApiCall({request:{accountKey:t.accountKey},resource:e.url.replace(":id",t.tweetId),method:e.method,success:function(t){i.callback(t)},error:function(t){i.errback(t)}})}catch(n){i.errback({request:t})}return i},this.handleSendTweet=function(t,e){e.files&&e.files.length||this.sendTweet(e)}}var i=t("flight/lib/component"),n=t("data/with_twitter_api");return i(e,n)}),define("util/with_watch_decider",[],function(){"use strict";function t(){this.before("initialize",function(){this.watchedDeciders={},this.watchedAccessLevels={}}),this.after("initialize",function(){this.on(document,"dataDeciderUpdated",this.handleDecidersChanged)}),this.watchAccessLevel=function(t,e,i){if("string"!=typeof t)throw new TypeError("watchAccessLevel feature must be a string");if("string"!=typeof e)throw new TypeError("watchAccessLevel level must be a string");if("function"!=typeof i)throw new TypeError("watchAccessLevel callback must be a function");var n=[t,e,i];this.watchedAccessLevels[n]=this.watchedAccessLevels[n]||{feature:t,level:e,value:TD.decider.hasAccessLevel(t,e),callback:i}},this.watchDecider=function(t,e){if("string"!=typeof t)throw new TypeError("watchDecider decider key list must be a string");if("function"!=typeof e)throw new TypeError("watchDecider callback must be a function");t.split(" ").forEach(function(t){this.watchedDeciders[t]=this.watchedDeciders[t]||{value:this.getDecider(t)},this.watchedDeciders[t].callback=e}.bind(this))},this.handleDecidersChanged=function(){Object.keys(this.watchedDeciders).forEach(function(t){var e=this.watchedDeciders[t],i=e.value,n=this.getDecider(t);i!==n&&(e.value=n,e.callback.call(this,n,i,t))}.bind(this)),Object.keys(this.watchedAccessLevels).forEach(function(t){var e=this.watchedAccessLevels[t],i=e.value,n=TD.decider.hasAccessLevel(e.feature,e.level);i!==n&&(e.value=n,e.callback.call(this,n,i,{feature:e.feature,level:e.level}))}.bind(this))},this.getDecider=function(t){return TD.decider.get(t)}}return t}),function(t,e){"function"==typeof define&&define.amd?define("scripts/UI/template",[],e):t.TD.ui.template=e()}(this,function(){function t(t){t=t.replace(h,"/");var e=l[t];return void 0===e&&(e=u.getHogan(t),e=o.compile(e,d),l[t]=e),e}function e(e,i){var n=this.partials[e];return i=i||{},i[n.name]||(i[n.name]=t(n.name)),Hogan.Template.prototype.ep.call(this,e,i)}function i(t,e,i){for(var s=Hogan.parse.call(this,t,e,i),r="",o=0;o<s.length;o++)if("_v"===s[o].tag&&0===s[o].n.indexOf("%TRANSLATION-HINT")){var a=s.splice(o,1)[0];o--,r=a.n.substring(a.n.indexOf("mode=")+"mode=".length)}return n(s,r,e,i)}function n(t,e,i,o){for(var a=[],c=0;c<t.length;c++)if("#"===t[c].tag&&"_i"===t[c].n){var u=r(i.substring(t[c].i,t[c].end),e);"raw"===u.tag?a.push(u):Array.prototype.push.apply(a,Hogan.parse(Hogan.scan(u,o.delimiters),i,o))}else"#"===t[c].tag||"^"===t[c].tag||"<"===t[c].tag||"$"===t[c].tag?(t[c].nodes=n(t[c].nodes,e,i,o),a.push(t[c])):a.push(t[c]);return s(a)}function s(t){if(0===t.length)return t;for(var e=[t[0]],i=1;i<t.length;i++)if("_t"!==e[e.length-1].tag||"\n"!==t[i].tag&&"_t"!==t[i].tag)e.push(t[i]);else{var n=e[e.length-1],s=t[i].text;void 0===s&&(s="\n"),n.text+=""+s}return e}function r(t,e){var i;return i=""!==e?{text:t,mode:e}:t,TD.i(i,null,!0)}var o,a,c,u={},h=/\\/g,l={},d={sectionTags:[{o:"_i",c:"i"}]};return c=function(t,i,n,s){this.ep=e,Hogan.Template.call(this,t,i,n,s)},c.prototype=Hogan.Template.prototype,a=function(){},a.prototype=Hogan,o=new a,o.template=c,o.parse=i,u.getHogan=function(t){var e=t+".mustache",i=TD.mustaches[e];return void 0===i?console.error('TD.mustaches["'+e+'"] is not defined'):i=i.trim(),i},u.render=function(e,i,n){var s,r=t(e),o=[];i=i||{};for(var a in TD.globalRenderOptions)void 0===i[a]&&(i[a]=TD.globalRenderOptions[a],o.push(a));return s=r.render(i,n),o.forEach(function(t){delete i[t]}),s.trim()},u.toHtml=function(t,e,i){var n=o.compile(t,d);return n.render(e,i).trim()},u.toHtmlFromRaw=function(t,e){var i=Hogan.compile(t);return i.render(e)},u.toURLFromRaw=function(t,e){return t.replace(/\{\{([^}]+?)\}\}/g,function(t,i){return encodeURIComponent(e[i])})},u}),define("data/schedule_tweet",["require","flight/lib/component","data/with_twitter_api","util/with_watch_decider","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({resources:{tweet:{method:"POST",url:"schedule/status/tweet.json",metricsKey:"status:tweet"},"delete":{method:"DELETE",url:"schedule/status/{{id}}.json",metricsKey:"status:delete"},dismiss:{method:"POST",url:"schedule/status/dismiss/{{id}}.json",metricsKey:"status:dismiss"},edit:{method:"PUT",url:"schedule/status/{{id}}.json",metricsKey:"status:edit"}}}),this.after("initialize",function(){this.on(document,"uiSendScheduledTweets",this.handleSendScheduleTweets),this.on(document,"uiDeleteScheduledTweetGroup",this.handleDeleteScheduledTweets),this.on(document,"uiEditScheduledTweetGroup",this.handleEditScheduleTweets),this.watchDecider("scheduler_read_background scheduler_read_visible",this.handleDeciderChange)}),this.handleSendScheduleTweets=function(t,e){if(e&&e.requests){e.metadata=e.metadata||{};var i=e.requests,n=i.filter(function(t){return this.shouldSchedule(t.type)},this),s=[],r=[],o=e.metadata.originalUpdates||[];if(n.length||o.length){this.trigger("metric",{key:"scheduler:ui:send"});var a=n.map(function(t){return t.accountKey});this.trigger("metric",{key:"scheduler:data:selected-accounts-to-nearest-hundred:"+~~(100*Math.round(a.length/100))}),e.tokenToDelete&&(o=[]),o.forEach(function(t,e){var i=a.indexOf(t.account.getKey());if(0>i)return r.push(t);var o=n.splice(i,1)[0];o.id=t.id,s.push(o)});var c=TD.core.defer.succeed();a.length>200&&(this.trigger("metric",{key:"scheduler:data:force-failure"}),c.addCallback(function(){throw new Error(TD.i("Failed to schedule tweets."))})),c.addCallbackWith(this,function(){return new TD.core.defer.gatherResults(n.map(this.waitForUploads,this))}),c.addCallbackWith(this,function(t){var e=new TD.core.defer.gatherResults(s.map(this.waitForUploads,this));return e.addCallbackWith(this,function(e){return{toCreate:t,toEdit:e}}),e}),c.addErrbackWith(this,function(t){return i.forEach(function(e){this.trigger("dataTweetError",{request:e,response:t})},this),t}),c.addCallbackWith(this,function(t){var e=[].concat(t.toCreate.map(this.makeApiCallToResource.bind(this,this.attr.resources.tweet)),t.toEdit.map(this.makeApiCallToResource.bind(this,this.attr.resources.edit)));return new TD.core.defer.gatherResults(e)}),c.addCallbackWith(this,function(t){return new TD.core.defer.gatherResults(r.map(function(t){return this.deleteScheduledTweet({id:t.id,token:t.token,accountKey:t.account.getKey()})},this))}),c.addBothWith(this,this.addOrRefreshScheduledColumn)}}},this.handleDeleteScheduledTweets=function(t,e){if(!this.isVisibilityOff()){this.trigger("metric",{key:"scheduler:ui:delete"});var i=new TD.core.defer.DeferredList(e.scheduledTweetGroup.updates.map(function(t){return this.deleteScheduledTweet({id:t.id,token:t.token,state:t.state,accountKey:t.account.getKey()})},this));i.addBoth(this.refreshScheduledColumn.bind(this))}},this.handleEditScheduleTweets=function(t,e){if(this.isWriteOff())return alert(TD.i("Sorry  editing scheduled tweets is currently unavailable."));this.trigger("metric",{key:"scheduler:ui:edit"});var i=e.scheduledTweetGroup;this.trigger("uiComposeTweet",{type:"tweet",schedule:{time:i.time},text:i.text,from:i.updates.map(function(t){return t.account.getKey()}),inReplyTo:{tweetId:status.inReplyToStatusId},metadata:{originalUpdates:i.updates}})},this.makeApiCallToResource=function(t,e){this.trigger("metric",{key:"scheduler:data:"+t.metricsKey});var i={status:e.text,execute_at:Math.round(e.scheduledDate.getTime()/1e3)};return e.inReplyToStatusId&&(i.in_reply_to_status_id=e.inReplyToStatusId),e.mediaId&&(i.media_ids=e.mediaId),this.makeTwitterApiCall({resource:r.toURLFromRaw(t.url,e),method:t.method,request:e,params:i,success:"dataTweetSent",error:"dataTweetError"})},this.deleteScheduledTweet=function(t){var e=this.attr.resources["failed"===t.state?"dismiss":"delete"];this.trigger("metric",{key:"scheduler:data:"+e.metricsKey});var i=this.makeTwitterApiCall({resource:r.toURLFromRaw(e.url,{id:t.id}),request:t,method:e.method});return i.addCallback(function(){TD.controller.feedManager.deleteChirp(t.token)}),i.addErrbackWith(this,function(t){return TD.controller.progressIndicator.addMessage(TD.i("Failed to delete scheduled tweet.")),t}),i},this.waitForUploads=function(t){if(!t.files||!t.files.length)return TD.core.defer.succeed(t);var e=t.mediaIds;return e.addCallbackWith(this,function(e){return delete t.file,delete t.files,t.mediaId=e.map(_.last).join(","),t}),e},this.refreshScheduledColumn=function(t){this.trigger("uiNeedsScheduledColumnVisible",t||{})},this.handleDeciderChange=function(){this.refreshScheduledColumn()},this.addOrRefreshScheduledColumn=function(){this.refreshScheduledColumn({allowAdd:!0})},this.isWriteOff=function(){var t=!TD.decider.hasAccessLevel("scheduler","WRITE");return t},this.isVisibilityOff=function(){var t=!TD.decider.hasAccessLevel("scheduler","READ_VISIBLE");return t},this.shouldSchedule=function(t){var e=!this.isWriteOff(),i={message:!1,tweet:e,reply:e};return i[t]}}var i=t("flight/lib/component"),n=t("data/with_twitter_api"),s=t("util/with_watch_decider"),r=t("scripts/UI/template");return i(e,n,s)}),define("ui/with_template",[],function(){function t(){this.render=function(t,e){this.$node.html(this.toHtml(t,e))},this.renderTemplate=function(t,e){return $(TD.ui.template.render(t,e))},this.toHtml=function(t,e){return TD.ui.template.render(t,e)},this.toHtmlFromRaw=function(t,e){var i=Hogan.compile(t);return i.render(e)},this.toURLFromRaw=function(t,e){return t.replace(/\{\{([^}]+?)\}\}/g,function(t,i){return encodeURIComponent(e[i])})}}return t}),define("data/dm",["require","flight/lib/component","data/with_twitter_api","data/with_client","ui/with_template"],function(t){"use strict";function e(){this.attributes({resources:{"delete":{method:"POST",resource:"dm/destroy.json",metricsKey:"status:delete"},read:{method:"POST",resource:"dm/conversation/{{conversationId}}/mark_read.json",metricsKey:"conversation:read-one"},readAll:{method:"POST",resource:"dm/conversation/mark_read.json",metricsKey:"conversation:read-all"},"new":{method:"POST",resource:"dm/new.json",metricsKey:"status:new"},addParticipants:{method:"POST",resource:"dm/conversation/{{conversationId}}/add_participants.json",metricsKey:"conversation:add-participants"},deleteConversation:{method:"POST",resource:"dm/conversation/{{conversationId}}/delete.json",metricsKey:"conversation:delete"},updateConversationName:{method:"POST",resource:"dm/conversation/{{conversationId}}/update_name.json",metricsKey:"conversation:rename"},disableNotifications:{method:"POST",resource:"dm/conversation/{{conversationId}}/disable_notifications",metricsKey:"conversation:disable_notifications"},enableNotifications:{method:"POST",resource:"dm/conversation/{{conversationId}}/enable_notifications",metricsKey:"conversation:enable_notifications"}}}),this.after("initialize",function(){this.on(document,"uiDeleteDm",this.handleDeleteDm),this.on(document,"uiDeleteConversation",this.handleDeleteConversation),this.on(document,"uiMarkDmAsRead",this.handleMarkDmAsRead),this.on(document,"uiMarkAllDmsAsRead",this.handleMarkAllDmsAsRead),this.on(document,"uiSendDm",this.handleSendDm),this.on(document,"uiAddConversationParticipants",this.handleAddConversationParticipants),this.on(document,"uiUpdateConversationName",this.handleUpdateConversationName),this.on(document,"uiConversationsDisableNotifications",this.handleConversationsDisableNotifications),this.on(document,"uiConversationsEnableNotifications",this.handleConversationsEnableNotifications)}),this.handleMarkDmAsRead=function(t,e){var i=this.attr.resources.read;this.trigger("metric",{key:"dm:data:"+i.metricsKey}),this.makeTwitterApiCall({request:e,method:i.method,resource:this.toURLFromRaw(i.resource,e),params:{last_read_event_id:e.lastReadEventId},error:e.error})},this.handleMarkAllDmsAsRead=function(t,e){var i=this.attr.resources.readAll;this.trigger("metric",{key:"dm:data:"+i.metricsKey}),this.makeTwitterApiCall({request:e,method:i.method,resource:i.resource,params:{last_read_event_id:e.lastReadEventId},error:e.error,success:e.success})},this.handleSendDm=function(t,e){if(!e.files||!e.files.length){var i=this.attr.resources["new"],n={text:e.text};return e.tweetId&&(n.tweet_id=e.tweetId),e.conversationId&&(n.conversation_id=e.conversationId),e.messageRecipientIds&&e.messageRecipientIds.length>0&&(n.recipient_ids=e.messageRecipientIds),n.conversation_id||n.recipient_ids?(this.trigger("metric",{key:"dm:data:"+i.metricsKey}),e.mediaId&&(n.media_id=e.mediaId),this.makeTwitterApiCall({request:e,resource:i.resource,method:i.method,params:n,success:"dataDmSent",error:"dataDmError",dataProcessor:function(t){return{user_events:t}},processAsStreamData:!0}),void 0):void this.trigger("dataDmError",{request:e})}},this.handleDeleteDm=function(t,e){var i=this.attr.resources["delete"];this.trigger("metric",{key:"dm:data:"+i.metricsKey}),this.makeTwitterApiCall({request:e,method:i.method,resource:i.resource,params:{dm_id:e.id},success:e.success,error:e.error})},this.handleAddConversationParticipants=function(t,e){var i=this.attr.resources.addParticipants;this.trigger("metric",{key:"dm:data:"+i.metricsKey}),this.makeTwitterApiCall({request:e,method:i.method,resource:this.toHtmlFromRaw(i.resource,e),params:{participant_ids:e.participantIds.join(",")},success:e.success,error:e.error,dataProcessor:function(t){return{participantAdded:{user_events:t}}},processAsStreamData:!0})},this.handleDeleteConversation=function(t,e){var i=this.attr.resources.deleteConversation;this.trigger("metric",{key:"dm:data:"+i.metricsKey}),this.makeTwitterApiCall({request:e,method:i.method,resource:this.toHtmlFromRaw(i.resource,e),success:e.success,error:e.error,dataProcessor:function(t){return{"delete":{conversationId:e.conversationId}}},processAsStreamData:!0})},this.handleUpdateConversationName=function(t,e){var i=this.attr.resources.updateConversationName;this.trigger("metric",{key:"dm:data"+i.metricsKey}),this.makeTwitterApiCall({request:e,method:i.method,resource:this.toHtmlFromRaw(i.resource,e),params:{name:e.name},success:e.success,error:e.error,dataProcessor:function(t){return{conversationRenamed:{conversationId:e.conversationId,name:e.name}}},processAsStreamData:!0})},this.handleConversationsDisableNotifications=function(t,e){var i=this.attr.resources.disableNotifications;this.trigger("metric",{key:"dm:data:"+i.metricsKey}),this.makeTwitterApiCall({request:e,method:i.method,resource:this.toHtmlFromRaw(i.resource,e),success:e.success,error:e.error})},this.handleConversationsEnableNotifications=function(t,e){var i=this.attr.resources.enableNotifications;this.trigger("metric",{key:"dm:data:"+i.metricsKey}),this.makeTwitterApiCall({request:e,method:i.method,resource:this.toHtmlFromRaw(i.resource,e),success:e.success,error:e.error
})}}var i=t("flight/lib/component"),n=t("data/with_twitter_api"),s=t("data/with_client"),r=t("ui/with_template");return i(e,n,s,r)}),define("data/with_media_uploader",["require","flight/lib/compose","data/with_twitter_api"],function(t){"use strict";function e(){i.mixin(this,[n]),this.attributes({uploadUrl:"/oauth/upload"}),this.withMediaUploaderUpload=function(t,e){if(t=t||{},!t.files||!t.files.length)throw new Error("Missing file to upload.");if(!t.accountKey)throw new Error("Missing account key to upload with.");e=_.defaults(e||{},{ttl:"ephemeral"});var i=this.getClientByAccountKey(t.accountKey),n=i.oauth.account,s=new FormData;t.file=t.files[0],s.append("media",t.file),s.append("ttl",e.ttl);var r=TD.net.ajax.upload(TD.config.api_root+this.attr.uploadUrl,s,n);return r.addCallback(function(t){if(t=t||{},t.data=t.data||{},"string"!=typeof t.data.media_id_string)throw new Error("Upload response missing media_id_string.");return t.data.media_id_string}),r}}var i=t("flight/lib/compose"),n=t("data/with_twitter_api");return e}),define("ui/with_api_errors",[],function(){return function(){var t="unknown",e="unknown_xauth";this.after("initialize",function(){this.apiErrors={0:TD.i("Something went wrong. Please check your connection and try again."),32:TD.i("Invalid username or password"),63:TD.i("This user has been suspended."),64:TD.i("Your account has been suspended."),130:TD.i("Twitter is temporarily over capacity. Please try again later."),131:TD.i("There's something wrong. Please try again later."),135:TD.i("Could not authenticate you."),108:TD.i("There is no user by that name."),150:TD.i("This user doesn't follow you. You can only send messages to people who do."),151:TD.i("Something went wrong, but don't fret. It's not your fault."),185:TD.i("You reached your daily tweet limit. Please try again tomorrow."),187:TD.i("You already tweeted that."),195:TD.i("Invalid search query."),215:TD.i("Could not authenticate you."),226:TD.i("This action was flagged as suspicious."),231:TD.i("You need to generate a temporary password on twitter.com to log in."),235:TD.i("Your login verification request has expired. Please log in again."),236:TD.i("That is not the correct code. Please re-enter the code sent to your phone."),241:TD.i("The login verification request sent to your phone was rejected."),242:TD.i("Your account is deactivated. Please log in on twitter.com to reactivate."),243:TD.i("You have too many failed login attempts. Please try again in an hour."),244:TD.i("You must reset the password on this account. Please log in on twitter.com to do this."),245:TD.i("You have initiated too many login requests. Please try logging in again in an hour."),246:TD.i("You have entered too many incorrect codes. Please try logging in again."),276:TD.i("Scheduled tweet was rejected. Please try again."),297:TD.i("You cannot have both media and tweet."),278:TD.i("You are not a member of this group"),280:TD.i("You cannot add more people to this conversation. Try starting a new one."),311:TD.i("You have already sent this message."),429:TD.i("You have initiated too many login requests. Please try logging in again later."),unknown_xauth:TD.i("Unknown log in error. Please try again."),unknown:TD.i("Unknown error. Please try again.")}}),this.getXAuthErrorMessage=function(t){return this.apiErrors[t]||this.apiErrors[e]},this.getApiErrorMessage=function(e){return e=e||{},this.apiErrors[e.code]||e.message||this.apiErrors[t]},this.getXAuthErrorIs2FACodeError=function(t){return 236===t}}}),define("data/tweetdeck_api",["require","flight/lib/component","data/with_client","data/with_media_uploader","ui/with_api_errors"],function(t){"use strict";function e(){var t=1,e=2,i=32,n=253;this.attributes({mobileAuthRequestLimit:60,mobile2FAPollInterval:2e3}),this.mobileAuthRequestCount=0,this.after("initialize",function(){this.on(document,"uiSendDm",this.handleSendTweet),this.on(document,"uiSendTweet",this.handleSendTweet),this.on(document,"uiNeedsMigrateLockStatus",this.handleMigrateLockStatusRequest),this.on(document,"uiLoginRequest",function(t,e){"twitter"===e.authType?this.handleTwitterLoginRequest(t,e):this.handleTweetDeckLoginRequest(t,e)}),this.on(document,"uiTweetDeckForgotPasswordRequest",this.handleForgotPasswordRequest),this.on(document,"uiLogin2FARequest",this.handleLogin2FARequest),this.on(document,"uiLogin2FACancel",this.handleLogin2FACancel)}),this.responseFactory=function(t,e){return function(i){this.trigger(t,{response:i,request:e})}.bind(this)},this.handleSendTweet=function(t,e){if(e.files&&e.files.length){var i=TD.decider.get("tweet_up_to_four_images"),n=i?e.mediaIds:this.withMediaUploaderUpload(e),s=this.responseFactory("dataTweetError",e);n.addCallbacks(function(n){var r=!1;delete e.file,delete e.files,e.mediaId=i?n.map(function(t){return t[0]||(r=!0),t[1]}).join(","):n,r?s({errors:[{message:TD.i("We could not upload all images, please try again.")}]}):this.trigger(document,t,e)}.bind(this),s)}},this.handleTwitterLoginRequest=function(t,e){var i=TD.storage.accountController.loginTwitter(e.username,e.password);return i.addCallback(function(t){this.handleLoginResponse(e,t)}.bind(this)),i},this.handleTweetDeckLoginRequest=function(t,e){var i=TD.storage.accountController.loginTweetdeck(e.username,e.password);return i.addCallback(function(t){this.handleTweetDeckLoginResponse(e,t,e.staySignedIn)}.bind(this)),i},this.handleMigrateLockStatusRequest=function(t,e){var i=TD.storage.accountController.loginTweetdeck(e.email,"");i.addBoth(this.triggerMigrateLockStatus.bind(this,e.email))},this.handleTweetDeckLoginResponse=function(t,e,i){switch(e.httpStatus){case 200:e.account.uid?(e.staySignedIn=i,this.trigger("dataLoginAuthSuccess",e)):this.trigger("dataLoginError");break;case 401:this.trigger("dataLoginError",{code:e.message});break;case 500:this.trigger("dataLoginServerError");break;default:this.trigger("dataLoginError")}this.triggerMigrateLockStatus(t.username,e)},this.triggerMigrateLockStatus=function(t,e){var i=e&&e.data||{},n=e&&401===e.httpStatus&&"AccountLocked"===i.error;this.trigger("dataMigrateAccountLockStatus",{email:t,importingUser:i.importing_user,isLocked:n})},this.handleForgotPasswordRequest=function(t,e){var i=new TD.services.TweetDeckClient,n=i.forgotPassword(e.email);n.addCallback(function(t){this.handleForgotPasswordResponse(t)}.bind(this)),n.addErrback(function(t){this.handleForgotPasswordResponse(t)}.bind(this))},this.handleForgotPasswordResponse=function(t){switch(t.httpStatus){case 200:this.trigger("dataForgotPasswordSuccess",t);break;case 403:this.trigger("dataForgotPasswordError",t);break;case 500:this.trigger("dataLoginServerError");break;default:this.trigger("dataLoginError",{})}},this.handleLogin2FARequest=function(t,e){var i,n;return e.requestId?(n={requestId:e.requestId,userId:e.userId},e.code&&(n.code=e.code),i=TD.storage.accountController.loginTwitterWith2FACode(e.username,e.password,n),i.addCallback(function(t){this.handleLoginResponse(e,t)}.bind(this)),i):void TD.sync.util.errmark("Undefined 2FA login request.")},this.handleLoginResponse=function(s,r){s=s||{},r.staySignedIn=s.staySignedIn,r.username=s.username,r.password=s.password;var o={};r.xAuth&&r.xAuth.errors&&r.xAuth.errors.length&&(o=r.xAuth.errors[0]),200===r.httpStatus?r.account.uid?this.trigger("dataLoginAuthSuccess",r):r.xAuth.login_verification_request_type===t?(TD.sync.util.verboseLog("Twogin: Awaiting 2FA code from SMS"),this.trigger("dataLoginTwoFactorCodeRequired",r)):r.xAuth.login_verification_request_type===e?(TD.sync.util.verboseLog("Twogin: Awaiting 2FA auth from mobile app"),this.schedule2FARequest({username:r.username,password:r.password,requestId:r.xAuth.login_verification_request_id,userId:r.xAuth.login_verification_user_id,staySignedIn:r.staySignedIn}),this.trigger("dataLoginTwoFactorAwaitingConfirmation")):this.trigger("dataLoginError",{isXAuth:!0}):401===r.httpStatus&&o?[i,n].indexOf(o.code)>-1&&s.requestId?this.schedule2FARequest(s):this.getXAuthErrorIs2FACodeError(o.code)?this.trigger("dataLogin2FAError",{isXAuth:!0,code:o.code}):this.trigger("dataLoginError",{isXAuth:!0,code:o.code,message:o.message}):429===r.httpStatus?this.trigger("dataLoginError",{isXAuth:!0,code:o.code||"245",message:o.message}):500===r.httpStatus?this.trigger("dataLoginServerError"):this.trigger("dataLoginError",{isXAuth:!0,httpStatus:r.httpStatus,code:o.code,message:o.message});var a=401===r.httpStatus&&o.code===n,c=200!==r.httpStatus&&!a;if(c){var u=o.code||"unknown";$(document).trigger("metric",{key:"login:"+r.httpStatus+":"+u})}},this.schedule2FARequest=function(t){this.mobileAuthRequestCount<this.attr.mobileAuthRequestLimit?(TD.sync.util.verboseLog("Twogin: Scheduling mobile 2FA check"),this.mobileAuthRequestTimeout=setTimeout(function(){this.mobileAuthRequestCount=this.mobileAuthRequestCount+1,this.trigger("uiLogin2FARequest",t)}.bind(this),this.attr.mobile2FAPollInterval)):this.trigger("dataLogin2FATimeout",t)},this.handleLogin2FACancel=function(){clearTimeout(this.mobileAuthRequestTimeout)},this.isTweetSchedulerOn=function(){return TD.decider.hasAccessLevel("scheduler","WRITE")},this.shouldSchedule=function(t){var e=this.isTweetSchedulerOn(),i={message:!0,tweet:!e,reply:!e};return i[t]}}var i=t("flight/lib/component"),n=t("data/with_client"),s=t("data/with_media_uploader"),r=t("ui/with_api_errors");return i(e,n,s,r)}),define("ui/message_banner/with_login_account_access_denied_message_banner",[],function(){return function(){this.getLoginAccountAccessDeniedMessageData=function(t){return{id:"expired-login-error",text:[TD.i("TweetDeck no longer has permission to access your main login account @{{1}}.",{1:t.account.getUsername()}),TD.i("You will be logged out in 5 seconds to prevent unauthorized access.")].join(" "),colors:{background:"#b2d5ed",foreground:"#555"}}},this.getDataminrAccountAccessDeniedMessageData=function(t){return{id:"expired-dataminr-login-error",text:TD.i("TweetDeck no longer has permission to access your Dataminr account.")+" "+TD.i("Please check your Dataminr settings."),colors:{background:"#b2d5ed",foreground:"#555"}}}}}),define("data/with_dataminr_api",["require","flight/lib/compose","data/with_accounts","ui/message_banner/with_login_account_access_denied_message_banner"],function(t){var e=t("flight/lib/compose"),i=t("data/with_accounts"),n=t("ui/message_banner/with_login_account_access_denied_message_banner");return function(){e.mixin(this,[i,n]),this.attributes({baseUrl:"https://gateway.dataminr.com",auth:{resource:"auth/1/get_auth_token",method:"GET",metricsKey:"authtoken"},httpStatusCodes:{ok:200,badRequest:400,unauthorized:401,tooManyRequests:429,internalServerError:500},dataminrErrorCodes:{invalidApiCall:101,oauthAuthenticationError:102,invalidDMToken:103,twitterAccountNotLinked:104,rateLimitExceeded:105}}),this.makeDataminrRequest=function(t,e){var i=this.withDataminrApiUrl(t,e);return this.trigger("metric",{key:"dataminr:data:"+t.metricsKey}),TD.controller.stats.dataminrApiRequest(t.metricsKey),TD.net.ajax.sendRequest(t.method,i,{Authorization:"DmAuth "+TD.settings.getDataminrAuthToken()}).addErrback(this.dataminrRequestError.bind(this,i,t))},this.dataminrRequestError=function(t,e,i){return i.number===this.attr.httpStatusCodes.unauthorized?this.makeDataminrRequestForAuthToken().addCallbacks(function(){return TD.net.ajax.sendRequest(e.method,t,{Authorization:"DmAuth "+TD.settings.getDataminrAuthToken()})},function(){TD.settings.setDataminrAuthToken(null),$(document).trigger("dataMessage",{message:this.getDataminrAccountAccessDeniedMessageData()})}.bind(this)):void 0},this.makeDataminrRequestForAuthToken=function(){var t=this.attr.auth,e=this.withDataminrApiUrl(t);return this.trigger("metric",{key:"dataminr:data:"+t.metricsKey}),TD.controller.stats.dataminrAuthRequest(),this.getHttpHeadersForOAuthEcho().addCallback(function(i){return TD.net.ajax.sendRequest(t.method,e,i)}).addCallbacks(this.handleAuthSuccess.bind(this),this.handleAuthError.bind(this))},this.handleAuthSuccess=function(t){t.data.dmaToken&&(TD.settings.setDataminrAuthToken(t.data.dmaToken),this.trigger("metric",{key:"dataminr:auth:success"}))},this.handleAuthError=function(t){throw this.trigger("metric",{key:"dataminr:auth:error:"+t.number}),t},this.withDataminrApiUrl=function(t,e){var i=[];i.push(t.baseUrl||this.attr.baseUrl),i.push(t.resource);var n=i.join("/");return e&&"GET"===t.method&&(n=TD.net.util.addURLParameters(n,e)),n}}}),define("data/dataminr",["require","flight/lib/component","data/with_client","data/with_dataminr_api"],function(t){"use strict";function e(){this.attributes({resources:{watchlists:{resource:"account/1/get_lists",method:"GET",metricsKey:"watchlists"},alerts:{resource:"alerts/1/get_alert",method:"GET",metricsKey:"alerts"}}}),this.after("initialize",function(){this.on(document,"uiNeedsDataminrAuth",this.handleUiNeedsDataminrAuth),this.on(document,"uiNeedsDataminrWatchlists",this.handleUiNeedsDataminrWatchlists),this.on(document,"uiNeedsDataminrAlerts",this.handleUiNeedsDataminrAlerts)}),this.handleUiNeedsDataminrAuth=function(){if(this.dataminrIsEnabled()){var t,e=TD.settings.getDataminrAuthToken();t=e?TD.core.defer.succeed():this.makeDataminrRequestForAuthToken(),t.addCallback(this.trigger.bind(this,"dataDataminrAuthenticated"))}},this.handleUiNeedsDataminrWatchlists=function(){this.dataminrIsEnabled()&&this.makeDataminrRequest(this.attr.resources.watchlists).addCallback(this.getEventDataFromResponse.bind(this)).addCallbacks(this.trigger.bind(this,"dataDataminrWatchlists"),this.trigger.bind(this,"dataDataminrWatchlistsError"))},this.handleUiNeedsDataminrAlerts=function(t,e){if(this.dataminrIsEnabled()){var i=_.defaults(e.params,{pagesize:200});this.makeDataminrRequest(this.attr.resources.alerts,i).addCallback(this.getEventDataFromResponse.bind(this)).addCallbacks(this.handleAlertsSuccess.bind(this,e.success),this.handleAlertsError.bind(this,e.error))}},this.handleAlertsSuccess=function(t,e){return"function"==typeof t?t(e):void this.trigger("dataDataminrAlerts",e)},this.handleAlertsError=function(t,e){return"function"==typeof t?t(e):void this.trigger("dataDataminrAlertsError",e)},this.getEventDataFromResponse=function(t){return t.data},this.dataminrIsEnabled=function(){return"twitter"===this.getCurrentAuthType()&&TD.decider.get("dataminr")}}var i=t("flight/lib/component"),n=t("data/with_client"),s=t("data/with_dataminr_api");return i(e,n,s)}),define("data/touch_controller",["flight/lib/component"],function(t){var e=function(){this.attributes({isTouchComposeClass:"is-touch-compose",isTouchSearchClass:"is-touch-search",isTouchSidebarClass:"is-touch-sidebar",isTouchTweetContainer:"is-touch-tweet-container",withTouchSidebarClass:"with-touch-sidebar",withTouchFontSizeClass:"with-touch-font-size"}),this.handleUpdateCompose=function(){TD.util.isTouchDevice()&&TD.decider.get("touchdeck_compose_v2")?$(".js-docked-compose").addClass(this.attr.isTouchComposeClass):$(".js-docked-compose").removeClass(this.attr.isTouchComposeClass)},this.handleUpdateFontSize=function(){TD.util.isTouchDevice()&&TD.decider.get("touchdeck_font_size_v2")?$("html").addClass(this.attr.withTouchFontSizeClass):$("html").removeClass(this.attr.withTouchFontSizeClass)},this.handleUpdateSearch=function(){TD.util.isTouchDevice()&&TD.decider.get("touchdeck_search_v2")?$(".js-search").addClass(this.attr.isTouchSearchClass):$(".js-search").removeClass(this.attr.isTouchSearchClass)},this.handleUpdateSidebar=function(){TD.util.isTouchDevice()&&TD.decider.get("touchdeck_sidebar_v2")?($(".js-app").addClass(this.attr.withTouchSidebarClass),$(".js-app-header").addClass(this.attr.isTouchSidebarClass)):($(".js-app").removeClass(this.attr.withTouchSidebarClass),$(".js-app-header").removeClass(this.attr.isTouchSidebarClass))},this.handleUpdateTweetControls=function(){TD.util.isTouchDevice()&&TD.decider.get("touchdeck_tweet_controls_v3")?$(".js-chirp-container").addClass(this.attr.isTouchTweetContainer):$(".js-chirp-container").removeClass(this.attr.isTouchTweetContainer)},this.after("initialize",function(){this.on(document,"dataDeciderUpdated",this.handleUpdateCompose),this.on(document,"dataDeciderUpdated",this.handleUpdateFontSize),this.on(document,"dataDeciderUpdated",this.handleUpdateSearch),this.on(document,"dataDeciderUpdated",this.handleUpdateSidebar),this.on(document,"dataDeciderUpdated",this.handleUpdateTweetControls)})};return t(e)}),define("data/custom_timelines",["flight/lib/component","data/with_client"],function(t,e){function i(){this.after("initialize",function(){this.on(document,"uiAddTweetToCustomTimeline",this.checkData(this.addTweetToCustomTimeline)),this.on(document,"uiRemoveTweetFromCustomTimeline",this.checkData(this.removeTweetFromCustomTimeline)),this.on(document,"uiNeedsCustomTimeline",this.fetchCustomTimeline),this.on(document,"uiUpdateCustomTimeline",this.updateCustomTimeline),this.on(document,"dataAddTweetToCustomTimelineError",function(){TD.controller.progressIndicator.addMessage(TD.i("Problem adding Tweet: please try again"))}),this.on(document,"dataRemoveTweetToCustomTimelineError",function(){TD.controller.progressIndicator.addMessage(TD.i("Problem removing Tweet: please try again"))})}),this.addTweetToCustomTimeline=function(t,e){var i=this.getClientByAccountKey(e.account);i.addTweetToCustomTimeline(e.id,e.tweetId,this.callbackFactory("dataAddTweetToCustomTimelineSuccess",e),this.callbackFactory("dataAddTweetToCustomTimelineError",e))},this.removeTweetFromCustomTimeline=function(t,e){var i=this.getClientByAccountKey(e.account);i.removeTweetFromCustomTimeline(e.id,e.tweetId,this.callbackFactory("dataRemoveTweetFromCustomTimelineSuccess",e),this.callbackFactory("dataRemoveTweetFromCustomTimelineError",e))},this.fetchCustomTimeline=function(t,e){var i=this.getClientByAccountKey(e.account);i.getCustomTimeline(e.id,this.callbackFactory("dataCustomTimelineSuccess",e),this.callbackFactory("dataCustomTimelineError",e))},this.updateCustomTimeline=function(t,e){function i(t){var i={name:void 0!==e.name?e.name:t.name,description:void 0!==e.description?e.description:t.description,url:void 0!==e.url?e.url:t.url};n.updateCustomTimeline(e.id,i,this.callbackFactory("dataCustomTimelineSuccess",e),this.callbackFactory("dataCustomTimelineUpdateError",e))}var n=this.getClientByAccountKey(e.account);n.getCustomTimeline(e.id,i.bind(this),this.callbackFactory("dataCustomTimelineUpdateError",e))},this.callbackFactory=function(t,e){return function(i){this.trigger(document,t,{action:e,result:i})}.bind(this)},this.checkData=function(t){return function(e,i){if(!i.id||!i.tweetId||!i.account)throw"data needs id, tweetId, and account";t.apply(this,[].slice.call(arguments))}}}return t(i,e)}),define("data/secure_image",["require","flight/lib/component"],function(t){function e(){this.attributes({needsSecureUrlSelector:".js-needs-secure-url",needsSecureUrlClass:"js-needs-secure-url",orignalUrlAttribute:"data-original-url",cacheSize:200,cacheExpiryMinutes:15}),this.after("initialize",function(){this.on(document,"uiNeedsSecureImageUrl",this.queueSignedImage),this.signedUrlCache=new TD.cache.LRUQueue(this.attr.cacheSize),this.imageQueue=[],this.debouncedProcessQueue=_.debounce(this.processQueue,100)}),this.queueSignedImage=function(t,e){this.imageQueue.push({event:t,data:e}),this.debouncedProcessQueue()},this.processQueue=function(){var t=this.$node.find(this.attr.needsSecureUrlSelector);this.imageQueue.forEach(function(e){this.findAndSignImage(t,e.event,e.data)}.bind(this)),this.imageQueue=[]},this.findAndSignImage=function(t,e,i){var n=TD.storage.accountController.get(i.accountKey),s=this.getSignedImage(n,i.url);s.addCallbackWith(this,function(e){var n=this.attr.orignalUrlAttribute,s=this.attr.needsSecureUrlClass;t.each(function(){var t=$(this);if(t.attr(n)===i.url){var r=t.find("img");r.length?r.attr("src",e.data.url):t.css({"background-image":"url("+e.data.url+")"}),t.removeClass(s).attr(n,"")}})})},this.getSignedImage=function(t,e,i){var n=t.getKey()+":"+e,s=this.signedUrlCache.get(n);if(s&&s.expires>Date.now())return this.signedUrlCache.enqueue(n,s),TD.core.defer.succeed(s.data);var r=TD.net.ajax.getSignedUrl(t,e);return r.addCallbackWith(this,function(t){return this.signedUrlCache.enqueue(n,{expires:Date.now()+6e4*this.attr.cacheExpiryMinutes,data:t}),t}),r}}var i=t("flight/lib/component");return i(e)}),define("data/dm_report",["require","flight/lib/component","data/with_client"],function(t){function e(){this.after("initialize",function(){this.on(document,"uiNeedsDMReport",this.handleDMReport)}),this.handleDMReport=function(t,e){TD.sync.util.assert(e.account,"Source account for report must be specified."),TD.sync.util.assert(e.dmId,"dmId must be specified"),TD.sync.util.assert(_.contains(["spam","abuse"],e.reportType),"reportType must be one of {spam, abuse}");var i=this.getClientByAccount(e.account);i.reportDMSpam(e.dmId,e.reportType,!!e.blockUser,this.handleSuccessFactory(e).bind(this),this.handleErrorFactory(e))},this.handleSuccessFactory=function(t){return function(){var e=this.getClientByAccount(t.account);e.destroyDM(t.dmId),e.deleteMessage(t.dmId),this.trigger("dataDMReport",{error:null})}},this.handleErrorFactory=function(t){return function(e){this.trigger("dataDMReport",{error:e||{},request:t})}.bind(this)}}var i=t("flight/lib/component"),n=t("data/with_client");return i(e,n)}),define("data/migrate",["require","flight/lib/component"],function(t){"use strict";function e(){this.after("initialize",function(){this.on(document,"uiMigrateActive",this.handleUiMigrateActive),this.on(document,"uiNeedsMigrateData",this.handleUiNeedsMigrateData),this.on(document,"uiNeedsMigratePreviewData",this.handleUiNeedsMigratePreviewData),this.on(document,"uiMigrateTweetDeckData",this.handleMigrateTweetDeckData),this.on(document,"uiMigrateTwitterData",this.handleMigrateTwitterData),this.on(document,"uiMigrateSuccess",this.handleMigrateSuccess),this.on(document,"uiMigrateCancel",this.handleMigrateCancel);var t=this.getMigrateData();t&&t.active&&t.email&&TD.controller.stats.setUid(t.email)}),this.handleUiMigrateActive=function(t,e){this.setMigrateData({active:!0,email:TD.storage.store.getTweetdeckAccount(),accountType:e.accountType,userHasAccountAuthority:e.userHasAccountAuthority,isTeamOrganiser:e.isTeamOrganiser})},this.handleUiNeedsMigrateData=function(){this.trigger("dataMigrateData",this.getMigrateData())},this.handleUiNeedsMigratePreviewData=function(t,e){var i=TD.sync.tdapi.importPreview(e.email,e.passhash);i.addCallbacks(this.trigger.bind(this,"dataMigrateTweetDeckAccountPreviewSuccess"),this.trigger.bind(this,"dataMigrateTweetDeckAccountPreviewError"))},this.handleMigrateTwitterData=function(t,e){var i=this.getMigrateData();i=_.extend({},i,{uid:e.user_id,screenName:e.screen_name}),this.setMigrateData(i)},this.handleMigrateTweetDeckData=function(t,e){var i=this.getMigrateData();i=_.defaults({},{email:e.email,passhash:e.passhash},i),this.setMigrateData(i)},this.handleMigrateSuccess=function(){this.clearMigrateData(),TD.sync.controller.ueberpull()},this.handleMigrateCancel=function(t,e){e.clearMigrateData&&this.clearMigrateData();try{TD.controller.init.signOut()}catch(i){this.reloadPage()}},this.reloadPage=function(){window.location.reload()},this.getMigrateData=function(){try{return JSON.parse(sessionStorage.getItem("migrate"))}catch(t){return this.clearMigrateData(),{}}},this.setMigrateData=function(t){return sessionStorage.setItem("migrate",JSON.stringify(t))},this.clearMigrateData=function(){try{sessionStorage.removeItem("migrate")}catch(t){}TD.controller.stats.setUid(null)}}var i=t("flight/lib/component");return i(e)}),define("text",["module"],function(t){"use strict";var e,i,n,s,r,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,u="undefined"!=typeof location&&location.href,h=u&&location.protocol&&location.protocol.replace(/\:/,""),l=u&&location.hostname,d=u&&(location.port||void 0),m={},g=t.config&&t.config()||{};return e={version:"2.0.14",strip:function(t){if(t){t=t.replace(a,"");var e=t.match(c);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:g.createXhr||function(){var t,e,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;3>e;e+=1){i=o[e];try{t=new ActiveXObject(i)}catch(n){}if(t){o=[i];break}}return t},parseName:function(t){var e,i,n,s=!1,r=t.lastIndexOf("."),o=0===t.indexOf("./")||0===t.indexOf("../");return-1!==r&&(!o||r>1)?(e=t.substring(0,r),i=t.substring(r+1)):e=t,n=i||e,r=n.indexOf("!"),-1!==r&&(s="strip"===n.substring(r+1),n=n.substring(0,r),i?i=n:e=n),{moduleName:e,ext:i,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,i,n,s){var r,o,a,c=e.xdRegExp.exec(t);return c?(r=c[2],o=c[3],o=o.split(":"),a=o[1],o=o[0],!(r&&r!==i||o&&o.toLowerCase()!==n.toLowerCase()||(a||o)&&a!==s)):!0},finishLoad:function(t,i,n,s){n=i?e.strip(n):n,g.isBuild&&(m[t]=n),s(n)},load:function(t,i,n,s){if(s&&s.isBuild&&!s.inlineText)return void n();g.isBuild=s&&s.isBuild;var r=e.parseName(t),o=r.moduleName+(r.ext?"."+r.ext:""),a=i.toUrl(o),c=g.useXhr||e.useXhr;return 0===a.indexOf("empty:")?void n():void(!u||c(a,h,l,d)?e.get(a,function(i){e.finishLoad(t,r.strip,i,n)},function(t){n.error&&n.error(t)}):i([o],function(t){e.finishLoad(r.moduleName+"."+r.ext,r.strip,t,n)}))},write:function(t,i,n,s){if(m.hasOwnProperty(i)){var r=e.jsEscape(m[i]);n.asModule(t+"!"+i,"define(function () { return '"+r+"';});\n")}},writeFile:function(t,i,n,s,r){var o=e.parseName(i),a=o.ext?"."+o.ext:"",c=o.moduleName+a,u=n.toUrl(o.moduleName+a)+".js";e.load(c,n,function(i){var n=function(t){return s(u,t)};n.asModule=function(t,e){return s.asModule(t,u,e)},e.write(t,c,n,r)},r)}},"node"===g.env||!g.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(i=require.nodeRequire("fs"),e.get=function(t,e,n){try{var s=i.readFileSync(t,"utf8");""===s[0]&&(s=s.substring(1)),e(s)}catch(r){n&&n(r)}}):"xhr"===g.env||!g.env&&e.createXhr()?e.get=function(t,i,n,s){var r,o=e.createXhr();if(o.open("GET",t,!0),s)for(r in s)s.hasOwnProperty(r)&&o.setRequestHeader(r.toLowerCase(),s[r]);g.onXhr&&g.onXhr(o,t),o.onreadystatechange=function(e){var s,r;4===o.readyState&&(s=o.status||0,s>399&&600>s?(r=new Error(t+" HTTP status: "+s),r.xhr=o,n&&n(r)):i(o.responseText),g.onXhrComplete&&g.onXhrComplete(o,t))},o.send(null)}:"rhino"===g.env||!g.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?e.get=function(t,e){var i,n,s="utf-8",r=new java.io.File(t),o=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),s)),c="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=a.readLine());)i.append(o),i.append(n);c=String(i.toString())}finally{a.close()}e(c)}:("xpconnect"===g.env||!g.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in n,e.get=function(t,e){var i,o,a,c={};r&&(t=t.replace(/\//g,"\\")),a=new FileUtils.File(t);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),i.init(a,1,0,!1),o=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),o.init(i,"utf-8",i.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(i.available(),c),o.close(),i.close(),e(c.value)}catch(u){throw new Error((a&&a.path||"")+": "+u)}}),e}),define("text!scripts/schema/shared_column.json",[],function(){return'{\n    "properties": {\n        "feeds": {\n            "items": {\n                "required": ["accountkey", "metadata", "mtime", "service", "type"],\n                "properties": {\n                    "accountkey": {\n                        "type": "string"\n                    },\n                    "metadata": {\n                        "required": ["baseQuery", "searchFilterData", "term"],\n                        "properties": {\n                            "baseQuery": {\n                                "type": "string"\n                            },\n                            "searchFilterData": {\n                                "required": ["action", "content", "engagement", "user"],\n                                "properties": {\n                                    "action": {\n                                        "properties": {\n                                            "showFavorites": {\n                                                "type": "boolean"\n                                            },\n                                            "showFollowers": {\n                                                "type": "boolean"\n                                            },\n                                            "showLists": {\n                                                "type": "boolean"\n                                            },\n                                            "showMentions": {\n                                                "type": "boolean"\n                                            },\n                                            "showRetweets": {\n                                                "type": "boolean"\n                                            }\n                                        },\n                                        "type": "object"\n                                    },\n                                    "content": {\n                                        "properties": {\n                                            "excluding": {\n                                                "type": "string"\n                                            },\n                                            "includeRTs": {\n                                                "type": "boolean"\n                                            },\n                                            "lang": {\n                                                "type": "string"\n                                            },\n                                            "matching": {\n                                                "type": "string"\n                                            },\n                                            "type": {\n                                                "type": "string"\n                                            }\n                                        },\n                                        "type": "object"\n                                    },\n                                    "engagement": {\n                                        "properties": {\n                                            "minFavorites": {\n                                                "type": "number"\n                                            },\n                                            "minReplies": {\n                                                "type": "number"\n                                            },\n                                            "minRetweets": {\n                                                "type": "number"\n                                            }\n                                        },\n                                        "type": "object"\n                                    },\n                                    "user": {\n                                        "properties": {\n                                            "from_name": {\n                                                "type": ["string", "null"]\n                                            },\n                                            "from_type": {\n                                                "type": ["string", "null"]\n                                            },\n                                            "mention_name": {\n                                                "type": ["string", "null"]\n                                            }\n                                        },\n                                        "type": "object"\n                                    }\n                                },\n                                "type": "object"\n                            },\n                            "term": {\n                                "type": "string"\n                            }\n                        },\n                        "type": "object"\n                    },\n                    "mtime": {\n                        "type": "string"\n                    },\n                    "service": {\n                        "type": "string"\n                    },\n                    "type": {\n                        "type": "string"\n                    }\n                },\n                "type": "object"\n            },\n            "type": "array"\n        },\n        "filters": {\n            "properties": {\n                "action": {\n                    "properties": {\n                        "showFavorites": {\n                            "type": "boolean"\n                        },\n                        "showFollowers": {\n                            "type": "boolean"\n                        },\n                        "showLists": {\n                            "type": "boolean"\n                        },\n                        "showMentions": {\n                            "type": "boolean"\n                        },\n                        "showRetweets": {\n                            "type": "boolean"\n                        }\n                    },\n                    "type": "object"\n                },\n                "content": {\n                    "properties": {\n                        "excluding": {\n                            "type": "string"\n                        },\n                        "includeRTs": {\n                            "type": "boolean"\n                        },\n                        "lang": {\n                            "type": "string"\n                        },\n                        "matching": {\n                            "type": "string"\n                        },\n                        "type": {\n                            "type": "string"\n                        }\n                    },\n                    "type": "object"\n                },\n                "engagement": {\n                    "properties": {\n                        "minFavorites": {\n                            "type": "number"\n                        },\n                        "minReplies": {\n                            "type": "number"\n                        },\n                        "minRetweets": {\n                            "type": "number"\n                        }\n                    },\n                    "type": "object"\n                },\n                "user": {\n                    "properties": {\n                        "from_name": {\n                            "type": ["string", "null"]\n                        },\n                        "from_type": {\n                            "type": ["string", "null"]\n                        }\n                    },\n                    "type": "object"\n                }\n            },\n            "type": "object"\n        }\n    },\n    "required": ["feeds", "filters"],\n    "type": "object"\n}\n';

}),define("data/with_validation_schemata",["require","text!scripts/schema/shared_column.json"],function(t){var e={sharedColumn:t("text!scripts/schema/shared_column.json")};return function(){this.getValidationSchema=function(t){return e[t]?JSON.parse(e[t]):null}}}),function(){function t(){return this instanceof t?(this.coerceType={},this.fieldType=e(r),this.fieldValidate=e(a),this.fieldFormat=e(o),this.defaultOptions=e(d),this.schema={},void 0):new t}var e=function(t){if(null===t||"object"!=typeof t)return t;var i;if(t instanceof Date)return i=new Date,i.setTime(t.getTime()),i;if(t instanceof RegExp)return i=new RegExp(t);if(t instanceof Array){i=[];for(var n=0,s=t.length;s>n;n++)i[n]=e(t[n]);return i}if(t instanceof Object){i={};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e(t[r]));return i}throw new Error("Unable to clone object!")},i=function(t){var i=t.length-1,n=t[i].key,s=t.slice(0);return s[i].object[n]=e(s[i].object[n]),s},n=function(t,e){var i=t.length-1,n=t[i].key;e[i].object[n]=t[i].object[n]},s={type:!0,not:!0,anyOf:!0,allOf:!0,oneOf:!0,$ref:!0,$schema:!0,id:!0,exclusiveMaximum:!0,exclusiveMininum:!0,properties:!0,patternProperties:!0,additionalProperties:!0,items:!0,additionalItems:!0,required:!0,"default":!0,title:!0,description:!0,definitions:!0,dependencies:!0},r={"null":function(t){return null===t},string:function(t){return"string"==typeof t},"boolean":function(t){return"boolean"==typeof t},number:function(t){return"number"==typeof t&&!isNaN(t)},integer:function(t){return"number"==typeof t&&t%1===0},object:function(t){return t&&"object"==typeof t&&!Array.isArray(t)},array:function(t){return Array.isArray(t)},date:function(t){return t instanceof Date}},o={alpha:function(t){return/^[a-zA-Z]+$/.test(t)},alphanumeric:function(t){return/^[a-zA-Z0-9]+$/.test(t)},identifier:function(t){return/^[-_a-zA-Z0-9]+$/.test(t)},hexadecimal:function(t){return/^[a-fA-F0-9]+$/.test(t)},numeric:function(t){return/^[0-9]+$/.test(t)},"date-time":function(t){return!isNaN(Date.parse(t))&&-1===t.indexOf("/")},uppercase:function(t){return t===t.toUpperCase()},lowercase:function(t){return t===t.toLowerCase()},hostname:function(t){return t.length<256&&/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/.test(t)},uri:function(t){return/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/.test(t)},email:function(t){return/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/.test(t)},ipv4:function(t){if(/^(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)$/.test(t)){var e=t.split(".").sort();if(e[3]<=255)return!0}return!1},ipv6:function(t){return/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/.test(t)}},a={readOnly:function(t,e){return!1},minimum:function(t,e,i){return!(e>t||i.exclusiveMinimum&&e>=t)},maximum:function(t,e,i){return!(t>e||i.exclusiveMaximum&&t>=e)},multipleOf:function(t,e){return t/e%1===0||"number"!=typeof t},pattern:function(t,e){if("string"!=typeof t)return!0;var i,n;"string"==typeof e?i=e:(i=e[0],n=e[1]);var s=new RegExp(i,n);return s.test(t)},minLength:function(t,e){return t.length>=e||"string"!=typeof t},maxLength:function(t,e){return t.length<=e||"string"!=typeof t},minItems:function(t,e){return t.length>=e||!Array.isArray(t)},maxItems:function(t,e){return t.length<=e||!Array.isArray(t)},uniqueItems:function(t,e){for(var i,n={},s=0,r=t.length;r>s;s++){if(i=JSON.stringify(t[s]),n.hasOwnProperty(i))return!1;n[i]=!0}return!0},minProperties:function(t,e){if("object"!=typeof t)return!0;var i=0;for(var n in t)t.hasOwnProperty(n)&&(i+=1);return i>=e},maxProperties:function(t,e){if("object"!=typeof t)return!0;var i=0;for(var n in t)t.hasOwnProperty(n)&&(i+=1);return e>=i},"enum":function(t,e){var i,n,s;if("object"==typeof t){for(s=JSON.stringify(t),i=0,n=e.length;n>i;i++)if(s===JSON.stringify(e[i]))return!0}else for(i=0,n=e.length;n>i;i++)if(t===e[i])return!0;return!1}},c=function(t){return-1===t.indexOf("://")?t:t.split("#")[0]},u=function(t,e,i){var n,s,r,o;if(r=i.indexOf("#"),-1===r)return t.schema.hasOwnProperty(i)?[t.schema[i]]:null;if(r>0)if(o=i.substr(0,r),i=i.substr(r+1),t.schema.hasOwnProperty(o))e=[t.schema[o]];else{if(!e||e[0].id!==o)return null;e=[e[0]]}else{if(!e)return null;i=i.substr(1)}if(""===i)return[e[0]];if("/"===i.charAt(0)){for(i=i.substr(1),n=e[0],s=i.split("/");s.length>0;){if(!n.hasOwnProperty(s[0]))return null;n=n[s[0]],e.push(n),s.shift()}return e}return null},h=function(t,e){var i,n,s,r,o=t.length-1,a=/^(\d+)/.exec(e);if(a){if(e=e.substr(a[0].length),s=parseInt(a[1],10),0>s||s>o)return;if(r=t[o-s],"#"===e)return r.key}else r=t[0];if(n=r.object[r.key],""===e)return n;if("/"===e.charAt(0)){for(e=e.substr(1),i=e.split("/");i.length>0;){if(i[0]=i[0].replace(/~1/g,"/").replace(/~0/g,"~"),!n.hasOwnProperty(i[0]))return;n=n[i[0]],i.shift()}return n}},l=function(t,e,r,o){var a,c,d,m,g,p,f,w,v,C,b=!1,S={},T=e.length-1,y=e[T],_=r.length-1,D=r[_].object,A=r[_].key,I=D[A];if(y.hasOwnProperty("$ref"))return e=u(t,e,y.$ref),e?l(t,e,r,o):{$ref:y.$ref};if(y.hasOwnProperty("type"))if("string"==typeof y.type){if(o.useCoerce&&t.coerceType.hasOwnProperty(y.type)&&(I=D[A]=t.coerceType[y.type](I)),!t.fieldType[y.type](I))return{type:y.type}}else{for(b=!0,a=0,c=y.type.length;c>a&&b;a++)t.fieldType[y.type[a]](I)&&(b=!1);if(b)return{type:y.type}}if(y.hasOwnProperty("allOf"))for(a=0,c=y.allOf.length;c>a;a++)if(w=l(t,e.concat(y.allOf[a]),r,o))return w;if(o.useCoerce||o.useDefault||o.removeAdditional){if(y.hasOwnProperty("oneOf")){for(a=0,c=y.oneOf.length,d=0;c>a;a++)if(new_stack=i(r),w=l(t,e.concat(y.oneOf[a]),new_stack,o))S=w;else{if(d+=1,d>1)break;n(new_stack,r)}if(d>1)return{oneOf:!0};if(1>d)return S;S={}}if(y.hasOwnProperty("anyOf")){for(a=0,c=y.anyOf.length;c>a;a++)if(new_stack=i(r),w=l(t,e.concat(y.anyOf[a]),new_stack,o),!w){n(new_stack,r);break}if(w)return w}if(y.hasOwnProperty("not")&&(w=l(t,e.concat(y.not),i(r),o),!w))return{not:!0}}else{if(y.hasOwnProperty("oneOf")){for(a=0,c=y.oneOf.length,d=0;c>a;a++)if(w=l(t,e.concat(y.oneOf[a]),r,o))S=w;else if(d+=1,d>1)break;if(d>1)return{oneOf:!0};if(1>d)return S;S={}}if(y.hasOwnProperty("anyOf")){for(a=0,c=y.anyOf.length;c>a&&(w=l(t,e.concat(y.anyOf[a]),r,o),w);a++);if(w)return w}if(y.hasOwnProperty("not")&&(w=l(t,e.concat(y.not),r,o),!w))return{not:!0}}if(y.hasOwnProperty("dependencies"))for(p in y.dependencies)if(y.dependencies.hasOwnProperty(p)&&I.hasOwnProperty(p))if(Array.isArray(y.dependencies[p])){for(a=0,c=y.dependencies[p].length;c>a;a++)if(!I.hasOwnProperty(y.dependencies[p][a]))return{dependencies:!0}}else if(w=l(t,e.concat(y.dependencies[p]),r,o))return w;if(Array.isArray(I)){if(y.hasOwnProperty("items"))if(Array.isArray(y.items)){for(a=0,c=y.items.length;c>a;a++)w=l(t,e.concat(y.items[a]),r.concat({object:I,key:a}),o),null!==w&&(S[a]=w,b=!0);if(I.length>c&&y.hasOwnProperty("additionalItems"))if("boolean"==typeof y.additionalItems){if(!y.additionalItems)return{additionalItems:!0}}else for(a=c,c=I.length;c>a;a++)w=l(t,e.concat(y.additionalItems),r.concat({object:I,key:a}),o),null!==w&&(S[a]=w,b=!0)}else for(a=0,c=I.length;c>a;a++)w=l(t,e.concat(y.items),r.concat({object:I,key:a}),o),null!==w&&(S[a]=w,b=!0);else if(y.hasOwnProperty("additionalItems")&&"boolean"!=typeof y.additionalItems)for(a=0,c=I.length;c>a;a++)w=l(t,e.concat(y.additionalItems),r.concat({object:I,key:a}),o),null!==w&&(S[a]=w,b=!0);if(b)return{schema:S}}else{v=[],S={};for(p in I)I.hasOwnProperty(p)&&v.push(p);if(o.checkRequired&&y.required)for(a=0,c=y.required.length;c>a;a++)I.hasOwnProperty(y.required[a])||(S[y.required[a]]={required:!0},b=!0);if(m=y.hasOwnProperty("properties"),g=y.hasOwnProperty("patternProperties"),m||g)for(a=v.length;a--;){if(C=!1,m&&y.properties.hasOwnProperty(v[a])&&(C=!0,w=l(t,e.concat(y.properties[v[a]]),r.concat({object:I,key:v[a]}),o),null!==w&&(S[v[a]]=w,b=!0)),g)for(p in y.patternProperties)y.patternProperties.hasOwnProperty(p)&&v[a].match(p)&&(C=!0,w=l(t,e.concat(y.patternProperties[p]),r.concat({object:I,key:v[a]}),o),null!==w&&(S[v[a]]=w,b=!0));C&&v.splice(a,1)}if(o.useDefault&&m&&!b)for(p in y.properties)y.properties.hasOwnProperty(p)&&!I.hasOwnProperty(p)&&y.properties[p].hasOwnProperty("default")&&(I[p]=y.properties[p]["default"]);if(o.removeAdditional&&m&&y.additionalProperties!==!0&&"object"!=typeof y.additionalProperties)for(a=0,c=v.length;c>a;a++)delete I[v[a]];else if(y.hasOwnProperty("additionalProperties"))if("boolean"==typeof y.additionalProperties){if(!y.additionalProperties)for(a=0,c=v.length;c>a;a++)S[v[a]]={additional:!0},b=!0}else for(a=0,c=v.length;c>a;a++)w=l(t,e.concat(y.additionalProperties),r.concat({object:I,key:v[a]}),o),null!==w&&(S[v[a]]=w,b=!0);if(b)return{schema:S}}for(f in y)y.hasOwnProperty(f)&&!s.hasOwnProperty(f)&&("format"===f?t.fieldFormat.hasOwnProperty(y[f])&&!t.fieldFormat[y[f]](I,y,r,o)&&(S[f]=!0,b=!0):t.fieldValidate.hasOwnProperty(f)&&!t.fieldValidate[f](I,y[f].hasOwnProperty("$data")?h(r,y[f].$data):y[f],y,r,o)&&(S[f]=!0,b=!0));return b?S:null},d={useDefault:!1,useCoerce:!1,checkRequired:!0,removeAdditional:!1};t.prototype={validate:function(t,e,i){var n=[t],s=null,r=[{object:{__root__:e},key:"__root__"}];if("string"==typeof t&&(n=u(this,null,t),!n))throw new Error("jjv: could not find schema '"+t+"'.");if(i)for(var o in this.defaultOptions)this.defaultOptions.hasOwnProperty(o)&&!i.hasOwnProperty(o)&&(i[o]=this.defaultOptions[o]);else i=this.defaultOptions;return s=l(this,n,r,i),s?{validation:s.hasOwnProperty("schema")?s.schema:s}:null},resolveRef:function(t,e){return u(this,t,e)},addType:function(t,e){this.fieldType[t]=e},addTypeCoercion:function(t,e){this.coerceType[t]=e},addCheck:function(t,e){this.fieldValidate[t]=e},addFormat:function(t,e){this.fieldFormat[t]=e},addSchema:function(t,e){if(!e&&t&&(e=t,t=void 0),e.hasOwnProperty("id")&&"string"==typeof e.id&&e.id!==t){if("/"===e.id.charAt(0))throw new Error("jjv: schema id's starting with / are invalid.");this.schema[c(e.id)]=e}else if(!t)throw new Error("jjv: schema needs either a name or id attribute.");t&&(this.schema[c(t)]=e)}},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=t:"function"==typeof define&&define.amd?define("jjv",[],function(){return t}):window.jjv=t}(),define("data/schema_validator",["require","flight/lib/component","data/with_validation_schemata","jjv"],function(t){"use strict";function e(){this.after("initialize",function(){this.on(document,"uiNeedsSchemaValidation",function(t,e){if(e.schemaName&&(e.schema=this.getValidationSchema(e.schemaName)),!e.schema)throw new Error("Missing validation schema",e);this.validate(e)}),this.validate=function(t){var e=s.validate(t.schema,t.data,{checkRequired:!0,useDefault:!0,removeAdditional:!0});this.trigger("dataSchemaValidation",{schema:t.schema,data:t.data,isValid:!e,validationError:e})}})}var i=t("flight/lib/component"),n=t("data/with_validation_schemata"),s=t("jjv")();return i(e,n)}),define("data/router",["require","flight/lib/component"],function(t){function e(){this.after("initialize",function(){this.initialUrlHash=window.location.hash,this.on(document,"TD.ready",this.handleTDReady)}),this.handleTDReady=function(){this.processUrlHash(this.initialUrlHash),this.cleanUrl()},this.cleanUrl=function(){window.history&&"function"==typeof window.history.replaceState?history.replaceState({},"",window.location.pathname):window.location.hash=""},this.processUrlHash=function(t){if(t){var e=TD.util.extractTweetDeckSharedColumnFromFragment(t);e&&this.trigger("uiShowImportColumnDialog",{columnState:e})}}}var i=t("flight/lib/component");return i(e)}),define("data/client_updater",["require","flight/lib/component","util/with_watch_decider"],function(t){function e(){this.attributes({keyChromeRestoreTab:"chromeRestoreTab"}),this.after("initialize",function(){this.chromeUpdaterCallback=this.performChromeAppUpdate.bind(this),TD.util.isMacApp()||TD.util.isChromeApp()&&(this.watchDecider("client_updater_replace_chrome_tab",this.setupChromeUpdater),this.setupChromeUpdater())}),this.setupChromeUpdater=function(){var t=!!TD.decider.get("client_updater_replace_chrome_tab"),e=chrome.runtime.onUpdateAvailable.hasListener(this.chromeUpdaterCallback);e!==t&&(t?chrome.runtime.onUpdateAvailable.addListener(this.chromeUpdaterCallback):chrome.runtime.onUpdateAvailable.removeListener(this.chromeUpdaterCallback))},this.performChromeAppUpdate=function(t){chrome.tabs.getCurrent(function(t){var i=JSON.stringify(t);try{e(i,{prune:!0})}finally{chrome.runtime.reload()}}.bind(this));var e=function(t,i){try{localStorage.setItem(this.attr.keyChromeRestoreTab,t)}catch(n){i.prune&&n.code===DOMException.QUOTA_EXCEEDED_ERR&&(this.trigger(document,"dataStorageFull"),e(t,{prune:!1}))}}.bind(this);this.logClientUpdateMetric(t.version)},this.logClientUpdateMetric=function(t){this.trigger("metric",{key:["client-update",TD.version,t].join(":")})},this.notifyWebAppUpdate=function(){},this.notifyMacAppUpdate=function(){}}var i=t("flight/lib/component"),n=t("util/with_watch_decider");return i(e,n)}),define("util/rewrite_feeds",[],function(){function t(t){return!TD.util.columnUtils.combinedColumnTypes[t.getColumnType()]}function e(t){return t.model.getKey()}function i(t){return function(e){return e.getAccountKey()===t}}function n(n,r){var o=TD.storage.accountController.get(n),a=TD.controller.columnManager.getAllOrdered().filter(t).map(e),c=TD.storage.feedController.getAll().filter(i(n)),u={initialCount:c.length,newFeeds:[],lostFeeds:[]};return c.reduce(function(t,e){var i=e.getType();if(!s.shouldRewrite[i])return t.lostFeeds.push(e),t;var n=i,c=e.getMetadata(),u=r;"undefined"!=typeof s.type[i]&&(n=s.type[i]),s.toDefault[i]&&(u=TD.storage.accountController.getDefault().getKey()),s.metadata.id[i]&&"undefined"==typeof c.id&&(c=_.extend({},c,{id:o.getUserID()}));var h=TD.storage.feedController.getOrCreateFeed(n,e.getService(),u,c);return TD.controller.feedManager.replaceFeed(e,h,a),t.newFeeds.push(h),t},u)}var s={};return s.shouldRewrite={home:!0,search:!0,list:!0,customtimeline:!0,usertimeline:!0,favorites:!0,usertweets:!0},s.type={},s.type={home:"usertimeline"},s.toDefault={},s.toDefault={search:!0},s.metadata={},s.metadata.id={home:!0,usertimeline:!0,favorites:!0,usertweets:!0},n}),define("data/feed_rewriter",["require","flight/lib/component","../util/rewrite_feeds"],function(t){var e=t("flight/lib/component"),i=t("../util/rewrite_feeds");return e(function(){this.after("initialize",function(){this.on(document,"dataAccountsRewriteColumns",function(t,e){var i=this.rewriteFeeds(e.sourceAccountKey,e.targetAccountKey);TD.controller.progressIndicator.addMessage(this.getRewriteResultMessage(i))})}),this.rewriteFeeds=i,this.getRewriteResultMessage=function(t){var e={kept:t.newFeeds.length,lost:t.lostFeeds.length,total:t.initialCount},i=TD.i("Kept {{kept}} columns.",e);1===e.kept&&(i=TD.i("Kept 1 column."));var n=TD.i("{{lost}} columns could not be kept.",e);return 1===e.lost&&(n=TD.i("1 column could not be kept.")),0===e.lost?n="":i=TD.i("Kept {{kept}} out of {{total}} columns.",e),(i+" "+n).trim()}})}),define("tracking/account_scribe",["flight/lib/component"],function(t){function e(){this.trackSelectDefaultAccount=function(){TD.controller.stats.defaultAccountSelected()},this.after("initialize",function(){this.on(document,"uiSelectDefaultAccount",this.trackSelectDefaultAccount)})}return t(e)}),define("tracking/column_options_scribe",["require","flight/lib/component"],function(t){function e(){this.trackClear=function(){TD.controller.stats.columnActionClick("clear")},this.trackMoveColumn=function(t,e){TD.controller.stats.columnActionClick(e.action)},this.trackEmbedTimeline=function(t,e){TD.controller.stats.columnActionClick("embed",{type:e.column.getColumnType()})},this.trackActionFilterError=function(t,e){TD.controller.stats.actionFilterError()},this.after("initialize",function(){this.on(document,"uiClearColumnAction",this.trackClear),this.on(document,"uiMoveColumnAction",this.trackMoveColumn),this.on(document,"uiEmbedTimelineAction",this.trackEmbedTimeline),this.on(document,"uiActionFilterError",this.trackActionFilterError)})}var i=t("flight/lib/component");return i(e)}),define("tracking/compose_scribe",["require","flight/lib/component","data/with_client"],function(t){function e(){this.after("initialize",function(){this.on(document,"dataTweetSent",this.handleTweetSent),this.on(document,"dataDmSent",this.handleDmSent),this.on(document,"dataScheduledTweetsSent",this.handleScheduledTweetSent),this.on(document,"uiRemoveInReplyTo",this.handleClearReply),this.on(document,"uiComposeStackReply",this.handleStackReply),this.on(document,"uiDockedComposeTweet",this.handleDockedTweet)}),this.handleTweetSent=function(t,e){if("message"===e.request.type)return this.handleDmSent(t,e);var i=this.getAccountData(e.request.accountKey),n=i?i.id:null,s=Boolean(e.request.files&&e.request.files.length),r=Boolean(e.request.scheduledDate),o=e.request.inline||!1;switch(e.request.type){case"tweet":TD.controller.stats.postTweet(n,s,r);break;case"reply":TD.controller.stats.postReply(n,s,r,o)}},this.handleDmSent=function(t,e){var i=this.getAccountData(e.request.accountKey),n=i?i.id:null,s=Boolean(e.request.files&&e.request.files.length),r=e.request.isReplyBar||!1,o="GROUP_DM"===e.request.messageType;TD.controller.stats.postMessage({twitterId:n,withImage:s,isReplyBar:r,isGroupDm:o})},this.handleScheduledTweetSent=function(t,e){e=e||{},e.request=e.request||{},e.request.requests=e.request.requests||[],e.request.requests.forEach(function(e){this.handleTweetSent(t,{request:e})}.bind(this))},this.handleClearReply=function(){TD.controller.stats.composeClearReply()},this.handleStackReply=function(){TD.controller.stats.composeStackReply()},this.handleDockedTweet=function(t,e){e.popFromInline&&TD.controller.stats.composePopFromInline(),e.contextMenu&&TD.controller.stats.composeFromContextMenu(e.contextMenu)}}var i=t("flight/lib/component"),n=t("data/with_client");return i(e,n)}),define("tracking/custom_timeline_scribe",["flight/lib/component"],function(t){function e(){this.after("initialize",function(){this.on(document,"dataCustomTimelineCreateSuccess",this.handleTimelineCreated),this.on(document,"dataCustomTimelineUpdateSuccess",this.handleTimelineUpdated),this.on(document,"dataCustomTimelineDeleteSuccess",this.handleTimelineDeleted),this.on(document,"dataAddTweetToCustomTimelineSuccess",this.handleTweetAdded),this.on(document,"dataRemoveTweetFromCustomTimelineSuccess",this.handleTweetRemoved)}),this.handleTimelineCreated=function(t,e){TD.controller.stats.customTimelineCreated()},this.handleTimelineUpdated=function(t,e){TD.controller.stats.customTimelineUpdated()},this.handleTimelineDeleted=function(t,e){TD.controller.stats.customTimelineDeleted()},this.handleTweetAdded=function(t,e){TD.controller.stats.tweetAddedToCustomTimeline()},this.handleTweetRemoved=function(t,e){TD.controller.stats.tweetRemovedFromCustomTimeline()}}return t(e)}),define("tracking/message_banner_scribe",["require","flight/lib/component"],function(t){function e(){this.trackImpression=function(t,e){TD.controller.stats.messageBannerImpression(e.id),this.trigger("metric",{key:"message_banner:"+e.id+":impression"})},this.trackDismiss=function(t,e){TD.controller.stats.messageBannerDismiss(e.id),this.trigger("metric",{key:"message_banner:"+e.id+":dismiss"})},this.trackAction=function(t,e){TD.controller.stats.messageBannerClick(e.messageId,e.actionId),this.trigger("metric",{key:"message_banner:"+e.messageId+":click:"+e.actionId})},this.after("initialize",function(){this.on(document,"uiShowMessageBanner",this.trackImpression),this.on(document,"uiDismissMessageAction",this.trackDismiss),this.on(document,"uiClickMessageButtonAction",this.trackAction)})}var i=t("flight/lib/component");return i(e)}),define("tracking/embed_tweet_dialog_scribe",["require","flight/lib/component"],function(t){function e(){this.trackOpen=function(t,e){TD.controller.stats.embedTweetDialogOpen(e.tweet.id)},this.after("initialize",function(){this.on(document,"uiShowEmbedTweet",this.trackOpen)})}var i=t("flight/lib/component");return i(e)}),define("tracking/typeahead_scribe",["require","flight/lib/component"],function(t){function e(){this.trackInvocation=function(){TD.controller.stats.typeaheadInvoked()},this.trackSelection=function(t,e){var i=e.query||e.input;"recent-search"===e.searchType?TD.controller.stats.typeaheadRecentItemSelected(i,e.searchType,e.index):TD.controller.stats.typeaheadItemSelected(i,e.searchType,e.index)},this.after("initialize",function(){this.on(document,"uiTypeaheadDropdownInvoked",this.trackInvocation),this.on(document,"uiTypeaheadItemSelected",this.trackSelection)})}var i=t("flight/lib/component");return i(e)}),define("tracking/social_proof_for_tweet_scribe",["require","flight/lib/component"],function(t){function e(){this.trackViews=function(t,e){TD.controller.stats.viewedTweetSocialProof(e.type)},this.after("initialize",function(){this.on(document,"uiShowSocialProof",this.trackViews)})}var i=t("flight/lib/component");return i(e)}),define("tracking/report_tweet_scribe",["require","flight/lib/component"],function(t){function e(){this.after("initialize",function(){this.on(document,"uiShowReportTweetOptions",function(t,e){e.isMessage||TD.controller.stats.reportUser("impression")}),this.on(document,"uiShowReportTweetCancel",function(){TD.controller.stats.reportUser("cancel")}),this.on(document,"uiReportSpamAction",function(t,e){TD.controller.stats.reportUser("report_as_spam","spam")}),this.on(document,"uiReportCompromisedAction",function(t,e){e&&e.block?TD.controller.stats.reportUser("block","compromised"):TD.controller.stats.reportUser("report_as_spam","compromised")}),this.on(document,"uiReportAbusiveAction",function(t,e){TD.controller.stats.reportUserAbusive("impression"),e&&e.block?TD.controller.stats.reportUser("block","abusive"):TD.controller.stats.reportUser("report_as_spam","abusive")}),this.on(document,"uiReportAbusiveOption",function(t,e){TD.controller.stats.reportUserAbusive("click",e.option)})})}var i=t("flight/lib/component");return i(e)}),define("tracking/report_message_scribe",["require","flight/lib/component"],function(t){"use strict";function e(){this.after("initialize",function(){this.on(document,"uiShowReportTweetOptions",function(t,e){e.isMessage&&TD.controller.stats.reportDM("impression")});var t={uiShowReportMessageCancel:"cancel",uiShowReportMessageError:"error",uiNeedsDMReport:function(t){return"report_as_"+t.reportType}};_.each(t,function(t,e){this.on(document,e,function(e,i){TD.controller.stats.reportDM(_.isFunction(t)?t(i):t)})}.bind(this))})}var i=t("flight/lib/component");return i(e)}),define("tracking/scribe_to_metric",["require","flight/lib/component"],function(t){function e(){this.after("initialize",function(){this.on(document,"scribing",function(t,e){e&&e.terms&&TD.decider.get("convert_scribe_to_metrics_v2")&&this.trigger("metric",{key:i(e.terms)})})})}function i(t){return["scribe"].concat(["page","section","component","element","action"].map(function(e){return t[e]||""})).join(":")}var n=t("flight/lib/component");return n(e)}),define("util/data_setup",["flight/lib/component","data/storage","data/accounts","data/column_manager","data/contributors","data/embed_timeline","data/embed_tweet","data/message_banner","data/preferred_account","data/relationship","data/favorite","data/twitter_user","data/user_actions","data/settings","data/stream_counter","data/user_search","data/recent_searches","data/typeahead","data/user_profile_social_proof","data/twitter_users","data/lists","data/tweet","data/schedule_tweet","data/dm","data/tweetdeck_api","data/dataminr","data/touch_controller","data/custom_timelines","data/secure_image","data/dm_report","data/migrate","data/schema_validator","data/router","data/client_updater","data/feed_rewriter","tracking/account_scribe","tracking/column_options_scribe","tracking/compose_scribe","tracking/custom_timeline_scribe","tracking/message_banner_scribe","tracking/embed_tweet_dialog_scribe","tracking/typeahead_scribe","tracking/social_proof_for_tweet_scribe","tracking/report_tweet_scribe","tracking/report_message_scribe","tracking/scribe_to_metric"],function(t){"use strict";var e=Array.prototype.slice.call(arguments,1);return t(function(){this.after("initialize",function(){_.invoke(e,"attachTo",this.$node)})})}),define("ui/with_key_handler",[],function(){function t(){this.activeSequences={},this.sequenceStarters={},this.singleKeys={},this.combos={},this.attributes({charCodes:{bksp:8,ret:13,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,del:46},defaultKeyEvent:"keypress",keySequenceTimeoutDelay:1e3,modifiers:{ctrl:"ctrlKey",alt:"altKey",cmd:"metaKey",shift:"shiftKey"}}),this.getShortcutForEvent=function(t){var e,i=t.which;return this.eventHasModifier(t)&&(e=this.combos[i]),!e&&!this.eventHasFunctionModifier(t)&&(e=this.activeSequences[i]||this.singleKeys[i]||this.sequenceStarters[i]),e},this.clearActiveSequences=function(){this.activeSequences={}},this.eventHasModifier=function(t){return t.ctrlKey||t.altKey||t.metaKey||t.shiftKey},this.eventHasFunctionModifier=function(t){return t.ctrlKey||t.metaKey},this.eventHasTextModifier=function(t){return t.altKey||t.shiftKey},this.getModifiedKeyEvent=function(t,e){var i;return this.eventHasModifier(t)&&e.modifiers&&_.each(e.modifiers,function(e,n){t[n]&&(i=e)},this),i},this.handleKeyPress=function(t){var e,i=[],n=":not(input):not(textarea):not(select)",s=":radio,:checkbox";t.which>=65&&t.which<=90&&(t.which+=32),e=this.getShortcutForEvent(t),e?e.sequences?(_.each(e.sequences,function(t,e){this.addSequenceEnd(e,t)},this),setTimeout(function(){this.clearActiveSequences()}.bind(this),this.attr.keySequenceTimeoutDelay)):(i=e.shortcuts||[e],i=i.map(function(e){return e.modifiers&&(e=this.getModifiedKeyEvent(t,e)),e},this),i=i.filter(function(t){return void 0!==t}),i.forEach(function(e){var i=e.selector||n,r=$(t.target);(r.is(i)||r.is(s))&&e.callback(t,e.data)}),this.clearActiveSequences()):this.clearActiveSequences()},this.getCharCodeForKey=function(t){var e,i=!1,n=[[32,64],[91,126]];if("string"!=typeof t)throw"Key must be a string";return t=t.toLowerCase(),1===t.length?(e=t.charCodeAt(0),n.forEach(function(t){return e>=t[0]&&e<=t[1]?(i=!0,!1):void 0}),i||(e=void 0)):e=this.attr.charCodes[t],e},this.addSingleKey=function(t,e,i,n){var s;if("function"!=typeof e)throw"addSingleKey: no callback";if(s=this.getCharCodeForKey(t),void 0===s)throw"addSingleKey: invalid key string";if(this.singleKeys[s]){var r=this.singleKeys[s].shortcuts.every(function(t){return e!==t.callback||i!==t.selector},this);if(!r)throw"addSingleKey: attempted to add identical shortcut"}else this.singleKeys[s]={shortcuts:[]};this.singleKeys[s].shortcuts.push({shortcut:t,callback:e,selector:i,data:n})},this.addSequence=function(t,e,i,n){var s,r,o;if("function"!=typeof e)throw"addSequence: no callback";if("string"!=typeof t)throw"addSequence: sequence must be a string";if(s=t.split(" "),2!==s.length)throw'addSequence: sequence should be in format "g a"';if(r=this.getCharCodeForKey(s[0]),void 0===r)throw'addSequence: sequence should be in format "g a"';if(o=this.getCharCodeForKey(s[1]),void 0===o)throw'addSequence: sequence should be in format "g a"';this.sequenceStarters[r]||(this.sequenceStarters[r]={sequences:{}}),this.sequenceStarters[r].sequences[s[1]]={shortcut:t,callback:e,selector:i,data:n}},this.addSequenceEnd=function(t,e){var i;if("function"!=typeof e.callback)throw"addSequenceEnd: no callback";if("string"!=typeof t)throw"addSequenceEnd: invalid shortcut key";if(i=this.getCharCodeForKey(t),void 0===i)throw"addSequenceEnd: invalid shortcut key";this.activeSequences[i]={shortcut:e.shortcut,callback:e.callback,selector:e.selector,data:e.data}},this.addCombo=function(t,e,i,n){var s,r,o;if("function"!=typeof e)throw"addCombo: no callback";if("string"!=typeof t)throw"addCombo: invalid combo string";if(s=t.split("+"),2!==s.length)throw'addCombo: invalid combo "'+t+'"';if(r=this.attr.modifiers[s[0].toLowerCase()],void 0===r)throw"addCombo: invalid modifier";if(o=this.getCharCodeForKey(s[1]),void 0===o)throw"addCombo: invalid shortcut key";var a={modifiers:{}};a.modifiers[r]={shortcut:t,callback:e,selector:i,data:n},this.combos[o]||(this.combos[o]={shortcuts:[]}),this.combos[o].shortcuts.push(a)},this.isSequence=function(t){return"string"==typeof t&&t.indexOf(" ")>0},this.isCombo=function(t){return"string"==typeof t&&t.indexOf("+")>0},this.addShortcut=function(t,e,i,n){3===arguments.length&&"string"!=typeof i&&(n=i,i=void 0),this.isCombo(t)?this.addCombo(t,e,i,n):this.isSequence(t)?this.addSequence(t,e,i,n):this.addSingleKey(t,e,i,n)},this.removeSingleKey=function(t){var e=this.getCharCodeForKey(t);this.singleKeys[e]&&delete this.singleKeys[e]},this.removeCombo=function(t){var e=this.getCharCodeForKey(t.split("+")[1]);this.combos[e]&&delete this.combos[e]},this.removeSequence=function(t){var e=this.getCharCodeForKey(t.split(" ")[0]);this.sequenceStarters[e]&&delete this.sequenceStarters[e]},this.removeShortcut=function(t){this.isCombo(t)?this.removeCombo(t):this.isSequence(t)?this.removeSequence(t):this.removeSingleKey(t)},this.handleKeyDown=function(t){var e=[this.attr.charCodes.del,this.attr.charCodes.bksp,this.attr.charCodes.esc,this.attr.charCodes.ret,this.attr.charCodes.left,this.attr.charCodes.right,this.attr.charCodes.up,this.attr.charCodes.down,this.attr.charCodes.pagedown,this.attr.charCodes.pageup,this.attr.charCodes.home,this.attr.charCodes.end],i=e.some(function(e){return e===t.which});i&&this.handleKeyPress(t)},this.after("initialize",function(){this.on(window,"keypress",this.handleKeyPress),this.on(window,"keydown",this.handleKeyDown)})}return t}),define("ui/keyboard_shortcuts",["flight/lib/component","ui/with_key_handler"],function(t,e){var i=function(){this.attributes({shortcuts:{esc:[{event:"uiKeyEscape"},{event:"uiInputEscape",selector:".js-escapable-input"},{event:"uiInputBlur",selector:"input:not(.js-non-escapable-input),                                         textarea:not(.js-non-escapable-input),                                         select:not(.js-non-escapable-input)"},{event:"uiCloseModal"},{event:"uiCloseDropdown"},{event:"uiGridClearSelection"},{event:"uiComposeClose"}],"CMD+ret":[{event:"uiSendRetweetAction"},{event:"uiComposeSendTweet",selector:".js-compose-text"}],"CTRL+ret":[{event:"uiSendRetweetAction"},{event:"uiComposeSendTweet",selector:".js-compose-text"}],del:[{event:"uiGridBack"}],bksp:[{event:"uiGridBack"}],ret:[{event:"uiKeyEnter"},{event:"uiInputSubmit",selector:".js-submittable-input"}],space:[{event:"uiKeySpace",throttle:!0},{event:"uiGridPageDown",throttle:!0}],n:[{event:"uiComposeTweet"}],"/":[{event:"uiAppSearchFocus"}],s:[{event:"uiAppSearchFocus"}],a:[{event:"uiShowAddColumn"}],x:[{event:"uiToggleNavbarWidth"}],"?":[{event:"uiShowKeyboardShortcutList"}],left:[{event:"uiKeyLeft",throttle:!0}],h:[{event:"uiKeyLeft",throttle:!0}],right:[{event:"uiKeyRight",throttle:!0}],l:[{event:"uiKeyRight",throttle:!0}],up:[{event:"uiKeyUp",throttle:!0}],k:[{event:"uiKeyUp",throttle:!0}],down:[{event:"uiKeyDown",throttle:!0}],j:[{event:"uiKeyDown",throttle:!0}],r:[{event:"uiGridReply"}],f:[{event:"uiGridFavorite"}],t:[{event:"uiGridRetweet"}],d:[{event:"uiGridDirectMessage"}],m:[{event:"uiGridDirectMessage"}],p:[{event:"uiGridProfile"}],c:[{event:"uiGridCustomTimeline"}],"SHIFT+ ":[{event:"uiGridPageUp",throttle:!0}],pageup:[{event:"uiGridPageUp",throttle:!0}],pagedown:[{event:"uiGridPageDown",throttle:!0}],home:[{event:"uiGridHome",throttle:!0}],end:[{event:"uiGridEnd",throttle:!0}],",":[{event:"uiShowGlobalSettings"}]}}),this.blurInput=function(t,e){
$(t.target).blur()},this.shortcutEventHandlerFactory=function(t){var e,i,n=function(e){e.preventDefault(),e.stopPropagation(),this.trigger(e.target,t.event,{keyboardShortcut:!0})}.bind(this);return t.throttle?e=_.throttle(n,100):i=_.debounce(n,200,!0)},this.columnFocusFactory=function(t){return function(e){e.preventDefault(),e.stopPropagation(),0===t?this.trigger("uiColumnFocus",{last:!0}):this.trigger("uiColumnFocus",{index:t-1})}.bind(this)},this.after("initialize",function(){this.on(document,"uiInputBlur",this.blurInput);for(var t=0;10>t;t++)this.addShortcut(t+"",this.columnFocusFactory(t));_.each(this.attr.shortcuts,function(t,e){t.forEach(function(t){var i=this.shortcutEventHandlerFactory(t);this.addShortcut(e,i,t.selector)},this)},this)})};return t(i,e)}),define("ui/message_banner",["require","flight/lib/component","ui/with_template"],function(t){function e(){this.attributes({dismissButton:".js-dismiss",actions:{triggerEvent:"trigger-event",dismiss:"dismiss",openUrl:"url-ext"},buttonClasses:{"trigger-event":"btn-positive","url-ext":"btn-positive",dismiss:"btn-alt"}}),this.eventHandlerFactory=function(t){return function(){switch(t.action){case"trigger-event":this.trigger(t.event.type,t.event.data);break;case"url-ext":case"dismiss":}this.trigger("uiClickMessageButtonAction",{messageId:this.message.id,actionId:t.id}),this.message.isUndismissable||this.hide()}.bind(this)},this.dismiss=function(){this.message&&(this.trigger("uiDismissMessageAction",this.message),this.hide())},this.hide=function(){window.clearInterval(this.resizeBannerCheckInterval),this.trigger("uiHidingMessageBanner",this.message),this.message=null},this.handleMessageData=function(t,e){this.message&&this.message.id===e.message.id||(this.message=e.message,this.showMessage())},this.handleMessageContainerHidden=function(){this.$node.addClass("is-hidden")},this.showMessage=function(){this.trigger("uiShowMessageBanner",this.message);var t,e,i,n={text:this.message.text,actions:[],isUndismissable:this.message.isUndismissable};for(e=0;this.message.actions&&e<this.message.actions.length;e++)switch(t=this.message.actions[e],i=t["class"],t.action){case this.attr.actions.openUrl:n.actions.push({label:t.label,action:t.action,actionId:t.id,url:t.url,isExternalUrl:!0,boundEventHandler:this.eventHandlerFactory(t),buttonClass:i||this.attr.buttonClasses[t.action]});break;case this.attr.actions.triggerEvent:n.actions.push({label:t.label,action:t.action,actionId:t.id,boundEventHandler:this.eventHandlerFactory(t),buttonClass:i||this.attr.buttonClasses[t.action]});break;case this.attr.actions.dismiss:n.actions.push({label:t.label,action:t.action,actionId:t.id,boundEventHandler:this.eventHandlerFactory(t),buttonClass:i||this.attr.buttonClasses[t.action]})}this.render("topbar/message_banner",n),this.message.colors&&this.$node.css({"background-color":this.message.colors.background,color:this.message.colors.foreground}),this.on(this.select("dismissButton"),"click",this.dismiss),n.actions.forEach(function(t){this.on('[data-action-id="'+t.actionId+'"]',"click",t.boundEventHandler)}.bind(this)),this.resizeBannerCheckInterval=window.setInterval(function(){this.currentBannerHeight&&this.currentBannerHeight!==this.$node.outerHeight()&&this.trigger("uiMessageBannerResized"),this.currentBannerHeight=this.$node.outerHeight()}.bind(this),200),this.$node.removeClass("is-hidden"),this.trigger("uiMessageBannerShown",this.message)},this.after("initialize",function(){this.on(document,"dataMessage",this.handleMessageData),this.on(document,"uiMessageBannerContainerHidden",this.handleMessageContainerHidden),this.on(document,"dataMessageRemove",this.dismiss)})}var i=t("flight/lib/component"),n=t("ui/with_template");return i(e,n)}),define("ui/search_input",["flight/lib/component"],function(t){var e=function(){this.attributes({clearButtonSelector:".js-clear-search",textInputSelector:'input[type="text"]',hasValueClass:"has-value",isWaitingForResponseClass:"is-waiting-for-response"}),this.handleClearAction=function(){this.$textInput.val(""),this.$node.removeClass(this.attr.hasValueClass),this.$textInput.trigger("change")},this.handleAsyncFormReceivedResponse=function(){var t=this.$textInput.val();this.$node.removeClass(this.attr.isWaitingForResponseClass),""!==t?this.$node.addClass(this.attr.hasValueClass):this.$node.removeClass(this.attr.hasValueClass),this.value=t},this.handleAsyncFormWaitingForResponse=function(){var t=this.$textInput.val();void 0!==this.value&&this.value!==t&&this.$node.addClass(this.attr.isWaitingForResponseClass),this.value=t},this.after("initialize",function(){this.$textInput=this.select("textInputSelector"),this.value=this.$textInput.val().trim(),""!==this.value&&this.$node.addClass(this.attr.hasValueClass),this.on("click",{clearButtonSelector:this.handleClearAction}),this.on("uiAsyncFormWaitingForResponse",this.handleAsyncFormWaitingForResponse),this.on("uiAsyncFormReceivedResponse",this.handleAsyncFormReceivedResponse),this.on("uiSearchInputDestroy",this.teardown)})};return t(e)}),define("ui/asynchronous_form",["flight/lib/component","ui/search_input"],function(t,e){var i=function(){this.attributes({searchControlSelector:".js-search-input-control"}),this.waitingForAsyncResponse=function(t,e){this.trigger(this.$searchControls,"uiAsyncFormWaitingForResponse")},this.receivedAsyncResponse=function(t,e){this.trigger(this.$searchControls,"uiAsyncFormReceivedResponse")},this.handleSearchInputCleared=function(){this.$node.closest("form").submit()},this.destroy=function(t,e){this.teardown()},this.before("teardown",function(){this.trigger(this.$searchControls,"uiSearchInputDestroy")}),this.after("initialize",function(){this.on("uiReceivedAsyncResponse",this.receivedAsyncResponse),this.on("uiWaitingForAsyncResponse",this.waitingForAsyncResponse),this.on("uiDestroyAsynchronousForm",this.destroy),this.on("uiSearchInputCleared",this.handleSearchInputCleared),this.$searchControls=this.select("searchControlSelector"),e.attachTo(this.$searchControls)})};return t(i)}),define("ui/app_search",["flight/lib/component","ui/asynchronous_form"],function(t,e){function i(){this.attributes({sourceId:"appSearch",appSearchInputSelector:".js-app-search-input",searchButtonSelector:".js-perform-search",clearButtonSelector:".js-clear-search",KEY_CODE_MAP:{13:{name:"ENTER",event:"uiSearchInputSubmit",on:"keypress",preventDefault:!0},27:{name:"ESC",event:"uiSearchInputEscaped",on:"keydown"},9:{name:"TAB",event:"uiSearchInputTab",on:"keydown",preventDefault:!0},37:{name:"LEFT",event:"uiSearchInputLeft",on:"keydown"},39:{name:"RIGHT",event:"uiSearchInputRight",on:"keydown"},38:{name:"UP",event:"uiSearchInputMoveUp",on:"keydown",preventDefault:!0},40:{name:"DOWN",event:"uiSearchInputMoveDown",on:"keydown",preventDefault:!0}}}),this.after("initialize",function(){e.attachTo(this.$node,{source:"appSearch"}),this.$input=this.select("appSearchInputSelector"),this.on(this.$input,"keyup keydown keypress paste",this.modifierKeyPressed),this.on(this.$input,"focus",this.handleFocus),this.on(this.$input,"uiInputBlur",function(t){this.$input.blur()}),this.on(this.$input,"click",function(t){t.stopPropagation()}),this.on(this.select("searchButtonSelector"),"click",function(t){this.trigger(this.$input,"uiSearchInputSubmit",{query:this.$input.val()})}),this.on(this.select("clearButtonSelector"),"click",this.handleClearSearchAction),this.on("uiAppSearchSetPreventDefault",this.setPreventKeyDefault),this.on("uiAppSearchItemComplete",this.completeInput),this.on("uiAppSearchSubmit",this.handleAppSearchSubmit),this.on(document,"uiNewSearchQuery uiSearchInputChanged",this.handleSearchInputChanged),this.on("uiSearchInPopoverHidden",this.handleResetState)}),this.handleSearchInputChanged=function(t,e){e.source!==this.attr.sourceId&&(this.$input.val(e.query),this.currentQuery=e.query)},this.handleAppSearchSubmit=function(t,e){this.completeInput(t,e),this.trigger(this.$input,"uiSearchInputSubmit",{query:this.$input.val()})},this.around("trigger",function(){var t,e=[].slice.call(arguments),i=e.shift();"string"!=typeof e[e.length-1]&&(t=e.pop()),void 0===t?t={source:this.attr.sourceId}:t.source=this.attr.sourceId,e.push(t),i.apply(this,e)}),this.setPreventKeyDefault=function(t,e){this.attr.KEY_CODE_MAP[e.key].preventDefault=e.preventDefault},this.handleFocus=function(t){_.defer(this.$input.select.bind(this.$input)),this.trigger(this.$input,"uiSearchInputFocus",{query:this.$input.val()})},this.modifierKeyPressed=function(t){var e=this.$input.val();e=""===e.trim()?"":e;var i=this.attr.KEY_CODE_MAP[t.which||t.keyCode];if(i){if(t.type!==i.on)return;i.preventDefault&&t.preventDefault(),this.trigger(this.$input,i.event,{query:e})}else this.setQueryAndTriggerUpdateEvent(e)},this.completeInput=function(t,e){"user"===e.searchType&&(e.query="@"+e.query),this.trigger("uiAppSearchSetQuery",{data:e.query}),this.$input.val(e.query),this.setQueryAndTriggerUpdateEvent(e.query),this.focusInput(),this.$input[0].selectionStart=e.query.length,this.$input[0].selectionEnd=e.query.length},this.setQueryAndTriggerUpdateEvent=function(t){this.currentQuery&&this.currentQuery===t||(this.currentQuery=t,this.trigger(this.$input,"uiSearchInputChanged",{query:this.currentQuery}))},this.focusInput=function(){this.$input.focus()},this.handleClearSearchAction=function(){this.focusInput()},this.handleResetState=function(){this.currentQuery=null,this.$input.val("")},this.before("teardown",function(){this.trigger("uiDestroyAsynchronousForm")})}return t(i)}),define("ui/alerts_form",["require","flight/lib/component","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({column:null,template:"column/alerts_form",actionButton:"[data-action]",summarySelector:".js-alerts-summary",summaryClass:"js-alerts-summary"}),this.after("initialize",function(){var t={summaryText:"",iconClass:"icon-info",title:TD.i("Alerts"),jsClass:this.attr.summaryClass,options:[{action:"sound",option:TD.i("Sounds"),on:this.attr.column.model.getHasSound()}]};return this.column=this.attr.column,this.column.getColumnType()===TD.util.columnUtils.columnMetaTypes.SCHEDULED?void this.teardown():(TD.controller.notifications.hasNotifications()&&t.options.push({action:"popups",option:TD.i("Popups"),on:this.column.model.getHasNotification()}),this.$alertsForm=$(n.render(this.attr.template,t)),this.$node.append(this.$alertsForm),this.updateSummary(),this.on(this.$alertsForm,"click",{actionButton:this.toggleColumnSetting}),void 0)}),this.updateSummary=function(){var t,e=this.column.model,i=e.getHasNotification(),n=e.getHasSound();t=TD.i(i&&n?"sounds and popups":i?"popups":n?"sounds":"none"),this.select("summarySelector").text(t)},this.toggleColumnSetting=function(t){var e,i=TD.controller.notifications,n=$(t.target).closest(this.attr.actionButton),s=n.data("action"),r=this.column.model,o=function(t){"granted"===t&&r.setHasNotification(e)};switch(s){case"popups":e=!r.getHasNotification(),i.isPermissionGranted()?o("granted"):i.getPermission(o);break;case"sound":e=!r.getHasSound(),r.setHasSound(e)}this.updateSummary()}}var i=t("flight/lib/component"),n=t("scripts/UI/template");return i(e)}),define("ui/with_transitions",[],function(){function t(){this.measureElementHeight=function(t,e){var i=$(t);return i.removeClass(e),i.height()},this.animateHeight=function(t,e,i,n){var s,r,o=this.measureElementHeight(t,e),a=function(){"function"==typeof i&&i(),"collapse"===n&&t.css("height","")};"expand"===n?(s=0,r=o):(s=o,r=0),this.animateHeightFromTo(t,s,r,e,a)},this.animateHeightFromTo=function(t,e,i,n,s){var r=function(){t.removeClass(n),t.trigger("uiTransitionExpandEnd"),"function"==typeof s&&s()};return e===i?void(s&&s()):(t.css({height:e}),void _.defer(function(){t.addClass(n),t.trigger("uiTransitionExpandStart",{delta:i-e}),TD.ui.main.TRANSITION_END_EVENTS?t.one(TD.ui.main.TRANSITION_END_EVENTS,r):r(),t.height(i)}.bind(this)))},this.animateElementContentHeight=function(t,e,i,n){var s=function(){t.html(e)};this.animateElementHeightChange(t,s,i,n)},this.animateElementHeightChange=function(t,e,i,n){var s,r=this.measureElementHeight(t,i);t.css({height:""}),e(),s=this.measureElementHeight(t),this.animateHeightFromTo(t,r,s,i,n)},this.deferredAnimateElementHeightChange=function(t,e,i){i=_.defaults(i||{},{isAnimatingClass:""});var n=new TD.core.defer.Deferred;return this.animateElementHeightChange(t,e,i.isAnimatingClass,n.callback.bind(n)),n},this.transitionExpand=function(t,e,i){this.animateHeight(t,e,i,"expand")},this.transitionCollapse=function(t,e,i){this.animateHeight(t,e,i,"collapse")},this.transitionTop=function(t,e,i,n){var s=function(){t.removeClass(e),"function"==typeof n&&n()};t.addClass(e),t.css("top",i),TD.ui.main.TRANSITION_END_EVENTS?t.one(TD.ui.main.TRANSITION_END_EVENTS,s):s()},this.addAnimateClass=function(t,e,i){return i=i||function(){},TD.ui.main.ANIMATION_END_EVENTS?(t.one(TD.ui.main.ANIMATION_END_EVENTS,function(){t.removeClass(e),i()}),void t.addClass(e)):void i()},this.stopAnimation=function(t,e){t.off(TD.ui.main.ANIMATION_END_EVENTS),t.removeClass(e)}}return t}),define("ui/with_accordion",["flight/lib/compose","ui/with_transitions"],function(t,e){var i=function(){t.mixin(this,[e]),this.attributes({accordionItemSelector:".js-accordion-item",accordionIsExpandedClass:"is-expanded",accordionIsActiveClass:"is-active",accordionToggleSelector:".js-accordion-toggle-view",accordionPanelSelector:".js-accordion-panel",isAccordionPanelAnimatingClass:"is-accordion-panel-animating"}),this.expandAccordionItem=function(t){this.trigger(t,"uiAccordionWillExpand");var e=t.find(this.attr.accordionPanelSelector);t.addClass(this.attr.accordionIsExpandedClass),t.addClass(this.attr.accordionIsActiveClass),this.transitionExpand(e,this.attr.isAccordionPanelAnimatingClass),this.trigger(t,"uiAccordionExpandAction")},this.collapseAccordionItem=function(t){var e=t.find(this.attr.accordionPanelSelector);t.removeClass(this.attr.accordionIsActiveClass),this.transitionCollapse(e,this.attr.isAccordionPanelAnimatingClass,function(){t.removeClass(this.attr.accordionIsExpandedClass)}.bind(this)),this.trigger(t,"uiAccordionCollapseAction")},this.getOpenAccordionItem=function(){return this.select("accordionItemSelector").filter(function(t,e){return $(e).hasClass(this.attr.accordionIsExpandedClass)}.bind(this))},this.accordionToggle=function(t){var e=$(t.target).closest(this.attr.accordionItemSelector),i=this.getOpenAccordionItem();i.length>0&&this.collapseAccordionItem(i),e.is(i)||this.expandAccordionItem(e)},this.showAccordionPanel=function(t){var e=t.closest(this.attr.accordionItemSelector),i=this.getOpenAccordionItem();e.is(i)||(this.collapseAccordionItem(i),this.expandAccordionItem(e))},this.handleUpdatePanelHeights=function(){this.select("accordionPanelSelector").filter(":visible").each(function(t,e){var i=$(e);i.css("height",""),i.height(i.height()),this.trigger("uiAccordionTotalHeightChanged")}.bind(this))},this.after("initialize",function(){this.on("click",{accordionToggleSelector:_.throttle(this.accordionToggle,300).bind(this)}),this.on("uiAccordionUpdatePanelHeights",this.handleUpdatePanelHeights)})};return i}),define("data/with_languages",[],function(){function t(){this.before("initialize",function(){this.languages=TD.languages.getAllLanguages()})}return t}),define("ui/search/content_filter_form",["flight/lib/component","ui/with_template","data/with_languages"],function(t,e,i){var n=function(){this.attributes({filterType:"content",template:"menus/search_content_form",matchingSelector:".js-matching",excludingSelector:".js-excluding",containingSelector:".js-containing",writtenInSelector:".js-written-in",retweetsSelector:".js-retweets",searchFilter:null,renderOptions:{withContentType:!0,withMatching:!0,withExcluding:!0,withLanguage:!0,withRetweetsToggle:!0}}),this.getContainingOptions=function(){return[{value:TD.vo.ContentFilter.TYPE_ANYTHING,title:TD.i("all Tweets")},{value:TD.vo.ContentFilter.TYPE_IMG,title:TD.i("Tweets with images")},{value:TD.vo.ContentFilter.TYPE_VID,title:TD.i("Tweets with videos")},{value:TD.vo.ContentFilter.TYPE_GIF,title:TD.i("Tweets with GIFs"),hidden:!this.attr.renderOptions.withAnimatedGifFilter||!TD.decider.get("native_animated_gifs")},{value:TD.vo.ContentFilter.TYPE_VINE,title:TD.i("Tweets with Vines")},{value:TD.vo.ContentFilter.TYPE_IMG_AND_VID,title:TD.i("Tweets with any media")},{value:TD.vo.ContentFilter.TYPE_LINKS,title:TD.i("Tweets with links")}]},this.getRetweetOptions=function(){return[{value:"included",title:TD.i("included"),isIncluded:!0},{value:"excluded",title:TD.i("excluded"),isIncluded:!1}]},this.handleChange=function(t){var e=this.$containing.val(),i=this.$matching.val(),n=this.$excluding.val(),s=this.$writtenIn.val(),r=this.$retweets.val(),o=this.retweetOptions.filter(function(t){return t.value===r})[0],a=new TD.vo.ContentFilter({type:e,matching:i,excluding:n,lang:s,includeRTs:o.isIncluded});this.trigger("uiSearchFilterUpdateAction",{type:"content",filter:a,filterName:$(t.target).data("title"),value:t.target.value})},this.after("initialize",function(){this.containingOptions=this.getContainingOptions(),this.retweetOptions=this.getRetweetOptions();var t={containingOptions:this.containingOptions,retweetOptions:this.retweetOptions},e=TD.languages.getSystemLanguageCode(!0),i=TD.languages.getLanguageFromISOCode(e);t.userLanguage=i,t.allLanguages=_.sortBy(this.languages,function(t){return t.localized_name}),$.extend(t,this.attr.renderOptions),this.render(this.attr.template,t),this.$matching=this.select("matchingSelector"),this.$excluding=this.select("excludingSelector"),this.$containing=this.select("containingSelector"),this.$writtenIn=this.select("writtenInSelector"),this.$retweets=this.select("retweetsSelector"),this.attr.searchFilter&&this.attr.searchFilter.content&&(this.$containing.val(this.attr.searchFilter.content.type),this.$retweets.val(this.attr.searchFilter.content.includeRTs?"included":"excluded"),this.$writtenIn.val(this.attr.searchFilter.content.lang)),this.on("change",this.handleChange),this.on("uiDestroyContentFilterForm",this.teardown)})};return t(n,e,i)}),define("ui/search/user_filter_form",["flight/lib/component","ui/with_template","data/with_languages"],function(t,e,i){var n=function(){this.attributes({FROM_ME:"from_me",MENTIONING_USER:"mentioning_user",MENTIONING_ME:"mentioning_me",filterType:"user",template:"menus/search_user_form",tweetsFromSelector:".js-tweets-from",tweetsFromUserSelector:".js-tweets-from-user",tweetsFromUserClass:"js-tweets-from-user",tweetsFromUserInputSelector:'.js-tweets-from-user input[type="text"]',tweetsFromListSelector:".js-tweets-from-list",tweetsFromListClass:"js-tweets-from-list",tweetsFromListInputSelector:'.js-tweets-from-list input[type="text"]',tweetsFromMeSelector:".js-tweets-from-me",mentioningSelector:".js-mentioning",mentioningUserSelector:".js-mentioning-user",mentioningUserInputSelector:'.js-mentioning-user input[type="text"]',mentioningUserClass:"js-mentioning-user",mentioningMeSelector:".js-mentioning-me",isHiddenClass:"is-hidden",renderOptions:{withFromList:!1},searchFilter:null}),this.getTweetsFromOptions=function(t){var e=[{value:TD.vo.UserFilter.FROM_ALL,title:TD.i("all users")},{value:TD.vo.UserFilter.FROM_USER,title:TD.i("specific user")},{value:this.attr.FROM_ME,title:TD.i("me")},{value:TD.vo.UserFilter.FROM_VERIFIED,title:TD.i("verified users")}];return t&&e.push({value:TD.vo.UserFilter.FROM_LIST,title:TD.i("members of list")}),e},this.getMentioningOptions=function(){return[{value:"",title:TD.i("-")},{value:this.attr.MENTIONING_USER,title:TD.i("specific user")},{value:this.attr.MENTIONING_ME,title:TD.i("me")}]},this.getMyAccounts=function(){var t=TD.storage.accountController.getPreferredAccount("twitter"),e=TD.storage.accountController.getAccountsForService("twitter");return e=e.map(function(e){return{value:e.getUsername().toLowerCase(),title:"@"+e.getUsername(),isDefault:e===t}}),e=e.sort(function(t,e){return t.value.toLowerCase().localeCompare(e.value.toLowerCase())})},this.updateFormState=function(t,e){switch(t){case TD.vo.UserFilter.FROM_USER:this.$tweetsFromUser.removeClass(this.attr.isHiddenClass),this.$tweetsFromList.addClass(this.attr.isHiddenClass),this.$tweetsFromMe.addClass(this.attr.isHiddenClass);break;case TD.vo.UserFilter.FROM_LIST:this.$tweetsFromList.removeClass(this.attr.isHiddenClass),this.$tweetsFromUser.addClass(this.attr.isHiddenClass),this.$tweetsFromMe.addClass(this.attr.isHiddenClass);break;case this.attr.FROM_ME:this.$tweetsFromMe.removeClass(this.attr.isHiddenClass),this.$tweetsFromUser.addClass(this.attr.isHiddenClass),this.$tweetsFromList.addClass(this.attr.isHiddenClass),this.$tweetsFromUserInput.val("");break;default:this.$tweetsFromMe.addClass(this.attr.isHiddenClass),this.$tweetsFromUser.addClass(this.attr.isHiddenClass),this.$tweetsFromList.addClass(this.attr.isHiddenClass),this.$tweetsFromUserInput.val("")}switch(e){case this.attr.MENTIONING_USER:this.$mentioningUser.removeClass(this.attr.isHiddenClass),this.$mentioningMe.addClass(this.attr.isHiddenClass);break;case this.attr.MENTIONING_ME:this.$mentioningMe.removeClass(this.attr.isHiddenClass),this.$mentioningUser.addClass(this.attr.isHiddenClass),this.$mentioningUserInput.val("");break;default:this.$mentioningMe.addClass(this.attr.isHiddenClass),this.$mentioningUser.addClass(this.attr.isHiddenClass),this.$mentioningUserInput.val("")}},this.handleChange=function(t){var e="",i="",n=this.$tweetsFrom.val(),s=this.$mentioning.val(),r=$(t.target).data("title");switch(this.updateFormState(n,s),n){case this.attr.FROM_ME:e=this.$tweetsFromMe.val(),n=TD.vo.UserFilter.FROM_USER;break;case TD.vo.UserFilter.FROM_USER:e=this.$tweetsFromUserInput.val();break;case TD.vo.UserFilter.FROM_LIST:e=this.$tweetsFromListInput.val()}i=s===this.attr.MENTIONING_ME?this.$mentioningMe.val():this.$mentioningUserInput.val(),!e&&(n===TD.vo.UserFilter.FROM_USER||n===TD.vo.UserFilter.FROM_LIST)&&(n=TD.vo.UserFilter.FROM_ALL);var o=new TD.vo.UserFilter({from_type:n,from_name:e,mention_name:i});this.trigger("uiSearchFilterUpdateAction",{type:"user",filter:o,filterName:r,value:t.target.value})},this.after("initialize",function(){var t,e,i;this.tweetsFromOptions=this.getTweetsFromOptions(this.attr.renderOptions.withFromList),this.mentioningOptions=this.getMentioningOptions(),this.myAccounts=this.getMyAccounts();var n=this.attr.searchFilter,s=n.user&&null!==n.user.from_type?n.user.from_name:"",r=n.user?n.user.mention_name:"";if(t={tweetsFromOptions:this.tweetsFromOptions,tweetsFromUser:{searchInputControlClass:this.attr.tweetsFromUserClass+" margin-txs",searchInputPlaceholder:TD.i("user name"),searchInputTitle:"from_user_or_list",searchInputValue:s},tweetsFromList:{searchInputControlClass:this.attr.tweetsFromListClass+" margin-txs",searchInputPlaceholder:TD.i("@username/list-name"),searchInputTitle:"from_user_or_list",searchInputValue:s},mentioningUser:{searchInputControlClass:this.attr.mentioningUserClass+" margin-txs",searchInputPlaceholder:TD.i("user name"),searchInputTitle:"mentioning_user",searchInputValue:r},mentioningOptions:this.mentioningOptions,myAccounts:this.myAccounts},this.render(this.attr.template,t),this.$tweetsFrom=this.select("tweetsFromSelector"),this.$tweetsFromUser=this.select("tweetsFromUserSelector"),this.$tweetsFromUserInput=this.select("tweetsFromUserInputSelector"),this.$tweetsFromList=this.select("tweetsFromListSelector"),this.$tweetsFromListInput=this.select("tweetsFromListInputSelector"),this.$tweetsFromMe=this.select("tweetsFromMeSelector"),this.$mentioning=this.select("mentioningSelector"),this.$mentioningUser=this.select("mentioningUserSelector"),this.$mentioningUserInput=this.select("mentioningUserInputSelector"),this.$mentioningMe=this.select("mentioningMeSelector"),this.attr.searchFilter&&this.attr.searchFilter.user){if(e=this.attr.searchFilter.user.from_name&&TD.storage.accountController.getAccountFromUsername(this.attr.searchFilter.user.from_name).length>0,i=this.attr.searchFilter.user.mention_name&&TD.storage.accountController.getAccountFromUsername(this.attr.searchFilter.user.mention_name).length>0,e)this.$tweetsFrom.val(this.attr.FROM_ME),this.$tweetsFromMe.val(this.attr.searchFilter.user.from_name);else switch(this.$tweetsFrom.val(this.attr.searchFilter.user.from_type),this.attr.searchFilter.user.from_type){case TD.vo.UserFilter.FROM_USER:this.$tweetsFromUserInput.val(this.attr.searchFilter.user.from_name);break;case TD.vo.UserFilter.FROM_LIST:this.$tweetsFromListInput.val(this.attr.searchFilter.user.from_name)}i?(this.$mentioning.val(this.attr.MENTIONING_ME),this.$mentioningMe.val(this.attr.searchFilter.user.mention_name)):this.attr.searchFilter.user.mention_name&&(this.$mentioning.val(this.attr.MENTIONING_USER),this.$mentioningUserInput.val(this.attr.searchFilter.user.mention_name))}this.updateFormState(this.$tweetsFrom.val(),this.$mentioning.val()),this.on("change",this.handleChange),this.on("uiDestroyUserFilterForm",this.teardown)})};return t(n,e,i)}),define("ui/search/action_filter_form",["flight/lib/component","ui/with_template"],function(t,e){function i(){this.attributes({filterType:"action",columnType:null,template:"menus/search_action_form",searchFilter:null,showFavoritesSelector:".js-show-favorites",showRetweetsSelector:".js-show-retweets",showListsSelector:".js-show-lists",showFollowersSelector:".js-show-followers",showMentionsSelector:".js-show-mentions",errorMessageSelector:".js-action-filter-error",isHiddenClass:"is-hidden"}),this.isInActivityColumn=function(){return this.attr.columnType===TD.util.columnUtils.columnMetaTypes.ACTIVITY},this.hasFilterError=function(t){var e=t.getFilters().length,i=!1;return this.isInActivityColumn()?e===TD.vo.ActionFilter.MAX_ACTIVITY_FILTERS&&(i=!0):e===TD.vo.ActionFilter.MAX_INTERACTION_FILTERS&&(i=!0),i},this.handleChange=function(t){var e,i={showFollowers:this.$showFollowers.prop("checked"),showLists:this.$showLists.prop("checked"),showMentions:this.$showMentions.prop("checked"),showRetweets:this.$showRetweets.prop("checked"),showFavorites:this.$showFavorites.prop("checked")};0===this.$showRetweets.length&&(i.showRetweets=!0),0===this.$showMentions.length&&(i.showMentions=!0),e=new TD.vo.ActionFilter(i),this.select("errorMessageSelector").toggleClass(this.attr.isHiddenClass,!this.hasFilterError(e)),this.trigger("uiAccordionUpdatePanelHeights"),this.trigger("uiSearchFilterUpdateAction",{type:this.attr.filterType,filter:e,filterName:$(t.target).data("title"),value:[t.target.value,t.target.checked?"show":"hide"].join(":")}),this.hasFilterError(e)&&this.trigger("uiActionFilterError")},this.after("initialize",function(){var t=this.attr.searchFilter.action.toJSONObject();t.showError=this.hasFilterError(this.attr.searchFilter.action),t.isInActivityColumn=this.isInActivityColumn(),this.render(this.attr.template,t),this.$showRetweets=this.select("showRetweetsSelector"),this.$showFavorites=this.select("showFavoritesSelector"),this.$showFollowers=this.select("showFollowersSelector"),this.$showLists=this.select("showListsSelector"),this.$showMentions=this.select("showMentionsSelector"),this.on("change",this.handleChange)})}return t(i,e)}),define("ui/search/engagement_filter_form",["flight/lib/component","ui/with_template"],function(t,e){function i(){this.attributes({filterType:"engagement",template:"menus/search_engagement_form",searchFilter:null,minRetweetsSelector:".js-min-retweets",minRepliesSelector:".js-min-replies",minFavoritesSelector:".js-min-favorites",zeroClass:"txt-mute"}),this.after("initialize",function(){var t=this.attr.searchFilter.engagement;this.render(this.attr.template,t),this.$minFavorites=this.select("minFavoritesSelector"),this.$minRetweets=this.select("minRetweetsSelector"),this.$minReplies=this.select("minRepliesSelector"),this.on("change blur",this.handleChange),this.validateInput(this.attr.searchFilter.engagement)}),this.validateInput=function(){var t=parseInt(this.$minFavorites.val(),10),e=parseInt(this.$minRetweets.val(),10),i=parseInt(this.$minReplies.val(),10);t=isNaN(t)?0:t,e=isNaN(e)?0:e,i=isNaN(i)?0:i,this.$minFavorites.val(t).toggleClass(this.attr.zeroClass,0===t),this.$minRetweets.val(e).toggleClass(this.attr.zeroClass,0===e),this.$minReplies.val(i).toggleClass(this.attr.zeroClass,0===i)},this.handleChange=function(t){var e,i=$(t.target).data("title"),n=$(t.target).val();this.validateInput(),e=new TD.vo.EngagementFilter({minFavorites:this.$minFavorites.val(),minRetweets:this.$minRetweets.val(),minReplies:this.$minReplies.val()}),this.trigger("uiSearchFilterUpdateAction",{type:this.attr.filterType,filter:e,filterName:i,value:n})}}return t(i,e)}),define("ui/with_search_filter",["flight/lib/compose","ui/with_template","ui/search/content_filter_form","ui/search/user_filter_form","ui/search/action_filter_form","ui/search/engagement_filter_form"],function(t,e,i,n,s,r){var o=function(){t.mixin(this,[e]),this.attributes({searchAccordionTemplate:"menus/search_accordion",contentFilterSelector:".js-content-filter",userFilterSelector:".js-user-filter",actionFilterSelector:".js-action-filter",engagementFilterSelector:".js-engagement-filter",searchFilterSelector:".js-search-filter",contentSummaryClass:"js-content-filter-summary",userSummaryClass:"js-user-filter-summary",actionSummaryClass:"js-action-filter-summary",engagementSummaryClass:"js-engagement-filter-summary",contentSummarySelector:".js-content-filter-summary",userSummarySelector:".js-user-filter-summary",actionSummarySelector:".js-action-filter-summary",engagementSummarySelector:".js-engagement-filter-summary",excludingClass:"js-excluding",matchingClass:"js-matching",filterTypes:["content","user","action","engagement"]}),this.isValidFilterType=function(t){return this.attr.filterTypes.some(function(e){return t===e})},this.handleSearchFilterUpdate=function(t,e){if(e.filter&&this.isValidFilterType(e.type)){this.searchFilter[e.type]=e.filter;var i=e.filter.getSummaryText(this.attr.columnType),n=this.select(e.type+"SummarySelector");n.text(i),TD.controller.stats.advancedSearchSettings(this.attr.scribeSection,e.type,e.filterName,e.value),this.trigger(this.$accordion,"uiAccordionUpdatePanelHeights"),this.trigger("uiColumnUpdateSearchFilter",this.searchFilter)}},this.renderSearchFilters=function(t,e){this.searchFilter=t,this.$accordion=this.select("accordionSelector");var o=this.renderTemplate(this.attr.searchAccordionTemplate,{content:{summaryText:this.searchFilter.content.getSummaryText(),iconClass:"icon-content",title:TD.i("Content"),jsClass:this.attr.contentSummaryClass,isExpanded:e.expandContentFilter},user:{summaryText:this.searchFilter.user.getSummaryText(),iconClass:"icon-user",title:TD.i("Users"),jsClass:this.attr.userSummaryClass,isExpanded:e.expandUserFilter},action:e.withActionFilter?{summaryText:this.searchFilter.action.getSummaryText(this.attr.columnType),iconClass:"icon-check",title:TD.i("Showing"),jsClass:this.attr.actionSummaryClass,isExpanded:e.expandActionFilter}:!1,engagement:e.withEngagementFilter?{summaryText:this.searchFilter.engagement.getSummaryText(),iconClass:"icon-retweet",title:TD.i("Engagement"),jsClass:this.attr.engagementSummaryClass,isExpanded:e.expandEngagementFilter}:!1});this.$accordion.append(o),this.trigger(this.select("contentFilterSelector"),"uiDestroyContentFilterForm"),this.trigger(this.select("userFilterSelector"),"uiDestroyUserFilterForm"),i.attachTo(this.select("contentFilterSelector"),{searchFilter:t,renderOptions:e}),n.attachTo(this.select("userFilterSelector"),{searchFilter:t,renderOptions:e}),e.withActionFilter&&s.attachTo(this.select("actionFilterSelector"),{searchFilter:t,renderOptions:e,columnType:this.attr.columnType}),e.withEngagementFilter&&r.attachTo(this.select("engagementFilterSelector"),{searchFilter:t,renderOptions:e})},this.after("initialize",function(){this.searchFilter=this.searchFilter||new TD.vo.SearchFilter,this.$searchFilter=this.select("searchFilterSelector"),this.on("uiSearchFilterUpdateAction",this.handleSearchFilterUpdate)})};return o}),define("ui/with_thumb_size_select",["flight/lib/compose","ui/with_template"],function(t,e){
function i(){t.mixin(this,[e]),this.attributes({thumbSizeSelectSelector:".js-thumb-size",thumbSizeSelectTemplate:"column/thumb_size_select",selectItemSelector:".js-toggle-item",selectedClass:"is-selected"}),this.after("initialize",function(){this.on(this.$node,"click",{selectItemSelector:this.handleThumbSizeSelectClick}),this.on("uiColumnUpdateSearchFilter",this.renderThumbSizeSelector)}),this.renderThumbSizeSelector=function(){var t=this.toHtml(this.attr.thumbSizeSelectTemplate);this.$thumbSizeSelect=this.select("thumbSizeSelectSelector"),this.$thumbSizeSelect.html(t),this.$thumbSizeSelectOptions=this.select("selectItemSelector");var e=this.attr.column.getMediaPreviewSize(),i='[data-value="'+e+'"]';this.$thumbSizeSelectOptions.filter(i).addClass(this.attr.selectedClass)},this.handleThumbSizeSelectClick=function(t,e){var i=$(e.el),n=i.data("value");n&&(this.trigger("uiColumnUpdateMediaPreview",{value:n}),this.$thumbSizeSelectOptions.removeClass(this.attr.selectedClass),i.addClass(this.attr.selectedClass))}}return i}),define("ui/column_options",["require","flight/lib/component","ui/alerts_form","ui/with_accordion","ui/with_search_filter","ui/with_thumb_size_select","ui/with_transitions","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({actionButton:"[data-action]",searchInputForm:".js-column-options-search-form",searchInput:".js-search-input",scribeSection:"column_options",isAnimatingClass:"is-column-options-animating",accordionSelector:".js-accordion",column:null,columnType:null,isTouchColumnOptionsClass:"is-touch-column-options",hideContentClass:"scroll-none",scribeElementSelector:"[data-scribe-element]"}),this.updateHeight=function(){this.$node.css("height",""),this.$node.height(this.$node.height()),this.trigger("uiAccordionTotalHeightChanged")},this.handleChildTransitionExpandStart=function(t,e){this.$node.css("height","")},this.handleChildTransitionExpandEnd=function(){this.$node.height(this.$node.height())},this.handleUpdateSearchFilter=function(t,e){this.updateHeight(),this.column.updateSearchFilter(e)},this.handleShowUserFilter=function(t){t.stopPropagation(),this.showAccordionPanel(this.select("userFilterSelector"))},this.handleShowContentFilter=function(t){t.stopPropagation(),this.showAccordionPanel(this.select("contentFilterSelector"))},this.hide=function(){this.$node.hasClass(this.attr.isAnimatingClass)||(this.trigger("uiHidingColumnOptions"),this.$node.addClass(this.attr.hideContentClass),this.transitionCollapse(this.$node,this.attr.isAnimatingClass,this.afterHideTransition.bind(this)),this.teardown())},this.afterHideTransition=function(){this.$node.css("height",""),this.$node.empty(),this.trigger("uiColumnOptionsHidden")},this.showColumnOptions=function(){var t=function(){this.$node.removeClass(this.attr.hideContentClass),this.trigger("uiColumnOptionsShown")}.bind(this);this.trigger("uiShowingColumnOptions"),this.$node.addClass(this.attr.hideContentClass),this.transitionExpand(this.$node,this.attr.isAnimatingClass,t.bind(this))},this.handleClickEvents=function(t){var e=$(t.target).closest(this.attr.actionButton),i=e.data("action"),n=this.column.model.getKey();switch(i){case"remove":this.trigger("uiDeleteColumnAction",{columnId:n});break;case"clear":this.column.clear(),this.trigger("uiClearColumnAction",{columnId:n});break;case"left":case"right":this.trigger("uiMoveColumnAction",{columnId:n,action:i});break;case"edit-list":new TD.components.ListMembers(this.column.isOwnList());break;case"delete-customtimeline":var s=_.uniqueId(),r={id:s,title:TD.i("Delete"),message:TD.i("Are you sure you want to delete this collection?"),okLabel:TD.i("Delete"),cancelLabel:TD.i("Cancel")};this.on(document,"uiConfirmationAction",function(t,e){e.id===s&&(this.off(document,"uiConfirmationAction"),e.result&&this.column.deleteCustomTimeline())}),this.trigger("uiShowConfirmationDialog",r);break;case"embed":this.trigger("uiEmbedTimelineAction",{column:this.column});break;case"view-on-web":this.trigger("uiViewTimeline");break;case"reference-to":this.trigger("uiReferenceTimeline")}},this.handleScribeElementClick=function(t){var e=$(t.target).closest(this.attr.scribeElementSelector).attr("data-scribe-element");TD.controller.stats.generic({section:this.attr.scribeSection,element:e,action:"click"})},this.after("initialize",function(){this.column=this.attr.column;var t,e=this.column.getSearchFilter(),i=this.column.isSearchColumn(),s=-1!==TD.util.columnUtils.mediaPreviewableColumnTypes.indexOf(this.column.getColumnType());this.on("uiShowUserFilter",this.handleShowUserFilter),this.on("uiShowContentFilter",this.handleShowContentFilter),this.on("uiColumnOptionsCloseAction",this.hide),this.on("uiColumnUpdateSearchFilter",this.handleUpdateSearchFilter),this.on("uiAccordionExpandAction",this.updateHeight),this.on("uiAccordionCollapseAction",this.updateHeight),this.on(document,"uiColumnWidthChange",this.updateHeight),this.on("uiTransitionExpandStart",{searchFilterSelector:this.handleChildTransitionExpandStart}),this.on("uiTransitionExpandEnd",{searchFilterSelector:this.handleChildTransitionExpandEnd}),this.on("click",{actionButton:this.handleClickEvents,scribeElementSelector:this.handleScribeElementClick});var r=Boolean(TD.util.isTouchDevice()&&TD.decider.get("touchdeck_column_options_v2"));r?this.$node.addClass(this.attr.isTouchColumnOptionsClass):this.$node.removeClass(this.attr.isTouchColumnOptionsClass),t={searchTerm:this.column.getBaseQuery(),isOwnList:Boolean(this.column.isOwnList()),isOwnCustomTimeline:this.column.isOwnCustomTimeline(),isShareableOrEmbeddable:this.column.isShareable()||this.column.isEmbeddable(),isClearable:this.column.isClearable(),isTouchColumnOptions:r,isDataminr:this.column.isDataminr()};var o=c.render("column/column_options",t);this.$node.html(o),this.column.isFilterable()&&this.renderSearchFilters(e,{withContentType:!0,withMatching:{isControl:!0,searchInputClassName:this.attr.matchingClass,searchInputPlaceholder:TD.i("Enter words to match"),searchInputTitle:"matching",searchInputValue:e.content?e.content.matching:""},withExcluding:{isControl:!0,searchInputClassName:this.attr.excludingClass,searchInputPlaceholder:TD.i("Enter words to exclude"),searchInputTitle:"excluding",searchInputValue:e.content?e.content.excluding:""},withLanguage:i,withRetweetsToggle:!0,withFromList:i,withActionFilter:this.column.isActionsColumn(),withEngagementFilter:this.column.isSearchColumn()&&TD.decider.get("engagement_filter"),withAnimatedGifFilter:!this.column.isSearchColumn(),expandContentFilter:this.attr.expandContentFilter,expandUserFilter:this.attr.expandUserFilter,expandActionFilter:this.attr.expandActionFilter,expandEngagementFilter:this.attr.expandEngagementFilter}),n.attachTo(this.select("accordionSelector"),{column:this.column}),s&&this.renderThumbSizeSelector(),this.showColumnOptions()})}var i=t("flight/lib/component"),n=t("ui/alerts_form"),s=t("ui/with_accordion"),r=t("ui/with_search_filter"),o=t("ui/with_thumb_size_select"),a=t("ui/with_transitions"),c=t("scripts/UI/template");return i(e,s,r,o,a)}),define("td/UI/columns",["ui/column_options"],function(t){var e=window.TD||{};e.ui=e.ui||{},window.TD=e,e.ui.columns=function(){var i,n,s=350,r=500,o=200,a=20,c={},u={},h={},l="is-options-open",d="is-moving",m="is-focused",g=".is-focused",p="is-actionable",f="#container",w=".js-app-columns",v=".js-column-options",C=".js-column-scroller",b=".js-column",S=".js-column-header",T=".js-column-message",y=".js-detail-header",D=".js-chirp-container",A=".js-action-header-button",I=".is-minimalist",k="is-touch-tweet-container",E=150,R=function(t){return j.getColumnElementByKey(t).find(S)},F=function(t){var i=$(t.target).closest("[data-action]"),n=i.data("action"),s=i.parents(b),r=s.attr("data-column"),o=i.data("conversation-id"),a=i.data("account-key");switch(n){case"options":t.preventDefault(),s.hasClass(l)?j.exitEditMode(r):j.enterEditMode(r),t.stopPropagation();break;case"mark-all-read":e.controller.stats.messagesColumnHeaderClick("mark_all_read"),s.trigger("uiMarkAllMessagesRead",{columnKey:r});break;case"compose-dm":e.controller.stats.messagesColumnHeaderClick("compose"),s.trigger("uiComposeTweet",{type:"message",columnKey:r});break;case"user-filter":case"content-filter":case"action-filter":case"engagement-filter":j.enterEditMode(r,n);break;case"message-menu":s.trigger("uiShowConversationMenu",{conversationId:o,accountKey:a,columnKey:r,$targetElement:i}),t.stopPropagation();break;case"edit-list":t.preventDefault(),t.stopPropagation()}},M=function(t){var i=$(t.currentTarget),n=(i.data("action"),i.parents(b)),s=n.data("column");e.ui.columns.setColumnToTop(s)},x=function(){var t=$(this);return t.offset().top+this.offsetHeight>0&&t.offset().top<i.innerHeight()},O=function(){var t=e.ui.updates.findParentArticle($(this)),i=e.controller.columnManager.get(t.column),n=i.updateIndex[t.statusKey];t.element.replaceWith(n.render({isTemporary:i.temporary}))},P=_.debounce(function(t){t.find(I).filter(x).each(O)},E),U=function(t,i){var n,s,r=0;return function(o){e.util.isTouchDevice()&&e.util.cancelFastClick();var a=o.timeStamp||(new Date).getTime(),c=i.scrollTop();u[t]=c,P(i),a-r>200&&(r=a,s=o.currentTarget.scrollHeight,n=i.height());var h=(n+c)/s;if(h>.999){r=0;var l=e.controller.columnManager.get(t);l.fetchUpdatesFromPoller()}else 0===c&&(e.ui.columns.unlockColumnFromElement(t),i.trigger("uiReadStateChange",{read:!0}))}},L=function(t,e){var i=e.closest(".scroll-h"),s=100,r={direction:"",time:0};return function(o){var a,c=Math.abs(o.originalEvent.wheelDeltaX),h=Math.abs(o.originalEvent.wheelDeltaY),l=$(o.currentTarget);if(o.originalEvent.wheelDeltaY||o.originalEvent.wheelDeltaX){o.preventDefault();var d="";c>h?d="h":h>c&&(d="v"),d!==r.direction&&Date.now()<r.time+s||(r.direction=d,r.time=Date.now(),"v"===d?l.is(C)?(a=u[t]-o.originalEvent.wheelDeltaY,e.scrollTop(a),u[t]=e.scrollTop()):l.scrollTop(l.scrollTop()-o.originalEvent.wheelDeltaY):"h"===d&&i.scrollLeft(n.scrollLeft()-o.originalEvent.wheelDeltaX))}}},N=function(t,n){var s,r=function(i){var n=i.model,r=i.isMessageColumn(),o=i.hasActiveSearchFilters(),a=null;o&&(a={content:i.hasActiveContentFilters(),user:i.hasActiveUserFilters(),action:i.hasActiveActionFilters()&&!i.isSingleActionTypeColumn(),engagement:i.hasActiveEngagementFilters(),filterError:i.hasFilterError()});var c=!i.temporary&&i.isOwnCustomTimeline(),u={columnkey:n.getKey(),columntitle:t[s].getTitleHTML({editable:c}),columnclass:t[s].getClass(),columniconclass:t[s].getIconClass(),columnfilter:a,filterError:i.hasFilterError(),withEditableTitle:c,withMarkAllRead:r,withDMComposeButton:r,isTouchColumnOptions:Boolean(e.util.isTouchDevice()&&e.decider.get("touchdeck_column_options_v2"))};return e.ui.template.render("column",u)};if(n=Boolean(n))for(s=t.length-1;s>=0;s--)i.prepend(r(t[s])),j.setupColumn(t[s]);else for(s=0;s<t.length;s++)i.append(r(t[s])),j.setupColumn(t[s])},j={COLUMN_GLOW_DURATION:500,init:function(){i=$(w),n=$(f);var t=_.throttle(F,300);i.on("click",A+", "+T,t),i.on("click",S,M)},setupColumn:function(t){var i=t.model.getKey(),n=$(D+'[data-column="'+i+'"]').closest(C),s=$(b+'[data-column="'+i+'"]'),r=n.scrollTop(),o=U(i,n),a=L(i,n);$(document).trigger("uiColumnRendered",{column:t,$column:s}),e.util.isTouchDevice()&&e.decider.get("touchdeck_tweet_controls_v3")&&n.addClass(k),u[i]=r,c[i]=n,n.scroll(o),s.on("mousewheel onmousewheel",".scroll-v",a),s.on("mouseover",S,function(){var t=u[i];$(this).toggleClass(p,t>0)}),e.util.isTouchDevice()&&window.navigator.standalone&&s.on("touchmove",".scroll-v",function(t){t.stopPropagation()})},refreshTitle:function(t,i){var n,s,r,o=t.getIconClass(),a=t.model.getKey(),c=!t.temporary&&t.isOwnCustomTimeline(),u=i instanceof e.services.TwitterConversation,h=t.getTitleHTML({editable:c}),l=j.getColumnElementByKey(a),d=t.isMessageColumn();s=t.temporary&&t.getColumnType()===e.util.columnUtils.columnMetaTypes.SEARCH?e.i("results"):t.getDetailTitleHTML(),t.isMessageColumn()&&(r=t.unreadMessageCount()),n=e.ui.template.render("column/column_header",{columntitle:h,columniconclass:o,isTemporary:t.temporary,withEditableTitle:c,withImageAttribution:!0,withMarkAllRead:d,withDMComposeButton:d,unreadCount:"0"===r?null:r}),R(t.model.getKey()).replaceWith(n),n=e.ui.template.render("column/column_header_detail",{headerClass:"js-detail-header",headerAction:"resetToTopColumn",headerLinkClass:"js-column-back",getConversationTitleInformation:u&&function(){var t=i.getConversationTitleInformation();return t.name=i.name&&e.util.transform(i.name),t.participants=i.participants,t},withConversationMenu:i instanceof e.services.TwitterConversation,columntitle:s,conversationId:u&&i.conversationId,accountKey:u&&i.account.getKey()}),l.find(y).replaceWith(n),l.trigger("uiColumnTitleRefreshed",{columnKey:a})},setColumnToTop:function(t){var e,i=c[t],n=10,r=u[t],o=250,a=function(){var s=Math.max(r-o,0);r-=o,i.scrollTop(s),u[t]=s,s>0?setTimeout(a,n):(i.trigger("uiReadStateChange",{read:!0}),e=R(t),e.toggleClass(p,i.scrollTop>0))};r*n/o>s&&(o=r*n/s),a()},enterEditMode:function(i,n){var s,r=e.controller.columnManager.get(i),o=j.getColumnElementByKey(i);o.length&&!o.hasClass(l)&&(o.addClass(l),s=$(v,o),t.attachTo(s,{column:r,expandContentFilter:"content-filter"===n,expandUserFilter:"user-filter"===n,expandActionFilter:"action-filter"===n,expandEngagementFilter:"engagement-filter"===n,columnType:r.getColumnType()}))},exitEditMode:function(t){var e=j.getColumnElementByKey(t),i=$(v,e);e.hasClass(l)&&(e.removeClass(l),i.trigger("uiColumnOptionsCloseAction"))},isScrolledToTop:function(t){var e=c[t];return e?0===u[t]:!0},alterColumnContents:function(t,e,i,n){if(n=n||{},e&&0!==e.length){var s,r,o=h[t],a=0;if("boolean"==typeof n.willBreakScrollPosition)s=n.willBreakScrollPosition;else{var c=o?o.position().top:a;s=e.position().top<c}s&&(r=this.cacheColumnScrollPosition(t));var u=i(e);return s&&r(),u}},cacheColumnScrollPosition:function(t){var e=c[t];if(!e)return function(){};var i=u[t],n=e[0].scrollHeight-i;return function(){var i;i=e[0].scrollHeight-n,e.scrollTop(i),u[t]=i,0===i&&P(e)}},lockColumnToElement:function(t,e){h[t]=e},unlockColumnFromElement:function(t){delete h[t]},columnIsLockedToElement:function(t){return!!h[t]},addColumnsToView:function(t){N(t),$(D).show()},removeColumn:function(t){var e=j.getColumnElementByKey(t);e.trigger("uiRemoveColumn"),e.remove(),delete u[t],delete c[t]},calculateScrollDuration:function(t,e,i){i=i||r,e=e||a;var n=o+t/100*e;return n=Math.min(n,i)},getLeftmostColumn:function(){var t=null;return i.children(b).each(function(){t||($(this).position().left<10&&$(this).position().left>=0?t=this:$(this).position().left>10&&(t=$(this).prev()))}),$(t)},focusColumn:function(t,n){$(g,i).removeClass(m),j.getColumnElementByKey(t).addClass(m),_.isNumber(n)&&_.delay(function(){e.ui.columns.unfocusColumn(t)},n)},unfocusColumn:function(t){j.getColumnElementByKey(t).removeClass(m)},setMovingColumn:function(t){j.getColumnElementByKey(t).addClass(d)},getColumnElementByKey:function(t){return $(b+'[data-column="'+t+'"]')}};return j}()}),define("ui/compose/with_character_limit",[],function(){return function(){this.attributes({maxCharCount:140}),this.getRemainingCharCount=function(t){return this.attr.maxCharCount-t},this.isWithinCharLimit=function(t){return t<=this.attr.maxCharCount&&t>0},this.isOverCharLimit=function(t){return t>this.attr.maxCharCount}}}),define("with-resources",[],function(){"use strict";function t(t){return function(){return t}}function e(){this.before("initialize",function(){this.withResourcesLocalRegistry=[]}),this.after("teardown",function(){this.withResourcesLocalRegistry.forEach(function(t){delete i[t]})}),this.provideResource=function(e,n){if("string"!=typeof e)throw new Error("Resource name must be a string.");if(i[e])throw new Error("Resource already registered.");this.withResourcesLocalRegistry.push(e),i[e]=("function"==typeof n?n:t(n)).bind(this)},this.requestResource=function(t,e){if("string"!=typeof t)throw new Error("Resource name not provided.");if(!i[t])throw new Error("Resource not registered");return i[t](e||{})},this.removeResource=function(t){if("string"!=typeof t)throw new Error("Resource name not provided.");this.withResourcesLocalRegistry=this.withResourcesLocalRegistry.filter(function(e){return t!==e}),delete i[t]}}var i={};return e}),define("util/observable_utils",[],function(){var t={};return t.anyKeysHaveChanged=function(){return function(t,e){return!Object.keys(t).some(function(i){return e[i]!==t[i]})}},t.filterKeys=function(t){return function(e){return t?t.reduce(function(t,i){return t[i]=e[i],t},{}):e}},t}),define("util/with_observe_state",["require","util/observable_utils"],function(t){"use strict";function e(){this.after("initialize",function(){this._localConnections=[]}),this.observe=function(t){var e=t.publishValue();return this._localConnections.push(e.connect()),e},this.observeState=function(t,e){var n=this.observe(t),s=e?i.filterKeys(e):function(t){return t};return n.map(s).distinctUntilChanged(void 0,i.anyKeysHaveChanged())},this.before("teardown",function(){this._localConnections.forEach(function(t){t.dispose()})})}var i=t("util/observable_utils");return e}),define("ui/compose/character_count",["require","flight/lib/component","ui/compose/with_character_limit","with-resources","util/with_observe_state"],function(t){function e(){this.attributes({characterCountInvalidClass:"invalid-char-count",stateSource:null}),this.after("initialize",function(t){this.observeState(this.requestResource(this.attr.stateSource),["characterCount"]).subscribeOnNext(this.render,this)}),this.render=function(t){this.$node.val(this.getRemainingCharCount(t.characterCount)),this.$node.toggleClass(this.attr.characterCountInvalidClass,this.isOverCharLimit(t.characterCount))}}var i=t("flight/lib/component"),n=t("ui/compose/with_character_limit"),s=t("with-resources"),r=t("util/with_observe_state");return i(r,e,n,s)}),define("util/tweet_utils",[],function(){var t={};return t.atMentionify=function(t){return TD.util.atMentionify(t)},t.deMentionify=function(t){return TD.util.deMentionify(t)},t.getTweetLength=function(t){return twttr.txt.getTweetLength(t)},t.extractMentions=function(t){return twttr.txt.extractMentions(t)},t.removeFirstMention=function(t){var e,i=twttr.txt.extractMentionsWithIndices(t);return i.length&&(e=i[0].indices,t=t.substring(0,e[0]).trim()+t.substring(e[1])),t},t}),define("ui/with_focusable_field",[],function(){var t=function(){this.attributes({focusableSelector:"textarea, input"}),this.after("initialize",function(){var t=this.select("focusableSelector");this.on(t,"focus",function(){TD.decider.get("touchdeck_compose_v2")&&(window.scrollTo(0,0),document.body.scrollTop=0)})})};return t}),define("ui/compose/with_compose_text",["require","flight/lib/compose","util/tweet_utils","ui/with_focusable_field"],function(t){var e=t("flight/lib/compose"),i=t("util/tweet_utils"),n=t("ui/with_focusable_field");return function(){e.mixin(this,[n]);var t="",s=!1,r=[],o=[],a=function(t){var e={};return t.map(function(t){return t.filter(function(t){var i=t.toLowerCase(),n=e[i];return e[i]=!0,!n})})};this.attributes({composeTextSelector:".js-compose-text",withAutoComplete:!0}),this.after("initialize",function(){this.on("uiRemoveInReplyTo",this.removeReplyStack),this.before("setupDOM",this.destroyAutoComplete),this.before("teardown",this.destroyAutoComplete),this.after("mergeState",this.composeTextCheckMaxRecipients)}),this.after("setupDOM",function(){this.$composeTextInput=this.select("composeTextSelector"),this.on(this.$composeTextInput,"input propertychange change",this.composeTextHandleChange),this.on(this.$composeTextInput,"blur",this.handleTextInputBlur),this.on("uiRequestComposeTextFocus",function(){(!TD.util.isiOSDevice()||!TD.decider.get("touchdeck_compose_v2"))&&this.composeTextSetFocus()}),this.attr.withAutoComplete&&(this.textAutoComplete=new TD.components.Autocomplete(this.$composeTextInput))}),this.composeTextCheckMaxRecipients=function(){var t="message"===this.state.tweetType,e=this.state.messageRecipients&&this.state.messageRecipients.length>=this.attr.maxRecipients,i=!!this.state.messageConversation;t&&(e||i)&&this.composeTextSetFocus()},this.composeTextGetText=function(){return this.state.quotedTweet?this.$composeTextInput.val()+" "+this.state.quotedTweet.getChirpURL():this.$composeTextInput.val()},this.composeTextSetFocus=function(){this.$composeTextInput.focus()},this.composeTextBlur=function(){this.$composeTextInput.blur()},this.composeTextSetText=function(t){this.$composeTextInput.val()!==t&&(this.$composeTextInput.val(t),this.composeTextHandleChange())},this.composeTextAppendText=function(t){var e=this.$composeTextInput.val();this.composeTextSetText((e&&e.trim()+" ")+t)},this.composeTextPrependText=function(t){this.composeTextSetText(t+" "+this.composeTextGetText())},this.composeTextSetDisabled=function(t){this.$composeTextInput.prop("disabled",t)},this.composeTextIsEmpty=function(){return""===this.$composeTextInput.val()},this.composeTextSetCaret=function(t){var e=this.$composeTextInput;e[0].selectionStart=e[0].selectionEnd=t,e.focus()},this.composeTextSetCaretToEnd=function(){this.composeTextSetCaret(this.$composeTextInput.val().length)},this.composeTextSetSelection=function(t,e){var i=this.$composeTextInput[0];i.selectionStart=t,i.selectionEnd=e,setTimeout(function(){i.selectionStart=t,i.selectionEnd=e},70),this.$composeTextInput.focus()},this.composeTextSetHeight=function(t){this.$composeTextInput.css({height:t})},this.removeReplyStack=function(e){e.stopPropagation();var i=this.composeTextGetReplyText();this.composeTextSetText(i.trim()),r=[],o=[],s=!1,t=""},this.composeTextReset=function(){this.composeTextSetText(""),r=[],o=[],s=!1,t=""},this.composeTextSetRepliesAndMentions=function(t,e,i){var n=this.composeTextComputeRepliesAndMentions(t,e,i);this.composeTextSetText(n.totalString),this.composeTextSetSelection(n.startIndex,n.endIndex)},this.composeTextComputeRepliesAndMentions=function(e,n,a){return e=e.map(i.atMentionify),n=n.map(i.atMentionify),a=a&&i.atMentionify(a),a&&(n=n.filter(function(t){return t.toLowerCase()!==a.toLowerCase()}),a===e[0]&&n.length>0&&(e=[n.shift()])),e=e.map(i.atMentionify),n=n.map(i.atMentionify),s===!1&&(s=this.$composeTextInput.val()),this.composeTextIsStacking()&&this.composeTextHasLostStackingState()&&(r=[],o=[],t=this.$composeTextInput.val(),s=""),this.composeTextGetReplyStack(e,n)},this.composeTextHandleChange=function(){this.trigger("uiComposeTextChanged",{value:this.$composeTextInput.val()})},this.handleTextInputBlur=function(){this.trigger("uiComposeTextBlur")},this.composeTextIsStacking=function(){return r.length+o.length>0},this.composeTextGenerateReplyStack=function(t,e,i){var n,r,o,a=t.join(" "),c=e.join(" "),u=[];return i&&(i=i.replace(/ $/,""),u.push(i)),a&&u.push(a),s&&u.push(s),c&&u.push(c),n=u.join(" ").trim()+" ",r=c?n.length-c.length-1:n.length,o=n.length,{totalString:n,startIndex:r,endIndex:o}},this.composeTextGetReplyText=function(){var t=o.concat(r);return this.$composeTextInput.val().split(" ").filter(function(e){return t.indexOf(e)<0}).join(" ")},this.composeTextHasLostStackingState=function(){var e=this.composeTextGenerateReplyStack(r,o,t);return e.totalString!==this.$composeTextInput.val()||e.startIndex!==this.$composeTextInput[0].selectionStart||e.endIndex!==this.$composeTextInput[0].selectionEnd},this.composeTextGetReplyStack=function(e,i){var n;return this.composeTextIsStacking()&&this.trigger("uiComposeStackReply"),r=r.concat(e),o=o.concat(i),n=a([r,o]),r=n[0],o=n[1],this.composeTextGenerateReplyStack(r,o,t)},this.destroyAutoComplete=function(){this.textAutoComplete&&(this.textAutoComplete.destroy(),this.textAutoComplete=null)}}}),define("with-child-components",[],function(){"use strict";function t(){var t=this.attrDef?this.attributes:this.defaultAttrs;t.call(this,{teardownOn:""}),this.after("initialize",function(){if(this.attr.teardownOn){if(this.attr.teardownOn===this.childTeardownEvent)throw new Error("Component initialized to listen for its own teardown event.");this.on(document,this.attr.teardownOn,function(){this.teardown()})}})}function e(){this.before("initialize",function(){this.childTeardownEvent=this.childTeardownEvent||e.nextTeardownEvent()}),this.before("teardown",function(){this.trigger(this.childTeardownEvent)}),this.attachChild=function(e,i,n){n=n||{},n.teardownOn||(n.teardownOn=this.childTeardownEvent);var s=e.prototype.mixedIn||[],r=s.indexOf(t)>-1?!0:!1;(r?e:e.mixin(t)).attachTo(i,n)}}var i=0;return e.nextTeardownEvent=function(){return i+=1,"_teardownEvent"+i},e.withBoundLifecycle=t,e}),function(t){function e(t){if(t.isDisposed)throw new Error(ct)}function n(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(t[i]);return e}function r(t,e){if(ut&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(mt)){for(var i=[],n=e;n;n=n.source)n.stack&&i.unshift(n.stack);i.unshift(t.stack);var s=i.join("\n"+mt+"\n");t.stack=o(s)}}function o(t){for(var e=t.split("\n"),i=[],n=0,s=e.length;s>n;n++){var r=e[n];a(r)||c(r)||!r||i.push(r)}return i.join("\n")}function a(t){var e=h(t);if(!e)return!1;var i=e[0],n=e[1];return i===lt&&n>=dt&&oi>=n}function c(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function u(){if(ut)try{throw new Error}catch(t){var e=t.stack.split("\n"),i=e[0].indexOf("@")>0?e[1]:e[2],n=h(i);if(!n)return;return lt=n[0],n[1]}}function h(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var i=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(i)return[i[1],Number(i[2])];var n=/.*@(.+):(\d+)$/.exec(t);return n?[n[1],Number(n[2])]:void 0}function l(t){var e=[];if(!qt(t))return e;jt.nonEnumArgs&&t.length&&Bt(t)&&(t=Ht.call(t));var i=jt.enumPrototypes&&"function"==typeof t,n=jt.enumErrorProps&&(t===Ot||t instanceof Error);for(var s in t)i&&"prototype"==s||n&&("message"==s||"name"==s)||e.push(s);if(jt.nonEnumShadows&&t!==Pt){var r=t.constructor,o=-1,a=St;if(t===(r&&r.prototype))var c=t===Ut?Ft:t===Ot?At:Mt.call(t),u=Nt[c];for(;++o<a;)s=bt[o],u&&u[s]||!xt.call(t,s)||e.push(s)}return e}function d(t,e,i){for(var n=-1,s=i(t),r=s.length;++n<r;){var o=s[n];if(e(t[o],o,t)===!1)break}return t}function m(t,e){return d(t,e,l)}function g(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function p(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;var s=typeof t,r=typeof e;if(t===t&&(null==t||null==e||"function"!=s&&"object"!=s&&"function"!=r&&"object"!=r))return!1;var o=Mt.call(t),a=Mt.call(e);if(o==Tt&&(o=Et),a==Tt&&(a=Et),o!=a)return!1;switch(o){case _t:case Dt:return+t==+e;case kt:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case Rt:case Ft:return t==String(e)}var c=o==yt;if(!c){if(o!=Et||!jt.nodeClass&&(g(t)||g(e)))return!1;var u=!jt.argsObject&&Bt(t)?Object:t.constructor,h=!jt.argsObject&&Bt(e)?Object:e.constructor;if(!(u==h||xt.call(t,"constructor")&&xt.call(e,"constructor")||ot(u)&&u instanceof u&&ot(h)&&h instanceof h)&&"constructor"in t&&"constructor"in e)return!1}i||(i=[]),n||(n=[]);for(var l=i.length;l--;)if(i[l]==t)return n[l]==e;var d=0,f=!0;if(i.push(t),n.push(e),c){if(l=t.length,d=e.length,f=d==l)for(;d--;){var w=e[d];if(!(f=p(t[d],w,i,n)))break}}else m(e,function(e,s,r){return xt.call(r,s)?(d++,f=xt.call(t,s)&&p(t[s],e,i,n)):void 0}),f&&m(t,function(t,e,i){return xt.call(i,e)?f=--d>-1:void 0});return i.pop(),n.pop(),f}function f(t,e){for(var i=new Array(t),n=0;t>n;n++)i[n]=e();return i}function w(t,e){this.id=t,this.value=e}function v(){this._s=s}function C(){this._s=s,this._l=s.length,this._i=0}function b(t){this._a=t}function S(t){this._a=t,this._l=D(t),this._i=0}function T(t){return"number"==typeof t&&W.isFinite(t)}function y(e){var i,n=e[gt];if(!n&&"string"==typeof e)return i=new v(e),i[gt]();if(!n&&e.length!==t)return i=new b(e),i[gt]();if(!n)throw new TypeError("Object is not iterable");return e[gt]()}function _(t){var e=+t;return 0===e?e:isNaN(e)?e:0>e?-1:1}function D(t){var e=+t.length;return isNaN(e)?0:0!==e&&T(e)?(e=_(e)*Math.floor(Math.abs(e)),0>=e?0:e>Fe?Fe:e):e}function A(t,e){return Z(t)||(t=ae),new Je(function(i){var n=0,s=e.length;return t.scheduleRecursive(function(t){s>n?(i.onNext(e[n++]),t()):i.onCompleted()})})}function I(t,e){return new Je(function(i){var n=new te,s=new ee;return s.setDisposable(n),n.setDisposable(t.subscribe(i.onNext.bind(i),function(t){var n,r;try{r=e(t)}catch(o){return void i.onError(o)}rt(r)&&(r=ze(r)),n=new te,s.setDisposable(n),n.setDisposable(r.subscribe(i))},i.onCompleted.bind(i))),s},t)}function k(t,e){var i=this;return new Je(function(n){var s=0,r=t.length;return i.subscribe(function(i){if(r>s){var o,a=t[s++];try{o=e(i,a)}catch(c){return n.onError(c)}n.onNext(o)}else n.onCompleted()},function(t){n.onError(t)},function(){n.onCompleted()})},i)}function E(){return!1}function R(){return[]}function F(t,e,i){var n=Ct(e,i,3);return t.map(function(e,i){var s=n(e,i,t);return rt(s)&&(s=ze(s)),(wt(s)||ft(s))&&(s=Me(s)),s}).concatAll()}function M(t,e,i){this.observer=t,this.selector=e,this.source=i,this.index=0,this.isStopped=!1}function x(t,e,i){var n=Ct(e,i,3);return t.map(function(e,i){var s=n(e,i,t);return rt(s)&&(s=ze(s)),(wt(s)||ft(s))&&(s=Me(s)),s}).mergeAll()}function $(t,e,i){this.observer=t,this.predicate=e,this.source=i,this.index=0,this.isStopped=!1}function O(t,e,i){if(t.addEventListener)return t.addEventListener(e,i,!1),Jt(function(){t.removeEventListener(e,i,!1)});throw new Error("No listener found")}function P(t,e,i){var n=new Yt;if("[object NodeList]"===Object.prototype.toString.call(t))for(var s=0,r=t.length;r>s;s++)n.add(P(t.item(s),e,i));else t&&n.add(O(t,e,i));return n}function U(t,e){return new Je(function(i){return e.scheduleWithAbsolute(t,function(){i.onNext(0),i.onCompleted()})})}function L(t,e,i){return new Je(function(n){var s=t,r=se(e);return i.scheduleRecursiveWithAbsoluteAndState(0,s,function(t,e){if(r>0){var o=i.now();s+=r,o>=s&&(s=o+r)}n.onNext(t),e(t+1,s)})})}function N(t,e){return new Je(function(i){return e.scheduleWithRelative(se(t),function(){i.onNext(0),i.onCompleted()})})}function j(t,e,i){return t===e?new Je(function(t){return i.schedulePeriodicWithState(0,e,function(e){return t.onNext(e),e+1})}):Ee(function(){return L(i.now()+t,e,i)})}function q(t,e,i){return new Je(function(n){var s,r=!1,o=new ee,a=null,c=[],u=!1;return s=t.materialize().timestamp(i).subscribe(function(t){var s,h;"E"===t.value.kind?(c=[],c.push(t),a=t.value.exception,h=!u):(c.push({value:t.value,timestamp:t.timestamp+e}),h=!r,r=!0),h&&(null!==a?n.onError(a):(s=new te,o.setDisposable(s),s.setDisposable(i.scheduleRecursiveWithRelative(e,function(t){var e,s,o,h;if(null===a){u=!0;do o=null,c.length>0&&c[0].timestamp-i.now()<=0&&(o=c.shift().value),null!==o&&o.accept(n);while(null!==o);h=!1,s=0,c.length>0?(h=!0,s=Math.max(0,c[0].timestamp-i.now())):r=!1,e=a,u=!1,null!==e?n.onError(e):h&&t(s)}}))))}),new Yt(s,o)},t)}function B(t,e,i){return Ee(function(){return q(t,e-i.now(),i)})}function K(t,e){return new Je(function(i){function n(){o&&(o=!1,i.onNext(r)),s&&i.onCompleted()}var s,r,o;return new Yt(t.subscribe(function(t){o=!0,r=t},i.onError.bind(i),function(){s=!0}),e.subscribe(n,i.onError.bind(i),n))},t)}function H(t,e,i){return new Je(function(n){function s(t,e){u[e]=t;var s;if(o[e]=!0,a||(a=o.every(tt))){if(r)return void n.onError(r);try{s=i.apply(null,u)}catch(h){return void n.onError(h)}n.onNext(s)}c&&u[1]&&n.onCompleted()}var r,o=[!1,!1],a=!1,c=!1,u=new Array(2);return new Yt(t.subscribe(function(t){s(t,0)},function(t){u[1]?n.onError(t):r=t},function(){c=!0,u[1]&&n.onCompleted()}),e.subscribe(function(t){s(t,1)},function(t){n.onError(t)},function(){c=!0,s(!0,1)}))},t)}var z={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},W=z[typeof window]&&window||this,V=z[typeof exports]&&exports&&!exports.nodeType&&exports,G=z[typeof module]&&module&&!module.nodeType&&module,Y=G&&G.exports===V&&V,Q=z[typeof global]&&global;!Q||Q.global!==Q&&Q.window!==Q||(W=Q);var X={internals:{},config:{Promise:W.Promise},helpers:{}},J=X.helpers.noop=function(){},Z=(X.helpers.notDefined=function(t){
return"undefined"==typeof t},X.helpers.isScheduler=function(t){return t instanceof X.Scheduler}),tt=X.helpers.identity=function(t){return t},et=(X.helpers.pluck=function(t){return function(e){return e[t]}},X.helpers.just=function(t){return function(){return t}},X.helpers.defaultNow=Date.now),it=X.helpers.defaultComparer=function(t,e){return Kt(t,e)},nt=X.helpers.defaultSubComparer=function(t,e){return t>e?1:e>t?-1:0},st=(X.helpers.defaultKeySerializer=function(t){return t.toString()},X.helpers.defaultError=function(t){throw t}),rt=X.helpers.isPromise=function(t){return!!t&&"function"==typeof t.then},ot=(X.helpers.asArray=function(){return Array.prototype.slice.call(arguments)},X.helpers.not=function(t){return!t},X.helpers.isFunction=function(){var t=function(t){return"function"==typeof t||!1};return t(/x/)&&(t=function(t){return"function"==typeof t&&"[object Function]"==Mt.call(t)}),t}()),at="Argument out of range",ct="Object has been disposed";X.config.longStackSupport=!1;var ut=!1;try{throw new Error}catch(ht){ut=!!ht.stack}var lt,dt=u(),mt="From previous event:",gt="function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_";W.Set&&"function"==typeof(new W.Set)["@@iterator"]&&(gt="@@iterator");var pt=X.doneEnumerator={done:!0,value:t},ft=X.helpers.isIterable=function(e){return e[gt]!==t},wt=X.helpers.isArrayLike=function(e){return e&&e.length!==t};X.helpers.iterator=gt;var vt,Ct=X.internals.bindCallback=function(t,e,i){if("undefined"==typeof e)return t;switch(i){case 0:return function(){return t.call(e)};case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,s){return t.call(e,i,n,s)}}return function(){return t.apply(e,arguments)}},bt=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],St=bt.length,Tt="[object Arguments]",yt="[object Array]",_t="[object Boolean]",Dt="[object Date]",At="[object Error]",It="[object Function]",kt="[object Number]",Et="[object Object]",Rt="[object RegExp]",Ft="[object String]",Mt=Object.prototype.toString,xt=Object.prototype.hasOwnProperty,$t=Mt.call(arguments)==Tt,Ot=Error.prototype,Pt=Object.prototype,Ut=String.prototype,Lt=Pt.propertyIsEnumerable;try{vt=Mt.call(document)!=Et||!!({toString:0}+"")}catch(ht){vt=!0}var Nt={};Nt[yt]=Nt[Dt]=Nt[kt]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Nt[_t]=Nt[Ft]={constructor:!0,toString:!0,valueOf:!0},Nt[At]=Nt[It]=Nt[Rt]={constructor:!0,toString:!0},Nt[Et]={constructor:!0};var jt={};!function(){var t=function(){this.x=1},e=[];t.prototype={valueOf:1,y:1};for(var i in new t)e.push(i);for(i in arguments);jt.enumErrorProps=Lt.call(Ot,"message")||Lt.call(Ot,"name"),jt.enumPrototypes=Lt.call(t,"prototype"),jt.nonEnumArgs=0!=i,jt.nonEnumShadows=!/valueOf/.test(e)}(1);var qt=X.internals.isObject=function(t){var e=typeof t;return t&&("function"==e||"object"==e)||!1},Bt=function(t){return t&&"object"==typeof t?Mt.call(t)==Tt:!1};$t||(Bt=function(t){return t&&"object"==typeof t?xt.call(t,"callee"):!1});var Kt=X.internals.isEqual=function(t,e){return p(t,e,[],[])},Ht=({}.hasOwnProperty,Array.prototype.slice),zt=this.inherits=X.internals.inherits=function(t,e){function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i},Wt=X.internals.addProperties=function(t){for(var e=[],i=1,n=arguments.length;n>i;i++)e.push(arguments[i]);for(var s=0,r=e.length;r>s;s++){var o=e[s];for(var a in o)t[a]=o[a]}};X.internals.addRef=function(t,e){return new Je(function(i){return new Yt(e.getDisposable(),t.subscribe(i))})},w.prototype.compareTo=function(t){var e=this.value.compareTo(t.value);return 0===e&&(e=this.id-t.id),e};var Vt=X.internals.PriorityQueue=function(t){this.items=new Array(t),this.length=0},Gt=Vt.prototype;Gt.isHigherPriority=function(t,e){return this.items[t].compareTo(this.items[e])<0},Gt.percolate=function(t){if(!(t>=this.length||0>t)){var e=t-1>>1;if(!(0>e||e===t)&&this.isHigherPriority(t,e)){var i=this.items[t];this.items[t]=this.items[e],this.items[e]=i,this.percolate(e)}}},Gt.heapify=function(t){if(+t||(t=0),!(t>=this.length||0>t)){var e=2*t+1,i=2*t+2,n=t;if(e<this.length&&this.isHigherPriority(e,n)&&(n=e),i<this.length&&this.isHigherPriority(i,n)&&(n=i),n!==t){var s=this.items[t];this.items[t]=this.items[n],this.items[n]=s,this.heapify(n)}}},Gt.peek=function(){return this.items[0].value},Gt.removeAt=function(e){this.items[e]=this.items[--this.length],this.items[this.length]=t,this.heapify()},Gt.dequeue=function(){var t=this.peek();return this.removeAt(0),t},Gt.enqueue=function(t){var e=this.length++;this.items[e]=new w(Vt.count++,t),this.percolate(e)},Gt.remove=function(t){for(var e=0;e<this.length;e++)if(this.items[e].value===t)return this.removeAt(e),!0;return!1},Vt.count=0;var Yt=X.CompositeDisposable=function(){var t=[];if(Array.isArray(arguments[0]))t=arguments[0];else for(var e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);this.disposables=t,this.isDisposed=!1,this.length=this.disposables.length},Qt=Yt.prototype;Qt.add=function(t){this.isDisposed?t.dispose():(this.disposables.push(t),this.length++)},Qt.remove=function(t){var e=!1;if(!this.isDisposed){var i=this.disposables.indexOf(t);-1!==i&&(e=!0,this.disposables.splice(i,1),this.length--,t.dispose())}return e},Qt.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var t=[],e=0,i=this.disposables.length;i>e;e++)t.push(this.disposables[e]);for(this.disposables=[],this.length=0,e=0,i=t.length;i>e;e++)t[e].dispose()}},Qt.toArray=function(){for(var t=[],e=this.disposables.length;e>i;i++)t.push(this.disposables[i]);return t};var Xt=X.Disposable=function(t){this.isDisposed=!1,this.action=t||J};Xt.prototype.dispose=function(){this.isDisposed||(this.action(),this.isDisposed=!0)};var Jt=Xt.create=function(t){return new Xt(t)},Zt=Xt.empty={dispose:J},te=X.SingleAssignmentDisposable=function(){function t(){this.isDisposed=!1,this.current=null}var e=t.prototype;return e.getDisposable=function(){return this.current},e.setDisposable=function(t){var e=this.isDisposed;if(!e){var i=this.current;this.current=t}i&&i.dispose(),e&&t&&t.dispose()},e.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var t=this.current;this.current=null}t&&t.dispose()},t}(),ee=X.SerialDisposable=te,ie=(X.RefCountDisposable=function(){function t(t){this.disposable=t,this.disposable.count++,this.isInnerDisposed=!1}function e(t){this.underlyingDisposable=t,this.isDisposed=!1,this.isPrimaryDisposed=!1,this.count=0}return t.prototype.dispose=function(){this.disposable.isDisposed||this.isInnerDisposed||(this.isInnerDisposed=!0,this.disposable.count--,0===this.disposable.count&&this.disposable.isPrimaryDisposed&&(this.disposable.isDisposed=!0,this.disposable.underlyingDisposable.dispose()))},e.prototype.dispose=function(){this.isDisposed||this.isPrimaryDisposed||(this.isPrimaryDisposed=!0,0===this.count&&(this.isDisposed=!0,this.underlyingDisposable.dispose()))},e.prototype.getDisposable=function(){return this.isDisposed?Zt:new t(this)},e}(),X.internals.ScheduledItem=function(t,e,i,n,s){this.scheduler=t,this.state=e,this.action=i,this.dueTime=n,this.comparer=s||nt,this.disposable=new te});ie.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())},ie.prototype.compareTo=function(t){return this.comparer(this.dueTime,t.dueTime)},ie.prototype.isCancelled=function(){return this.disposable.isDisposed},ie.prototype.invokeCore=function(){return this.action(this.scheduler,this.state)};var ne=X.Scheduler=function(){function t(t,e,i,n){this.now=t,this._schedule=e,this._scheduleRelative=i,this._scheduleAbsolute=n}function e(t,e){return e(),Zt}var i=t.prototype;return i.schedule=function(t){return this._schedule(t,e)},i.scheduleWithState=function(t,e){return this._schedule(t,e)},i.scheduleWithRelative=function(t,i){return this._scheduleRelative(i,t,e)},i.scheduleWithRelativeAndState=function(t,e,i){return this._scheduleRelative(t,e,i)},i.scheduleWithAbsolute=function(t,i){return this._scheduleAbsolute(i,t,e)},i.scheduleWithAbsoluteAndState=function(t,e,i){return this._scheduleAbsolute(t,e,i)},t.now=et,t.normalize=function(t){return 0>t&&(t=0),t},t}(),se=ne.normalize;!function(t){function e(t,e){var i=e.first,n=e.second,s=new Yt,r=function(e){n(e,function(e){var i=!1,n=!1,o=t.scheduleWithState(e,function(t,e){return i?s.remove(o):n=!0,r(e),Zt});n||(s.add(o),i=!0)})};return r(i),s}function i(t,e,i){var n=e.first,s=e.second,r=new Yt,o=function(e){s(e,function(e,n){var s=!1,a=!1,c=t[i](e,n,function(t,e){return s?r.remove(c):a=!0,o(e),Zt});a||(r.add(c),s=!0)})};return o(n),r}function n(t,e){t(function(i){e(t,i)})}t.scheduleRecursive=function(t){return this.scheduleRecursiveWithState(t,function(t,e){t(function(){e(t)})})},t.scheduleRecursiveWithState=function(t,i){return this.scheduleWithState({first:t,second:i},e)},t.scheduleRecursiveWithRelative=function(t,e){return this.scheduleRecursiveWithRelativeAndState(e,t,n)},t.scheduleRecursiveWithRelativeAndState=function(t,e,n){return this._scheduleRelative({first:t,second:n},e,function(t,e){return i(t,e,"scheduleWithRelativeAndState")})},t.scheduleRecursiveWithAbsolute=function(t,e){return this.scheduleRecursiveWithAbsoluteAndState(e,t,n)},t.scheduleRecursiveWithAbsoluteAndState=function(t,e,n){return this._scheduleAbsolute({first:t,second:n},e,function(t,e){return i(t,e,"scheduleWithAbsoluteAndState")})}}(ne.prototype),function(){ne.prototype.schedulePeriodic=function(t,e){return this.schedulePeriodicWithState(null,t,e)},ne.prototype.schedulePeriodicWithState=function(t,e,i){if("undefined"==typeof W.setInterval)throw new Error("Periodic scheduling not supported.");var n=t,s=W.setInterval(function(){n=i(n)},e);return Jt(function(){W.clearInterval(s)})}}(ne.prototype);var re,oe=ne.immediate=function(){function t(t,e){return e(this,t)}function e(t,e,i){for(var n=this.now()+se(e);n-this.now()>0;);return i(this,t)}function i(t,e,i){return this.scheduleWithRelativeAndState(t,e-this.now(),i)}return new ne(et,t,e,i)}(),ae=ne.currentThread=function(){function t(t){for(;t.length>0;){var e=t.dequeue();if(!e.isCancelled()){for(;e.dueTime-ne.now()>0;);!e.isCancelled()&&e.invoke()}}}function e(t,e){return this.scheduleWithRelativeAndState(t,0,e)}function i(e,i,n){var r=this.now()+ne.normalize(i),o=new ie(this,e,n,r);if(s)s.enqueue(o);else{s=new Vt(4),s.enqueue(o);try{t(s)}catch(a){throw a}finally{s=null}}return o.disposable}function n(t,e,i){return this.scheduleWithRelativeAndState(t,e-this.now(),i)}var s,r=new ne(et,e,i,n);return r.scheduleRequired=function(){return!s},r.ensureTrampoline=function(t){s?t():this.schedule(t)},r}(),ce=(X.internals.SchedulePeriodicRecursive=function(){function t(t,e){e(0,this._period);try{this._state=this._action(this._state)}catch(i){throw this._cancel.dispose(),i}}function e(t,e,i,n){this._scheduler=t,this._state=e,this._period=i,this._action=n}return e.prototype.start=function(){var e=new te;return this._cancel=e,e.setDisposable(this._scheduler.scheduleRecursiveWithRelativeAndState(0,this._period,t.bind(this))),e},e}(),J),ue=function(){var t,e=J;if("WScript"in this)t=function(t,e){WScript.Sleep(e),t()};else{if(!W.setTimeout)throw new Error("No concurrency detected!");t=W.setTimeout,e=W.clearTimeout}return{setTimeout:t,clearTimeout:e}}(),he=ue.setTimeout,le=ue.clearTimeout;!function(){function t(){if(!W.postMessage||W.importScripts)return!1;var t=!1,e=W.onmessage;return W.onmessage=function(){t=!0},W.postMessage("","*"),W.onmessage=e,t}var e=RegExp("^"+String(Mt).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),i="function"==typeof(i=Q&&Y&&Q.setImmediate)&&!e.test(i)&&i,n="function"==typeof(n=Q&&Y&&Q.clearImmediate)&&!e.test(n)&&n;if("function"==typeof i)re=i,ce=n;else if("undefined"!=typeof process&&"[object process]"==={}.toString.call(process))re=process.nextTick;else if(t()){var s="ms.rx.schedule"+Math.random(),r={},o=0,a=function(t){if("string"==typeof t.data&&t.data.substring(0,s.length)===s){var e=t.data.substring(s.length),i=r[e];i(),delete r[e]}};W.addEventListener?W.addEventListener("message",a,!1):W.attachEvent("onmessage",a,!1),re=function(t){var e=o++;r[e]=t,W.postMessage(s+e,"*")}}else if(W.MessageChannel){var c=new W.MessageChannel,u={},h=0;c.port1.onmessage=function(t){var e=t.data,i=u[e];i(),delete u[e]},re=function(t){var e=h++;u[e]=t,c.port2.postMessage(e)}}else"document"in W&&"onreadystatechange"in W.document.createElement("script")?re=function(t){var e=W.document.createElement("script");e.onreadystatechange=function(){t(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},W.document.documentElement.appendChild(e)}:(re=function(t){return he(t,0)},ce=le)}();var de=ne.timeout=function(){function t(t,e){var i=this,n=new te,s=re(function(){n.isDisposed||n.setDisposable(e(i,t))});return new Yt(n,Jt(function(){ce(s)}))}function e(t,e,i){var n=this,s=ne.normalize(e);if(0===s)return n.scheduleWithState(t,i);var r=new te,o=he(function(){r.isDisposed||r.setDisposable(i(n,t))},s);return new Yt(r,Jt(function(){le(o)}))}function i(t,e,i){return this.scheduleWithRelativeAndState(t,e-this.now(),i)}return new ne(et,t,e,i)}(),me=X.Notification=function(){function t(t,e){this.hasValue=null==e?!1:e,this.kind=t}return t.prototype.accept=function(t,e,i){return t&&"object"==typeof t?this._acceptObservable(t):this._accept(t,e,i)},t.prototype.toObservable=function(t){var e=this;return Z(t)||(t=oe),new Je(function(i){return t.schedule(function(){e._acceptObservable(i),"N"===e.kind&&i.onCompleted()})})},t}(),ge=me.createOnNext=function(){function t(t){return t(this.value)}function e(t){return t.onNext(this.value)}function i(){return"OnNext("+this.value+")"}return function(n){var s=new me("N",!0);return s.value=n,s._accept=t,s._acceptObservable=e,s.toString=i,s}}(),pe=me.createOnError=function(){function t(t,e){return e(this.exception)}function e(t){return t.onError(this.exception)}function i(){return"OnError("+this.exception+")"}return function(n){var s=new me("E");return s.exception=n,s._accept=t,s._acceptObservable=e,s.toString=i,s}}(),fe=me.createOnCompleted=function(){function t(t,e,i){return i()}function e(t){return t.onCompleted()}function i(){return"OnCompleted()"}return function(){var n=new me("C");return n._accept=t,n._acceptObservable=e,n.toString=i,n}}(),we=X.internals.Enumerator=function(t){this._next=t};we.prototype.next=function(){return this._next()},we.prototype[gt]=function(){return this};var ve=X.internals.Enumerable=function(t){this._iterator=t};ve.prototype[gt]=function(){return this._iterator()},ve.prototype.concat=function(){var t=this;return new Je(function(e){var i,n=t[gt](),s=new ee,r=oe.scheduleRecursive(function(t){if(!i){try{var r=n.next()}catch(o){return e.onError(o)}if(r.done)return e.onCompleted();var a=r.value;rt(a)&&(a=ze(a));var c=new te;s.setDisposable(c),c.setDisposable(a.subscribe(function(t){e.onNext(t)},function(t){e.onError(t)},t))}});return new Yt(s,r,Jt(function(){i=!0}))})},ve.prototype.catchError=function(){var t=this;return new Je(function(e){var i,n=t[gt](),s=new ee,r=oe.scheduleRecursiveWithState(null,function(t,r){if(!i){try{var o=n.next()}catch(a){return observer.onError(a)}if(o.done)return void(null!==t?e.onError(t):e.onCompleted());var c=o.value;rt(c)&&(c=ze(c));var u=new te;s.setDisposable(u),u.setDisposable(c.subscribe(function(t){e.onNext(t)},r,function(){e.onCompleted()}))}});return new Yt(s,r,Jt(function(){i=!0}))})},ve.prototype.catchErrorWhen=function(t){var e=this;return new Je(function(i){var n,s,r=new ei,o=new ei,a=t(r),c=a.subscribe(o),u=e[gt](),h=new ee,l=oe.scheduleRecursive(function(t){if(!n){try{var e=u.next()}catch(a){return i.onError(a)}if(e.done)return void(s?i.onError(s):i.onCompleted());var c=e.value;rt(c)&&(c=ze(c));var l=new te,d=new te;h.setDisposable(new Yt(d,l)),l.setDisposable(c.subscribe(function(t){i.onNext(t)},function(e){d.setDisposable(o.subscribe(t,function(t){i.onError(t)},function(){i.onCompleted()})),r.onNext(e)},function(){i.onCompleted()}))}});return new Yt(c,h,l,Jt(function(){n=!0}))})};var Ce,be=ve.repeat=function(t,e){return null==e&&(e=-1),new ve(function(){var i=e;return new we(function(){return 0===i?pt:(i>0&&i--,{done:!1,value:t})})})},Se=ve.of=function(t,e,i){if(e)var n=Ct(e,i,3);return new ve(function(){var i=-1;return new we(function(){return++i<t.length?{done:!1,value:e?n(t[i],i,t):t[i]}:pt})})},Te=X.Observer=function(){},ye=Te.create=function(t,e,i){return t||(t=J),e||(e=st),i||(i=J),new De(t,e,i)},_e=X.internals.AbstractObserver=function(t){function e(){this.isStopped=!1,t.call(this)}return zt(e,t),e.prototype.onNext=function(t){this.isStopped||this.next(t)},e.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.error(t))},e.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.completed())},e.prototype.dispose=function(){this.isStopped=!0},e.prototype.fail=function(t){return this.isStopped?!1:(this.isStopped=!0,this.error(t),!0)},e}(Te),De=X.AnonymousObserver=function(t){function e(e,i,n){t.call(this),this._onNext=e,this._onError=i,this._onCompleted=n}return zt(e,t),e.prototype.next=function(t){this._onNext(t)},e.prototype.error=function(t){this._onError(t)},e.prototype.completed=function(){this._onCompleted()},e}(_e),Ae=X.Observable=function(){function t(t){if(X.config.longStackSupport&&ut){try{throw new Error}catch(e){this.stack=e.stack.substring(e.stack.indexOf("\n")+1)}var i=this;this._subscribe=function(e){var n=e.onError.bind(e);return e.onError=function(t){r(t,i),n(t)},t.call(i,e)}}else this._subscribe=t}return Ce=t.prototype,Ce.subscribe=Ce.forEach=function(t,e,i){return this._subscribe("object"==typeof t?t:ye(t,e,i))},Ce.subscribeOnNext=function(t,e){return this._subscribe(ye("undefined"!=typeof e?function(i){t.call(e,i)}:t))},Ce.subscribeOnError=function(t,e){return this._subscribe(ye(null,"undefined"!=typeof e?function(i){t.call(e,i)}:t))},Ce.subscribeOnCompleted=function(t,e){return this._subscribe(ye(null,null,"undefined"!=typeof e?function(){t.call(e)}:t))},t}(),Ie=X.internals.ScheduledObserver=function(t){function e(e,i){t.call(this),this.scheduler=e,this.observer=i,this.isAcquired=!1,this.hasFaulted=!1,this.queue=[],this.disposable=new ee}return zt(e,t),e.prototype.next=function(t){var e=this;this.queue.push(function(){e.observer.onNext(t)})},e.prototype.error=function(t){var e=this;this.queue.push(function(){e.observer.onError(t)})},e.prototype.completed=function(){var t=this;this.queue.push(function(){t.observer.onCompleted()})},e.prototype.ensureActive=function(){var t=!1,e=this;!this.hasFaulted&&this.queue.length>0&&(t=!this.isAcquired,this.isAcquired=!0),t&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(function(t){var i;if(!(e.queue.length>0))return void(e.isAcquired=!1);i=e.queue.shift();try{i()}catch(n){throw e.queue=[],e.hasFaulted=!0,n}t()}))},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.disposable.dispose()},e}(_e),ke=X.ObservableBase=function(t){function e(t){return t&&"function"==typeof t.dispose?t:"function"==typeof t?Jt(t):Zt}function i(t,i){var n=i[0],s=i[1];try{n.setDisposable(e(s.subscribeCore(n)))}catch(r){if(!n.fail(r))throw r}}function n(t){var e=new Ze(t),n=[e,this];return ae.scheduleRequired()?ae.scheduleWithState(n,i):i(null,n),e}function s(){t.call(this,n)}return zt(s,t),s.prototype.subscribeCore=function(){throw new Error("Not implemeneted")},s}(Ae);Ce.toArray=function(){var t=this;return new Je(function(e){var i=[];return t.subscribe(function(t){i.push(t)},function(t){e.onError(t)},function(){e.onNext(i),e.onCompleted()})},t)},Ae.create=Ae.createWithDisposable=function(t,e){return new Je(t,e)};var Ee=Ae.defer=function(t){return new Je(function(e){var i;try{i=t()}catch(n){return Ue(n).subscribe(e)}return rt(i)&&(i=ze(i)),i.subscribe(e)})},Re=Ae.empty=function(t){return Z(t)||(t=oe),new Je(function(e){return t.schedule(function(){e.onCompleted()})})},Fe=Math.pow(2,53)-1;v.prototype[gt]=function(){return new C(this._s)},C.prototype[gt]=function(){return this},C.prototype.next=function(){if(this._i<this._l){var t=this._s.charAt(this._i++);return{done:!1,value:t}}return pt},b.prototype[gt]=function(){return new S(this._a)},S.prototype[gt]=function(){return this},S.prototype.next=function(){if(this._i<this._l){var t=this._a[this._i++];return{done:!1,value:t}}return pt};var Me=Ae.from=function(t,e,i,n){if(null==t)throw new Error("iterable cannot be null.");if(e&&!ot(e))throw new Error("mapFn when provided must be a function");if(e)var s=Ct(e,i,2);Z(n)||(n=ae);var r=Object(t),o=y(r);return new Je(function(t){return n.scheduleRecursiveWithState(0,function(e,i){try{var n=o.next()}catch(r){return void t.onError(r)}if(n.done)return void t.onCompleted();var a=n.value;if(s)try{a=s(a,e)}catch(r){return void t.onError(r)}t.onNext(a),i(e+1)})})},xe=function(t){function e(e,i){this.args=e,this.scheduler=i||ae,t.call(this)}return zt(e,t),e.prototype.subscribeCore=function(t){var e=new $e(t,this);return e.run()},e}(ke),$e=function(){function t(t,e){this.observer=t,this.parent=e}function e(t,e){t.i<t.len?(t.observer.onNext(t.args[t.i++]),e(t)):t.observer.onCompleted()}return t.prototype.run=function(){return this.parent.scheduler.scheduleRecursiveWithState({i:0,args:this.parent.args,len:this.parent.args.length,observer:this.observer},e)},t}(),Oe=Ae.fromArray=function(t,e){return new xe(t,e)};Ae.never=function(){return new Je(function(){return Zt})},Ae.of=function(){for(var t=[],e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);return A(null,t)},Ae.ofWithScheduler=function(t){for(var e=[],i=1,n=arguments.length;n>i;i++)e.push(arguments[i]);return A(t,e)},Ae.pairs=function(t,e){return e||(e=X.Scheduler.currentThread),new Je(function(i){var n=Object.keys(t),s=n.length;return e.scheduleRecursiveWithState(0,function(e,r){if(s>e){var o=n[e];i.onNext([o,t[o]]),r(e+1)}else i.onCompleted()})})},Ae.range=function(t,e,i){return Z(i)||(i=ae),new Je(function(n){return i.scheduleRecursiveWithState(0,function(i,s){e>i?(n.onNext(t+i),s(i+1)):n.onCompleted()})})},Ae.repeat=function(t,e,i){return Z(i)||(i=ae),Pe(t,i).repeat(null==e?-1:e)};var Pe=Ae["return"]=Ae.just=function(t,e){return Z(e)||(e=oe),new Je(function(i){return e.schedule(function(){i.onNext(t),i.onCompleted()})})};Ae.returnValue=function(){return Pe.apply(null,arguments)};var Ue=Ae["throw"]=Ae.throwError=function(t,e){return Z(e)||(e=oe),new Je(function(i){return e.schedule(function(){i.onError(t)})})};Ae.throwException=function(){return Ae.throwError.apply(null,arguments)},Ce["catch"]=Ce.catchError=function(t){return"function"==typeof t?I(this,t):Le([this,t])},Ce.catchException=function(t){return this.catchError(t)};var Le=Ae.catchError=Ae["catch"]=Ae.catchException=function(){var t=[];if(Array.isArray(arguments[0]))t=arguments[0];else for(var e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);return Se(t).catchError()};Ce.combineLatest=function(){for(var t=[],e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);return Array.isArray(t[0])?t[0].unshift(this):t.unshift(this),Ne.apply(this,t)};var Ne=Ae.combineLatest=function(){for(var t=[],e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);var n=t.pop();return Array.isArray(t[0])&&(t=t[0]),new Je(function(e){function i(t){var i;if(a[t]=!0,c||(c=a.every(tt))){try{i=n.apply(null,h)}catch(s){return void e.onError(s)}e.onNext(i)}else u.filter(function(e,i){return i!==t}).every(tt)&&e.onCompleted()}function s(t){u[t]=!0,u.every(tt)&&e.onCompleted()}for(var r=function(){return!1},o=t.length,a=f(o,r),c=!1,u=f(o,r),h=new Array(o),l=new Array(o),d=0;o>d;d++)!function(n){var r=t[n],o=new te;rt(r)&&(r=ze(r)),o.setDisposable(r.subscribe(function(t){h[n]=t,i(n)},function(t){e.onError(t)},function(){s(n)})),l[n]=o}(d);return new Yt(l)},this)};Ce.concat=function(){for(var t=[],e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);return t.unshift(this),je.apply(null,t)};var je=Ae.concat=function(){var t=[];if(Array.isArray(arguments[0]))t=arguments[0];else for(var e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);return Se(t).concat()};Ce.concatAll=Ce.concatObservable=function(){return this.merge(1)},Ce.merge=function(t){if("number"!=typeof t)return qe(this,t);var e=this;return new Je(function(i){function n(t){var e=new te;r.add(e),rt(t)&&(t=ze(t)),e.setDisposable(t.subscribe(function(t){i.onNext(t)},function(t){i.onError(t)},function(){r.remove(e),a.length>0?n(a.shift()):(s--,o&&0===s&&i.onCompleted())}))}var s=0,r=new Yt,o=!1,a=[];return r.add(e.subscribe(function(e){t>s?(s++,n(e)):a.push(e)},function(t){i.onError(t)},function(){o=!0,0===s&&i.onCompleted()})),r},e)};var qe=Ae.merge=function(){var t,e,i=[],n=arguments.length;if(arguments[0])if(Z(arguments[0]))for(t=arguments[0],e=1;n>e;e++)i.push(arguments[e]);else for(t=oe,e=0;n>e;e++)i.push(arguments[e]);else for(t=oe,e=1;n>e;e++)i.push(arguments[e]);return Array.isArray(i[0])&&(i=i[0]),A(t,i).mergeAll()};Ce.mergeAll=function(){var t=this;return new Je(function(e){var i=new Yt,n=!1,s=new te;return i.add(s),s.setDisposable(t.subscribe(function(t){var s=new te;i.add(s),rt(t)&&(t=ze(t)),s.setDisposable(t.subscribe(function(t){e.onNext(t)},function(t){e.onError(t)},function(){i.remove(s),n&&1===i.length&&e.onCompleted()}))},function(t){e.onError(t)},function(){n=!0,1===i.length&&e.onCompleted()})),i},t)},Ce.mergeObservable=function(){return this.mergeAll.apply(this,arguments)},Ce.skipUntil=function(t){var e=this;return new Je(function(i){var n=!1,s=new Yt(e.subscribe(function(t){n&&i.onNext(t)},function(t){i.onError(t)},function(){n&&i.onCompleted()}));rt(t)&&(t=ze(t));var r=new te;return s.add(r),r.setDisposable(t.subscribe(function(){n=!0,r.dispose()},function(t){i.onError(t)},function(){r.dispose()})),s},e)},Ce["switch"]=Ce.switchLatest=function(){var t=this;return new Je(function(e){var i=!1,n=new ee,s=!1,r=0,o=t.subscribe(function(t){var o=new te,a=++r;i=!0,n.setDisposable(o),rt(t)&&(t=ze(t)),o.setDisposable(t.subscribe(function(t){r===a&&e.onNext(t)},function(t){r===a&&e.onError(t)},function(){r===a&&(i=!1,s&&e.onCompleted())}))},function(t){e.onError(t)},function(){s=!0,!i&&e.onCompleted()});return new Yt(o,n)},t)},Ce.takeUntil=function(t){var e=this;return new Je(function(i){return rt(t)&&(t=ze(t)),new Yt(e.subscribe(i),t.subscribe(function(){i.onCompleted()},function(t){i.onError(t)},J))},e)},Ce.withLatestFrom=function(){for(var t=[],e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);var n=t.pop(),s=this;if("undefined"==typeof s)throw new Error("Source observable not found for withLatestFrom().");if("function"!=typeof n)throw new Error("withLatestFrom() expects a resultSelector function.");return Array.isArray(t[0])&&(t=t[0]),new Je(function(e){for(var i=function(){return!1},r=t.length,o=f(r,i),a=!1,c=new Array(r),u=new Array(r+1),h=0;r>h;h++)!function(i){var n=t[i],s=new te;rt(n)&&(n=ze(n)),s.setDisposable(n.subscribe(function(t){c[i]=t,o[i]=!0,a=o.every(tt)},e.onError.bind(e),function(){})),u[i]=s}(h);var l=new te;return l.setDisposable(s.subscribe(function(t){var i,s=[t].concat(c);if(a){try{i=n.apply(null,s)}catch(r){return void e.onError(r)}e.onNext(i)}},e.onError.bind(e),function(){e.onCompleted()})),u[r]=l,new Yt(u)},this)},Ce.zip=function(){for(var t=[],e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);if(Array.isArray(t[0]))return k.apply(this,t);var n=this,s=t.pop();return t.unshift(n),new Je(function(e){function i(t){var i,r;if(a.every(function(t){return t.length>0})){try{r=a.map(function(t){return t.shift()}),i=s.apply(n,r)}catch(o){return void e.onError(o)}e.onNext(i)}else c.filter(function(e,i){return i!==t}).every(tt)&&e.onCompleted()}function r(t){c[t]=!0,c.every(function(t){return t})&&e.onCompleted()}for(var o=t.length,a=f(o,R),c=f(o,E),u=new Array(o),h=0;o>h;h++)!function(n){var s=t[n],o=new te;rt(s)&&(s=ze(s)),o.setDisposable(s.subscribe(function(t){a[n].push(t),i(n)},function(t){e.onError(t)},function(){r(n)})),u[n]=o}(h);return new Yt(u)},n)},Ae.zip=function(){for(var t=[],e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);var n=t.shift();return n.zip.apply(n,t)},Ae.zipArray=function(){var t=[];if(Array.isArray(arguments[0]))t=arguments[0];else for(var e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);return new Je(function(e){function i(t){if(r.every(function(t){return t.length>0})){var i=r.map(function(t){return t.shift()});e.onNext(i)}else if(o.filter(function(e,i){return i!==t}).every(tt))return void e.onCompleted()}function n(t){return o[t]=!0,o.every(tt)?void e.onCompleted():void 0}for(var s=t.length,r=f(s,function(){return[]}),o=f(s,function(){return!1}),a=new Array(s),c=0;s>c;c++)!function(s){a[s]=new te,a[s].setDisposable(t[s].subscribe(function(t){r[s].push(t),i(s)},function(t){e.onError(t)},function(){n(s)}))}(c);return new Yt(a)})},Ce.asObservable=function(){var t=this;return new Je(function(e){return t.subscribe(e)},this)},Ce.dematerialize=function(){var t=this;return new Je(function(e){return t.subscribe(function(t){return t.accept(e)},function(t){e.onError(t)},function(){e.onCompleted()})},this)},Ce.distinctUntilChanged=function(t,e){var i=this;return e||(e=it),new Je(function(n){var s,r=!1;return i.subscribe(function(i){var o=i;if(t)try{o=t(i)}catch(a){return void n.onError(a)}if(r)try{var c=e(s,o)}catch(a){return void n.onError(a)}r&&c||(r=!0,s=o,n.onNext(i))},function(t){n.onError(t)},function(){n.onCompleted()})},this)},Ce["do"]=Ce.tap=Ce.doAction=function(t,e,i){var n=this,s="function"==typeof t||"undefined"==typeof t?ye(t||J,e||J,i||J):t;return new Je(function(t){return n.subscribe(function(e){try{s.onNext(e)}catch(i){t.onError(i)}t.onNext(e)},function(e){try{s.onError(e)}catch(i){t.onError(i)}t.onError(e)},function(){try{s.onCompleted()}catch(e){t.onError(e)}t.onCompleted()})},this)},Ce.doOnNext=Ce.tapOnNext=function(t,e){return this.tap("undefined"!=typeof e?function(i){t.call(e,i)}:t)},Ce.doOnError=Ce.tapOnError=function(t,e){return this.tap(J,"undefined"!=typeof e?function(i){t.call(e,i)}:t)},Ce.doOnCompleted=Ce.tapOnCompleted=function(t,e){return this.tap(J,null,"undefined"!=typeof e?function(){t.call(e)}:t)},Ce["finally"]=Ce.ensure=function(t){var e=this;return new Je(function(i){var n;try{n=e.subscribe(i)}catch(s){throw t(),s}return Jt(function(){try{n.dispose()}catch(e){throw e}finally{t()}})},this)},Ce.finallyAction=function(t){return this.ensure(t)},Ce.ignoreElements=function(){var t=this;return new Je(function(e){return t.subscribe(J,function(t){e.onError(t)},function(){e.onCompleted()})},t)},Ce.materialize=function(){var t=this;return new Je(function(e){return t.subscribe(function(t){e.onNext(ge(t))},function(t){e.onNext(pe(t)),e.onCompleted()},function(){e.onNext(fe()),e.onCompleted()})},t)},Ce.repeat=function(t){return be(this,t).concat()},Ce.retry=function(t){return be(this,t).catchError()},Ce.retryWhen=function(t){return be(this).catchErrorWhen(t)},Ce.scan=function(){var t,e,i=!1,n=this;return 2===arguments.length?(i=!0,t=arguments[0],e=arguments[1]):e=arguments[0],new Je(function(s){var r,o,a;return n.subscribe(function(n){!a&&(a=!0);try{r?o=e(o,n):(o=i?e(t,n):n,r=!0)}catch(c){return void s.onError(c)}s.onNext(o)},function(t){s.onError(t)},function(){!a&&i&&s.onNext(t),s.onCompleted()})},n)},Ce.skipLast=function(t){var e=this;return new Je(function(i){var n=[];return e.subscribe(function(e){n.push(e),n.length>t&&i.onNext(n.shift())},function(t){i.onError(t)},function(){i.onCompleted()})},e)},Ce.startWith=function(){var t,e=0;arguments.length&&Z(arguments[0])?(t=arguments[0],e=1):t=oe;for(var i=[],n=e,s=arguments.length;s>n;n++)i.push(arguments[n]);return Se([Oe(i,t),this]).concat()},Ce.takeLast=function(t){var e=this;return new Je(function(i){var n=[];return e.subscribe(function(e){n.push(e),n.length>t&&n.shift()},function(t){i.onError(t)},function(){for(;n.length>0;)i.onNext(n.shift());i.onCompleted()})},e)},Ce.selectConcat=Ce.concatMap=function(t,e,i){return ot(t)&&ot(e)?this.concatMap(function(i,n){var s=t(i,n);return rt(s)&&(s=ze(s)),(wt(s)||ft(s))&&(s=Me(s)),s.map(function(t,s){return e(i,t,n,s)})}):ot(t)?F(this,t,i):F(this,function(){
return t})};var Be=function(t){function e(e,i,n){this.source=e,this.selector=Ct(i,n,3),t.call(this)}return zt(e,t),e.prototype.internalMap=function(t,i){var n=this;return new e(this.source,function(e,i,s){return t(n.selector(e,i,s),i,s)},i)},e.prototype.subscribeCore=function(t){return this.source.subscribe(new M(t,this.selector,this))},e}(ke);M.prototype.onNext=function(t){if(!this.isStopped){try{var e=this.selector(t,this.index++,this.source)}catch(i){return this.observer.onError(i)}this.observer.onNext(e)}},M.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.observer.onError(t))},M.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.observer.onCompleted())},M.prototype.dispose=function(){this.isStopped=!0},M.prototype.fail=function(t){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(t),!0)},Ce.map=Ce.select=function(t,e){var i="function"==typeof t?t:function(){return t};return this instanceof Be?this.internalMap(t,e):new Be(this,i,e)},Ce.pluck=function(){var e=arguments,i=arguments.length;if(0===i)throw new Error("List of properties cannot be empty.");return this.map(function(n){for(var s=n,r=0;i>r;r++){var o=s[e[r]];if("undefined"==typeof o)return t;s=o}return s})},Ce.selectMany=Ce.flatMap=function(t,e,i){return ot(t)&&ot(e)?this.flatMap(function(i,n){var s=t(i,n);return rt(s)&&(s=ze(s)),(wt(s)||ft(s))&&(s=Me(s)),s.map(function(t,s){return e(i,t,n,s)})},i):ot(t)?x(this,t,i):x(this,function(){return t})},Ce.selectSwitch=Ce.flatMapLatest=Ce.switchMap=function(t,e){return this.select(t,e).switchLatest()},Ce.skip=function(t){if(0>t)throw new Error(at);var e=this;return new Je(function(i){var n=t;return e.subscribe(function(t){0>=n?i.onNext(t):n--},function(t){i.onError(t)},function(){i.onCompleted()})},e)},Ce.skipWhile=function(t,e){var i=this,n=Ct(t,e,3);return new Je(function(t){var e=0,s=!1;return i.subscribe(function(r){if(!s)try{s=!n(r,e++,i)}catch(o){return void t.onError(o)}s&&t.onNext(r)},function(e){t.onError(e)},function(){t.onCompleted()})},i)},Ce.take=function(t,e){if(0>t)throw new RangeError(at);if(0===t)return Re(e);var i=this;return new Je(function(e){var n=t;return i.subscribe(function(t){n-->0&&(e.onNext(t),0===n&&e.onCompleted())},function(t){e.onError(t)},function(){e.onCompleted()})},i)},Ce.takeWhile=function(t,e){var i=this,n=Ct(t,e,3);return new Je(function(t){var e=0,s=!0;return i.subscribe(function(r){if(s){try{s=n(r,e++,i)}catch(o){return void t.onError(o)}s?t.onNext(r):t.onCompleted()}},function(e){t.onError(e)},function(){t.onCompleted()})},i)};var Ke=function(t){function e(e,i,n){this.source=e,this.predicate=Ct(i,n,3),t.call(this)}return zt(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new $(t,this.predicate,this))},e.prototype.internalFilter=function(t,i){var n=this;return new e(this.source,function(e,i,s){return n.predicate(e,i,s)&&t(e,i,s)},i)},e}(ke);$.prototype.onNext=function(t){try{var e=this.predicate(t,this.index++,this.source)}catch(i){return this.observer.onError(i)}e&&this.observer.onNext(t)},$.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.observer.onError(t))},$.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.observer.onCompleted())},$.prototype.dispose=function(){this.isStopped=!0},$.prototype.fail=function(t){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(t),!0)},Ce.filter=Ce.where=function(t,e){return this instanceof Ke?this.internalFilter(t,e):new Ke(this,t,e)},Ae.fromCallback=function(t,e,i){return function(){for(var n=[],s=0,r=arguments.length;r>s;s++)n.push(arguments[s]);return new Je(function(s){function r(){var t=arguments;if(i){try{t=i(t)}catch(e){return s.onError(e)}s.onNext(t)}else t.length<=1?s.onNext.apply(s,t):s.onNext(t);s.onCompleted()}n.push(r),t.apply(e,n)}).publishLast().refCount()}},Ae.fromNodeCallback=function(t,e,i){return function(){for(var n=[],s=0,r=arguments.length;r>s;s++)n.push(arguments[s]);return new Je(function(s){function r(t){if(t)return void s.onError(t);for(var e=[],n=1,r=arguments.length;r>n;n++)e.push(arguments[n]);if(i){try{e=i(e)}catch(o){return s.onError(o)}s.onNext(e)}else e.length<=1?s.onNext.apply(s,e):s.onNext(e);s.onCompleted()}n.push(r),t.apply(e,n)}).publishLast().refCount()}},X.config.useNativeEvents=!1,Ae.fromEvent=function(t,e,i){if(t.addListener)return He(function(i){t.addListener(e,i)},function(i){t.removeListener(e,i)},i);if(!X.config.useNativeEvents){if("function"==typeof t.on&&"function"==typeof t.off)return He(function(i){t.on(e,i)},function(i){t.off(e,i)},i);if(W.Ember&&"function"==typeof W.Ember.addListener)return He(function(i){Ember.addListener(t,e,i)},function(i){Ember.removeListener(t,e,i)},i)}return new Je(function(n){return P(t,e,function(t){var e=t;if(i)try{e=i(arguments)}catch(s){return void n.onError(s)}n.onNext(e)})}).publish().refCount()};var He=Ae.fromEventPattern=function(t,e,i){return new Je(function(n){function s(t){var e=t;if(i)try{e=i(arguments)}catch(s){return void n.onError(s)}n.onNext(e)}var r=t(s);return Jt(function(){e&&e(s,r)})}).publish().refCount()},ze=Ae.fromPromise=function(t){return Ee(function(){var e=new X.AsyncSubject;return t.then(function(t){e.onNext(t),e.onCompleted()},e.onError.bind(e)),e})};Ce.toPromise=function(t){if(t||(t=X.config.Promise),!t)throw new TypeError("Promise type not provided nor in Rx.config.Promise");var e=this;return new t(function(t,i){var n,s=!1;e.subscribe(function(t){n=t,s=!0},i,function(){s&&t(n)})})},Ae.startAsync=function(t){var e;try{e=t()}catch(i){return Ue(i)}return ze(e)},Ce.multicast=function(t,e){var i=this;return"function"==typeof t?new Je(function(n){var s=i.multicast(t());return new Yt(e(s).subscribe(n),s.connect())},i):new We(i,t)},Ce.publish=function(t){return t&&ot(t)?this.multicast(function(){return new ei},t):this.multicast(new ei)},Ce.share=function(){return this.publish().refCount()},Ce.publishLast=function(t){return t&&ot(t)?this.multicast(function(){return new ii},t):this.multicast(new ii)},Ce.publishValue=function(t,e){return 2===arguments.length?this.multicast(function(){return new si(e)},t):this.multicast(new si(t))},Ce.shareValue=function(t){return this.publishValue(t).refCount()},Ce.replay=function(t,e,i,n){return t&&ot(t)?this.multicast(function(){return new ri(e,i,n)},t):this.multicast(new ri(e,i,n))},Ce.shareReplay=function(t,e,i){return this.replay(null,t,e,i).refCount()};var We=X.ConnectableObservable=function(t){function e(e,i){var n,s=!1,r=e.asObservable();this.connect=function(){return s||(s=!0,n=new Yt(r.subscribe(i),Jt(function(){s=!1}))),n},t.call(this,function(t){return i.subscribe(t)})}return zt(e,t),e.prototype.refCount=function(){var t,e=0,i=this;return new Je(function(n){var s=1===++e,r=i.subscribe(n);return s&&(t=i.connect()),function(){r.dispose(),0===--e&&t.dispose()}})},e}(Ae),Ve=Ae.interval=function(t,e){return j(t,t,Z(e)?e:de)};Ae.timer=function(e,i,n){var s;return Z(n)||(n=de),i!==t&&"number"==typeof i?s=i:Z(i)&&(n=i),e instanceof Date&&s===t?U(e.getTime(),n):e instanceof Date&&s!==t?(s=i,L(e.getTime(),s,n)):s===t?N(e,n):j(e,s,n)},Ce.delay=function(t,e){return Z(e)||(e=de),t instanceof Date?B(this,t.getTime(),e):q(this,t,e)},Ce.debounce=Ce.throttleWithTimeout=function(t,e){Z(e)||(e=de);var i=this;return new Je(function(n){var s,r=new ee,o=!1,a=0,c=i.subscribe(function(i){o=!0,s=i,a++;var c=a,u=new te;r.setDisposable(u),u.setDisposable(e.scheduleWithRelative(t,function(){o&&a===c&&n.onNext(s),o=!1}))},function(t){r.dispose(),n.onError(t),o=!1,a++},function(){r.dispose(),o&&n.onNext(s),n.onCompleted(),o=!1,a++});return new Yt(c,r)},this)},Ce.throttle=function(t,e){return this.debounce(t,e)},Ce.timestamp=function(t){return Z(t)||(t=de),this.map(function(e){return{value:e,timestamp:t.now()}})},Ce.sample=Ce.throttleLatest=function(t,e){return Z(e)||(e=de),"number"==typeof t?K(this,Ve(t,e)):K(this,t)},Ce.timeout=function(t,e,i){(null==e||"string"==typeof e)&&(e=Ue(new Error(e||"Timeout"))),Z(i)||(i=de);var n=this,s=t instanceof Date?"scheduleWithAbsolute":"scheduleWithRelative";return new Je(function(r){function o(){var n=a;l.setDisposable(i[s](t,function(){a===n&&(rt(e)&&(e=ze(e)),u.setDisposable(e.subscribe(r)))}))}var a=0,c=new te,u=new ee,h=!1,l=new ee;return u.setDisposable(c),o(),c.setDisposable(n.subscribe(function(t){h||(a++,r.onNext(t),o())},function(t){h||(a++,r.onError(t))},function(){h||(a++,r.onCompleted())})),new Yt(u,l)},n)},Ce.throttleFirst=function(t,e){Z(e)||(e=de);var i=+t||0;if(0>=i)throw new RangeError("windowDuration cannot be less or equal zero.");var n=this;return new Je(function(t){var s=0;return n.subscribe(function(n){var r=e.now();(0===s||r-s>=i)&&(s=r,t.onNext(n))},function(e){t.onError(e)},function(){t.onCompleted()})},n)};var Ge=function(t){function e(t){var e=this.source.publish(),i=e.subscribe(t),n=Zt,s=this.pauser.distinctUntilChanged().subscribe(function(t){t?n=e.connect():(n.dispose(),n=Zt)});return new Yt(i,n,s)}function i(i,n){this.source=i,this.controller=new ei,this.pauser=n&&n.subscribe?this.controller.merge(n):this.controller,t.call(this,e,i)}return zt(i,t),i.prototype.pause=function(){this.controller.onNext(!1)},i.prototype.resume=function(){this.controller.onNext(!0)},i}(Ae);Ce.pausable=function(t){return new Ge(this,t)};var Ye=function(e){function i(e){var i,n=[],s=H(this.source,this.pauser.distinctUntilChanged().startWith(!1),function(t,e){return{data:t,shouldFire:e}}).subscribe(function(s){if(i!==t&&s.shouldFire!=i){if(i=s.shouldFire,s.shouldFire)for(;n.length>0;)e.onNext(n.shift())}else i=s.shouldFire,s.shouldFire?e.onNext(s.data):n.push(s.data)},function(t){for(;n.length>0;)e.onNext(n.shift());e.onError(t)},function(){for(;n.length>0;)e.onNext(n.shift());e.onCompleted()});return s}function n(t,n){this.source=t,this.controller=new ei,this.pauser=n&&n.subscribe?this.controller.merge(n):this.controller,e.call(this,i,t)}return zt(n,e),n.prototype.pause=function(){this.controller.onNext(!1)},n.prototype.resume=function(){this.controller.onNext(!0)},n}(Ae);Ce.pausableBuffered=function(t){return new Ye(this,t)};var Qe=function(t){function e(t){return this.source.subscribe(t)}function i(i,n){t.call(this,e,i),this.subject=new Xe(n),this.source=i.multicast(this.subject).refCount()}return zt(i,t),i.prototype.request=function(t){return null==t&&(t=-1),this.subject.request(t)},i}(Ae),Xe=function(t){function e(t){return this.subject.subscribe(t)}function i(i){null==i&&(i=!0),t.call(this,e),this.subject=new ei,this.enableQueue=i,this.queue=i?[]:null,this.requestedCount=0,this.requestedDisposable=Zt,this.error=null,this.hasFailed=!1,this.hasCompleted=!1,this.controlledDisposable=Zt}return zt(i,t),Wt(i.prototype,Te,{onCompleted:function(){this.hasCompleted=!0,(!this.enableQueue||0===this.queue.length)&&this.subject.onCompleted()},onError:function(t){this.hasFailed=!0,this.error=t,(!this.enableQueue||0===this.queue.length)&&this.subject.onError(t)},onNext:function(t){var e=!1;0===this.requestedCount?this.enableQueue&&this.queue.push(t):(-1!==this.requestedCount&&0===this.requestedCount--&&this.disposeCurrentRequest(),e=!0),e&&this.subject.onNext(t)},_processRequest:function(t){if(this.enableQueue){for(;this.queue.length>=t&&t>0;)this.subject.onNext(this.queue.shift()),t--;return 0!==this.queue.length?{numberOfItems:t,returnValue:!0}:{numberOfItems:t,returnValue:!1}}return this.hasFailed?(this.subject.onError(this.error),this.controlledDisposable.dispose(),this.controlledDisposable=Zt):this.hasCompleted&&(this.subject.onCompleted(),this.controlledDisposable.dispose(),this.controlledDisposable=Zt),{numberOfItems:t,returnValue:!1}},request:function(t){this.disposeCurrentRequest();var e=this,i=this._processRequest(t),t=i.numberOfItems;return i.returnValue?Zt:(this.requestedCount=t,this.requestedDisposable=Jt(function(){e.requestedCount=0}),this.requestedDisposable)},disposeCurrentRequest:function(){this.requestedDisposable.dispose(),this.requestedDisposable=Zt}}),i}(Ae);Ce.controlled=function(t){return null==t&&(t=!0),new Qe(this,t)},Ce.transduce=function(t){function e(t){return{init:function(){return t},step:function(t,e){return t.onNext(e)},result:function(t){return t.onCompleted()}}}var i=this;return new Je(function(n){var s=t(e(n));return i.subscribe(function(t){try{s.step(n,t)}catch(e){n.onError(e)}},n.onError.bind(n),function(){s.result(n)})},i)};var Je=X.AnonymousObservable=function(t){function e(t){return t&&"function"==typeof t.dispose?t:"function"==typeof t?Jt(t):Zt}function i(t,i){var n=i[0],s=i[1];try{n.setDisposable(e(s(n)))}catch(r){if(!n.fail(r))throw r}}function n(e,n){function s(t){var n=new Ze(t),s=[n,e];return ae.scheduleRequired()?ae.scheduleWithState(s,i):i(null,s),n}this.source=n,t.call(this,s)}return zt(n,t),n}(Ae),Ze=function(t){function e(e){t.call(this),this.observer=e,this.m=new te}zt(e,t);var i=e.prototype;return i.next=function(t){var e=!1;try{this.observer.onNext(t),e=!0}catch(i){throw i}finally{!e&&this.dispose()}},i.error=function(t){try{this.observer.onError(t)}catch(e){throw e}finally{this.dispose()}},i.completed=function(){try{this.observer.onCompleted()}catch(t){throw t}finally{this.dispose()}},i.setDisposable=function(t){this.m.setDisposable(t)},i.getDisposable=function(){return this.m.getDisposable()},i.dispose=function(){t.prototype.dispose.call(this),this.m.dispose()},e}(_e),ti=function(t,e){this.subject=t,this.observer=e};ti.prototype.dispose=function(){if(!this.subject.isDisposed&&null!==this.observer){var t=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(t,1),this.observer=null}};var ei=X.Subject=function(t){function i(t){return e(this),this.isStopped?this.hasError?(t.onError(this.error),Zt):(t.onCompleted(),Zt):(this.observers.push(t),new ti(this,t))}function s(){t.call(this,i),this.isDisposed=!1,this.isStopped=!1,this.observers=[],this.hasError=!1}return zt(s,t),Wt(s.prototype,Te.prototype,{hasObservers:function(){return this.observers.length>0},onCompleted:function(){if(e(this),!this.isStopped){this.isStopped=!0;for(var t=0,i=n(this.observers),s=i.length;s>t;t++)i[t].onCompleted();this.observers.length=0}},onError:function(t){if(e(this),!this.isStopped){this.isStopped=!0,this.error=t,this.hasError=!0;for(var i=0,s=n(this.observers),r=s.length;r>i;i++)s[i].onError(t);this.observers.length=0}},onNext:function(t){if(e(this),!this.isStopped)for(var i=0,s=n(this.observers),r=s.length;r>i;i++)s[i].onNext(t)},dispose:function(){this.isDisposed=!0,this.observers=null}}),s.create=function(t,e){return new ni(t,e)},s}(Ae),ii=X.AsyncSubject=function(t){function i(t){return e(this),this.isStopped?(this.hasError?t.onError(this.error):this.hasValue?(t.onNext(this.value),t.onCompleted()):t.onCompleted(),Zt):(this.observers.push(t),new ti(this,t))}function s(){t.call(this,i),this.isDisposed=!1,this.isStopped=!1,this.hasValue=!1,this.observers=[],this.hasError=!1}return zt(s,t),Wt(s.prototype,Te,{hasObservers:function(){return e(this),this.observers.length>0},onCompleted:function(){var t,i;if(e(this),!this.isStopped){this.isStopped=!0;var s=n(this.observers),i=s.length;if(this.hasValue)for(t=0;i>t;t++){var r=s[t];r.onNext(this.value),r.onCompleted()}else for(t=0;i>t;t++)s[t].onCompleted();this.observers.length=0}},onError:function(t){if(e(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=t;for(var i=0,s=n(this.observers),r=s.length;r>i;i++)s[i].onError(t);this.observers.length=0}},onNext:function(t){e(this),this.isStopped||(this.value=t,this.hasValue=!0)},dispose:function(){this.isDisposed=!0,this.observers=null,this.exception=null,this.value=null}}),s}(Ae),ni=X.AnonymousSubject=function(t){function e(t){return this.observable.subscribe(t)}function i(i,n){this.observer=i,this.observable=n,t.call(this,e)}return zt(i,t),Wt(i.prototype,Te.prototype,{onCompleted:function(){this.observer.onCompleted()},onError:function(t){this.observer.onError(t)},onNext:function(t){this.observer.onNext(t)}}),i}(Ae),si=X.BehaviorSubject=function(t){function i(t){return e(this),this.isStopped?(this.hasError?t.onError(this.error):t.onCompleted(),Zt):(this.observers.push(t),t.onNext(this.value),new ti(this,t))}function s(e){t.call(this,i),this.value=e,this.observers=[],this.isDisposed=!1,this.isStopped=!1,this.hasError=!1}return zt(s,t),Wt(s.prototype,Te,{hasObservers:function(){return this.observers.length>0},onCompleted:function(){if(e(this),!this.isStopped){this.isStopped=!0;for(var t=0,i=n(this.observers),s=i.length;s>t;t++)i[t].onCompleted();this.observers.length=0}},onError:function(t){if(e(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=t;for(var i=0,s=n(this.observers),r=s.length;r>i;i++)s[i].onError(t);this.observers.length=0}},onNext:function(t){if(e(this),!this.isStopped){this.value=t;for(var i=0,s=n(this.observers),r=s.length;r>i;i++)s[i].onNext(t)}},dispose:function(){this.isDisposed=!0,this.observers=null,this.value=null,this.exception=null}}),s}(Ae),ri=X.ReplaySubject=function(t){function i(t,e){return Jt(function(){e.dispose(),!t.isDisposed&&t.observers.splice(t.observers.indexOf(e),1)})}function s(t){var n=new Ie(this.scheduler,t),s=i(this,n);e(this),this._trim(this.scheduler.now()),this.observers.push(n);for(var r=0,o=this.q.length;o>r;r++)n.onNext(this.q[r].value);return this.hasError?n.onError(this.error):this.isStopped&&n.onCompleted(),n.ensureActive(),s}function r(e,i,n){this.bufferSize=null==e?Number.MAX_VALUE:e,this.windowSize=null==i?Number.MAX_VALUE:i,this.scheduler=n||ae,this.q=[],this.observers=[],this.isStopped=!1,this.isDisposed=!1,this.hasError=!1,this.error=null,t.call(this,s)}return zt(r,t),Wt(r.prototype,Te.prototype,{hasObservers:function(){return this.observers.length>0},_trim:function(t){for(;this.q.length>this.bufferSize;)this.q.shift();for(;this.q.length>0&&t-this.q[0].interval>this.windowSize;)this.q.shift()},onNext:function(t){if(e(this),!this.isStopped){var i=this.scheduler.now();this.q.push({interval:i,value:t}),this._trim(i);for(var s=0,r=n(this.observers),o=r.length;o>s;s++){var a=r[s];a.onNext(t),a.ensureActive()}}},onError:function(t){if(e(this),!this.isStopped){this.isStopped=!0,this.error=t,this.hasError=!0;var i=this.scheduler.now();this._trim(i);for(var s=0,r=n(this.observers),o=r.length;o>s;s++){var a=r[s];a.onError(t),a.ensureActive()}this.observers.length=0}},onCompleted:function(){if(e(this),!this.isStopped){this.isStopped=!0;var t=this.scheduler.now();this._trim(t);for(var i=0,s=n(this.observers),r=s.length;r>i;i++){var o=s[i];o.onCompleted(),o.ensureActive()}this.observers.length=0}},dispose:function(){this.isDisposed=!0,this.observers=null}}),r}(Ae);X.Pauser=function(t){function e(){t.call(this)}return zt(e,t),e.prototype.pause=function(){this.onNext(!1)},e.prototype.resume=function(){this.onNext(!0)},e}(ei),"function"==typeof define&&"object"==typeof define.amd&&define.amd?(W.Rx=X,define("rxjs",[],function(){return X})):V&&G?Y?(G.exports=X).Rx=X:V.Rx=X:W.Rx=X;var oi=u()}.call(this),define("with-state",["require","flight/lib/utils"],function(t){"use strict";function e(){this.initialState=function(t){this._stateDef=i.merge(this._stateDef||{},t)},this.replaceState=function(t){return t&&"object"==typeof t?(this.state=t,this.stateChanged(this.state),this.state):void 0},this.mergeState=function(t){return this.replaceState(i.merge(this.state,t))},this.fromState=function(t){var e=this;return function(){return e.state[t]}},this.toState=function(t){var e=this;return function(i){var n={};n[t]=i,e.mergeState(n)}},this.fromAttr=function(t){var e=this;return function(i){return e.attr[t]}},this.stateChanged=function(){},this.after("initialize",function(){var t=this._stateDef||{},e=this,i=Object.keys(t).reduce(function(i,n){var s=t[n];return i[n]="function"==typeof s?s.call(e):s,i},{});this.replaceState(i)})}var i=t("flight/lib/utils");return e}),define("util/with_observable_state",["require","flight/lib/compose","rxjs","with-state"],function(t){"use strict";function e(){i.mixin(this,[s]),this.after("initialize",function(){this.observableState=new n.BehaviorSubject(this.state),this.after("stateChanged",this.observableState.onNext.bind(this.observableState))}),this.getObservableState=function(){return this.observableState.shareValue()},this.before("teardown",function(){this.observableState.dispose()})}var i=t("flight/lib/compose"),n=t("rxjs"),s=t("with-state");return e}),define("ui/custom_timeline_description",["require","flight/lib/component","ui/compose/character_count","ui/compose/with_character_limit","ui/compose/with_compose_text","ui/with_transitions","with-child-components","with-resources","util/with_observable_state","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({accountKey:null,customTimelineId:null,isOwnCustomTimeline:!1,readOnly:!1,reloadPeriod:900,animatingClass:"is-column-options-animating",characterCountSelector:".js-character-count",inputSelector:".js-input",editSelector:".js-edit",saveSelector:".js-save",cancelSelector:".js-cancel"}),this.initialState({characterCount:0}),this.after("initialize",function(){this.customTimeline=null,this.newDescription=null,this.on(document,"dataCustomTimelineSuccess",this.handleCustomTimeline.bind(this)),this.on(document,"dataCustomTimelineUpdateError",this.handleUpdateError.bind(this)),this.on("uiComposeTextChanged",this.handleComposeTextChanged);var t=new Rx.BehaviorSubject(this.state);this.after("stateChanged",t.onNext.bind(t)),this.after("stateChanged",this.renderButtons),this.stateSource="customTimelineDescription["+_.uniqueId("ctlid")+"].state",this.provideResource(this.stateSource,this.getObservableState),this.on("click",{editSelector:this.edit,saveSelector:this.save,cancelSelector:this.cancel}),this.on("uiInputSubmit",{inputSelector:this.save}),this.on("uiInputBlur",{inputSelector:this.cancel}),this.reloadTaskId=TD.controller.scheduler.schedulePeriodicTask(this.attr.reloadPeriod,this.requestData.bind(this),!0)}),this.before("teardown",function(){TD.controller.scheduler.removePeriodicTask(this.reloadTaskId)}),this.requestData=function(){this.trigger(document,"uiNeedsCustomTimeline",{id:this.attr.customTimelineId,account:this.attr.accountKey})},this.handleCustomTimeline=function(t,e){var i=!0;e.action.id===this.attr.customTimelineId&&(i=!this.customTimeline||this.customTimeline.description!==e.result.description,this.customTimeline=e.result,this.customTimeline.description===this.newDescription&&(this.newDescription=null),i&&this.showDescription(this.customTimeline.description))},this.showDescription=function(t){var e=$(h.render("column/custom_timeline_description",{description:t,editable:this.attr.isOwnCustomTimeline&&!this.attr.readOnly}));this.animateElementContentHeight(this.$node,e,this.attr.animatingClass)},this.edit=function(){var t=null!==this.newDescription?this.newDescription:this.customTimeline.description,e=$(h.render("column/custom_timeline_edit_description"));this.animateElementContentHeight(this.$node,e,this.attr.animatingClass),this.select("inputSelector").focus(),this.setupDOM(),this.attachChild(n,this.select("characterCountSelector"),{stateSource:this.stateSource,maxCharCount:160}),this.composeTextSetText(t),this.composeTextSetCaretToEnd(),this.composeTextHandleChange()},this.setupDOM=function(){},this.save=function(t,e){var i=this.select("inputSelector").val(),n=this.customTimeline?this.customTimeline.description:null;this.select("saveSelector").prop("disabled")||(this.showDescription(i),i!==n&&(this.newDescription=i,this.trigger(document,"uiUpdateCustomTimeline",{account:this.attr.accountKey,id:this.attr.customTimelineId,description:i})))},this.cancel=function(){this.showDescription(this.customTimeline.description)},this.handleUpdateError=function(t,e){e.action.id===this.attr.customTimelineId&&this.newDescription&&(this.edit(),TD.controller.progressIndicator.addMessage(TD.i("Error: unable to save description")))},this.handleComposeTextChanged=function(t,e){t.stopPropagation(),this.mergeState({characterCount:e.value.length})},this.renderButtons=function(){var t=this.isOverCharLimit(this.state.characterCount);this.select("saveSelector").prop("disabled",t)}}var i=t("flight/lib/component"),n=t("ui/compose/character_count"),s=t("ui/compose/with_character_limit"),r=t("ui/compose/with_compose_text"),o=t("ui/with_transitions"),a=t("with-child-components"),c=t("with-resources"),u=t("util/with_observable_state"),h=t("scripts/UI/template");return i(u,e,s,r,o,a,c)}),define("ui/user_selector",["require","flight/lib/component","with-child-components","ui/asynchronous_form","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({focusOnInit:!0,clearOnSelect:!0,blurOnSelect:!0,templateName:"user_selector",placeholder:TD.i("Enter Twitter username"),selectButtonIconClass:"icon-plus",selectButtonSelector:".js-select-button",inputSelector:".js-username-input",withSelectButton:!0}),this.after("initialize",function(){var t=r.render(this.attr.templateName,{searchInputControlClass:"margin-tm",selectButtonIconClass:this.attr.selectButtonIconClass,placeholder:this.attr.placeholder,withSelectButton:this.attr.withSelectButton});this.$node.html(t),this.attachChild(s,this.$node),this.on("click",{selectButtonSelector:this.handleInputSelection}),this.on("uiInputSubmit",{inputSelector:this.handleInputSelection}),this.autocomplete=new TD.components.Autocomplete(this.select("inputSelector"),{dmMode:!0}),this.on(this.autocomplete.$node,"td-autocomplete-select",this.handleTDAutocompleteSelect),this.attr.focusOnInit&&this.select("inputSelector").focus()}),this.handleTDAutocompleteSelect=function(t,e){this.select("inputSelector").val(e.screenName),this.handleInputSelection()},this.handleInputSelection=function(){var t=this.select("inputSelector").val();if(t){this.trigger(this.attr.inputSelector,"uiWaitingForAsyncResponse");var e=TD.cache.twitterUsers.getByScreenName(t);e.addCallbacks(this.triggerSelection.bind(this),this.handleError.bind(this)),e.addBoth(this.trigger.bind(this,this.attr.inputSelector,"uiReceivedAsyncResponse"))}},this.triggerSelection=function(t){this.trigger("uiUserSelected",{user:t}),this.attr.clearOnSelect&&this.select("inputSelector").val(""),this.attr.blurOnSelect&&this.select("inputSelector").blur()},this.handleError=function(t){var e;try{e=t.req.errors[0].message}finally{e&&TD.controller.progressIndicator.addMessage(e)}}}var i=t("flight/lib/component"),n=t("with-child-components"),s=t("ui/asynchronous_form"),r=t("scripts/UI/template");return i(e,n)}),define("ui/dm_conversation_participants",["require","flight/lib/component","with-state","with-child-components","ui/user_selector","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({columnBackSelector:".js-dm-participants-back",headerLinkClass:"js-dm-participants-back",conversationAdderSelector:".js-conversation-adder",conversationId:null,accountKey:null}),this.initialState({participants:null,isOneToOne:!1,conversationId:function(){return this.attr.conversationId},accountKey:function(){return this.attr.accountKey}}),this.after("initialize",function(){this.after("stateChanged",this.render),this.on("uiCloseDmParticipants",this.close),this.on("click",{columnBackSelector:this.close}),this.on("uiUserSelected",{conversationAdderSelector:this.handleUserSelection}),this.on(document,"dataConversationParticipants",this.handleConversationParticipants),this.fetchData()}),this.fetchData=function(){var t=TD.controller.clients.getClient(this.state.accountKey),e=t.conversations.getConversation(this.state.conversationId),i=e.participants;this.mergeState({participants:i,isOneToOne:e.isOneToOne()})},this.handleConversationParticipants=function(t,e){e.conversationId===this.state.conversationId&&this.mergeState({participants:e.participants})},this.render=function(){if(null!==this.state.participants){var t={columntitle:TD.i("Conversation"),headerLinkClass:this.attr.headerLinkClass,withUserMenu:!0,users:this.state.participants,showAddUser:!0},e=o.render("column/column_dm_participants",t);this.$node.html(e),this.attachChild(r,this.attr.conversationAdderSelector,{placeholder:TD.i("Add people to group"),withSelectButton:!1,focusOnInit:!1})}},this.close=function(){this.trigger("uiDmParticipantsClosed"),this.teardown()},this.addParticipants=function(t){var e={conversationId:this.state.conversationId,participantIds:[t.user.id],accountKey:this.state.accountKey};this.trigger("uiAddConversationParticipants",e)},this.createNewConversation=function(t){var e={type:"message",messageRecipients:this.state.participants.concat(t.user),from:[this.state.accountKey],text:""};this.trigger("uiComposeTweet",e)},this.handleUserSelection=function(t,e){this.state.isOneToOne?this.createNewConversation(e):this.addParticipants(e)}}var i=t("flight/lib/component"),n=t("with-state"),s=t("with-child-components"),r=t("ui/user_selector"),o=t("scripts/UI/template");return i(n,e,s)}),define("ui/with_text_utils",["flight/lib/compose","ui/with_template"],function(t,e){function i(){t.mixin(this,[e]),this.highlightSubstring=function(t,e){var i,n,s=-1;return e&&(s=t.toLowerCase().indexOf(e.toLowerCase())),-1!==s?(n={before:t.substr(0,s),highlight:t.substr(s,e.length),after:t.substr(s+e.length)},i=this.toHtmlFromRaw("{{before}}<b>{{highlight}}</b>{{after}}",n)):i=this.toHtmlFromRaw("{{text}}",{text:t}),i},this.prettyNumber=function(t){return TD.util.prettyNumber(t)}}return i}),define("ui/social_proof_for_tweet",["require","flight/lib/component","ui/with_text_utils","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({columnBackSelector:".js-tweet-social-proof-back",headerLinkClass:"js-tweet-social-proof-back",templateName:"status/social_proof_for_tweet",tweetSummary:null,type:null}),this.after("initialize",function(){var t,e,i;this.on("uiSocialProofForTweetClose",this.close),this.on("click",{columnBackSelector:this.close}),this.on(document,"dataTwitterUsers",this.handleTwitterUsers),this.userIds=this.attr.tweetSummary[this.attr.type],"retweeters"===this.attr.type?(e="Retweeted",i=this.attr.tweetSummary.retweeters_count):(e="Favorited",i=this.attr.tweetSummary.favoriters_count),t=parseInt(i,10)>1?TD.i("{{action}} {{n}} times",{n:this.prettyNumber(i),action:e}):TD.i("{{action}} once",{action:e}),this.renderParams={title:t,columntitle:TD.i("Tweet"),headerLinkClass:this.attr.headerLinkClass,withUserMenu:!0};var n=s.render(this.attr.templateName,this.renderParams);this.$node.html(n),this.requestId=_.uniqueId("twitterUsers"),this.trigger("uiNeedsTwitterUsers",{requestId:this.requestId,userIds:this.userIds})}),this.handleTwitterUsers=function(t,e){if(e.requestId===this.requestId){this.renderParams.users=e.users;var i=s.render(this.attr.templateName,this.renderParams);this.$node.html(i)}},this.close=function(){this.trigger("uiSocialProofForTweetClosed"),this.teardown()}}var i=t("flight/lib/component"),n=t("ui/with_text_utils"),s=t("scripts/UI/template");return i(e,n)}),define("ui/with_column_selectors",[],function(){var t=function(){this.attributes({appColumnsContainerSelector:".js-app-columns-container",columnsContainerSelector:".js-app-columns",columnStateDetailViewClass:"js-column-state-detail-view",columnStateSocialProofClass:"js-column-state-social-proof",columnSelector:".js-app-columns .js-column",columnUpdateGlow:".js-column-update-glow",scrollContainerSelector:".js-column-scroller",columnDetailScrollerSelector:".js-detail-container",columnOptionsSelector:".js-column-options",columnOptionsContainerSelector:".js-column-options-container",columnHeaderSelector:".js-column-header",columnUnreadCountSelector:".js-column-header .js-unread-count",columnContentSelector:".js-column-content"}),this.getColumnScrollContainerByKey=function(t){var e=this.getColumnElementByKey(t),i=e.find(this.attr.columnDetailScrollerSelector);return i.length>0?i:e.find(this.attr.scrollContainerSelector)},this.getColumnElementByKey=function(t){return this.select("columnSelector").filter('[data-column="'+t+'"]')},this.getKeyForColumnAtIndex=function(t){return this.select("columnSelector").eq(t).attr("data-column");

},this.getKeyForLastColumn=function(){return this.select("columnSelector").last().attr("data-column")}};return t}),define("ui/with_focus",[],function(){function t(){this.focusRequest=function(){this.trigger("uiFocusRequest",{id:this.focusId})},this.focusRelease=function(){this.trigger("uiFocusRelease",{id:this.focusId})},this.handleFocus=function(t,e){this.hasFocus=e.id===this.focusId?!0:!1},this.whenHasFocus=function(t){return function(){return this.hasFocus?t.apply(this,arguments):void 0}.bind(this)},this.getNewFocusId=function(){return _.uniqueId("focus")},this.after("teardown",function(){this.hasFocus&&this.trigger("uiFocusRelease",{id:this.focusId})}),this.after("initialize",function(){this.focusId=this.attr.focusId||this.getNewFocusId(),this.hasFocus=!1,this.on(document,"uiFocus",this.handleFocus),this.attr.autoFocus===!0&&this.focusRequest()})}return t}),define("ui/with_dropdown",["require","flight/lib/compose","ui/with_template","ui/with_focus"],function(t){"use strict";function e(){i.mixin(this,[n,s]),this.attributes({dropdownContainerSelector:".js-dropdown-container",dropdownContentSelector:".js-dropdown-content",isSelectableClass:"is-selectable",isSelectableSelector:".is-selectable",isSelectedClass:"is-selected",isSelectedSelector:".is-selected",dropdownOptions:{position:"",toggle:!1},dropdownPositions:{offsetLeft:"pos-l",offsetRight:"pos-r",underLeftIcon:"pos-r-under-icon",verticalRight:"pos-br",above:"pos-t"}}),this.after("initialize",function(){this.on(document,"uiDropdownShowing uiDetailViewOpening uiKeyEscape",this.teardownCurrentDropdown.bind(this)),this.dropdownFocusId=this.getNewFocusId(),this.on(document,"uiKeyEnter uiKeySpace",this.whenHasDropdownFocus(this.clickSelectedActionable)),this.on(document,"uiKeyUp",this.whenHasDropdownFocus(this.makeHandleChangeSelectionIndexBy(-1))),this.on(document,"uiKeyDown",this.whenHasDropdownFocus(this.makeHandleChangeSelectionIndexBy(1))),this.on(document,"uiKeyRight uiKeyLeft",this.whenHasDropdownFocus(this.jumpIntoDropdown))}),this.before("teardown",function(){this.teardownCurrentDropdown()}),this.renderDropdown=function(t,e,i,n){if(!t||!t.length)throw new Error("Please supply a node to render dropdown with.");if(!e)throw new Error("Please supply a template.");i=i||{},n=_.defaults(n||{},this.attr.dropdownOptions);var s=_.uniqueId("dropdown");if(this.dropdownIsOpen()){if(this.$dropdownSourceNode&&t.get(0)===this.$dropdownSourceNode.get(0))return n.toggle?(this.trigger("uiDropdownToggling",{id:s}),this.teardownCurrentDropdown()):this.trigger("uiDropdownAlreadyOpen",{id:s});this.teardownCurrentDropdown()}this.$dropdownSourceNode=t,this.trigger("uiDropdownShowing",{id:s});var r=e;"string"==typeof e&&(r=this.renderTemplate(e,i));var o=this.renderTemplate("menus/dropdown",n);return o.find(this.attr.dropdownContentSelector).append(r),t.after(o),this.currentDropdown={$el:o,id:s},this.maybeRepositionDropdown(),this.attachDropdownInteractions(o,n),this.parentFocusId=this.focusId,this.focusId=this.dropdownFocusId,this.focusRequest(),this.on(document,"click",this.handleDocumentClick),this.trigger("uiDropdownShown",{id:s}),o},this.handleDocumentClick=function(t){this.teardownCurrentDropdown()},this.attachDropdownInteractions=function(t,e){this.on(t,"mouseleave",this.removeCurrentSelection),this.on(t,"mouseover",{isSelectableSelector:this.handleChangeSelectionToTarget}),this.on(t,"click",this.cancelEventIfNotFromSelectable);var i=t.find(this.attr.isSelectableSelector),n=i.filter(this.attr.isSelectedSelector),s=i.index(n);this.currentDropdown.$selectables=i,this.currentDropdown.selectedIndex=s,s>-1&&this.changeSelectionToIndex(s)},this.teardownCurrentDropdown=function(t,e){if(t=t||{},e=e||{},this.dropdownIsOpen()){if(e.id===this.currentDropdown.id)return;this.$dropdownSourceNode=null,this.trigger("uiDropdownHiding",{id:this.currentDropdown.id}),this.focusRelease(),this.focusId=this.parentFocusId;var i=this.currentDropdown.$el;this.off(document,"click",this.handleDocumentClick),this.off(i,"mouseleave",this.removeCurrentSelection),this.off(i,"mouseover"),this.off(i,"click",this.cancelEventIfNotFromSelectable),this.currentDropdown.$el.remove();var n=this.currentDropdown.id;this.currentDropdown=null,this.trigger("uiDropdownHidden",{id:n})}},this.clickSelectedActionable=function(){this.currentDropdown.selectedIndex>-1&&this.currentDropdown.$selectables.eq(this.currentDropdown.selectedIndex).find("[data-action]").first().click()},this.changeSelection=function(t){var e=$(t),i=this.currentDropdown.$selectables.index(e.get(0));this.removeCurrentSelection(),i>-1&&(this.currentDropdown.$selectables.eq(i).addClass(this.attr.isSelectedClass),this.currentDropdown.selectedIndex=i)},this.changeSelectionToIndex=function(t){if(0>t)return this.removeCurrentSelection();var e=this.currentDropdown.$selectables.eq(t);this.changeSelection(e)},this.handleChangeSelectionToTarget=function(t,e){this.changeSelection(e.el)},this.makeHandleChangeSelectionIndexBy=function(t){return function(e,i){e.stopPropagation();var n=this.getNewSelectedIndex(t);this.changeSelectionToIndex(n)}},this.removeCurrentSelection=function(){this.currentDropdown.$selectables.eq(this.currentDropdown.selectedIndex).removeClass(this.attr.isSelectedClass),this.currentDropdown.selectedIndex=-1},this.getNewSelectedIndex=function(t){"undefined"==typeof t&&(t=1);var e=this.currentDropdown.selectedIndex;if(0===t)return e;var i=this.currentDropdown.$selectables.length,n=(e+t)%i;return 0>e?t>0?0:i-1:0>n?i+n:n},this.whenHasDropdownFocus=function(t){return this.whenHasFocus(function(){return this.focusId===this.dropdownFocusId?t.apply(this,arguments):void 0})},this.jumpIntoDropdown=function(t){-1===this.currentDropdown.selectedIndex&&this.changeSelectionToIndex(0)},this.cancelEventIfNotFromSelectable=function(t){var e=this.currentDropdown.$el,i=$(t.target).closest(this.attr.isSelectableSelector,e);i.length||(event.stopPropagation(),event.preventDefault())},this.dropdownIsOpen=function(){return!!this.currentDropdown&&!!this.currentDropdown.$el},this.maybeRepositionDropdown=function(){var t,e,i,n,s,r=this.currentDropdown.$el,o=r.closest(this.attr.dropdownContainerSelector);o.length>0&&!r.hasClass("pos-t")&&(t=r.offset().top,s=r.outerHeight(),i=t+s,e=o.offset().top,n=e+o.height(),TD.util.isTouchDevice()&&TD.decider.get("touchdeck_dropdowns_v2")&&TD.decider.get("touchdeck_tweet_controls_v3")&&(s+=25),i>=n&&t-s>e&&r.addClass("pos-t"))}}var i=t("flight/lib/compose"),n=t("ui/with_template"),s=t("ui/with_focus");return e}),define("ui/drag_drop/with_drag_drop",["require"],function(t){function e(){this.attributes({eventMap:{uiDragStart:"dragstart",uiDragEnd:"dragend",mousedown:"predrag"},dropTargetClass:"with-drop-target",draggableSelector:".is-draggable"}),this.setupDragDrop=function(t){t.type||(t.type=["*"]),"string"==typeof t.type&&(t.type=[t.type]),_.contains(t.type,"*")&&(t.wantsAll=!0),"undefined"!=typeof t.indicateDrop&&(this.indicateDrop=!!t.indicateDrop),t.drop&&this.indicateDrop!==!1&&(this.indicateDrop=!0),this.listeners.push(t)},this.hasSetupDragDrop=function(){return this.listeners.length>0},this.wantsDragType=function(t){return this.listeners.some(function(e){return e.wantsAll||_.contains(e.type,t)}.bind(this))},this.notifyListeners=function(t,e){this.listeners.forEach(function(i){if(i.wantsAll||_.contains(i.type,e.type)){var n=i[t.type]||i[this.attr.eventMap[t.type]];n&&"function"==typeof n&&n.call(i.context||this,t,e)}}.bind(this))},this.saveDragState=function(t){return function(e,i){return this.dragDropState={active:!0,data:i},t.apply(this,[].slice.call(arguments))}},this.clearDragState=function(t){return function(e,i){return this.dragDropState=this.dragDropStateInit,t.apply(this,[].slice.call(arguments))}},this.retrieveDragState=function(t){return function(e){return t.call(this,e,this.dragDropState.data)}},this.retrieveAndNotify=function(){return this.retrieveDragState(this.notifyListeners)},this.extractDataFromEvent=function(t){var e=$(t.target).attr("data-drag-type"),i=t.target.tagName.toLowerCase();return e=e||i,{type:e,el:t.target}},this.whenActive=function(t){return function(e){var i=this.dragDropState.active&&this.wantsDragType(this.dragDropState.data.type);return i?t.apply(this,arguments):void 0}.bind(this)},this.whenSetup=function(t){return function(){return this.hasSetupDragDrop()?t.apply(this,arguments):void 0}.bind(this)},this.whenSetupAndActive=function(t){return this.whenSetup(this.whenActive(t))},this.before("initialize",function(){this.listeners=[],this.dragDropState=this.dragDropStateInit={active:!1,data:{}},this.indicateDrop=!0,this.dragDepth=0}),this.after("initialize",function(){this.on(document,"uiDragStart",this.whenSetup(this.saveDragState(this.notifyListeners))),this.on(document,"uiDragEnd",this.whenSetup(function(){this.dragDepth=0,this.clearDragState(this.notifyListeners).apply(this,arguments)})),this.on("drop",this.whenSetupAndActive(function(t){t.preventDefault(),this.dragDepth=0,this.retrieveAndNotify().apply(this,arguments)})),this.on("dragenter",this.whenSetupAndActive(function(t){this.dragDepth+=1,1===this.dragDepth&&this.retrieveAndNotify().apply(this,[].slice.call(arguments))})),this.on("dragleave",this.whenSetupAndActive(function(t){this.dragDepth-=1,this.dragDepth<=0&&(this.dragDepth=0,this.retrieveAndNotify().apply(this,[].slice.call(arguments)))})),this.on("dragover",this.whenSetupAndActive(function(t){this.indicateDrop===!0&&t.preventDefault(),this.retrieveAndNotify().apply(this,[].slice.call(arguments))})),this.on("mousedown",{draggableSelector:this.whenSetup(function(t,e){var i=this.extractDataFromEvent({target:e.el});this.notifyListeners(t,i)})})})}return e}),define("ui/with_spinner_button",[],function(){function t(){this.attributes({spinnerButtonSelector:".js-spinner-button",spinnerButtonActiveSelector:".js-spinner-button-active",spinnerButtonActiveClass:"spinner-button-is-active",spinnerButtonHiddenClass:"is-hidden"}),this.spinnerButtonToggle=function(t){var e=this.select("spinnerButtonSelector"),i=this.select("spinnerButtonActiveSelector");e.toggleClass(this.attr.spinnerButtonActiveClass,t),i.toggleClass(this.attr.spinnerButtonHiddenClass,!t)}}return t}),define("ui/with_add_to_customtimeline",["flight/lib/compose","ui/with_spinner_button","ui/with_template"],function(t,e,i){function n(){t.mixin(this,[e,i]),this.eventIsForCustomTimeline=function(t,e){var i=this.select("addToCustomTimelineInputSelector"),n=TD.util.extractTweetIdFromPermalink(i.val());return e.action.tweetId===n&&e.action.id===i.data(this.attr.customTimelineIdDataAttr)},this.attributes({addToCustomTimelineSelector:".js-add-to-customtimeline",addToCustomTimelineTemplate:"column/add_to_customtimeline",addToCustomTimelineInputSelector:".js-add-to-customtimeline-input",addToCustomTimelineButtonSelector:".js-add-to-customtimeline-button",customTimelineIdDataAttr:"customtimeline-id"}),this.renderAddToCustomTimeline=function(t,e){var i=this.toHtml(this.attr.addToCustomTimelineTemplate,{accountKey:t,customTimelineId:e});this.select("addToCustomTimelineSelector").html(i).removeClass("is-hidden"),this.on("uiInputSubmit",{addToCustomTimelineInputSelector:this.addTweetToCustomTimeline}),this.on("click",{addToCustomTimelineButtonSelector:this.addTweetToCustomTimeline}),this.on(document,"dataAddTweetToCustomTimelineSuccess",function(t,e){this.eventIsForCustomTimeline(t,e)&&(this.spinnerButtonToggle(!1),e.result.response.errors&&e.result.response.errors.length?TD.controller.progressIndicator.addMessage(TD.i("Unable to add that Tweet")):this.select("addToCustomTimelineInputSelector").val(""))}),this.on("dataAddTweetToCustomTimelineError",function(t,e){this.eventIsForCustomTimeline(t,e)&&(this.spinnerButtonToggle(!1),TD.controller.progressIndicator.addMessage(TD.i("Unable to add that Tweet")))})},this.addTweetToCustomTimeline=function(){var t=this.select("addToCustomTimelineInputSelector"),e=t.data("account-key"),i=t.data("customtimeline-id"),n=t.val(),s=TD.util.extractTweetIdFromPermalink(n);s?(this.trigger(document,"uiAddTweetToCustomTimeline",{account:e,id:i,tweetId:s}),this.spinnerButtonToggle(!0)):(TD.controller.progressIndicator.addMessage(TD.i("Can't recognize Tweet URL")),this.spinnerButtonToggle(!1))}}return n}),define("ui/with_edit_customtimeline",["flight/lib/compose","ui/with_template"],function(t,e){function i(){t.mixin(this,[e]),this.attributes({editCustomTimelineSelector:".js-edit-customtimeline",editCustomTimelineTemplate:"column/edit_customtimeline",customTimelineTitleSelector:".js-customtimeline-title",customTimelineDescSelector:".js-customtimeline-desc"}),this.after("initialize",function(){this.on(this.$node,"change uiInputSubmit",{customTimelineTitleSelector:this.saveCustomTimelineState,customTimelineDescSelector:this.saveCustomTimelineState})}),this.renderEditCustomTimeline=function(t,e){var i=this.column.getCustomTimeline();if(i){var n=this.toHtml(this.attr.editCustomTimelineTemplate,{customTimelineName:i.name,customTimelineDescription:i.description,withTitle:t,withDescription:e});this.$editCustomTimeline=this.select("editCustomTimelineSelector"),this.$editCustomTimeline.html(n)}},this.saveCustomTimelineState=function(){var t=this.column.getCustomTimeline(),e=this.select("customTimelineTitleSelector").val(),i=this.select("customTimelineDescSelector").val(),n=void 0!==e&&e!==t.name,s=void 0!==i&&i!==t.description;(n||s)&&(this.trigger(document,"uiUpdateCustomTimeline",{account:t.account.getKey(),id:t.id,name:e,description:i}),this.on(document,"dataCustomTimelineSuccess",function(){var t;this.off(document,"dataCustomTimelineSuccess"),n&&s?t=TD.i("Collection updated"):n?t=TD.i("Title updated"):s&&(t=TD.i("Description updated")),t&&TD.controller.progressIndicator.addMessage(t)}))}}return i}),define("util/with_rebroadcast",[],function(){function t(){this.rebroadcast=function(t){return function(e){return this._isRebroadcasting?void 0:(this._isRebroadcasting=!0,this.trigger(e,t.apply(this,[].slice.call(arguments))),this._isRebroadcasting=!1,e.stopPropagation(),!1)}.bind(this)}}return t}),define("ui/with_will_animate",[],function(){var t=_.memoize(function(){var t=window.navigator.userAgent,e=t.match(/Chrome\/([\d]+)\./),i=t.match(/AppleWebKit\/([\d]+)\./);return e&&parseInt(e[1],10)>=35?!0:"mac"===TD.util.getAppEnv()&&i&&parseInt(i[1],10)>=537?!0:!1});return function(){this.applyWillAnimate=function(e){t()&&$(e).addClass("will-animate")}}}),define("ui/dm_rename_conversation",["require","flight/lib/component"],function(t){"use strict";function e(){this.attributes({renameParentContainer:".js-detail-header",renameHeaderText:".js-tooltip-target",renameContainerSelector:".js-edit-conversation-name",renameInputSelector:".js-conversation-name",renameConfirmSelector:'[data-action="confirm-edit-conversation"]',renameCloseSelector:'[data-action="close-edit-conversation"]'}),this.after("initialize",function(){this.on("uiRenameConversation",this.handleRenameConversation),this.on("click",{renameConfirmSelector:this.handleRenameConversationActions,renameCloseSelector:this.handleRenameConversationActions}),this.on("uiInputEscape uiInputSubmit",{renameInputSelector:this.handleRenameConversationKeypress})}),this.handleRenameConversation=function(t,e){var i=e.name||"",n=this.select("renameContainerSelector"),s=this.select("renameInputSelector").val(i).focus();i&&(s[0].selectionStart=0,s[0].selectionEnd=i.length),n.addClass("is-visible")},this.handleRenameConversationKeypress=function(t,e){this.performRenameConversation("uiInputSubmit"===t.type?$(e.el).val().trim():"")},this.performRenameConversation=function(t){var e=this.select("renameContainerSelector");if(t.length>0){var i=e.data("conversation-id");this.trigger("uiUpdateConversationName",{conversationId:i,name:t})}e.removeClass("is-visible")},this.handleRenameConversationActions=function(t,e){var i=$(e.el),n=this.select("renameInputSelector"),s=i.is(this.attr.renameConfirmSelector)?n.val().trim():"";this.performRenameConversation(s),t.stopPropagation()}}var i=t("flight/lib/component");return i(e)}),define("ui/column",["require","flight/lib/component","ui/asynchronous_form","ui/custom_timeline_description","ui/dm_conversation_participants","ui/social_proof_for_tweet","ui/with_column_selectors","ui/with_transitions","ui/with_dropdown","ui/drag_drop/with_drag_drop","ui/with_add_to_customtimeline","ui/with_edit_customtimeline","util/with_rebroadcast","with-child-components","ui/with_will_animate","ui/dm_rename_conversation","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({columnMessageSelector:".js-column-message",columnMessageTemplate:"column/column_message",filterErrorTemplate:"column/column_filter_error",filterErrorClass:"filter-error",showDetailViewClass:"is-shifted-1",showSocialProofClass:"is-shifted-2",socialProofSelector:".js-column-social-proof",columnStateDefault:"default",columnStateDetailView:"detailView",columnStateSocialProof:"socialProof",columnScrollerIsAnimatingClass:"is-column-scroller-animating",isNewClass:"is-new",chirpSelector:".js-stream-item",tweetActionsSelector:".js-tweet-actions",tweetActionsVisibleClass:"is-visible",animateInClass:"anim-rotate-in",animateOutClass:"anim-rotate-out",customTimelineDescriptionSelector:".js-customtimeline-description",shareColumnSelector:".js-share-column",focusId:null,tweetImpressionTrackingPeriod:250,scribeElementSelector:"[data-scribe-element]",userSelectorInputSelector:".js-username-input"}),this.after("initialize",function(){this.attachChild(f,this.$node),this.applyWillAnimate(this.$node),this.columnKey=this.$node.data("column"),this.column=TD.controller.columnManager.get(this.columnKey),this.visibleChirpsTierTwo={},this.visibleChirpsTierThree={};var t,e,i,n=this.column.getCustomTimelineFeed(),r=this.column.isOwnCustomTimeline();r&&(t=n.getMetadata(),e=t.id,i=TD.storage.Account.generateKeyFor("twitter",t.ownerId)),this.targetTopPosition=0,this.$socialProofContainer=this.select("socialProofSelector"),this.$columnOptions=this.select("columnOptionsSelector"),this.$scrollContainer=this.select("scrollContainerSelector"),this.createNewHeightCache(),this.renderColumnMessage(),this.attr.tweetImpressionTrackingPeriod>0&&(this.scribeTweetImpressions=_.throttle(this.scribeTweetImpressions.bind(this),this.attr.tweetImpressionTrackingPeriod)),this.setupDragDrop({type:"tweet",indicateDrop:!1,predrag:function(t,e){$(e.el).closest(this.attr.tweetActionsSelector).addClass(this.attr.tweetActionsVisibleClass)},dragend:function(t,e){$(e.el).closest(this.attr.tweetActionsSelector).removeClass(this.attr.tweetActionsVisibleClass)}}),this.on("click",{shareColumnSelector:this.handleShareColumnButtonClick,scribeElementSelector:this.handleScribeElementClick}),this.on("uiViewTimeline",this.handleViewTimeline),this.on("uiReferenceTimeline",this.handleReferenceTimeline),this.on("uiDetailViewActive",this.handleDetailViewActive),this.on("uiDetailViewClosed",this.handleDetailViewClosed),this.on("uiCloseDetailView",this.handleCloseDetailView),this.on("uiSocialProofForTweetClosed",this.handleSocialProofClosed),this.on("uiShowSocialProof",this.handleShowSocialProof),this.on("uiCloseSocialProof",this.handleCloseSocialProof),this.on(document,"uiShowDmParticipants",this.handleShowDmParticipants),this.on("uiDmParticipantsClosed",this.handleCloseDmParticipants),this.on("uiColumnOptionsShown",this.handleColumnOptionsShown),this.on("uiHidingColumnOptions",this.handleHidingColumnOptions),this.on("uiShowingColumnOptions",this.handleShowingColumnOptions),this.on("uiColumnOptionsHidden",this.handleColumnOptionsHidden),this.on("uiMarkAllMessagesRead",this.handleMarkAllRead),this.on("uiReadStateChange",this.handleColumnReadStatus),this.on(document,"uiMessageThreadRead",this.handleMessageThreadRead),this.on(document,"uiMessageUnreadCount",this.handleMessageCount),this.on("uiTransitionExpandStart",{columnOptionsContainerSelector:function(t,e){this.fixColumnTop(),this.moveColumnTop(e.delta)}.bind(this)}),this.on("uiAccordionTotalHeightChanged",{columnOptionsContainerSelector:this.fixColumnTop}),this.on("uiColumnUpdateSearchFilter",this.handleUpdateSearchFilter),this.on("uiColumnUpdateMediaPreview",this.handleUpdateMediaPreview),this.on("dataColumnUpdatingFilters dataColumnUpdatingFeed",this.handleColumnUpdating),this.on("dataColumnFiltersUpdated dataColumnFeedUpdated",this.handleColumnUpdated),this.on("uiRemoveColumn",this.handleUiRemoveColumn),this.on(document,"dataSerializedColumn",this.handleSerializedColumn),this.on(document,"dataSettingsValues",this.handleSettingsChange),this.on(document,"uiColumnUpdateMediaPreview",this.handleMediaPreviewChange),this.on(document,"uiFocus",function(t,e){this.hasFocus=e.id===this.attr.focusId,this.hasFocus&&this.scribeTweetImpressions()}),this.on(this.$scrollContainer,"scroll",this.scribeTweetImpressions),this.on(document,"uiColumnVisibilities",this.handleColumnVisibilities),this.on(document,"uiColumnChirpsChanged",function(t,e){e.id===this.columnKey&&this.scribeTweetImpressions()}),this.on("uiDetailViewClosed uiTransitionExpandEnd",this.scribeTweetImpressions),this.on(document,TD.util.visibilityChangeEventName(),function(t){this.scribeTweetImpressions()}),this.on(window,"beforeunload",this.scribeAllChirpsHidden),r&&(this.setupDragDrop({type:"tweet",indicateDrop:!0,dragenter:this.addDropTargetClass,dragleave:this.removeDropTargetClass,dragend:this.removeDropTargetClass,drop:function(t,e){var i=this.getAllCustomTimelineData();this.trigger("uiAddTweetToCustomTimeline",{id:i.metadata.id,tweetId:$(e.el).attr("data-tweet-id"),account:i.account})}}),this.renderAddToCustomTimeline(i,e),this.select("columnContentSelector").addClass("with-add-by-url"),this.on(document,"dataAddTweetToCustomTimelineSuccess",this.refreshCustomTimelineFeed.bind(this)),this.on(document,"dataRemoveTweetFromCustomTimelineSuccess",this.removeChripFromCustomTimelineFeed.bind(this)),this.on("uiRemoveTweetFromCustomTimeline",this.rebroadcast(this.transformRemoveTweetFromCustomTimeline))),n&&this.attachChild(s,this.select("customTimelineDescriptionSelector"),{withAutoComplete:!1,customTimelineId:n.getMetadata().id,isOwnCustomTimeline:this.column.isOwnCustomTimeline(),readOnly:this.column.temporary,accountKey:n.getAccountKey(),maxCharCount:160})}),this.handleScribeElementClick=function(t){var e=$(t.target);if(this.column.isDataminr()&&(this.$scrollContainer.find(e).length||this.column.detailViewComponent)){var i=e.closest(this.attr.scribeElementSelector).attr("data-scribe-element"),n=this.column.detailViewComponent?"dataminr_alert_detail":"dataminr_alert";TD.controller.stats.dataminrClickImpression(n,i)}},this.setColumnState=function(t){switch(this.$node.removeClass([this.attr.showDetailViewClass,this.attr.columnStateDetailViewClass,this.attr.showSocialProofClass,this.attr.columnStateSocialProofClass].join(" ")),t){case this.attr.columnStateDetailView:this.$node.addClass(this.attr.showDetailViewClass),this.$node.addClass(this.attr.columnStateDetailViewClass);break;case this.attr.columnStateSocialProof:this.$node.addClass(this.attr.showSocialProofClass),this.$node.addClass(this.attr.columnStateSocialProofClass),TD.ui.main.TRANSITION_END_EVENTS?this.$node.one(TD.ui.main.TRANSITION_END_EVENTS,function(){this.select("userSelectorInputSelector").focus()}.bind(this)):this.select("userSelectorInputSelector").focus()}},this.handleDetailViewActive=function(){this.setColumnState(this.attr.columnStateDetailView),this.scribeAllChirpsHidden()},this.handleDetailViewClosed=function(){this.setColumnState(this.attr.columnStateDefault),this.column.detailViewComponent=null},this.handleCloseDetailView=function(){this.column.detailViewComponent.destroy()},this.handleShowSocialProof=function(t,e){o.attachTo(this.$socialProofContainer,{type:e.type,tweetSummary:e.tweetSummary}),this.setColumnState(this.attr.columnStateSocialProof)},this.handleSocialProofClosed=function(){this.setColumnState(this.attr.columnStateDetailView)},this.handleCloseSocialProof=function(){this.trigger(this.$socialProofContainer,"uiSocialProofForTweetClose")},this.handleShowDmParticipants=function(t,e){e.columnKey===this.columnKey&&(r.attachTo(this.$socialProofContainer,e),this.setColumnState(this.attr.columnStateSocialProof))},this.handleCloseDmParticipants=function(t,e){this.setColumnState(this.attr.columnStateDetailView)},this.handleUiRemoveColumn=function(){this.scribeAllChirpsHidden(),this.teardown()},this.handleShareColumnButtonClick=function(t,e){var i=$(e.el);this.toggleShareMenu(t,i)},this.toggleShareMenu=function(t,e){t.preventDefault(),t.stopPropagation();var i=this.attr.dropdownPositions;this.renderDropdown(e,"menus/column_share",{isEmbeddable:this.column.isEmbeddable(),isShareable:this.column.isShareable(),isViewable:this.column.isViewable()},{position:[i.offsetRight,i.underLeftIcon].join(" "),toggle:!0})},this.getCustomTimelineDataForPermalink=function(){var t=this.column.getCustomTimelineFeed(),e=t.getMetadata(),i=TD.util.deMentionify(TD.cache.names.getScreenName(e.ownerId)),n=TD.cache.names.getCustomTimelineName(e.id,e.ownerId);if(!i)throw new Error("Could not get username from name cache.");return{username:i,name:n,id:e.id.replace(/[^\d]*/,"")}},this.getCustomTimelinePermalinkURL=function(){var t=this.getCustomTimelineDataForPermalink(),e=w.toURLFromRaw("https://twitter.com/{{username}}/timelines/{{id}}",{username:t.username,id:t.id});return e},this.getCustomTimelinePermalinkURLWithDescription=function(){var t=this.getCustomTimelineDataForPermalink(),e=w.toHtmlFromRaw("{{name}} - @{{username}} https://twitter.com/{{username}}/timelines/{{id}}",{name:t.name,username:t.username,id:t.id});return e},this.handleViewTimeline=function(){var t=this.getCustomTimelinePermalinkURL();TD.util.openURL(t)},this.handleReferenceTimeline=function(){var t=this.column.getColumnType();"col_customtimeline"===t?this.trigger("uiComposeTweet",{appendText:this.getCustomTimelinePermalinkURLWithDescription()}):this.trigger("uiNeedsSerializedColumn",{columnId:this.columnKey})},this.handleShowingColumnOptions=function(t,e){var i=this.select("columnMessageSelector");i.css({opacity:0}),this.transitionCollapse(i)},this.handleColumnOptionsShown=function(t,e){n.attachTo(this.$columnOptions)},this.handleHidingColumnOptions=function(t){this.trigger(this.$columnOptions,"uiDestroyAsynchronousForm"),this.renderColumnMessage()},this.handleColumnOptionsHidden=function(t,e){var i=this.select("columnMessageSelector");i.animate({opacity:1},150,"easeInOutQuad")},this.renderColumnMessage=function(){var t,e=this.select("columnMessageSelector");this.column.hasActiveSearchFilters()?(this.column.hasFilterError()?(t=$(w.render(this.attr.filterErrorTemplate)),e.addClass(this.attr.filterErrorClass)):(t=$(w.render(this.attr.columnMessageTemplate,{action:this.column.hasActiveActionFilters()&&!this.column.isSingleActionTypeColumn(),content:this.column.hasActiveContentFilters(),user:this.column.hasActiveUserFilters(),engagement:this.column.hasActiveEngagementFilters()})),e.removeClass(this.attr.filterErrorClass)),this.animateElementContentHeight(e,t)):this.animateElementContentHeight(e,"")},this.handleSettingsChange=function(t,e){(e.font_size||e.column_width)&&(this.createNewHeightCache(),this.scribeTweetImpressions())},this.handleMediaPreviewChange=function(t,e){this.createNewHeightCache(),this.scribeTweetImpressions()},this.createNewHeightCache=function(){this.chirpHeightCache=new TD.cache.LRUQueue(200)},this.moveColumnTop=function(t,e){if(0!==t){var i=this.select("scrollContainerSelector"),n=this.select("columnUpdateGlow");e=e||void 0===e,this.targetTopPosition+=t,e?(this.transitionTop(i,this.attr.columnScrollerIsAnimatingClass,this.targetTopPosition),this.transitionTop(n,this.attr.columnScrollerIsAnimatingClass,this.targetTopPosition)):(i.css("top",this.targetTopPosition),n.css("top",this.targetTopPosition))}},this.getColumnTopError=function(){var t,e=this.select("scrollContainerSelector"),i=0;return e.hasClass(this.attr.columnScrollerIsAnimatingClass)||(t=this.select("columnOptionsContainerSelector").height(),i=t-this.targetTopPosition),i},this.fixColumnTop=function(){this.moveColumnTop(this.getColumnTopError(),!1)},this.handleShowUserFilter=function(){this.trigger(this.$columnOptions,"uiShowUserFilter")},this.handleShowContentFilter=function(){this.trigger(this.$columnOptions,"uiShowContentFilter")},this.handleUpdateSearchFilter=function(t,e){this.column.updateSearchFilter(e)},this.handleUpdateMediaPreview=function(t,e){this.column.setMediaPreviewSize(e.value)},this.handleColumnUpdating=function(){this.trigger(this.$columnOptions,"uiWaitingForAsyncResponse")},this.handleColumnUpdated=function(){this.trigger(this.$columnOptions,"uiReceivedAsyncResponse")},this.handleMarkAllRead=function(){this.column.markAllMessagesAsRead()},this.handleSerializedColumn=function(t,e){if(e.columnId===this.columnKey){var i=w.toHtmlFromRaw("Check out this TweetDeck column: {{url}}",{name:this.column.model.getTitle(),url:e.url});this.trigger("uiComposeTweet",{appendText:i})}},this.handleMessageCount=function(t,e){if(this.columnKey===e.columnKey){var i=this.select("columnUnreadCountSelector"),n=i.text()||"0",s="0"===n&&"0"!==e.count,r="0"!==n&&"0"===e.count;i.text(e.count),s&&(this.stopAnimation(i,this.attr.animateOutClass),i.addClass("is-visible"),this.addAnimateClass(i,this.attr.animateInClass)),r&&(this.stopAnimation(i,this.attr.animateInClass),this.addAnimateClass(i,this.attr.animateOutClass,function(){i.removeClass("is-visible")}))}},this.handleColumnReadStatus=function(t,e){this.column.isMessageColumn()||(e.columnKey=this.columnKey,this.$node.toggleClass(this.attr.isNewClass,!e.read))},this.handleMessageThreadRead=function(t,e){this.column.isMessageColumn()&&this.trigger(document,"uiMessageUnreadCount",{columnKey:this.columnKey,count:this.column.unreadMessageCount()})},this.handleColumnVisibilities=function(t,e){var i=this.column.visibility,n=e[this.columnKey];n&&(this.column.visibility=n,i.visibleFraction!==n.visibleFraction&&this.scribeTweetImpressions())},this.getChirpVerticalVisibileFraction=function(t,e){if(0>=e)return 0;var i=Math.min(this.scrollContainerHeight,Math.max(0,t)),n=Math.min(this.scrollContainerHeight,Math.max(0,t+e)),s=n-i;return s/e},this.scribeTweetImpressions=function(){var t=this.column.temporary||this.column.visibility.visibleFraction>.5,e=this.$node.hasClass(this.attr.columnStateDetailViewClass)||this.$node.hasClass(this.attr.columnStateSocialProofClass);if(TD.util.documentIsHidden()||e||!t)this.setAllChirpsHidden();else{var i=Date.now();this.updateVisibleChirps(i),this.updateVisibleChirpsWithEndTimes(i),TD.controller.stats.tweetStreamImpression(this.column.getColumnType(),this.getChirpsToScribeTierTwo())}TD.controller.stats.tweetStreamImpression(this.column.getColumnType(),this.getChirpsToScribeTierThree(),!0),this.removeScribedChirpsFromVisibleChirps()},this.scribeAllChirpsHidden=function(){this.setAllChirpsHidden(),TD.controller.stats.tweetStreamImpression(this.column.getColumnType(),this.getChirpsToScribeTierThree(),!0)},this.updateVisibleChirps=function(t){var e=!1;this.scrollContainerHeight=this.$scrollContainer.height();var i=null;this.select("chirpSelector").each(function(n,s){var r=$(s),o=r.attr("data-key"),a=this.chirpHeightCache.get(o);if(!a){if(a=r.height(),0>=a)return;this.chirpHeightCache.enqueue(o,a)}var c;c=null===i?r.position().top:i+1,i=c+a;var u=this.getChirpVerticalVisibileFraction(c,a),h=u*(this.column.temporary?1:this.column.visibility.visibleFraction);if(0>=h&&e)return!1;if(h>0){e=!0;var l=this.visibleChirpsTierTwo[o];l||(l={scribed:!1}),this.visibleChirpsTierTwo[o]=l}if(h>.5){var d=this.visibleChirpsTierThree[o];d||(d={scribed:!1,visibilityStart:t}),d.knownVisible=!0,this.visibleChirpsTierThree[o]=d}}.bind(this))},this.updateVisibleChirpsWithEndTimes=function(t){Object.keys(this.visibleChirpsTierThree).forEach(function(e){var i=this.visibleChirpsTierThree[e];i.knownVisible||(i.visibilityEnd=t),this.visibleChirpsTierThree[e]=i},this)},this.getChirpsToScribeTierThree=function(){
var t=[];return Object.keys(this.visibleChirpsTierThree).forEach(function(e){var i,n=this.visibleChirpsTierThree[e];n.visibilityStart&&n.visibilityEnd&&(n.visibilityEnd-n.visibilityStart>500&&(i=this.column.findMostInterestingChirp(e),i instanceof TD.services.TwitterStatus&&t.push(i.getScribeItemData(n))),n.scribed=!0,this.visibleChirpsTierThree[e]=n)},this),t},this.getChirpsToScribeTierTwo=function(){var t=[];return Object.keys(this.visibleChirpsTierTwo).forEach(function(e){var i,n=this.visibleChirpsTierTwo[e];this.column.scribedImpressionIDs.get(e)||(i=this.column.findMostInterestingChirp(e),i instanceof TD.services.TwitterStatus&&t.push(i.getScribeItemData(n)),this.column.scribedImpressionIDs.enqueue(e,!0)),n.scribed=!0,this.visibleChirpsTierTwo[e]=n},this),t},this.removeScribedChirpsFromVisibleChirps=function(){Object.keys(this.visibleChirpsTierTwo).forEach(function(t){var e=this.visibleChirpsTierTwo[t];e.scribed&&delete this.visibleChirpsTierTwo[t]},this),Object.keys(this.visibleChirpsTierThree).forEach(function(t){var e=this.visibleChirpsTierThree[t];e.scribed?delete this.visibleChirpsTierThree[t]:(e.knownVisible=!1,this.visibleChirpsTierThree[t]=e)},this)},this.setAllChirpsHidden=function(){var t=Date.now();Object.keys(this.visibleChirpsTierThree).forEach(function(e){this.visibleChirpsTierThree[e].visibilityEnd=t},this)},this.getAllCustomTimelineData=function(){var t=this.column.getCustomTimelineFeed(),e=this.column.getCustomTimeline(),i=t.getMetadata(),n=e.account.getKey(),s=TD.controller.feedManager.getPoller(t.getKey());return{feed:t,customTimeline:e,metadata:i,account:n,poller:s}},this.customTimelineActionWasMe=function(t){var e=this.column.getCustomTimelineFeed();if(e){var i=e.getMetadata();if(i)return t.action.id===i.id}},this.refreshCustomTimelineFeed=function(t,e){if(this.customTimelineActionWasMe(e)){var i=this.getAllCustomTimelineData();i.poller.refresh()}},this.removeChripFromCustomTimelineFeed=function(t,e){if(this.customTimelineActionWasMe(e)){var i=this.getAllCustomTimelineData();i.poller.removeWhere(function(t){return t.id===e.action.tweetId})}},this.transformRemoveTweetFromCustomTimeline=function(t,e){var i=this.getAllCustomTimelineData();return{id:i.metadata.id,tweetId:e.tweetId,account:i.account}},this.isOfMetaType=function(t){if(!this.column||!this.column.getColumnType)return!1;var e=this.column.getColumnType();return e===TD.util.columnUtils.columnMetaTypes[t]},this.addDropTargetClass=function(t,e){this.$node.addClass(this.attr.dropTargetClass)},this.removeDropTargetClass=function(t,e){this.$node.removeClass(this.attr.dropTargetClass)}}var i=t("flight/lib/component"),n=t("ui/asynchronous_form"),s=t("ui/custom_timeline_description"),r=t("ui/dm_conversation_participants"),o=t("ui/social_proof_for_tweet"),a=t("ui/with_column_selectors"),c=t("ui/with_transitions"),u=t("ui/with_dropdown"),h=t("ui/drag_drop/with_drag_drop"),l=t("ui/with_add_to_customtimeline"),d=t("ui/with_edit_customtimeline"),m=t("util/with_rebroadcast"),g=t("with-child-components"),p=t("ui/with_will_animate"),f=t("ui/dm_rename_conversation"),w=t("scripts/UI/template");return i(e,a,c,u,h,l,d,m,g,p)}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("util/animation_frame",[],e):_.extend(t,e())}(this,function(){var t=0,e=["ms","moz","webkit","o"],i={};i={requestAnimationFrame:window.requestAnimationFrame,cancelAnimationFrame:window.cancelAnimationFrame};for(var n=0;n<e.length&&!i.requestAnimationFrame;n+=1)i.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],i.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];return i.requestAnimationFrame||(i.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),s=window.setTimeout(function(){e(i+n)},n);return t=i+n,s}),i.cancelAnimationFrame||(i.cancelAnimationFrame=function(t){clearTimeout(t)}),i}),define("util/easing",["require","util/animation_frame"],function(t){function e(t){var e=o[t];if(!e)throw"No such method";return function(t,i,n){return i+n*e(t)}}function i(t){if(t=t||{},[typeof t.from,typeof t.time,typeof t.applicator].indexOf("undefined")>-1)throw new Error("animate requires from, time and applicator.");var i=parseFloat(t.from);if(!_.isNumber(i))throw new Error("A numeric from value is required.");if("undefined"==typeof t.to&&"undefined"==typeof t.delta)throw new Error("animate either a to amount or a delta.");var o=parseFloat(t.to);if("undefined"!=typeof t.delta&&(o=i+parseFloat(t.delta)),!_.isNumber(o))throw new Error("A numeric to value is required.");var a=t.time;_.isNumber(a)||(a=parseFloat(a));var c=t.easing;"function"!=typeof c&&(c=e("linear"));var u=t.applicator;if("function"!=typeof u)throw new Error("applicator must be a function.");var h=t.name,l=t.done||function(){},d=Date.now(),m=o-i;0!==m&&(h&&(s[h]=r),n(function g(t){var e=Date.now()-d,r=e/a;return e>=a?(u(c(1,i,m)),l(e)):h&&s[h]!==t?l(e):(n(g.bind(this,t)),void u(c(r,i,m),i,r))}.bind(this,r)),r+=1)}var n=t("util/animation_frame").requestAnimationFrame,s={},r=1,o={linear:function(t){return t},inQuad:function(t){return t*t},outQuad:function(t){return t*(2-t)},inOutQuad:function(t){return.5>t?2*t*t:-1+(4-2*t)*t},inCubic:function(t){return t*t*t},outCubic:function(t){return--t*t*t+1},inOutCubic:function(t){return.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},inQuart:function(t){return t*t*t*t},outQuart:function(t){return 1- --t*t*t*t},inOutQuart:function(t){return.5>t?8*t*t*t*t:1-8*--t*t*t*t},inQuint:function(t){return t*t*t*t*t},outQuint:function(t){return 1+--t*t*t*t*t},inOutQuint:function(t){return.5>t?16*t*t*t*t*t:1+16*--t*t*t*t*t}};return{easeFn:e,ease:i}}),define("ui/drag_drop/with_drag_scroll",["require","util/easing"],function(t){function e(){this.attributes({defaultDragScrollConfig:{regionSize:20,maxSpeed:400,throttlePeriod:200,horizontal:!0,vertical:!1,deltaFn:function(t,e,i,n){return t}}}),this.before("initialize",function(){this.animateScrollLeft=this.animateScroll.bind(this,"scrollLeft"),this.animateScrollTop=this.animateScroll.bind(this,"scrollTop"),this.dragScrollId=_.uniqueId("drag-scroll")}),this.handleDrag=function(t,e,i,n){if(this.justDropped)return void(this.justDropped=!1);var s=$(n.el),r=this.mousePositionRelativeToElement(s,i.originalEvent),o={};o.left=r.x/s.width()*100,o.right=100-o.left,o.top=r.y/s.height()*100,o.bottom=100-o.top;var a={};a.left=-this.percToDelta(o.left,t),a.right=this.percToDelta(o.right,t),a.up=-this.percToDelta(o.top,t),a.down=this.percToDelta(o.bottom,t),t.horizontal!==!1&&(o.left<t.regionSize?this.animateScrollLeft(s,"left",a.left,t,e.left):o.right<t.regionSize&&this.animateScrollLeft(s,"right",a.right,t,e.right)),t.vertical!==!1&&(o.top<t.regionSize?this.animateScrollTop(s,"up",a.up,t,e.up):o.bottom<t.regionSize&&this.animateScrollTop(s,"down",a.down,t,e.down))},this.setupDragScroll=function(t,e){e=_.defaults(e||{},this.attr.defaultDragScrollConfig);var i={up:{},down:{},left:{},right:{}},n={};n[t]=_.throttle(this.handleDrag.bind(this,e,i),e.throttlePeriod),this.on("dragover",n),this.on("drop",function(){this.justDropped=!0})},this.percToDelta=function(t,e){var i=t/e.regionSize;return e.maxSpeed-e.maxSpeed*i},this.animateScroll=function(t,e,n,s,r,o){var a=$(e);if(!a[t])throw new Error("$elem has no method "+t);o.startTime||(o.startTime=Date.now()),clearTimeout(o.timeout),o.timeout=setTimeout(function(){delete o.startTime},1.1*r.throttlePeriod);var c=Date.now()-o.startTime,u=r.deltaFn.call(this,s,n,h,c),h=a[t]();i.ease({name:this.dragScrollId,from:h,delta:u,time:r.throttlePeriod,applicator:function(e){a[t](e)}})},this.getMousePosition=function(t){var e=0,i=0;return t||(t=window.event),t.pageX||t.pageY?(e=t.pageX,i=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:e,y:i}},this.mousePositionRelativeToElement=function(t,e){var i=$(t),n=i.offset(),s=this.getMousePosition(e);return s.x-=n.left+parseInt(i.css("paddingLeft"),10)+parseInt(i.css("borderLeftWidth"),10),s.y-=n.top+parseInt(i.css("paddingTop"),10)+parseInt(i.css("borderTopWidth"),10),s}}var i=t("util/easing");return e}),define("ui/column_controller",["require","td/UI/columns","flight/lib/component","ui/column","ui/with_column_selectors","ui/with_transitions","ui/drag_drop/with_drag_scroll"],function(t){function e(){this.attributes({columnDragHandleSelector:".js-column-drag-handle",hideTweetDragHandlesClass:"without-tweet-drag-handles",scrollDebounceTime:200,focusId:null,dragScrollActivationOffset:{left:500,right:800},dragScrollActivationResponseDamping:10}),this.after("initialize",function(){this.$scrollContainer=this.select("appColumnsContainerSelector"),this.on(document,"dataColumnOrder",this.setTweetDragHandleState),this.on(document,"uiColumnRendered",this.handleColumnRendered),this.select("columnSelector").each(function(t,e){var i=$(e);n.attachTo(i,{focusId:this.attr.focusId})}.bind(this)),this.setupDragScroll("appColumnsContainerSelector",{deltaFn:function(t,e,i,n){if(!this.attr.dragScrollActivationOffset[e])return t;var s=this.attr.dragScrollActivationOffset[e]/10,r=this.attr.dragScrollActivationResponseDamping,o=1/(1+Math.pow(Math.E,s-n/r));return parseFloat((t*o).toFixed(4))}});var t=["dataColumnOrder","uiToggleNavBarWidth","uiDrawerTransitionComplete"];this.on(document,t.join(" "),this.calculateColumnVisibilities),this.on(this.$scrollContainer,"scroll",_.debounce(this.calculateColumnVisibilities.bind(this),this.attr.scrollDebounceTime)),this.on(window,"resize",this.calculateColumnVisibilities),TD.util.isTouchDevice()&&this.on(this.$scrollContainer,"scroll",function(){TD.util.cancelFastClick()}),this.trigger("uiNeedsColumnOrder")}),this.handleColumnRendered=function(t,e){n.attachTo(e.$column,{column:e.column,focusId:this.attr.focusId})},this.calculateColumnVisibilities=function(){var t=this.select("columnSelector"),e=this.$scrollContainer.width(),i={};t.each(function(t){var n,s=$(this),r=s.position(),o=s.width();r.right=r.left+o,r.left=Math.max(0,r.left),r.right=Math.max(0,r.right),r.left=Math.min(e,r.left),r.right=Math.min(e,r.right),n={columnWidth:o,visibleWidth:r.right-r.left,visibleHeight:s.height()},n.visibleFraction=n.visibleWidth/n.columnWidth,i[s.data("column")]=n}),this.trigger("uiColumnVisibilities",i)},this.setTweetDragHandleState=function(t,e){var i=e.columnOrder.some(function(t){return TD.controller.columnManager.get(t).isOwnCustomTimeline()}),n=!i;this.select("columnsContainerSelector").toggleClass(this.attr.hideTweetDragHandlesClass,n)}}t("td/UI/columns");var i=t("flight/lib/component"),n=t("ui/column"),s=t("ui/with_column_selectors"),r=t("ui/with_transitions"),o=t("ui/drag_drop/with_drag_scroll");return i(e,s,r,o)}),define("ui/grid",["flight/lib/component","ui/with_focus","ui/with_column_selectors"],function(t,e,i){function n(){this.attributes({id:"grid",focusId:null,chirpScrollOffset:20,columnScrollOffset:20,isSelectedClass:"is-selected-tweet",chirpSelector:".js-stream-item",autoFocus:!0,pagingEasingFunction:"easeOutQuad"}),this.after("initialize",function(){this.selectedColumn=null,this.$selectedChirp=$(),this.columnIndex=null,this.chirpCenter=null,this.scrollDirection=this.attr.down,this.chirpOffsetTop=null,this.on(document,"uiKeyLeft",this.moveSelection("left")),this.on(document,"uiKeyUp",this.moveSelection("up")),this.on(document,"uiKeyRight",this.moveSelection("right")),this.on(document,"uiKeyDown",this.moveSelection("down")),this.on(document,"uiGridBack",this.handleBack),this.on(document,"uiGridClearSelection",this.handleClearSelection),this.on(document,"uiColumnFocus",this.handleColumnFocus),this.on(document,"uiGridPageDown",this.handlePagingFactory("down")),this.on(document,"uiGridPageUp",this.handlePagingFactory("up")),this.on(document,"uiGridHome",this.handleGridHome),this.on(document,"uiGridEnd",this.handleGridEnd),this.on(document,"uiKeyEnter",this.tweetActionFactory("viewDetails")),this.on(document,"uiGridReply",this.tweetActionFactory("reply")),this.on(document,"uiGridFavorite",this.tweetActionFactory("favorite")),this.on(document,"uiGridRetweet",this.tweetActionFactory("retweet")),this.on(document,"uiGridDirectMessage",this.tweetActionFactory("dm")),this.on(document,"uiGridProfile",this.tweetActionFactory("profile")),this.on(document,"uiGridCustomTimeline",this.tweetActionFactory("customTimeline")),this.on(document,"uiDetailViewActive",this.handleDetailViewActive),this.on(document,"uiShowSocialProof",this.handleDetailViewActive),this.on(document,"uiDetailViewClosed",this.handleDetailClosed),this.on(document,"uiSkipToReplies",this.handleSkipToReplies),this.on(document,"dataColumns",this.handleDataColumns),this.trigger("uiNeedsColumns")}),this.handleSkipToReplies=function(t,e){var i=this.$selectedChirp.hasClass(this.attr.isSelectedClass);this.selectColumnByKey(e.columnKey),this.selectFirstChirpInSelectedColumn(),this.scrollDirection="up",this.selectNextChirp({forceScroll:!0}),i||this.$selectedChirp.removeClass(this.attr.isSelectedClass)},this.handleDataColumns=function(t,e){e.columns&&(this.columns=e.columns,this.columnIndex=this.columns.indexOf(this.selectedColumn),-1===this.columnIndex&&(this.selectedColumn=null,this.$selectedChirp=$(),this.offset=null))},this.setSelectedColumn=function(t){var e=this.columns.length;0>t?t=0:t>=e&&(t=e-1),this.columns[t]!==this.selectedColumn&&(clearTimeout(this.chirpCenterTimeout),this.chirpCenter=this.calculateChirpCenterRelativeToColumn(this.selectedColumn,this.$selectedChirp),this.chirpCenterTimeout=setTimeout(function(){this.chirpCenter=null}.bind(this),1e3),this.selectedColumn=this.columns[t],this.columnIndex=t,null===this.chirpCenter?this.selectFirstChirpInSelectedColumn():this.selectClosestChirpToOffsetCenter(this.selectedColumn,this.chirpCenter,!0))},this.selectClosestChirpToOffsetCenter=function(t,e,i){var n=this.selectedColumn.model.getKey(),s=this.getColumnScrollContainerByKey(n),r=s.innerHeight(),o=s.find(this.attr.chirpSelector),a=$(),c=null,u=Number.MAX_VALUE;o.each(function(){var t=$(this),i=t.position().top,n=i+t.outerHeight();n>=0&&r>=i&&e>=i&&n>=e&&(a=$().add(t))}),0===a.length?c=o.last():1===a.length?c=a:a.each(function(i,n){var s=this.calculateChirpCenterRelativeToColumn(t,$(n)),r=Math.abs(e-s);u=Math.min(r,u),r===u&&(c=$(n))}.bind(this)),this.setSelectedChirp(c,{doScrollToChirp:i})},this.calculateChirpCenterRelativeToColumn=function(t,e){if(0===e.length||null!==this.chirpCenter)return this.chirpCenter;var i,n,s,r=t.model.getKey(),o=this.getColumnScrollContainerByKey(r).innerHeight();return i=e.position().top,n=e.outerHeight(),s=i+n/2,s>o?s=o:0>s&&(s=0),s},this.selectAndScrollToFirstChirpInSelectedColumn=function(){this.selectFirstChirpInSelectedColumn(),this.scrollToChirp({direction:"up"})},this.selectFirstChirpInSelectedColumn=function(){var t;if(this.isInDetailView())this.$selectedChirp=this.selectedColumn.detailViewComponent.getMostInteresting$Chirp();else if(!this.isInDetailViewLevel2()){t=this.selectedColumn.model.getKey();var e=this.getColumnElementByKey(t).find(this.attr.chirpSelector);this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=$(),e.each(function(t,e){var i=$(e);return i.position().top+i.outerHeight()/2>0?(this.$selectedChirp=i,!1):void 0}.bind(this)),0===this.$selectedChirp.length&&(this.$selectedChirp=e.first())}this.$selectedChirp.addClass(this.attr.isSelectedClass)},this.setSelectedChirp=function(t,e){this.$selectedChirp.length>0&&this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=t,this.$selectedChirp.addClass(this.attr.isSelectedClass),e.doScrollToChirp&&this.$selectedChirp.length>0&&this.scrollToChirp({direction:this.scrollDirection,forceScroll:e.forceScroll})},this.selectPrevChirp=function(){var t,e,i;this.chirpCenter=null,this.isInDetailView()?(e=this.selectedColumn.detailViewComponent.$find(this.attr.chirpSelector),i=e.index(this.$selectedChirp),t=e.eq(Math.max(0,i-1))):t=this.$selectedChirp.prev(this.attr.chirpSelector),0===t.length?this.selectAndScrollToFirstChirpInSelectedColumn():this.setSelectedChirp(t,{doScrollToChirp:!0})},this.selectNextChirp=function(t){var e,i,n;t=t||{},this.chirpCenter=null,this.isInDetailView()?(i=this.selectedColumn.detailViewComponent.$find(this.attr.chirpSelector),n=i.index(this.$selectedChirp),e=i.eq(Math.min(i.length-1,n+1))):e=this.$selectedChirp.next(this.attr.chirpSelector).length>0?this.$selectedChirp.next(this.attr.chirpSelector):this.$selectedChirp,0===e.length?this.selectAndScrollToFirstChirpInSelectedColumn():this.setSelectedChirp(e,{doScrollToChirp:!0,forceScroll:t.forceScroll})},this.moveSelection=function(t){var e=function(){var e;if(this.hasFocus)if(null===this.selectedColumn)this.setSelectedColumn(0);else{switch(this.scrollDirection=t,t){case"left":e=null===this.columnIndex?0:this.columnIndex-1,this.setSelectedColumn(e);break;case"right":e=null===this.columnIndex?0:this.columnIndex+1,this.setSelectedColumn(e);break;case"up":this.selectPrevChirp();break;case"down":this.selectNextChirp()}this.trigger("uiColumnsScrollToColumn",{columnKey:this.selectedColumn.model.getKey(),source:this.attr.id,offset:this.attr.columnScrollOffset,direction:this.scrollDirection})}},i=_.throttle(e.bind(this),100);return i},this.selectColumnByKey=function(t){if(this.selectedColumn&&this.selectedColumn.model.getKey()===t)return!1;for(var e=0;e<this.columns.length;e+=1)if(this.columns[e].model.getKey()===t)return this.columnIndex=e,this.selectedColumn=this.columns[e],!0;return!1},this.selectColumnByIndex=function(t){return this.selectedColumn!==this.columns[t]?(this.columnIndex=t,this.selectedColumn=this.columns[t],!0):!1},this.selectLastColumn=function(){return this.selectColumnByIndex(this.columns.length-1)},this.handleColumnFocus=function(t,e){if(this.hasFocus){var i=!1;this.$selectedChirp.removeClass(this.attr.isSelectedClass),void 0!==e.columnKey?i=this.selectColumnByKey(e.columnKey):void 0!==e.index?i=this.selectColumnByIndex(e.index):e.last===!0&&(i=this.selectLastColumn()),i?(this.$selectedChirp=$(),this.chirpIndex=null,this.offset=null):this.selectedColumn&&(this.$selectedChirp.addClass(this.attr.isSelectedClass),1===this.selectedColumn.visibility.visibleFraction&&this.trigger("uiGridHome"))}},this.clearSelection=function(){this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=$(),this.selectedColumn=null,this.chirpIndex=null,this.columnIndex=null,this.offset=null},this.scrollToChirp=function(t){this.trigger("uiColumnsScrollToChirp",{columnKey:this.selectedColumn.model.getKey(),$chirp:this.$selectedChirp,direction:t.direction,forceScroll:t.forceScroll,offset:this.attr.chirpScrollOffset})},this.handleBack=function(){var t,e,i,n;this.hasFocus&&(n=this.getColumnElementByKey(this.selectedColumn.model.getKey()),this.isInDetailView()?(t=this.selectedColumn.detailViewComponent.parentChirp,i=this.selectedColumn.ui.getChirpContainer(),e=i.find('[data-key="'+t.id+'"]'),n.trigger("uiCloseDetailView"),e.addClass(this.attr.isSelectedClass),this.$selectedChirp=e,this.scrollToChirp({direction:"down"})):this.isInDetailViewLevel2()&&n.trigger("uiCloseSocialProof"))},this.handleClearSelection=function(){this.hasFocus&&this.clearSelection()},this.isInDetailView=function(){var t=this.getColumnElementByKey(this.selectedColumn.model.getKey());return t.hasClass(this.attr.columnStateDetailViewClass)},this.isInDetailViewLevel2=function(){var t=this.getColumnElementByKey(this.selectedColumn.model.getKey());return t.hasClass(this.attr.columnStateSocialProofClass)},this.tweetActionFactory=function(t){return function(){var e,i,n,s;if(this.hasFocus&&this.$selectedChirp.length>0&&!this.isInDetailViewLevel2()){if(i=this.$selectedChirp.attr("data-key"),e=this.selectedColumn.findMostInterestingChirp(i),!e)return;switch(t){case"profile":e.getMainUser?n=e.getMainUser():e.getRelatedUser&&(n=e.getRelatedUser()),n&&this.trigger("uiShowProfile",{id:n.screenName});break;case"viewDetails":if(e instanceof TD.services.TwitterConversationMessageEvent)return;default:if(e instanceof TD.services.TwitterAction)return;var r=e instanceof TD.services.TwitterConversation||e instanceof TD.services.TwitterConversationMessageEvent;s="reply"===t&&r?"dm":t,this.parentChirp=this.selectedColumn.findChirp(i),$.publish("chirp/action",[s,e,this.parentChirp,this.selectedColumn,{element:this.$selectedChirp}])}}else switch(t){case"dm":this.trigger("uiComposeTweet",{type:"message"})}}.bind(this)},this.handleDetailViewActive=function(t,e){var i=e.$chirp.closest(this.attr.columnSelector);this.selectColumnByKey(i.attr("data-column")),this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=e.$chirp,this.parentChirp===e.parentChirp&&this.$selectedChirp.addClass(this.attr.isSelectedClass)},this.handleDetailClosed=function(t,e){var i;e&&e.column&&(i=e.column.model.getKey(),this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.selectColumnByKey(i),this.$selectedChirp=$())},this.handlePagingFactory=function(t){var e=function(){if(this.hasFocus&&this.selectedColumn){var e,i,n,s,r,o,a,c=this.selectedColumn.model.getKey(),u=this.getColumnScrollContainerByKey(c),h=u.scrollTop(),l=u.innerHeight();if(0===this.$selectedChirp.length&&this.selectAndScrollToFirstChirpInSelectedColumn(),null!==this.chirpOffsetTop?e=this.chirpOffsetTop:(e=this.$selectedChirp.position().top,this.targetChirpOffsetTop=null),this.chirpOffsetTop=e,this.$selectedChirp.removeClass(this.attr.isSelectedClass),"down"===t){this.targetChirpOffsetTop=null===this.targetChirpOffsetTop?e+l:this.targetChirpOffsetTop+l;do o=this.$selectedChirp.next(this.attr.chirpSelector),o.length>0&&(this.$selectedChirp=o);while(o.length>0&&o.position().top<this.targetChirpOffsetTop);i=h+(this.$selectedChirp.position().top-e),i+l+50>u.get(0).scrollHeight&&(i+=50),n=i-h}else{this.targetChirpOffsetTop=null===this.targetChirpOffsetTop?e-l:this.targetChirpOffsetTop-l;do r=this.$selectedChirp.prev(this.attr.chirpSelector),r.length>0&&(this.$selectedChirp=r);while(r.length>0&&r.position().top>this.targetChirpOffsetTop);i=h-(e+Math.abs(this.$selectedChirp.position().top)),n=h-i}this.$selectedChirp.addClass(this.attr.isSelectedClass),a=function(){this.chirpOffsetTop=null,this.targetChirpOffsetTop=null}.bind(this),s=TD.ui.columns.calculateScrollDuration(n,50,750),u.stop().animate({scrollTop:i},s,this.attr.pagingEasingFunction,a)}};return e.bind(this)},this.handleGridHome=function(){if(this.hasFocus&&this.selectedColumn){this.chirpOffsetTop=null,this.targetChirpOffsetTop=null;var t=this.selectedColumn.model.getKey(),e=this.getColumnScrollContainerByKey(t),i=e.scrollTop(),n=TD.ui.columns.calculateScrollDuration(i,20,300);this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=this.$selectedChirp.parent().find(".js-stream-item:first"),this.$selectedChirp.addClass(this.attr.isSelectedClass),e.stop().animate({scrollTop:0},n,this.attr.pagingEasingFunction)}},this.handleGridEnd=function(){if(this.hasFocus&&this.selectedColumn){this.chirpOffsetTop=null,this.targetChirpOffsetTop=null;var t=this.selectedColumn.model.getKey(),e=this.getColumnScrollContainerByKey(t),i=e.scrollTop(),n=e.get(0).scrollHeight-e.innerHeight()+50,s=n-i,r=TD.ui.columns.calculateScrollDuration(s,20,300);this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=this.$selectedChirp.parent().find(".js-stream-item:last"),this.$selectedChirp.addClass(this.attr.isSelectedClass),e.stop().animate({scrollTop:n},r,this.attr.pagingEasingFunction)}}}return t(n,e,i)}),define("ui/grid_scroll",["require","flight/lib/component","ui/with_column_selectors"],function(t){function e(){this.attributes({columnsLeftMargin:10,columnSlideMinDuration:200,columnSlideMaxDuration:500,columnExtraSlideTimePer100Px:20,chirpSlideMinDuration:100,chirpSlideMaxDuration:500,chirpExtraSlideTimePer100Px:100,columnGlowDuration:500}),this.after("initialize",function(){this.on(document,"uiColumnFocus",this.handleColumnFocus),this.on(document,"uiColumnsScrollToColumn",this.handleScrollToColumn),this.on(document,"uiColumnsScrollColumnToCenter",this.handleScrollColumnToCenter),this.on(document,"uiColumnsScrollToChirp",this.handleScrollToChirp)}),this.handleColumnFocus=function(t,e){var i;void 0!==e.index?i=this.getKeyForColumnAtIndex(e.index):e.last?i=this.getKeyForLastColumn():e.columnKey&&(i=e.columnKey),i&&this.trigger("uiColumnsScrollColumnToCenter",{columnKey:i})},this.handleScrollToColumn=function(t,e){var i,n=this.getColumnElementByKey(e.columnKey),s=this.select("appColumnsContainerSelector"),r=this.select("columnsContainerSelector"),o=n.outerWidth(),a=r.width(),c=s.scrollLeft(),u=n.position().left,h=u+o;u>=0&&a>=h||(i="left"===e.direction?c+u-e.offset:c+h+e.offset-a,this.scrollColumnToOffset(e.columnKey,i,!1))},this.handleScrollColumnToCenter=function(t,e){var i,n,s,r,o,a,c=this.getColumnElementByKey(e.columnKey),u=this.select("appColumnsContainerSelector"),h=this.select("columnsContainerSelector"),l=u.innerWidth()/c.outerWidth(!0),d=u.scrollLeft(),m=!0;3.05>=l?(a=parseInt(h.css("padding-left"),10),i=d+c.position().left-a):(n=c.outerWidth(),s=u.get(0).scrollWidth-this.attr.columnsLeftMargin,r=h.width(),o=c.offset().left,i=d+o-(r-n)/2,i=Math.min(i,s-r),i=Math.max(i,0)),2>l&&(m=!1),this.scrollColumnToOffset(e.columnKey,i,m)},this.calculateScrollDuration=function(t){var e=Math.abs(t.target-t.current),i=t.minTime+e/100*t.extraSlideTimePer100Px;return i=Math.min(i,t.maxTime)},this.scrollColumnToOffset=function(t,e,i){var n,s=this.select("appColumnsContainerSelector"),r=s.scrollLeft();e!==r?(s.stop(),n=this.calculateScrollDuration({target:e,current:r,minTime:this.attr.columnSlideMinDuration,maxTime:this.attr.columnSlideMaxDuration,extraSlideTimePer100Px:this.attr.columnExtraSlideTimePer100Px}),s.animate({scrollLeft:e},n,"easeInOutQuad",function(){i&&TD.ui.columns.focusColumn(t,this.attr.columnGlowDuration),this.getColumnElementByKey(t).trigger("uiColumnScrolled",{columnKey:t})}.bind(this))):(i&&TD.ui.columns.focusColumn(t,this.attr.columnGlowDuration),this.getColumnElementByKey(t).trigger("uiColumnScrolled",{columnKey:t}))},this.handleScrollToChirp=function(t,e){if(e.$chirp&&e.columnKey&&0!==e.$chirp.length){var i,n,s,r=this.getColumnScrollContainerByKey(e.columnKey),o=r.scrollTop(),a=e.$chirp.position().top+o,c=r.innerHeight(),u=!1;"up"===e.direction?(i=a-e.offset,(e.forceScroll||o>i)&&(u=!0)):(n=a+e.$chirp.outerHeight()+e.offset,(e.forceScroll||n>o+c)&&(i=n-c,u=!0)),u&&(s=this.calculateScrollDuration({target:i,current:o,minTime:this.attr.chirpSlideMinDuration,maxTime:this.attr.chirpSlideMaxDuration,extraSlideTimePer100Px:this.attr.chirpExtraSlideTimePer100Px}),r.stop().animate({scrollTop:i},s,"easeInOutQuad"))}}}var i=t("flight/lib/component"),n=t("ui/with_column_selectors");return i(e,n)}),define("ui/focus_controller",["flight/lib/component"],function(t){var e=function(){this.handleFocusRequest=function(t,e){e&&void 0!==e.id&&this.focusHistory[this.focusHistory.length-1]!==e.id&&(this.focusHistory.push(e.id),this.trigger("uiFocus",{id:e.id}))},this.handleFocusRelease=function(t,e){e&&void 0!==e.id&&(this.focusHistory[this.focusHistory.length-1]===e.id?(this.focusHistory=this.focusHistory.filter(function(t){return t!==e.id}),this.focusHistory.length>0&&_.defer(function(){this.trigger("uiFocus",{id:this.focusHistory[this.focusHistory.length-1]})}.bind(this))):this.focusHistory=this.focusHistory.filter(function(t){return t!==e.id}))},this.after("initialize",function(){this.focusHistory=[],this.on(document,"uiFocusRequest",this.handleFocusRequest),this.on(document,"uiFocusRelease",this.handleFocusRelease)})};return t(e)}),define("ui/confirmation_dialog_controller",["flight/lib/component"],function(t){var e=function(){this.showConfirmationDialog=function(t,e){this.trigger(document,"uiConfirmationAction",{id:e.id,result:confirm(e.message)?!0:!1})},this.after("initialize",function(){this.on(document,"uiShowConfirmationDialog",this.showConfirmationDialog)})};return t(e)}),define("ui/modal/with_modal",["flight/lib/compose","ui/with_focus"],function(t,e){function i(){t.mixin(this,[e]),this.attributes({dismissButton:".js-dismiss",modal:".js-modal",modalPanel:".js-modal-panel",modalDragHandle:".mdl-drag-handle",isDraggingClass:"is-dragging",isTouchModalClass:"is-touch-modal",openModalID:"#open-modal",autoFocus:!0}),this.handleDragStart=function(){var t=this.select("modalPanel");t.css({position:"absolute",top:t.offset().top,left:t.offset().left}),this.$node.addClass(this.attr.isDraggingClass)},this.getDragDropBoundary=function(){return this.$node},this.dismiss=function(t){this.attr.closeEvent&&(t&&t.preventDefault(),this.trigger(this.attr.closeEvent))},this.handleClickOnOverlay=function(t){t.target===this.$node.get(0)&&this.dismiss()},this.before("initialize",function(){$(document).trigger("uiCloseModal")}),this.after("initialize",function(){this.on(this.$node,"click",this.handleClickOnOverlay),this.on("click",{dismissButton:this.dismiss}),this.on(document,"uiCloseModal",this.dismiss)}),this.after("render",function(){this.select("modalPanel").draggable({boundary:this.getDragDropBoundary.bind(this),handle:this.select("modalDragHandle")}),this.on("start.draggable",this.handleDragStart),this.focusRequest();var t=this.select("modalPanel").parent(this.attr.modal),e=$(this.attr.openModalID);TD.util.isTouchDevice()&&TD.decider.get("touchdeck_modals_v2")?(t.addClass(this.attr.isTouchModalClass),e.addClass(this.attr.isTouchModalClass)):(t.removeClass(this.attr.isTouchModalClass),e.removeClass(this.attr.isTouchModalClass))}),this.before("teardown",function(){this.$node.removeClass(this.attr.isDraggingClass)}),this.after("teardown",function(){this.$node.hide()})}return i}),define("ui/embed_tweet",["require","flight/lib/component","ui/modal/with_modal","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({embedDataCache:{},includeParentTweet:!0,includeMedia:!0,closeEvent:"uiCloseEmbedTweet",dataEmbeddedTweetEvent:"dataEmbeddedTweet",dataEmbeddedTweetErrorEvent:"dataEmbeddedTweetError",embedTextArea:".js-embed-textarea",embedIncludeParentCheckBox:".js-embed-include-parent",embedIncludeMediaCheckBox:".js-embed-include-media",modalTitle:".js-header-title",embedIframe:".js-embed-iframe",embedIframeContainer:".js-embed-iframe-container",embedModalPanel:".js-modal-panel",embedModalHeader:".js-mdl-header",embedModalContent:".js-mdl-content",embedLoading:".js-embed-loading-container",tweet:null}),this.after("initialize",function(){this.includeParentTweet=this.attr.includeParentTweet,this.includeMedia=this.attr.includeMedia;var t=s.render("embed_tweet",{loading:!0});this.$node.html(t),this.trigger(document,"uiNeedsEmbeddedTweet",{tweetID:this.attr.tweet.id,hideThread:!this.includeParentTweet,hideMedia:!this.includeMedia}),this.on(this.attr.closeEvent,this.teardown),this.on("change",{embedIncludeParentCheckBox:this.handleEmbeddedTweetOptionsChange,embedIncludeMediaCheckBox:this.handleEmbeddedTweetOptionsChange}),this.on(document,this.attr.dataEmbeddedTweetEvent,this.handleEmbeddedTweet),this.on(document,this.attr.dataEmbeddedTweetErrorEvent,this.handleEmbeddedTweetError)}),this.handleEmbeddedTweet=function(t,e){var i,n,r,o,a,c,u,h;if(e&&e.html&&e.request&&e.request.tweetID===this.attr.tweet.id&&e.request.hideThread!==this.includeParentTweet&&e.request.hideMedia!==this.includeMedia)if(this.putEmbedDataInCache(e),h=function(t){var h,l=s.render("embed_tweet",{html:e.html,isReply:!!t.inReplyToID,includeParentTweet:this.includeParentTweet,hasMedia:!!t.cards,includeMedia:this.includeMedia});this.$node.html(l),this.select("modalTitle").text(TD.i("Embed this Tweet")),this.on(this.select("embedTextArea"),"focus",this.handleInputBoxFocus),n=this.select("embedIframe"),r=this.select("embedIframeContainer"),o=this.select("embedModalPanel"),a=this.select("embedModalHeader"),c=this.select("embedModalContent"),u=this.select("embedLoading"),h=function(){r.css("height","auto"),n.height(Math.max($("html",i).outerHeight(),$("body",i).outerHeight(),n.height())),
o.height(c.height()+a.outerHeight()),$("a",i).attr("target","_blank")}.bind(this),n.load(function(){u.addClass("is-hidden"),h(),this.resizeIframeIntervalId=setInterval(h,500)}.bind(this)),n[0]&&(i=n[0].contentWindow.document,i.open(),i.write(["<!DOCTYPE html>",'<meta charset="utf-8">','<base href="https://tweetdeck.twitter.com">','<meta name="twitter:widgets:csp" content="on">',e.html].join("\n")),i.close()),c.removeClass("horizontal-flow-container")},!this.attr.tweet.cards&&this.attr.tweet.hasLink()){var l=TD.controller.clients.getClient(this.attr.tweet.account.getKey());l.show(this.attr.tweet.id,h.bind(this),function(){this.trigger(document,this.attr.dataEmbeddedTweetErrorEvent,e)}.bind(this))}else h.call(this,this.attr.tweet)},this.handleEmbeddedTweetError=function(t,e){e&&e.request&&e.request.tweetID===this.attr.tweet.id&&(this.teardown(t),TD.controller.progressIndicator.addMessage(TD.i("Sorry, couldn't retrieve embedded Tweet. Please try again later.")))},this.handleInputBoxFocus=function(t){var e=this.select("embedTextArea");_.defer(function(){e.select()})},this.handleEmbeddedTweetOptionsChange=function(t){var e;this.includeParentTweet=$(this.attr.embedIncludeParentCheckBox).prop("checked"),this.includeMedia=$(this.attr.embedIncludeMediaCheckBox).prop("checked");var i=s.render("embed_tweet",{loading:!0});this.$node.html(i),e=this.getEmbedDataFromCache(),e?this.trigger(document,"dataEmbeddedTweet",e):this.trigger(document,"uiNeedsEmbeddedTweet",{tweetID:this.attr.tweet.id,hideThread:!this.includeParentTweet,hideMedia:!this.includeMedia})},this.getEmbedDataFromCache=function(){var t=!!this.includeParentTweet,e=!!this.includeMedia,i=this.attr.embedDataCache[t+":"+e];return i&&i.request.tweetID===this.attr.tweet.id?i:void 0},this.putEmbedDataInCache=function(t){var e=!!this.includeParentTweet,i=!!this.includeMedia;this.attr.embedDataCache[e+":"+i]=t},this.after("teardown",function(){clearInterval(this.resizeIframeIntervalId),this.$node.html("")})}var i=t("flight/lib/component"),n=t("ui/modal/with_modal"),s=t("scripts/UI/template");return i(e,n)}),define("ui/keyboard_shortcut_list",["require","flight/lib/component","ui/modal/with_modal","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({closeEvent:"uiCloseKeyboardShortcutsList",modalTitle:".js-header-title"}),this.after("initialize",function(){var t=s.render("keyboard_shortcut_list",{isMac:"osx"===TD.util.getOSName()});this.$node.html(t),this.select("modalTitle").text(TD.i("Keyboard shortcuts")),this.on(this.attr.closeEvent,this.teardown)}),this.after("teardown",function(){this.$node.html("")})}var i=t("flight/lib/component"),n=t("ui/modal/with_modal"),s=t("scripts/UI/template");return i(e,n)}),define("ui/follow_state",["flight/lib/component"],function(t){var e=function(){this.attributes({account:null,twitterUser:null,follows:"s-follows"}),this.handleRelationshipData=function(t,e){e&&e.relationship&&this.account.isSameUser(e.relationship.source.screen_name)&&this.twitterUser.isSameUser(e.relationship.target.screen_name)&&this.$node.toggleClass(this.attr.follows,e.relationship.target.following)},this.destroy=function(t){t.stopPropagation(),this.teardown()},this.after("initialize",function(){if(this.account=this.attr.account,this.twitterUser=this.attr.twitterUser,!(this.account instanceof TD.storage.Account))throw"source must be instance of TD.storage.Account";if(!(this.twitterUser instanceof TD.services.TwitterUser))throw"target must be instance of TD.services.TwitterUser";this.on(document,"dataRelationship",this.handleRelationshipData),this.attr.closeEvent&&this.on(this.attr.closeEvent,this.destroy),this.trigger("uiNeedsRelationship",{account:this.account,screenName:this.twitterUser.screenName})})};return t(e)}),define("ui/relationship",["require","flight/lib/component"],function(t){function e(){this.attributes({account:null,twitterUser:null,states:{blocking:"blocking",following:"following",me:"me",notFollowing:"notFollowing",unknown:"unknown"},classNamesForStates:{blocking:"s-blocking",following:"s-following",me:"s-thats-you",notFollowing:"s-not-following",unknown:"unknown"},followButton:".js-follow-button"}),this.after("initialize",function(){this.account=this.attr.account,this.twitterUser=this.attr.twitterUser,this.state=this.attr.states.unknown,this.on(document,"dataRelationship",this.handleRelationshipData),this.on("click",{followButton:this.handleFollowButtonClick}),this.on(document,"uiFollowAction dataUnfollowActionError",this.handleActionFactory("following")),this.on(document,"uiUnfollowAction dataFollowActionError",this.handleActionFactory("notFollowing")),this.on(document,"uiBlockAction dataUnblockActionError",this.handleActionFactory("blocking")),this.on(document,"uiUnblockAction dataBlockActionError dataReportActionError",this.handleActionFactory("notFollowing")),$.subscribe("/user/"+this.screenName+"/block",this.handlePubSubEvent("blocking")),$.subscribe("/user/"+this.screenName+"/unblock",this.handlePubSubEvent("notFollowing")),this.attr.closeEvent&&this.on(this.attr.closeEvent,this.destroy),this.trigger("uiNeedsRelationship",{account:this.account,screenName:this.twitterUser.screenName})}),this.resetState=function(){this.$node.removeClass(this.attr.classNamesForStates[this.state])},this.setState=function(t,e){this.state=t.following?this.attr.states.following:this.attr.states.notFollowing,t.id===e.id&&(this.state=this.attr.states.me),t.blocking&&(this.state=this.attr.states.blocking)},this.handleFollowButtonClick=function(t){var e={account:this.account,twitterUser:this.twitterUser};switch(this.state){case this.attr.states.following:this.trigger("uiUnfollowAction",e);break;case this.attr.states.notFollowing:this.trigger("uiFollowAction",e);break;case this.attr.states.blocking:this.trigger("uiUnblockAction",e);break;case this.attr.states.me:TD.util.openURL("https://twitter.com/settings/profile")}t.stopPropagation()},this.enableButton=function(){this.select("followButton").prop("disabled",!1)},this.setTargetElementState=function(){this.$node.addClass(this.attr.classNamesForStates[this.state])},this.isRelevantRelationship=function(t){return this.account.isSameUser(t.source.screen_name)&&this.twitterUser.isSameUser(t.target.screen_name)},this.handleRelationshipData=function(t,e){e&&e.relationship&&this.isRelevantRelationship(e.relationship)&&(this.resetState(),this.setState(e.relationship.source,e.relationship.target),this.state!==this.attr.states.unknown&&this.enableButton(),this.setTargetElementState())},this.isRelevantAction=function(t){return t&&t.twitterUser&&t.twitterUser.isSameUser(this.twitterUser)&&t.account===this.account},this.handleActionFactory=function(t){var e=function(e,i){i=i||{},this.isRelevantAction(i.request||i)&&(this.resetState(),this.state=this.attr.states[t],this.setTargetElementState())};return e.bind(this)},this.handlePubSubEvent=function(t){var e=function(e,i){i.getAccountKey()===this.account.getAccountKey()&&(this.resetState(),this.state=this.attr.states[t],this.setTargetElementState())};return e.bind(this)},this.destroy=function(t){t.stopPropagation(),this.teardown()}}var i=t("flight/lib/component");return i(e)}),define("util/notifications",[],function(){var t={};return t.publishToQueue=function(t,e){TD.storage.notification.notify(t,e)},t.publish=function(t,e){$.publish(t,e)},t.subscribe=function(t,e){return $.subscribe(t,e)},t.unsubscribe=function(t){$.unsubscribe(t)},t}),define("ui/with_column_config",[],function(){var t=function(){this.before("initialize",function(){this.columnConfig={DISPLAY_ORDER_PROFILE:TD.controller.columnManager.DISPLAY_ORDER_PROFILE,OPEN_COLUMN_URL_BASE:TD.components.OpenColumnHome.URL_BASE,GO_EVENT:TD.components.OpenColumn.GO_EVENT}})};return t}),define("ui/twitter_profile",["require","flight/lib/component","ui/follow_state","ui/relationship","util/notifications","ui/with_column_config","ui/with_template","ui/with_transitions"],function(t){function e(){this.attributes({screenName:null,dataAction:"[data-action]",socialProofSelector:".js-social-proof",followFromSelector:".js-action-follow",followStateSelector:".prf-follow-status",closeEvent:"uiTwitterProfileClosing",numUsersInSocialProof:3,isSocialProofAnimatingClass:"social-proof-animating"}),this.handleTwitterAccount=function(t,e){if(e&&e.account&&e.screenName&&e.screenName.toLowerCase()===this.screenName.toLowerCase()){this.twitterUser=e,this.render("twitter_profile",{twitterProfile:{preferredAccount:this.account.getUsername(),profile:this.twitterUser,displayOrderProfile:this.columnConfig.DISPLAY_ORDER_PROFILE,account:this.account,showAccountMenu:!0,hideFromAccountName:!0,isSingleAccount:this.isSingleAccount}}),this.on(this.attr.dataAction,"click",this.handleActionClick),this.twitterUser.isMe()||this.trigger(document,"uiNeedsUserProfileSocialProof",{screenName:this.screenName});var i={account:this.account,twitterUser:this.twitterUser,closeEvent:this.attr.closeEvent};s.attachTo(this.select("followFromSelector"),i),n.attachTo(this.select("followStateSelector"),i)}},this.handleTwitterUserError=function(t,e){e.screenName.toLowerCase()===this.screenName.toLowerCase()&&this.teardown()},this.handleSocialProofData=function(t,e){var i,n,s,r=this.select("socialProofSelector"),o=[],a=0,c=[];if(e.users&&e.users.length){if(e.users.length>this.attr.numUsersInSocialProof)for(a=e.users.length-this.attr.numUsersInSocialProof;o.length<this.attr.numUsersInSocialProof;)s=Math.floor(Math.random()*e.users.length),o.push(e.users.splice(s,1)[0]);else o=e.users;o.forEach(function(t){c.push(TD.ui.template.render("text/social_proof_link",t))}),a>0&&c.push(TD.ui.template.render("text/followers_you_follow_link",{screenName:this.screenName})),c.length>1&&(n=c.splice(c.length-1,1)),i=c.join(", "),r.removeClass("is-hidden"),r.html(TD.ui.template.render("twitter_profile_social_proof",{followedByString:i,others:n})),this.transitionExpand(r,this.attr.isSocialProofAnimatingClass)}},this.handleActionClick=function(t){var e=$(t.currentTarget),i=e.data("type"),n=this.columnConfig.OPEN_COLUMN_URL_BASE+"/"+i,s=TD.util.maybeOpenClickExternally(t);s||(this.screenName&&(n+="?screenName="+this.screenName),r.publishToQueue(this.columnConfig.GO_EVENT,{data:n,history:{type:"uiShowProfile",target:document,data:{id:this.screenName}}}),t.preventDefault(),t.stopPropagation())},this.destroy=function(t){t.stopPropagation(),this.teardown()},this.before("teardown",function(){this.trigger(this.select("followStateSelector"),this.attr.closeEvent),this.trigger(this.select("followFromSelector"),this.attr.closeEvent)}),this.after("teardown",function(){this.$node.html("")}),this.handleSingleAccountStatus=function(t,e){this.isSingleAccount=e.isSingleAccount},this.handlePreferredAccount=function(t,e){this.account=e.account},this.after("initialize",function(){this.screenName=""+this.attr.screenName,0===this.screenName.indexOf("@")&&(this.screenName=this.screenName.substring(1)),this.on(document,"dataSingleAccountStatus",this.handleSingleAccountStatus),this.on(document,"dataPreferredAccount",this.handlePreferredAccount),this.trigger(document,"uiNeedsSingleAccountStatus"),this.on(document,"dataTwitterUser",this.handleTwitterAccount),this.on(document,"dataTwitterUserError",this.handleTwitterUserError),this.on(document,"dataUserProfileSocialProof",this.handleSocialProofData),this.render("twitter_profile",{loading:!0}),this.trigger(document,"uiNeedsPreferredAccount"),this.trigger(document,"uiNeedsTwitterUser",{screenName:this.screenName})})}var i=t("flight/lib/component"),n=t("ui/follow_state"),s=t("ui/relationship"),r=t("util/notifications"),o=t("ui/with_column_config"),a=t("ui/with_template"),c=t("ui/with_transitions");return i(e,a,o,c)}),define("ui/report_message_options",["require","flight/lib/component","ui/modal/with_modal","scripts/UI/template"],function(t){"use strict";function e(t,e){var i=t.attr.twitterUser||{},n=r.render("report_message_options",{screenName:i.screenName,no_horiz_flow_container:!0,showResult:e});t.$node.html(n),t.select("modalTitle").text(TD.i("Mark + delete message"))}function i(){this.attributes({twitterUser:null,closeEvent:"uiReportMessageActionClose",modalTitle:".js-header-title",spamButtonSelector:".js-report-spam",abuseButtonSelector:".js-mark-abusive"}),this.after("initialize",function(){e(this),this.on(this.attr.closeEvent,this.teardown),this.on("click",{spamButtonSelector:this.handleActionFactory("spam"),abuseButtonSelector:this.handleActionFactory("abuse"),dismissButton:this.handleManualDismiss}),this.on(document,"dataDMReport",this.handleReportData)}),this.after("teardown",function(){this.$node.html("")}),this.handleManualDismiss=function(){this.trigger("uiShowReportMessageCancel")},this.handleActionFactory=function(t){return function(i){i.preventDefault(),this.trigger("uiNeedsDMReport",{account:this.attr.account,dmId:this.attr.tweetId,reportType:t,blockUser:!1}),e(this,!0)}.bind(this)},this.handleReportData=function(t,e){e.error?(this.trigger("uiShowReportMessageError"),TD.controller.progressIndicator.addMessage(TD.i("Error: unable report direct message"))):TD.controller.feedManager.deleteChirp(e.tweetId)}}var n=t("flight/lib/component"),s=t("ui/modal/with_modal"),r=t("scripts/UI/template");return n(i,s)}),define("ui/report_tweet_options",["require","flight/lib/component","ui/modal/with_modal","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({closeEvent:"uiReportTweetActionClose",modalTitle:".js-header-title",blockCheckbox:".js-report-block",optionRadios:".js-report-option",submitButton:".js-report-submit",inputs:".js-report-block, .js-report-option",abuseLinks:".abuse-link",twitterUser:null,account:null}),this.after("initialize",function(){i=null;var t=r.render("report_tweet_options",{screenName:this.attr.twitterUser.screenName,no_horiz_flow_container:!0});this.$node.html(t),this.select("modalTitle").text(TD.i("Report Tweet")),this.on("change",{inputs:this.handleInputClick}),this.on("click",{submitButton:this.handleSubmitclick,abuseLinks:this.handleAbuseLinkClick,dismissButton:this.handleManualDismiss}),this.on(this.$node,"click",this.handleOffNodeDismiss),this.on(this.attr.closeEvent,this.teardown),this.select("inputs").filter(":checked").trigger("change")}),this.handleInputClick=function(t){var e=$(t.target).val();"block"===e?i=$(t.target).prop("checked"):this.setBlockCheckbox(e),this.select("submitButton").text("abusive"===e?TD.i("Next"):TD.i("Submit")),this.select("submitButton").prop("disabled",!Boolean(this.select("inputs").filter(":checked").length))},this.handleSubmitclick=function(){var t=this.select("optionRadios").filter(":checked").val(),e=$("input[name=report-block]").is(":checked");"spam"===t?this.trigger("uiReportSpamAction",{account:this.attr.account,twitterUser:this.attr.twitterUser,block:e}):"compromised"===t?this.trigger("uiReportCompromisedAction",{account:this.attr.account,twitterUser:this.attr.twitterUser,block:e}):"abusive"===t&&(this.renderAbusiveModal(),this.trigger("uiReportAbusiveAction",{block:e})),"spam"!==t&&e&&this.trigger("uiBlockAction",{account:this.attr.account,twitterUser:this.attr.twitterUser}),"abusive"!==t&&this.dismiss()},this.setBlockCheckbox=function(t){this.select("blockCheckbox").prop("spam"===t?{checked:!0,disabled:!0}:{disabled:!1,checked:null!==i?i:!1})},this.renderAbusiveModal=function(){var t=r.render("report_tweet_options_abusive",{screenName:this.attr.twitterUser.screenName,tweetId:this.attr.tweetId,no_horiz_flow_container:!0});this.$node.html(t),this.select("modalTitle").text(TD.i("Select Form"))},this.handleAbuseLinkClick=function(t){this.trigger("uiReportAbusiveOption",{option:$(t.target).attr("data-scribe")}),this.dismiss()},this.handleManualDismiss=function(){this.trigger("uiShowReportTweetCancel")},this.handleOffNodeDismiss=function(t){t.target===this.$node.get(0)&&this.handleManualDismiss()},this.after("teardown",function(){this.$node.html("")})}var i,n=t("flight/lib/component"),s=t("ui/modal/with_modal"),r=t("scripts/UI/template");return n(e,s)}),define("ui/account_shared_warning",["require","flight/lib/component","ui/modal/with_modal","scripts/UI/template"],function(t){function e(){this.attributes({closeEvent:"uiAccountSharedWarningClose",modalTitle:".js-header-title",continueSelector:".js-account-shared-continue-btn",abortSelector:".js-account-shared-abort-btn"}),this.after("initialize",function(){var t=TD.storage.store.getTwitterLoginAccount(),e=s.render("account_shared_warning",{no_horiz_flow_container:!0,signinAccount:t.getUsername()});this.$node.html(e),TD.controller.stats.sharedAccountWarning("impression"),this.select("modalTitle").text(TD.i("Multi-account security")),this.on("click",{continueSelector:this.handleContinue,abortSelector:this.handleAbort,dismissButton:this.handleExplicitDismiss}),this.on(this.attr.closeEvent,this.teardown)}),this.handleContinue=function(){TD.controller.stats.sharedAccountWarning("accept"),this.trigger("uiAccountSharedWarningContinue"),this.dismiss()},this.handleAbort=function(){TD.controller.stats.sharedAccountWarning("cancel"),this.trigger("uiAccountSharedWarningAbort"),this.dismiss()},this.handleExplicitDismiss=function(){TD.controller.stats.sharedAccountWarning("dismiss"),this.trigger("uiAccountSharedWarningDismiss")},this.after("teardown",function(){this.$node.html("")})}var i=t("flight/lib/component"),n=t("ui/modal/with_modal"),s=t("scripts/UI/template");return i(e,n)}),define("ui/follow_from_options",["require","flight/lib/component","ui/modal/with_modal","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({userToFollow:null,closeEvent:"uiFollowFromOptionsClose",modalTitleSelector:".js-header-title",modalContentSelector:".js-mdl-content"}),this.after("initialize",function(){this._components=[],this._renderDialog(),this.on(this.attr.closeEvent,this.teardown)}),this.after("teardown",function(){this.$node.html(""),_.invoke(this._components,"destroy")}),this._renderDialog=function(){var t=s.render("follow_from_options",{userToFollow:this.userToFollow,no_horiz_flow_container:!0});this.$node.html(t),this.select("modalTitleSelector").html(TD.i("Your relationship with {{>text/user_link_screenname}}",this.attr.userToFollow)),this._components=this._components.concat(this._renderFollowFromComponents())},this._renderFollowFromComponents=function(){var t=TD.storage.accountController.getAccountsForService("twitter"),e=document.createDocumentFragment(),i=t.map(function(t){return t.getUserID()!==this.attr.userToFollow.id?new TD.components.FollowFrom(this.attr.userToFollow,t):void 0}.bind(this)).filter(_.identity);return _.pluck(i,"$node").forEach(function(t){e.appendChild(t[0])}),this.select("modalContentSelector").append(e),i}}var i=t("flight/lib/component"),n=t("ui/modal/with_modal"),s=t("scripts/UI/template");return i(e,n)}),define("ui/with_favorite_button",["require","flight/lib/compose","ui/with_template"],function(t){"use strict";var e=t("flight/lib/compose"),i=t("ui/with_template"),n={favorited:"s-favorited",unfavorited:"s-not-favorited","protected":"s-protected"};return function(){function t(t,e,i){i=i||{},_.each(n,t.removeClass.bind(t)),t.addClass(n[e]),t.removeAttr("title"),t.removeAttr("data-orig-title"),t.toggleClass("is-disabled",i.disabled||!1),i.tooltip&&(t.attr("title",i.tooltip),t.attr("data-orig-title",i.tooltip))}function s(e,i,n){function s(s,r){r.tweetId===i&&r.accountKey===n&&t(e,r.isFavorite?"favorited":"unfavorited")}function r(s,r){if(r.request.tweetId===i&&r.request.accountKey===n){var o=r.error.responseJSON;return o&&179===o.errors[0].code?void t(e,"protected",{tooltip:TD.i("You cannot favorite this protected Tweet"),disabled:!0}):void TD.controller.progressIndicator.addMessage(TD.i("Cannot retrieve favorite status"))}}function o(t,e){e.tweetId===i&&e.accountKey===n&&TD.controller.progressIndicator.addMessage(TD.i("Failed changing favorite status"))}this.on(document,"dataFavoriteState",s),this.before("teardown",this.off.bind(this,document,"dataFavoriteState",s)),this.on(document,"dataFavoriteStateError",r),this.before("teardown",this.off.bind(this,document,"dataFavoriteStateError",r)),this.on(document,"dataFavoriteError",o),this.before("teardown",this.off.bind(this,document,"dataFavoriteError",o)),this.trigger("uiNeedsFavoriteState",{tweetId:i,accountKey:n})}e.mixin(this,[i]),this.attachFavoriteButtons=function(t){t=t||this.$node,t.find('[rel="favorite-button"]').each(function(t,e){var i=e.dataset;this.renderFavoriteButton(e,i.tweetId,i.accountKey)}.bind(this))},this.renderFavoriteButton=function(t,e,i){var n=this.renderTemplate("buttons/favorite");return $(t).html(n),s.call(this,n,e,i),n.click(this.handleFavoriteButtonClick.bind(this,e,i)),n},this.handleFavoriteButtonClick=function(t,e,i){i.preventDefault();var s,r=i.currentTarget;r.classList.contains("is-disabled")||(r.classList.contains(n.favorited)?s="uiUnfavoriteTweet":r.classList.contains(n.unfavorited)&&(s="uiFavoriteTweet"),s&&this.trigger(s,{tweetId:t,accountKey:e}))}}}),define("ui/favorite_from_options",["require","flight/lib/component","ui/modal/with_modal","ui/with_favorite_button","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({tweet:null,closeEvent:"uiFavoriteFromOptionsClose",modalTitleSelector:".js-header-title",modalContentSelector:".js-mdl-content"}),this.after("initialize",function(){this._renderDialog(),this.on(this.attr.closeEvent,this.teardown)}),this.after("teardown",function(){this.$node.html("")}),this._renderDialog=function(){var t=TD.storage.accountController.getAccountsForService("twitter"),e=r.render("favorite_from_options",{no_horiz_flow_container:!0,accounts:t,tweet:this.attr.tweet});this.$node.html(e),this.attachFavoriteButtons(this.select("modalContentSelector")),this.select("modalTitleSelector").html(TD.i("Favorite this Tweet"))}}var i=t("flight/lib/component"),n=t("ui/modal/with_modal"),s=t("ui/with_favorite_button"),r=t("scripts/UI/template");return i(e,n,s)}),define("ui/modal/with_in_modal",["require"],function(t){"use strict";function e(){this.after("initialize",function(){this.trigger("uiModalShowing"),this.trigger("uiCloseModal"),this.on(document,"uiModalShowing uiCloseModal",this.teardown)}),this.before("teardown",function(){this.trigger("uiModalHiding")})}return e}),define("ui/modal/with_show_modal",["require","ui/modal/with_in_modal"],function(t){"use strict";function e(){this.showModal=function(t,e,i){if(!t||"function"!=typeof t||"function"!=typeof t.attachTo)throw new TypeError("Component must be a constructor and have an attachTo method.");e=e||{},e.isModal=!0,i=_.defaults(i||{},{id:_.uniqueId("modal")}),this.boundHandleModalContext=this.handleModalContext.bind(this,t,e,i),this.on(document,"uiModalContext",this.boundHandleModalContext),this.trigger("uiNeedsModalContext",i)},this.handleModalContext=function(t,e,n,s,r){r.id===n.id&&(this.off(document,"uiModalContext",this.boundHandleModalContext),t.mixin(i).attachTo(r.$node,e))}}var i=t("ui/modal/with_in_modal");return e}),define("ui/with_dialog_manager",["require","flight/lib/compose","ui/embed_tweet","ui/keyboard_shortcut_list","ui/twitter_profile","ui/report_message_options","ui/report_tweet_options","ui/account_shared_warning","ui/follow_from_options","ui/favorite_from_options","ui/modal/with_show_modal"],function(t){var e=t("flight/lib/compose"),i=t("ui/embed_tweet"),n=t("ui/keyboard_shortcut_list"),s=t("ui/twitter_profile"),r=t("ui/report_message_options"),o=t("ui/report_tweet_options"),a=t("ui/account_shared_warning"),c=t("ui/follow_from_options"),u=t("ui/favorite_from_options"),h=t("ui/modal/with_show_modal");return function(){e.mixin(this,[h]),this.showDialogDecorator=function(t){return function(e,i){var n=this.select("modal");t.call(this,n,i),n.show()}.bind(this)},this.showAddColumn=function(){TD.ui.openColumn.showOpenColumn()},this.showProfile=function(t,e){this.showModal(s,{screenName:e.id},{withHeader:!1,withFooter:!1,withChrome:!1,withDismissButton:!1,withClasses:["prf","s-tall-fixed","s-profile","is-inverted-dark"],withBorder:!1})},this.showEmbedTweet=function(t,e){i.attachTo(t,{tweet:e.tweet})},this.showKeyboardShortcutList=function(t){n.attachTo(t)},this.showReportTweetOptions=function(t,e){e.isMessage?r.attachTo(t,{account:e.account,twitterUser:e.twitterUser,tweetId:e.tweetId}):o.attachTo(t,{account:e.account,twitterUser:e.twitterUser,tweetId:e.tweetId})},this.showFollowFromOptions=function(t,e){c.attachTo(t,{userToFollow:e.userToFollow})},this.showFavoriteFromOptions=function(t,e){u.attachTo(t,{tweet:e.tweet})},this.showAccountSharedWarning=function(t){a.attachTo(t)},this.showImportColumn=function(t,e){var i;try{i=TD.core.base64.decode(e.columnState)}catch(n){console.warn("Column state deserialization failed:",n)}i&&TD.ui.openColumn.showImportSharedColumn(i)},this.showGlobalSettings=function(){new TD.components.GlobalSettings},this.after("initialize",function(){this.on(document,"uiShowProfile",this.showProfile),this.on(document,"uiShowImportColumnDialog",this.showImportColumn),this.on(document,"uiShowAddColumn",this.showAddColumn),this.on(document,"uiShowGlobalSettings",this.showGlobalSettings),this.on(document,"uiShowEmbedTweet",this.showDialogDecorator(this.showEmbedTweet)),this.on(document,"uiShowKeyboardShortcutList",this.showDialogDecorator(this.showKeyboardShortcutList)),this.on(document,"uiShowReportTweetOptions",this.showDialogDecorator(this.showReportTweetOptions)),this.on(document,"uiShowAccountSharedWarning",this.showDialogDecorator(this.showAccountSharedWarning)),this.on(document,"uiShowFollowFromOptions",this.showDialogDecorator(this.showFollowFromOptions)),this.on(document,"uiShowFavoriteFromOptions",this.showDialogDecorator(this.showFavoriteFromOptions))})}}),define("ui/message_banner/with_access_denied_message_banner",[],function(){var t=function(){this.getReauthorizeAccountMessageData=function(t){return{id:"expired-token-error",text:TD.i("You can no longer access the @{{1}} account.",{1:t.account.getUsername()}),colors:{background:"#ea596e",foreground:"white"},actions:[{id:"no-button",action:"trigger-event",label:TD.i("Remove columns"),"class":"btn-negative",event:{type:"uiAccountAction",data:{action:"remove",accountKey:t.account.getKey()}}},{id:"keep-columns",action:"trigger-event",label:TD.i("Keep columns"),"class":"btn-alt"+(TD.decider.get("enable_rewrite_columns")?"":" is-hidden"),event:{type:"uiAccountAction",data:{action:"rewriteColumns",accountKey:t.account.getKey()}}},{id:"yes-button",action:"trigger-event",label:TD.i("Enter account password"),"class":"btn-alt",event:{type:"uiAccountAction",data:{action:"reauthorize",accountKey:t.account.getKey()}}}]}}};return t}),define("ui/message_banner/with_account_suspended_message_banner",[],function(t){var e=function(){this.getAccountSuspendedMessageData=function(t){return{id:"expired-token-error",text:TD.i("Your account @{{1}} is currently suspended.",{1:t.account.getUsername()}),colors:{background:"#b2d5ed",foreground:"#555"},actions:[{id:"yes-button",action:"url-ext",label:TD.i("Visit Suspended Accounts Help page"),url:"https://twitter.com/account/suspended_help"}]}}};return e}),define("ui/message_banner_container",["require","flight/lib/component","ui/with_transitions","ui/message_banner/with_access_denied_message_banner","ui/message_banner/with_login_account_access_denied_message_banner","ui/message_banner/with_account_suspended_message_banner"],function(t){function e(){this.attributes({messageSelector:".js-message-banner",applicationSelector:".js-app",isAnimatingClass:"is-application-animating"}),this._onHidden=function(){this.trigger("uiMessageBannerContainerHidden")},this.showAccessDeniedMessage=function(t,e){var i;i=e.isLoginAccount?this.getLoginAccountAccessDeniedMessageData(e):this.getReauthorizeAccountMessageData(e),$(document).trigger("dataMessage",{message:i})},this.removeAccessDeniedMessage=function(){$(document).trigger("dataMessageRemove")},this.showAccountSuspendedMessage=function(t,e){var i=this.getAccountSuspendedMessageData(e);$(document).trigger("dataMessage",{message:i})},this.handleMessageBannerResize=function(){this.transitionTop(this.$application,this.attr.isAnimatingClass,this.$message.outerHeight())},this.handleHideMessageBannerContainer=function(){this.transitionTop(this.$application,this.attr.isAnimatingClass,0,this._boundOnHiddenFn)},this.after("initialize",function(){this.$application=this.select("applicationSelector"),this.$message=this.select("messageSelector"),this._boundOnHiddenFn=this._onHidden.bind(this),this.on(document,"uiHidingMessageBanner",this.handleHideMessageBannerContainer),this.on(document,"uiMessageBannerShown",this.handleMessageBannerResize),this.on(document,"uiMessageBannerResized",this.handleMessageBannerResize),this.on(document,"dataTwitterAccountAccessDenied",this.showAccessDeniedMessage),this.on(document,"dataTwitterAccountAccessEnabled",this.removeAccessDeniedMessage),this.on(document,"dataTwitterAccountSuspended",this.showAccountSuspendedMessage)})}var i=t("flight/lib/component"),n=t("ui/with_transitions"),s=t("ui/message_banner/with_access_denied_message_banner"),r=t("ui/message_banner/with_login_account_access_denied_message_banner"),o=t("ui/message_banner/with_account_suspended_message_banner");return i(e,n,s,r,o)}),define("ui/image_upload",["flight/lib/component"],function(t){function e(){return TD.decider.get("tweet_up_to_four_images")?4:1}function i(t){return"image/gif"===t.type}function n(){this.attributes({ALLOWED_IMAGE_TYPES:["jpg","jpeg","gif","png"],MAX_ALLOWED_SIZE:3145728,errors:{TOO_MANY_FILES_ERROR:"tooManyFilesError",MAX_FILES_ALREADY_ADDED_ERROR:"alreadyAddedFileError",INCORRECT_FILETYPE_ERROR:"incorrectFileTypeError",INVALID_FILESIZE_ERROR:"invalidFileSizeError",GIF_ERROR:"cannotUploadGIFWithOtherFiles"},states:{WAITING:"waiting",DRAG_OK:"drag_ok",DRAG_ERROR:"drag_error",GIF_ERROR:"gif_error"},uploadInputTemplate:'<input id="file-upload-input" type="file" class="cmp-file-upload" multiple />',uploadInputSelector:"#file-upload-input",disabled:!1}),this.validateFile=function(t){var i=e(),n=t.type.split("/")[1],s=t.size,r={success:!0};return this.files.length>=i?r.error=this.attr.errors.MAX_FILES_ALREADY_ADDED_ERROR:_.include(this.attr.ALLOWED_IMAGE_TYPES,n)?s>this.attr.MAX_ALLOWED_SIZE&&(r.error=this.attr.errors.INVALID_FILESIZE_ERROR):r.error=this.attr.errors.INCORRECT_FILETYPE_ERROR,r.error&&(r.success=!1),r},this.validateFiles=function(t){var e;if(TD.decider.get("tweet_up_to_four_images")&&(e=this.validateStandAloneGIF(t),!e.success))return e;var i=this.validateFileCount(t.length);if(!i.success)return i;for(var n=0;n<t.length;n++)if(e=this.validateFile(t[n]),!e.success)return e;return e},this.validateFileCount=function(t){var i=e(),n={success:!0};return t>i?n.error=this.attr.errors.TOO_MANY_FILES_ERROR:this.files.length>0&&this.files.length+t>i&&(n.error=this.attr.errors.MAX_FILES_ALREADY_ADDED_ERROR),n.error&&(n.success=!1),n},this.validateStandAloneGIF=function(t){var e=_.map(this.files).concat(_.map(t));return e.length>1&&e.some(i)?(this.state=this.attr.states.GIF_ERROR,{success:!1,error:this.attr.errors.GIF_ERROR}):{success:!0}},this.handleResetImageUpload=function(t){this.files=[]},this.addFilesToUpload=function(t){var i,n=e();if(t){if(i=this.validateFiles(t),!i.success)switch(i.error){case this.attr.errors.TOO_MANY_FILES_ERROR:return void TD.controller.progressIndicator.addMessage(1===n?TD.i("Only one image can be attached to a tweet."):TD.i("You cannot attach more than {{max}} images.",{max:n}));case this.attr.errors.MAX_FILES_ALREADY_ADDED_ERROR:return void TD.controller.progressIndicator.addMessage(1===n?TD.i("You have already attached an image."):TD.i("You cannot attach more than {{max}} images.",{max:n}));case this.attr.errors.INCORRECT_FILETYPE_ERROR:return void TD.controller.progressIndicator.addMessage(TD.i(1===n?"You did not select an image.":"One selected file is not an image."));case this.attr.errors.INVALID_FILESIZE_ERROR:return void TD.controller.progressIndicator.addMessage(TD.i(1===n?"The file you selected is greater than the 3MB limit.":"One selected file is greater than the 3MB limit."));

case this.attr.errors.GIF_ERROR:return void TD.controller.progressIndicator.addMessage(TD.i("You cannot upload a GIF with other images."))}this.trigger("uiFilesAdded",{files:t}),this.files=t}},this.updateFilesOncePreviewed=function(t,e){e&&e.files&&(this.files=e.files)},this.handleDragEnterEvent=function(t){if(this.currentDragElement)return void(this.currentDragElement=t.target);if(this.currentDragElement=t.target,this.state=this.attr.states.DRAG_OK,t.originalEvent.dataTransfer.items){t.preventDefault();var e,i,n=t.originalEvent.dataTransfer.items,s=this.validateFileCount(n.length);if(s.success){for(var r=0;r<n.length;r++)if(e=n[r],"file"===e.kind&&(i=this.validateFile(e),!i.success))return this.state=this.attr.states.DRAG_ERROR,void this.trigger("uiShowDropMessage",{errorCondition:i.error});this.trigger("uiShowDropMessage")}else this.state=this.attr.states.DRAG_ERROR,this.trigger("uiShowDropMessage",{errorCondition:s.error})}},this.handleDragLeaveEvent=function(t){this.currentDragElement===t.target&&(this.currentDragElement=null,this.state=this.attr.states.WAITING)},this.handleDropEvent=function(t){if(t.preventDefault(),this.state===this.attr.states.DRAG_OK){var e=t.originalEvent.dataTransfer.files;this.addFilesToUpload(e)}this.state=this.attr.states.WAITING,this.currentDragElement=null},this.cancel=function(t){return t.preventDefault(),!1},this.handleComposeAddImageClick=function(t,e){$(this.attr.uploadInputSelector).click()},this.handleFileUploadChange=function(t){this.addFilesToUpload(t.target.files),$(this.attr.uploadInputSelector).remove(),$("body").append(this.attr.uploadInputTemplate)},this.whenEnabled=function(t){return function(){return this.attr.disabled?void 0:t.apply(this,[].slice.call(arguments))}},this.disable=function(){this.attr.disabled=!0},this.enable=function(){this.attr.disabled=!1},this.after("initialize",function(){this.files=[],$("body").append(this.attr.uploadInputTemplate),this.on(document,"uiResetImageUpload",this.handleResetImageUpload),this.on(document,"uiComposeAddImageClick",this.handleComposeAddImageClick),this.on(document,"dragstart",this.disable),this.on(document,"dragend",this.enable),this.on(document,"dragenter",this.whenEnabled(this.handleDragEnterEvent)),this.on(document,"dragleave",this.whenEnabled(this.handleDragLeaveEvent)),this.on(document,"drop",this.whenEnabled(this.handleDropEvent)),this.on(document,"dragover",this.whenEnabled(this.cancel)),this.on(document,"uiComposeImageAdded",this.updateFilesOncePreviewed),this.on(document,"change",{uploadInputSelector:this.handleFileUploadChange})})}return t(n)}),define("ui/login/two_factor",["require","flight/lib/component","ui/with_template","ui/with_api_errors","ui/with_spinner_button"],function(t){"use strict";function e(){this.attributes({withCode:!1,templateWithCode:"login/2fa_verification_code",template:"login/2fa_verification",codeFormSelector:".js-twogin-2fa-code-form",codeSelector:".js-twogin-2fa-code",errorSelector:".js-login-error",errorMessageSelector:".js-login-error-message",dismissSelector:".js-dismiss"}),this.after("initialize",function(){this.on(document,"dataLoginError dataLoginAuthSuccess",this.teardown),this.on(document,"dataLogin2FAError",this.handle2FAError),this.on("click",{dismissSelector:this.handleCancelledTwoFactor}),this.trigger("uiTwoFactorShowing",{withCode:this.attr.withCode}),this.on("submit",{codeFormSelector:this.handle2FACodeForm});var t=this.attr.withCode?"templateWithCode":"template";this.render(this.attr[t])}),this.handle2FACodeForm=function(t){t.preventDefault();var e=this.select("codeSelector").val();e?(this.spinnerButtonToggle(!0),this.trigger("uiLogin2FACode",{code:e})):this.showErrorMessage(TD.i("Fill the code in"))},this.handle2FAError=function(t,e){this.spinnerButtonToggle(!1),this.showErrorMessage(this.getXAuthErrorMessage(e.code))},this.showErrorMessage=function(t){this.select("errorMessageSelector").text(t),this.select("errorSelector").removeClass("is-hidden")},this.handleCancelledTwoFactor=function(){this.trigger("uiLogin2FACancel"),this.teardown()}}var i=t("flight/lib/component"),n=t("ui/with_template"),s=t("ui/with_api_errors"),r=t("ui/with_spinner_button");return i(e,n,s,r)}),define("ui/login/with_login_form",["require","flight/lib/compose","ui/with_spinner_button","ui/with_api_errors","ui/modal/with_show_modal","ui/login/two_factor"],function(t){"use strict";var e=t("flight/lib/compose"),i=t("ui/with_spinner_button"),n=t("ui/with_api_errors"),s=t("ui/modal/with_show_modal"),r=t("ui/login/two_factor");return function(){e.mixin(this,[i,n,s]),this.attributes({staySignedIn:!0,userFormSelector:".js-login-form",successSelector:".js-login-success",successMessageSelector:".js-login-success-message",errorSelector:".js-login-error",errorMessageSelector:".js-login-error-message",usernameSelector:".js-login-username",passwordSelector:".js-login-password",staySignedInSelector:".js-login-stay-signed-in",toggleLoginTypeSelector:".js-toggle-login-type",externalLinkSelector:'a[target="_blank"]',forgotPasswordSelector:".js-login-forgot-password",withToggleLoginType:!0,withForgotPassword:!0,withRememberMe:!0,twoFactorModalConfig:{withDismissButton:!1,withDraggable:!1,withDragHandle:!1,withClickTrap:!1,withHeader:!1,withFooter:!1,withChrome:!1,withBorder:!1}}),this.after("initialize",function(){this.trigger("uiLoginFormShowing"),this.username=null,this.password=null,this.verificationRequestId=null,this.verificationUserId=null,this.on(document,"uiLoginFormShowing",this.teardown),this.on(document,"dataLoginAuthSuccess",this.handleLoginAuthSuccess),this.on(document,"dataLoginError",this.loginFormHandleLoginError),this.on(document,"dataLoginServerError",this.loginFormHandleLoginServerError),this.on(document,"dataLoginTwoFactorCodeRequired",this.handleLoginTwoFactorCode),this.on(document,"dataLoginTwoFactorAwaitingConfirmation",this.handleLoginTwoFactorAwaiting),this.on(document,"dataLogin2FATimeout",this.handleLogin2FATimeout),this.on(document,"uiLogin2FACode",this.handleLogin2FACode),this.on(document,"uiLogin2FACancel",this.handleLogin2FACancel),this.on(document,"uiLoginRequest",this.loginFormToggleFormDisabled.bind(this,!0)),this.on(document,"dataLoginError dataLoginServerError",this.loginFormToggleFormDisabled.bind(this,!1)),this.on(document,"dataForgotPasswordSuccess",this.handleForgotPasswordSuccess),this.on(document,"dataForgotPasswordError",this.handleForgotPasswordError),this.on("click",{staySignedInSelector:this.handleStaySignedInClick,toggleLoginTypeSelector:this.loginFormHandleToggleLoginType,externalLinkSelector:this.openExternalLink,forgotPasswordSelector:function(){this.trigger("uiForgotPassword")}.bind(this)}),this.on("submit",{userFormSelector:this.loginFormHandleFormSubmit}),this.setupLoginForm()}),this.before("teardown",function(){this.loginFormToggleFormDisabled(!0,{disableSpinner:!0})}),this.handleLoginAuthSuccess=function(t,e){this.trigger("uiLoginAuthComplete",e)},this.setupLoginForm=function(){this.select("staySignedInSelector").prop("checked",this.attr.staySignedIn),setTimeout(function(){this.select("usernameSelector").focus()}.bind(this),0);var t=!1;this.attr.loginFormDisabled&&(t=!0),this.loginFormToggleFormDisabled(t),this.attr.errorMsg&&this.loginFormShowErrorMessage(this.attr.errorMsg)},this.loginFormHandleToggleLoginType=function(t){t.preventDefault(),this.trigger("uiLoginToggleType",{staySignedIn:this.getStaySignedIn()})},this.loginFormToggleFormDisabled=function(t,e){e=e||{},this.select("userFormSelector").find("fieldset, button").prop("disabled",t),this.spinnerButtonToggle(t&&!e.disableSpinner)},this.loginFormShowErrorMessage=function(t){this.loginFormToggleFormDisabled(!1),this.select("successSelector").addClass("is-hidden"),this.select("errorMessageSelector").text(t),this.select("errorSelector").removeClass("is-hidden"),this.select("passwordSelector").select()},this.loginFormShowSuccessMessage=function(t){this.select("errorSelector").addClass("is-hidden"),this.select("successMessageSelector").text(t),this.select("successSelector").removeClass("is-hidden")},this.loginFormHideMessages=function(){this.select("errorSelector").addClass("is-hidden"),this.select("successSelector").addClass("is-hidden")},this.loginFormHandleLoginError=function(t,e){var i;i=e&&e.isXAuth?e.message||this.getXAuthErrorMessage(e.code):TD.i("We could not sign you in with this username and password."),this.loginFormShowErrorMessage(i)},this.loginFormHandleLoginServerError=function(){this.loginFormShowErrorMessage(this.getXAuthErrorMessage(131))},this.handleLogin2FATimeout=function(){this.loginFormShowErrorMessage(TD.i("The login verification request sent to your phone went unanswered."))},this.handleLoginTwoFactorCode=function(t,e){this.verificationRequestId=e.xAuth.login_verification_request_id,this.verificationUserId=e.xAuth.login_verification_user_id,this.staySignedIn=e.staySignedIn,this.username=e.username,this.password=e.password,this.request2FA({withCode:!0})},this.handleLoginTwoFactorAwaiting=function(t){this.request2FA()},this.handleLogin2FACode=function(t,e){this.trigger("uiLogin2FARequest",{username:this.username,password:this.password,code:e.code,requestId:this.verificationRequestId,userId:this.verificationUserId,staySignedIn:this.staySignedIn})},this.handleLogin2FACancel=function(){this.loginFormShowErrorMessage(TD.i("You have cancelled login verification."))},this.request2FA=function(t){this.showModal(r,t||{},this.attr.twoFactorModalConfig)},this.handleForgotPasswordSuccess=function(t,e){this.loginFormShowSuccessMessage(TD.i("We have sent an email to {{email}} with instructions to reset your password.",e))},this.handleForgotPasswordError=function(t,e){this.loginFormShowErrorMessage(TD.i("We could not find a TweetDeck account associated with {{email}}.",e))},this.handleStaySignedInClick=function(t,e){this.trigger("uiLoginToggleStaySignedIn",{staySignedIn:$(e.el).prop("checked")})},this.loginFormHandleFormSubmit=function(t){t.preventDefault();var e=this.getLoginFormData();e.username&&e.password?(this.loginFormHideMessages(),this.trigger("uiLoginRequest",e)):this.loginFormShowErrorMessage(TD.i("Username and password must be filled in."))},this.getLoginFormData=function(){return{authType:this.select("userFormSelector").attr("data-auth-type"),username:this.select("usernameSelector").val(),password:this.select("passwordSelector").val(),staySignedIn:this.getStaySignedIn()}},this.getStaySignedIn=function(){return this.select("staySignedInSelector").prop("checked")}}}),define("ui/login/twitter_account_login_form",["require","flight/lib/component","ui/login/with_login_form"],function(t){function e(){this.attributes({authType:"twitter",passwordResetFlow:{url:"https://mobile.twitter.com/account/resend_password",windowWidth:320,windowHeight:500},newPasswordResetFlow:{url:"https://twitter.com/account/begin_password_reset?ref=td&account_identifier={{username}}",windowWidth:1e3,windowHeight:600}}),this.after("initialize",function(){this.on("uiForgotPassword",this.handleForgotPassword)}),this.handleForgotPassword=function(){var t=this.attr.passwordResetFlow;TD.decider.get("new_password_reset_flow")&&(t=this.attr.newPasswordResetFlow);var e=t.url.replace("{{username}}",this.getLoginFormData().username);window.open(e,null,"width="+Math.min(t.windowWidth,screen.width)+",height="+Math.min(t.windowHeight,screen.height))}}var i=t("flight/lib/component"),n=t("ui/login/with_login_form");return i(e,n)}),define("ui/login/tweetdeck_account_login_form",["require","flight/lib/component","ui/login/with_login_form"],function(t){function e(){this.attributes({authType:"tweetdeck"}),this.after("initialize",function(){this.on("uiForgotPassword",this.handleForgotPassword)}),this.handleForgotPassword=function(){var t=this.select("usernameSelector").val();t?this.trigger("uiTweetDeckForgotPasswordRequest",{email:t}):this.loginFormShowErrorMessage(TD.i("Please enter your email address."))}}var i=t("flight/lib/component"),n=t("ui/login/with_login_form");return i(e,n)}),define("ui/login/general_login",["require","flight/lib/component","with-child-components","ui/with_template","ui/login/twitter_account_login_form","ui/login/tweetdeck_account_login_form"],function(t){function e(){this.attributes({formIsRendered:!1,staySignedIn:!0,authType:"twitter",errorMsg:"",uid:"",withToggleLoginType:!0,withForgotPassword:!0,withRememberMe:!0,headerSelector:".js-header-container",layoutTemplate:"login/login_form",loginContainerSelector:".js-signin-ui",loginFormSelector:"form[data-auth-type]",signUpLinkSelector:".js-twitter-signup"}),this.after("initialize",function(){this.on(document,"uiLoginToggleType",this.handleLoginToggleType),this.on(document,"uiLoginToggleStaySignedIn",this.handleLoginToggleStaySignedIn),this.on(document,"dataMigrateAccountLockStatus",this.handleAccountMigrateLockStatus),this.on("click",{signUpLinkSelector:this.handleTwitterSignUpClick}),this.renderLayout(),"tweetdeck"===this.attr.authType&&this.attr.uid?this.trigger("uiNeedsMigrateLockStatus",{email:this.attr.uid}):this.initialRender()}),this.initialRender=function(){this.attr.formIsRendered||(this.attr.formIsRendered=!0,this.displayLoginForm())},this.renderLayout=function(){this.render(this.attr.layoutTemplate,{screenshot:TD.assets.get("td_screenshot",{resolution:TD.util.isRetina()?"2x":"1x"})})},this.handleTwitterSignUpClick=function(){this.trigger("uiLoginToggleType",{authType:"twitter"})},this.handleAccountMigrateLockStatus=function(t,e){this.initialRender(),e.isLocked&&(this.attr.tweetdeckLoginUsername="",this.trigger("uiLoginToggleType",{authType:"twitter"}),this.showLockedAccountWarning({email:e.email,screenName:e.importingUser}))},this.showLockedAccountWarning=function(t){this.select("headerSelector").html(this.toHtml("login/locked_account_warning",t)).removeClass("is-hidden")},this.handleLoginToggleType=function(t,e){var i=this.getCurrentAuthType();e.authType||(e.authType="twitter"===i?"tweetdeck":"twitter"),e.authType!==i&&(["authType","errorMsg","uid"].forEach(function(t){this.attr[t]=e[t]}.bind(this)),this.displayLoginForm())},this.displayLoginForm=function(){this.attr.formIsRendered=!0,TD.storage.store.setCurrentAuthType(this.attr.authType);var t=this.select("loginContainerSelector").empty();this.select("headerSelector").empty().addClass("is-hidden");var e,i;"twitter"===this.attr.authType?(e="login/twitter_account_login_form",i=r):(e="login/tweetdeck_account_login_form",i=o),t.html(this.toHtml(e,{withToggleLoginType:this.attr.withToggleLoginType,withForgotPassword:this.attr.withForgotPassword,withRememberMe:this.attr.withRememberMe,tweetdeckLoginUsername:"tweetdeck"===this.attr.authType?this.attr.uid:""})),this.attachChild(i,t,{authType:this.attr.authType,staySignedIn:this.attr.staySignedIn,errorMsg:this.attr.errorMsg})},this.getCurrentAuthType=function(){return this.select("loginFormSelector").attr("data-auth-type")},this.handleLoginToggleStaySignedIn=function(t,e){this.attr.staySignedIn=!!e.staySignedIn,TD.storage.store.setStaySignedIn(this.attr.staySignedIn)}}var i=t("flight/lib/component"),n=t("with-child-components"),s=t("ui/with_template"),r=t("ui/login/twitter_account_login_form"),o=t("ui/login/tweetdeck_account_login_form");return i(e,n,s)}),define("util/wait_at_least",[],function(){"use strict";function t(t,e,i,n){var s=Date.now()-e;return setTimeout(i.bind(n),s>t?0:t-s)}return t}),define("ui/login/migrate_tweetdeck_account_preview",["require","flight/lib/component","ui/with_template","util/wait_at_least"],function(t){"use strict";function e(){this.attributes({template:"login/migrate_tweetdeck_account_preview",errorTemplate:"login/migrate_tweetdeck_account_preview_error",badPasswordTemplate:"login/migrate_tweetdeck_account_preview_bad_password",minWaitTime:1e3,withNumericData:!0}),this.after("initialize",function(){this.on(document,"dataMigrateTweetDeckAccountPreviewSuccess",this.handleMigrateTweetDeckAccountPreviewSuccess),this.on(document,"dataMigrateTweetDeckAccountPreviewError",this.handleMigrateTweetDeckAccountPreviewError),this.on(document,"dataMigrateData",_.once(this.handleMigrateData)),this.trigger("uiNeedsMigrateData"),this.trigger(document,"metric",{key:"migrate:tweetdeck_account_preview"})}),this.handleMigrateData=function(t,e){this.attr.migrate=_.extend({},this.attr.migrate,e),this.needsPreviewTimestamp=Date.now(),this.trigger("uiNeedsMigratePreviewData",this.attr.migrate)},this.handleMigrateTweetDeckAccountPreviewSuccess=function(t,e){this.attr.preview=_.extend({},this.attr.preview,{accounts:e.accounts.map(function(t){return t.screenName=t.screen_name,t.isVerified=t.verified,t}),numAccounts:e.accounts.length,numColumns:e.num_columns,numScheduled:e.num_scheduled}),s(this.attr.minWaitTime,this.needsPreviewTimestamp,this.renderPreview,this)},this.handleMigrateTweetDeckAccountPreviewError=function(t,e){s(this.attr.minWaitTime,this.needsPreviewTimestamp,this.renderPreviewError.bind(this,e))},this.renderPreview=function(){this.trigger(document,"metric",{key:"migrate:tweetdeck_account_preview:success"}),this.trigger("uiMigratePreviewSuccess"),this.render(this.attr.template,{withNumericData:this.attr.withNumericData,accounts:this.attr.preview.accounts,numAccounts:this.attr.preview.accounts.length,numColumns:this.attr.preview.numColumns,numScheduled:this.attr.preview.numScheduled})},this.renderPreviewError=function(t){this.trigger(document,"metric",{key:"migrate:tweetdeck_account_preview:error"});var e;this.trigger("uiMigratePreviewError",t),e=401===t.req.status?this.attr.badPasswordTemplate:this.attr.errorTemplate,this.render(e)}}var i=t("flight/lib/component"),n=t("ui/with_template"),s=t("util/wait_at_least");return i(e,n)}),define("ui/login/migrate_tweetdeck_account_warning",["require","flight/lib/component","ui/with_template"],function(t){"use strict";function e(){this.attributes({template:"login/migrate_tweetdeck_account_warning",errorTemplate:"login/migrate_tweetdeck_account_warning_error",migrateContinueSelector:".js-migrate-continue",migrateCancelSelector:".js-migrate-cancel"}),this.after("initialize",function(){this.on("click",{migrateContinueSelector:this.handleMigrateContinue,migrateCancelSelector:this.handleMigrateCancel}),this.on(document,"dataMigrateTweetDeckAccountPreviewSuccess",this.handleMigrateTweetDeckAccountPreviewSuccess),this.on(document,"dataMigrateTweetDeckAccountPreviewError",this.handleMigrateTweetDeckAccountPreviewError),this.on(document,"dataMigrateData",_.once(this.handleMigrateData)),this.trigger("uiNeedsMigrateData"),this.trigger(document,"metric",{key:"migrate:tweetdeck_account_warning"})}),this.handleMigrateData=function(t,e){this.attr.migrate=_.extend({},this.attr.migrate,e),this.trigger("uiNeedsMigratePreviewData",this.attr.migrate)},this.handleMigrateTweetDeckAccountPreviewSuccess=function(t,e){this.trigger("uiMigratePreviewSuccess"),this.trigger(document,"metric",{key:"migrate:tweetdeck_account_warning:success"});var i=TD.storage.accountController.getAccountFromId(this.attr.migrate.uid),n=TD.storage.accountController.getAccountsForService("twitter"),s=e.accounts,r=this.buildImportData(i,n,s,{dedupeExisting:!1,dedupeSignIn:!0}),o=r.newProfiles.length>0,a=r.existingProfiles.length>0,c=this.attr.migrate.isTeamOrganiser,u="multiple"===this.attr.migrate.accountType&&!c;this.render(this.attr.template,{twitterProfile:r.twitterProfile,newProfiles:r.newProfiles,showNewProfiles:o,existingProfiles:r.existingProfiles,showExistingProfiles:a,isMultiUser:u,isTeamOrganiser:c})},this.handleMigrateTweetDeckAccountPreviewError=function(t,e){this.trigger(document,"metric",{key:"migrate:tweetdeck_account_warning:error"}),this.trigger("uiMigratePreviewError",e),this.render(this.attr.errorTemplate)},this.handleMigrateContinue=function(){this.trigger("uiMigrateContinue")},this.handleMigrateCancel=function(){this.trigger("uiMigrateCancel",{})},this.buildImportData=function(t,e,i,n){var s=this.extractProfileFromStoredAccount(t),r=[],o=e.reduce(function(t,e){var i=this.extractProfileFromStoredAccount(e);return i.id!==s.id&&(t.push(i),r.push(i.id)),t}.bind(this),[]),a=i.reduce(function(t,e){var i=r.indexOf(e.uid)>-1&&n.dedupeExisting,o=e.uid===s.id&&n.dedupeSignIn;return!i&&!o&&t.push(this.extractProfileFromPreviewAccount(e)),t}.bind(this),[]);return{twitterProfile:s,existingProfiles:o,newProfiles:a}},this.extractProfileFromStoredAccount=function(t){return{id:t.getUserID(),screenName:t.getUsername(),name:t.getName(),profileImageURL:t.getProfileImageURL(),isVerified:!1}},this.extractProfileFromPreviewAccount=function(t){return{id:t.uid,screenName:t.screen_name,name:t.name,profileImageURL:t.avatar,isVerified:t.verified}}}var i=t("flight/lib/component"),n=t("ui/with_template");return i(e,n)}),define("ui/login/migrate_account_login",["require","flight/lib/component","with-child-components","ui/login/twitter_account_login_form","ui/login/tweetdeck_account_login_form","ui/login/migrate_tweetdeck_account_preview","ui/login/migrate_tweetdeck_account_warning","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({layoutTemplate:"login/migrate_account_login",staySignedIn:!0,migrate:null,migrateTwitterFormSelector:".js-migrate-twitter-form",migrateTweetdeckFormSelector:".js-migrate-tweetdeck-form",migrateTweetdeckAccountPreviewSelector:".js-migrate-tweetdeck-account-preview",migrateTweetdeckAccountPreviewContentSelector:".js-migrate-tweetdeck-account-preview-content",migrateTweetdeckAccountWarningSelector:".js-migrate-tweetdeck-account-warning",migrateAccountLoginFormsCancelSelector:".js-migrate-account-login-forms-cancel",migrateAccountLoginFormsRestartSelector:".js-migrate-account-login-forms-restart",migrateAccountStepClassPrefix:"migrate-account-login-step-",migrateArrowSelector:".migrate-account-login-arrow",migrateCancelWrapperSelector:".migrate-account-login-forms-cancel",migrateTweetdeckAccountPreviewLegendSelector:".js-migrate-tweetdeck-account-preview-legend",scribeNamespaceMap:{1:"migrate_tweetdeck_login",2:"migrate_twitter_login",3:"migrate_final_confirmation"}}),this.after("initialize",function(){this.on("uiLoginRequest",this.handleLoginFormSubmit),this.on("uiLoginRequest",{migrateTweetdeckFormSelector:this.handleTweetdeckLoginFormSubmit}),this.on(document,"dataNeedsMigrateLoginConfirmation",this.handleDataNeedsMigrateTwitterLoginConfirmation),this.on("uiLoginAuthComplete",{migrateTwitterFormSelector:this.handleMigrateTwitterLoginAuthComplete}),this.on("uiMigrateContinue",{migrateTweetdeckAccountWarningSelector:this.handleMigrateWarningContinue}),this.on("uiMigrateCancel",{migrateTweetdeckAccountWarningSelector:this.handleMigrateWarningCancel}),this.on("uiMigratePreviewSuccess",{migrateTweetdeckAccountPreviewSelector:this.handleMigratePreviewSuccess,migrateTweetdeckAccountWarningSelector:this.setStep.bind(this,3)}),this.on("uiMigratePreviewError",{migrateTweetdeckAccountPreviewSelector:this.handleMigratePreviewError,migrateTweetdeckAccountWarningSelector:this.handleMigrateWarningPreviewError}),this.on("click",{migrateAccountLoginFormsCancelSelector:this.migrateLoginFormsCancelClick,migrateAccountLoginFormsRestartSelector:this.migrateLoginFormsRestartClick});var t=this.attr.migrate.isTeamOrganiser,e="single"===this.attr.migrate.accountType&&!t,i="multiple"===this.attr.migrate.accountType&&!t,n=c.render(this.attr.layoutTemplate,{resolution:TD.util.isRetina()?"2x":"1x",withToggleLoginType:!1,withRememberMe:!1,withForgotPassword:!0,withFixedTweetdeckLoginUsername:!0,withForcedMigration:TD.decider.hasAccessLevel("migration","FORCED_MIGRATION"),tweetdeck:{tweetdeckLoginUsername:this.attr.migrate.email,tweetdeckLoginLegend:TD.i("Enter the password for your TweetDeck account"),tweetdeckLoginLegendClasses:"txt-bold padding-vl",loginFormButtonContent:TD.i("Next"),loginFormButtonIcon:"icon-arrow-r"},twitter:{twitterLoginLegend:TD.i("Choose a Twitter username to log in with from now on"),twitterLoginLegendClasses:"txt-bold padding-vl",withWarning:!0,withMultiUserWarning:i,withSingleUserWarning:e,withTeamOrganiserWarning:t,loginFormButtonContent:TD.i("Next"),loginFormButtonIcon:"icon-arrow-r"}});this.$node.html(n),TD.storage.store.setCurrentAuthType("twitter"),s.attachTo(this.select("migrateTwitterFormSelector")),r.attachTo(this.attr.migrateTweetdeckFormSelector,{staySignedIn:this.attr.staySignedIn,teardownOn:"uiMigratePreviewSuccess"}),this.setStep(1),this.attr.migrate&&this.attr.migrate.email&&this.attr.migrate.passhash&&this.tryMigratePreview(this.attr.migrate)}),this.handleTweetdeckLoginFormSubmit=function(t,e){t.preventDefault(),t.stopPropagation(),this.tryMigratePreview({email:e.username,passhash:TD.core.sha1(e.password)})},this.tryMigratePreview=function(t){this.trigger("uiMigrateTweetDeckData",t),this.select("migrateTweetdeckFormSelector").addClass("is-hidden"),this.select("migrateTweetdeckAccountPreviewSelector").removeClass("is-hidden"),this.attachChild(o,this.select("migrateTweetdeckAccountPreviewContentSelector"),{withNumericData:!0,teardownOn:"dataNeedsMigrateLoginConfirmation"})},this.handleMigratePreviewSuccess=function(t){s.attachTo(this.attr.migrateTwitterFormSelector,{staySignedIn:this.attr.staySignedIn,teardownOn:"dataNeedsMigrateLoginConfirmation"}),this.setStep(2)},this.handleMigratePreviewError=function(t,e){this.scribeError(),this.select("migrateArrowSelector").addClass("is-hidden"),this.select("migrateCancelWrapperSelector").addClass("is-hidden"),this.select("migrateTweetdeckAccountPreviewLegendSelector").addClass("is-hidden")},this.handleMigrateTwitterLoginAuthComplete=function(t,e){this.trigger(document,"metric",{key:"migrate:login:twitter_auth_complete"}),this.trigger("uiMigrateTwitterData",e.data)},this.handleDataNeedsMigrateTwitterLoginConfirmation=function(){this.attachChild(a,this.select("migrateTweetdeckAccountWarningSelector"),{teardownOn:"uiMigrationLoginConfirmation"})},this.handleMigrateWarningPreviewError=function(){this.setStep(3),this.scribeError(),this.select("migrateCancelWrapperSelector").addClass("is-hidden")},this.handleLoginFormSubmit=function(){this.scribeAction("next")},this.handleMigrateWarningContinue=function(t){t.stopPropagation(),this.trigger("uiMigrationLoginConfirmation"),this.scribeAction("next")},this.handleMigrateWarningCancel=function(t,e){e.clearMigrateData=!1,this.scribeAction("previous")},this.migrateLoginFormsCancelClick=function(){TD.storage.store.setCurrentAuthType("tweetdeck"),this.scribeAction("cancel"),this.trigger(document,"metric",{key:"migrate:login:twitter_auth_complete"}),this.trigger("uiMigrateCancel",{clearMigrateData:!0})},this.migrateLoginFormsRestartClick=function(){this.trigger("uiMigrateTweetDeckData",{passhash:null}),this.scribeAction("restart"),window.location.reload()},this.setStep=function(t){this.currentStep&&this.$node.removeClass(this.attr.migrateAccountStepClassPrefix+this.currentStep),this.currentStep=t,this.$node.addClass(this.attr.migrateAccountStepClassPrefix+this.currentStep),this.scribeAction("impression")},this.scribeAction=function(t,e){var i=this.attr.scribeNamespaceMap[this.currentStep];TD.controller.stats.migrateStartflow(i,t,e)},this.scribeError=function(){this.scribeAction("impression",!0)}}var i=t("flight/lib/component"),n=t("with-child-components"),s=t("ui/login/twitter_account_login_form"),r=t("ui/login/tweetdeck_account_login_form"),o=t("ui/login/migrate_tweetdeck_account_preview"),a=t("ui/login/migrate_tweetdeck_account_warning"),c=t("scripts/UI/template");return i(e,n)}),define("ui/login/startflow",["require","flight/lib/component","with-child-components","ui/with_template","ui/login/general_login","ui/login/migrate_account_login"],function(t){function e(){this.attributes({chromeTemplate:"startflow_wrapper",startflowContentSelector:".js-startflow-content",startflowChromeSelector:".js-startflow-chrome",externalLinkSelector:'a[target="_blank"]'}),this.after("initialize",function(){this.prepareStartflowUi(),this.on(document,"uiLoginShowLoginForm",this.handleStartflow),this.on("click",{externalLinkSelector:this.openExternalLink})}),this.before("teardown",function(){this.$node.empty().hide()}),this.handleStartflow=function(t,e){this.resetStartflowUi(),e.sessionData=e.sessionData||{};var i={authType:e.sessionData.authType,errorMsg:e.errorMsg,staySignedIn:e.sessionData.staySignedIn,migrate:e.sessionData.migrate,uid:e.sessionData.uid},n=e.sessionData.migrate&&e.sessionData.migrate.email;n?this.attachChild(o,this.attr.startflowContentSelector,i):this.attachChild(r,this.attr.startflowContentSelector,i)},this.prepareStartflowUi=_.once(function(){this.render(this.attr.chromeTemplate,{version:TD.util.getFullVersionString(),withLoading:!0})}),this.resetStartflowUi=function(){this.select("startflowChromeSelector").removeClass("is-hidden"),this.trigger(this.childTeardownEvent),this.select("startflowContentSelector").empty()},this.openExternalLink=function(t,e){t.preventDefault(),TD.util.openURL(e.el.href)}}var i=t("flight/lib/component"),n=t("with-child-components"),s=t("ui/with_template"),r=t("ui/login/general_login"),o=t("ui/login/migrate_account_login");return i(e,n,n.withBoundLifecycle,s)}),define("ui/login/sole_user_dialog",["require","flight/lib/component","ui/with_template"],function(t){function e(){this.attributes({username:null,questionYesButtonSelector:".js-twogin-question-yes-btn",questionNoButtonSelector:".js-twogin-question-no-btn",warningAccessAnywayButtonSelector:".js-twogin-warning-login-anyway-btn",warningLogoutButtonSelector:".js-twogin-warning-logout-btn",soleUserDialogSelector:".js-twogin-sole-user-dialog",questionFormSelector:".js-twogin-question-form",signUpPromptSelector:".js-twogin-show-signup-prompt"}),this.after("initialize",function(){this.showQuestion(),this.on("click",{questionYesButtonSelector:this.handleQuestionYes,questionNoButtonSelector:this.handleQuestionNo,warningAccessAnywayButtonSelector:this.handleWarningAccessAnyway,warningLogoutButtonSelector:this.handleWarningLogout,signUpPromptSelector:this.handleSignUpPrompt})}),this.showQuestion=function(){this.render("login/sole_user_question",{username:this.attr.username,version:TD.version}),TD.controller.stats.soleUserWarningImpression()},this.handleQuestionYes=function(t){t.preventDefault(),this.render("login/sole_user_warning",{username:this.attr.username,version:TD.version}),TD.controller.stats.soleUserWarningClick("sole_user_shared")},this.handleQuestionNo=function(t){t.preventDefault(),this.trigger("uiLoginConfirmSoleUser",{shared:!1}),TD.controller.stats.soleUserWarningClick("sole_user_confirmed"),this.teardown()},this.handleWarningAccessAnyway=function(t){t.preventDefault(),this.trigger("uiLoginConfirmSoleUser",{shared:!0}),TD.controller.stats.soleUserWarningClick("sole_user_ignore_warning"),this.teardown()},this.handleWarningLogout=function(t){this.trigger(document,"uiLoginDenySoleUser"),this.teardown()},this.handleSignUpPrompt=function(t){t.preventDefault(),this.render("login/sole_user_signup_prompt",{version:TD.version})}}var i=t("flight/lib/component"),n=t("ui/with_template");return i(e,n)}),define("ui/with_nav_flyover",["flight/lib/compose","ui/with_template","ui/drag_drop/with_drag_drop"],function(t,e,i){function n(){t.mixin(this,[e,i]),this.after("initialize",function(){this.mouseDown=!1,this.setupDragDrop({indicateDrop:!1,dragstart:this.mouseDownOff,dragend:function(){this.mouseDownOff(),this.destroyFlyover()}}),this.on(document,"mousedown",this.mouseDownOn),this.on(document,"mouseup",this.mouseDownOff)}),this.mouseDownOn=function(t){this.mouseDown=!0},this.mouseDownOff=function(t){this.mouseDown=!1},this.renderFlyover=function(t,e){if(!this.mouseDown){var i;if(i=e&&e.content?e.content:t.data("title")){this.$flyover=this.renderTemplate("column_nav_flyout",{content:i}),$("body").append(this.$flyover);var n=t.height();this.$flyover.css({lineHeight:n+"px"}),this.$flyover.children().height(n),this.repositionFlyover(t)}}},this.destroyFlyover=function(){this.$flyover&&(this.$flyover.remove(),this.$flyover=null)},this.repositionFlyover=function(t){var e;this.$flyover&&(e=t.offset().top-(this.$flyover.height()-t.height())/2,
this.$flyover.css("top",e))}}return n}),define("ui/column_navigation",["require","flight/lib/component","ui/drag_drop/with_drag_drop","ui/with_transitions","ui/with_nav_flyover","scripts/UI/template"],function(t){"use strict";function e(){var t=!1,e=null,i=null,n=null;this.attributes({templateName:"menus/column_nav_menu",contentSelector:".js-column-nav-list",dragAndDropContainerSelector:".js-int-scroller",addColumnButtonSelector:".js-header-add-column",headerActionSelector:".js-header-action",listItemSelector:".js-column-nav-menu-item",dragHandleSelector:".js-drag-handle",columnNavScrollerSelector:".js-column-nav-scroller",animateInClass:"anim-rotate-in",animateOutClass:"anim-rotate-out",isNewClass:"is-new",touchEvents:"touchstart touchmove touchend touchcancel",listOrientation:"vertical",initScrollbarsDelay:300,showScrollbarsThrottle:100}),this.after("initialize",function(){this.renderColumnNavigation(),this.on(document,"dataColumnsLoaded",this.handleDataColumnsLoaded),this.on(document,"uiMainWindowResized",this.handleUiMainWindowResized),$.subscribe("/storage/client/column_order_changed",this.handleColumnsChanged.bind(this)),$.subscribe("/storage/client/change",this.handleColumnsChanged.bind(this)),this.on(document,"uiReadStateChange",this.handleReadStateChange),this.on(document,"uiMessageUnreadCount",this.handleMessageCount),this.on(document,"dataSettings",this.handleDataSettings),this.on(document,"uiColumnTitleRefreshed",this.handleColumnTitleRefreshed),this.on("click",{headerActionSelector:this.handleClick}),this.trigger("uiNeedsSettings"),this.$columnNavScroller=$(".js-column-nav-scroller"),TD.util.isTouchDevice()&&this.on(this.$columnNavScroller,this.attr.touchEvents,this.handleTouch),this.throttledShowScrollbars=_.throttle(this.showScrollbars.bind(this),this.attr.showScrollbarsThrottle),this.debouncedInitScrollbars=_.debounce(this.initScrollbars.bind(this),this.attr.initScrollbarsDelay),this.debouncedInitScrollbars(),this.setupDragDrop({type:"tweet",indicateDrop:!1,dragover:this.delegateDragOver,drop:function(t,e){var i=$(t.target).closest(".js-droptarget",this.$node);i.length&&this.trigger("uiAddTweetToCustomTimeline",{id:i.data("customtimeline-id"),tweetId:$(e.el).attr("data-tweet-id"),account:i.data("customtimeline-account")})}})}),this.delegateDragOver=function(t){var e,i=$(t.target);if(e=i.is(".js-droptarget")?i:i.closest(".js-droptarget",this.$node),e.length){if(t.preventDefault(),this.$flyover){if(this.flyoverFor===e[0])return;this.destroyFlyover()}this.showFlyoverFor(e[0]),this.flyoverFor=e[0]}else this.destroyFlyover()},this.handleDataColumnsLoaded=function(){this.renderColumnNavigation()},this.handleColumnsChanged=function(){this.debouncedInitScrollbars()},this.renderColumnNavigation=function(){var t,e,i=TD.controller.columnManager.getAllOrdered(),n=[];if(this.select("listItemSelector").each(function(){n.push($(this).attr("data-column"))}),t=n.length!==i.length,e=_.map(i,function(e,i){var s,r,o,a,c,u=e.model.getKey(),h=TD.ui.columns.getColumnElementByKey(u);return n[i]!==u&&(t=!0),e.isOwnCustomTimeline()&&(s=e.getCustomTimelineFeed(),r=s&&s.getMetadata(),o=r&&r.id,a=s&&s.getAccountKey()),e.isMessageColumn()&&(c=e.unreadMessageCount()),{key:u,title:e.getTitleHTML(),iconclass:e.getIconClass(),isNew:h.hasClass(this.attr.isNewClass),customTimelineId:o,customTimelineAccount:a,isMessageColumn:e.isMessageColumn(),unreadCount:"0"===c?null:c}}.bind(this)),t){var s=o.render(this.attr.templateName,{columns:e});this.$node.html(s),this.$content=this.select("contentSelector"),this.$addColumnButton=this.select("addColumnButtonSelector"),this.select("headerActionSelector").on("mouseover",this.handleListItemMouseover.bind(this)).on("mouseout",this.handleListItemMouseout.bind(this)),this.resizeColumnNavigation(),this.initialiseDragDrop()}var r=$(".js-column-nav-list a").find(":hover");r.length||this.destroyFlyover()},this.resizeColumnNavigation=function(){var t=this.$node.height();this.$node&&t&&(this.$content.height()>t?($(document).trigger("uiColumnNavSizeOverflow"),this.$addColumnButton.hide()):($(document).trigger("uiColumnNavSizeNormal"),this.$addColumnButton.show()))},this.handleUiMainWindowResized=function(){this.resizeColumnNavigation(),this.throttledShowScrollbars()},this.handleClick=function(e){if(!TD.util.isTouchDevice()||!t){var i=$(e.target).closest("a[data-action]"),n=i.data("action"),s=i.data("column");switch(n){case"jumpto":TD.controller.columnManager.showColumn(s),TD.controller.stats.navbarJumpToColumn()}this.trigger(TD.components.BaseModal.CLOSE_EVENT)}},this.handleDrop=function(t){var e=[],i=$(t.target).attr("data-column");this.trigger("uiColumnMoving",{columnKey:i}),this.select("listItemSelector").each(function(){e.push($(this).attr("data-column"))}),TD.storage.clientController.client.setColumnOrder(e),TD.controller.stats.navbarReorderColumns()},this.handleDrag=function(t,e){this.repositionFlyover($(t.target))},this.handleDropped=function(t,e){this.repositionFlyover($(t.target))},this.initialiseDragDrop=function(){this.select("dragAndDropContainerSelector").dragdroplist({handle:this.attr.dragHandleSelector,orientation:this.attr.listOrientation,selector:this.attr.listItemSelector,$boundary:this.$node}).on("drop.dragdroplist",this.handleDrop.bind(this)).on("drag.draggable",this.handleDrag.bind(this)).on("dropped.dragdroplist",this.handleDropped.bind(this))},this.getColumnItem=function(t){return this.$node.find(".js-column-nav-menu-item[data-column="+t+"]")},this.handleReadStateChange=function(t,e){var i=this.getColumnItem(e.columnKey),n=i.find(".js-unread-count");0===n.length&&i.toggleClass(this.attr.isNewClass,!e.read)},this.handleMessageCount=function(t,e){var i=this.getColumnItem(e.columnKey),n=i.find(".js-unread-count"),s=n.text()||"0",r="0"===s&&"0"!==e.count,o="0"!==s&&"0"===e.count;n.text(e.count),r&&(this.stopAnimation(n,this.attr.animateOutClass),n.addClass("is-visible"),this.addAnimateClass(n,this.attr.animateInClass)),o&&(this.stopAnimation(n,this.attr.animateInClass),this.addAnimateClass(n,this.attr.animateOutClass,function(){n.removeClass("is-visible")}))},this.showFlyoverFor=function(t){var e=$(t);if(this.isNavbarCollapsed&&!TD.util.isTouchDevice()){var i,n,s=e.data("column");s&&(i=TD.controller.columnManager.get(s),n={content:i.getTitleHTML()}),this.isDragging()||this.renderFlyover(e,n)}},this.handleListItemMouseover=function(t){this.showFlyoverFor(t.currentTarget)},this.handleListItemMouseout=function(t){this.isDragging()||this.destroyFlyover()},this.isDragging=function(){return this.$node.find(".draggable-dragging").length>0},this.handleDataSettings=function(t,e){this.isNavbarCollapsed=Boolean("condensed"===e.navbarWidth),this.destroyFlyover()},this.handleDataColumnStateUpdated=function(t,e){var i=this.$node.find(".js-column-nav-menu-item[data-column="+e.columnKey+"]");e.unread?i.addClass(this.attr.isNewClass):i.removeClass(this.attr.isNewClass)},this.handleColumnTitleRefreshed=function(t,e){var i=this.$node.find(".js-column-nav-menu-item[data-column="+e.columnKey+"] .js-column-title"),n=TD.controller.columnManager.get(e.columnKey),s=n.getTitleHTML();i.html(s)},this.initScrollbars=function(){var t=this.$columnNavScroller.data("antiscroll");t?t.refresh():this.$columnNavScroller.antiscroll({showOnMouseOver:!1,position:"left"})},this.showScrollbars=function(){var t=this.$columnNavScroller.data("antiscroll");t?(t.refresh(),t.vertical&&t.vertical.show()):this.initScrollbars()},this.handleTouch=function(s){var r=$(s.target);if(0!==r.closest(".js-drag-handle").length){var o=null,a=s.originalEvent,c=a.changedTouches[0],u={x:c.pageX,y:c.pageY},h=(new Date).getTime();switch(a.type){case"touchstart":t=!1,e=h,i=u,n=0;break;case"touchmove":var l=this.countDistance(u,i);if(l>n&&(n=l),e+300>h)break;!t&&50>n?(t=!0,o="mousedown"):t&&(o="mousemove");break;case"touchend":t&&(o="mouseup")}o&&this.simulateMouseEvent(o,a)}},this.simulateMouseEvent=function(t,e){var i=e.changedTouches[0],n=document.createEvent("MouseEvent");n.initMouseEvent(t,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(n),e.preventDefault()},this.countDistance=function(t,e){if(!t||!e)return 0;var i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);return Math.sqrt(i*i+n*n)}}var i=t("flight/lib/component"),n=t("ui/drag_drop/with_drag_drop"),s=t("ui/with_transitions"),r=t("ui/with_nav_flyover"),o=t("scripts/UI/template");return i(e,n,s,r)}),define("ui/columns/column_order",["require","flight/lib/component","ui/with_column_selectors"],function(t){function e(){this.attributes({isMovingClass:"is-moving",isMovingSelector:".is-moving"}),this.after("initialize",function(){this.on(document,"uiColumnMoving",this.handleMovingColumn),this.on(document,"dataColumnOrder",this.handleColumnOrder),this.$columnsContainer=this.select("columnsContainerSelector")}),this.handleMovingColumn=function(t,e){this.getColumnElementByKey(e.columnKey).addClass(this.attr.isMovingClass)},this.isColumnOffScreen=function(t){var e=t.position().left,i=this.getOriginalWidth(t);return 0>e+i||e+i>this.$node.width()},this.storeOriginalWidth=function(t){var e=t.data("originalWidth");void 0===e&&(e=parseInt(t.css("width"),10)),t.data("originalWidth",e)},this.getOriginalWidth=function(t){return t.data("originalWidth")||parseInt(t.css("width"),10)},this.moveColumnInstantly=function(t,e,i,n){i.length>0&&i.attr("data-column")!==n.newOrder[n.newIndex+1]&&(n.detached[i.attr("data-column")]=i.detach()),t?e.insertAfter(t):this.$columnsContainer.prepend(e)},this.moveColumnToNewIndex=function(t,e){var i,n,s=t.newOrder[t.newIndex],r=t.detached[s]||this.getColumnElementByKey(s),o=r.index(),a=function(){r.removeClass(this.attr.isMovingClass),e=r,delete t.detached[s]}.bind(this);t.newOrder.length>=t.newIndex?(i=this.getColumnElementByKey(t.newOrder[t.newIndex+1]),n=i.index()):(i=!1,n=-1),t.newIndex<t.newOrder.length&&o!==n&&(r.hasClass(this.attr.isMovingClass)?(this.storeOriginalWidth(r),this.moveColumnInstantly(e,r,i,t),this.isColumnOffScreen(r)?(r.one("uiColumnScrolled",function(){a(),t.newIndex+=1,this.moveColumnToNewIndex(t,e)}.bind(this)),r.trigger("uiColumnsScrollColumnToCenter",{columnKey:r.attr("data-column")})):(TD.ui.columns.focusColumn(r.attr("data-column"),TD.ui.columns.COLUMN_GLOW_DURATION),a(),t.newIndex+=1,this.moveColumnToNewIndex(t,e))):(e=r,t.newIndex+=1,this.moveColumnToNewIndex(t,e)))},this.handleColumnOrder=function(t,e){var i={},n=null,s=this.select("columnSelector").filter(this.attr.isMovingSelector);return s.length>0?void this.moveColumnToNewIndex({newIndex:0,newOrder:e.columnOrder,detached:i}):void e.columnOrder.forEach(function(t,s){var r=i[t]||this.getColumnElementByKey(t),o=this.select("columnSelector").eq(s);o[0]!==r[0]&&(e.columnOrder.length>s+1&&o.length>0&&o.attr("data-column")!==e.columnOrder[s+1]&&(i[o.attr("data-column")]=o.detach()),0===s?r.prependTo(this.$columnsContainer):r.insertAfter(n),delete i[t]),n=r},this)}}var i=t("flight/lib/component"),n=t("ui/with_column_selectors");return i(e,n)}),define("ui/with_popover",["flight/lib/compose","ui/with_template"],function(t,e){function i(){t.mixin(this,[e]),this.attributes({popoverSelector:".js-popover",popoverContentSelector:".js-popover-content",isHiddenClass:"is-hidden",hasOverlayClass:"has-overlay",defaultHeight:2e3,defaultWidth:310,bottomPadding:30,withClickTrap:!0,withOverlay:!1,repositionPeriod:100,closeModals:!1,positionalClasses:{rt:"popover-position-rt"},popoverPosition:"rt"}),this.after("initialize",function(){this.trigger("uiPopoverCreated",{id:this.attr.id}),this.on(document,"uiCloseModal",this.handleCloseModal),this.boundClickTrap=this.popoverClickTrap.bind(this)}),this.handleCloseModal=function(t){t.target!==this.node&&this.hidePopover()},this.popoverClickTrap=function(t){t!==this.lastSeenEvent&&(this.lastSeenEvent=t,this.$node&&0===this.$node.find(t.currentTarget).length&&this.hidePopover())},this.isPopoverVisible=function(){return!this.$popover.hasClass(this.attr.isHiddenClass)},this.showPopover=function(t){this.$popover.hasClass(this.attr.isHiddenClass)&&(this.$popover.removeClass(this.attr.isHiddenClass),this.withOverlay&&(this.$overlay.removeClass(this.attr.isHiddenClass),this.$overlayControlNode.addClass(this.attr.hasOverlayClass)),this.attr.closeModals&&this.trigger("uiCloseModal"),this.repositionPopover(),this.repositionInterval=this.repositionInterval||setInterval(this.repositionPopover.bind(this),this.attr.repositionPeriod),this.withClickTrap&&_.defer(function(){$("body").on("click","*",this.boundClickTrap)}.bind(this)),this.trigger("uiPopoverShown",{id:this.attr.id}))},this.hidePopover=function(t){this.$popover.hasClass(this.attr.isHiddenClass)||($("body").off("click","*",this.boundClickTrap),this.trigger("uiPopoverHiding",{id:this.attr.id}),this.$popover.addClass(this.attr.isHiddenClass),this.$overlay.addClass(this.attr.isHiddenClass),this.$overlayControlNode.removeClass(this.attr.hasOverlayClass),clearInterval(this.repositionInterval),this.repositionInterval=null,this.trigger("uiPopoverHidden",{id:this.attr.id}))},this.showPopoverOverlay=function(){this.withOverlay=!0,this.$overlay.removeClass("is-hidden"),this.$overlayControlNode.addClass(this.attr.hasOverlayClass)},this.hidePopoverOverlay=function(){this.withOverlay=!1,this.$overlay.addClass("is-hidden"),this.$overlayControlNode.removeClass(this.attr.hasOverlayClass)},this.repositionPopover=function(){var t=this.$node.offset().top,e=$(window).height();this.maxHeight=e-t-this.attr.bottomPadding,this.$popover.css({height:this.maxHeight,"max-height":this.maxHeight}),"auto"===this.defaultHeight&&(this.height=this.$popoverContent.outerHeight(),this.$popover.css({height:this.height,"max-height":this.height}))},this.setPopoverSize=function(t){this.width=t.width,this.height=t.height,this.$popover.css({width:this.width,height:this.height})},this.getPopoverPositionClass=function(){return this.attr.positionalClasses[this.attr.popoverPosition]},this.renderInPopover=function(t,e,i){i&&(this.defaultHeight=i.defaultHeight||this.attr.defaultHeight,this.withOverlay=i.withOverlay||this.attr.withOverlay,this.withClickTrap=i.withClickTrap||this.attr.withClickTrap),this.$overlay=this.renderTemplate("overlay"),this.$overlayControlNode=this.$node.closest(".js-overlay"),this.$overlay.insertBefore(this.$overlayControlNode),this.render("popover"),this.$popover=this.select("popoverSelector"),this.$popover.addClass(this.getPopoverPositionClass()),this.setPopoverSize({width:this.attr.defaultWidth}),this.$popoverContent=this.select("popoverContentSelector");var n=this.renderTemplate(t,e);this.$popoverContent.append(n)}}return i}),define("ui/search/search_in_popover",["flight/lib/component","ui/with_popover"],function(t,e){function i(){this.attributes({searchInputSelector:".js-app-search-input",searchInputClassName:"js-app-search-input",searchInPopoverTemplate:"search/search_in_popover",isHiddenClass:null,appSearchSourceId:null,searchPopoverSourceId:null,typeaheadContainer:".js-typeahead-dropdown",searchResultsContainer:".js-search-results-container",searchFormContainer:".js-search-form"}),this.after("initialize",function(){this.renderInPopover(this.attr.searchInPopoverTemplate,{searchInputClassName:this.attr.searchInputClassName,searchInputTitle:TD.i("Search"),searchInputPlaceholder:TD.i("Search"),isTouchColumnOptions:Boolean(TD.util.isTouchDevice()&&TD.decider.get("touchdeck_column_options_v2"))},{defaultHeight:"auto"}),this.$searchResultsContainer=this.select("searchResultsContainer"),this.$typeaheadContainer=this.select("typeaheadContainer"),this.searchData=null,this.on("uiTypeaheadItemSelected",this.handleTypeaheadItemSelect),this.on("uiTypeaheadNoItemSelected",this.handleTypeaheadNoItemSelected),this.on("uiTypeaheadSubmitQuery",this.handleTypeaheadSubmitQuery),this.on("uiTypeaheadItemComplete",this.handleTypeaheadItemComplete),this.on("uiTypeaheadSuggestions",this.handleTypeaheadSuggestions),this.on("uiTypeaheadNoSuggestions",this.handleTypeaheadNoSuggestions),this.on("uiTypeaheadRenderResults",this.handleTypeaheadRenderResults),this.on("uiSearchResultsColumnAdded",this.handleSearchResultsColumnAdded);var t=this.searchInputHandlerFactory.bind(this);this.on(document,"uiSearchInputSubmit",this.handleSearchInputSubmit),this.on(document,"uiSearchInputEscaped",this.handleSearchInputEscaped),this.on(document,"uiSearchInputFocus",this.handleSearchInputFocus),this.on(document,"uiSearchInputChanged",this.handleSearchInputChanged),this.on(document,"uiSearchInputTab",t("uiTypeaheadInputTab")),this.on(document,"uiSearchInputLeft",t("uiTypeaheadInputLeft")),this.on(document,"uiSearchInputRight",t("uiTypeaheadInputRight")),this.on(document,"uiSearchInputMoveUp",t("uiTypeaheadInputMoveUp")),this.on(document,"uiSearchInputMoveDown",t("uiTypeaheadInputMoveDown")),this.on("uiPopoverShown",this.handlePopoverShown),this.on("uiPopoverHiding",this.handlePopoverHiding),this.on("uiPopoverHidden",this.handlePopoverHidden),this.hasTypeaheadResults=!0,this.around("hidePopover",function(t,e){e!==!1&&this.$input&&this.$input.blur(),this.trigger("uiSearchResultsHidden"),t.apply(this)})}),this.handlePopoverShown=function(t,e){this.$input.addClass("is-focused")},this.handlePopoverHiding=function(t,e){this.defaultHeight="auto",this.$searchResultsContainer.addClass("is-hidden"),this.$typeaheadContainer.removeClass("is-hidden")},this.handlePopoverHidden=function(t,e){this.$input.removeClass("is-focused"),this.trigger("uiSearchInPopoverHidden")},this.handleSearchResultsColumnAdded=function(){this.hidePopover()},this.handleSearchInputFocus=function(t,e){this.isCorrectSource(e.source)&&(this.$input=$(t.target),this.isPopoverVisible()||TD.controller.stats.searchboxFocus(),this.isPopoverEmpty()||this.showPopover(),this.trigger("uiFixedHeaderChangedPosition"),this.$typeaheadContainer.hasClass(this.attr.isHiddenClass)?this.showPopoverOverlay():(this.trigger("uiTypeaheadInputFocus",e),this.hidePopoverOverlay(),this.defaultHeight="auto"))},this.searchInputHandlerFactory=function(t){return function(e,i){this.isCorrectSource(i.source)&&!this.$typeaheadContainer.hasClass(this.attr.isHiddenClass)&&this.trigger(t,i)}.bind(this)},this.handleSearchInputChanged=function(t,e){this.isCorrectSource(e.source)&&(this.$input=$(t.target),this.isPopoverVisible()||this.showPopover(),this.hidePopoverOverlay(),this.defaultHeight="auto",this.$searchResultsContainer.addClass("is-hidden"),this.$typeaheadContainer.removeClass("is-hidden"),this.trigger("uiTypeaheadInputChanged",e))},this.isCorrectSource=function(t){return t===this.attr.appSearchSourceId||t===this.attr.searchPopoverSourceId},this.handleSearchInputEscaped=function(t,e){this.isCorrectSource(e.source)&&(this.trigger("uiTypeaheadInputBlur"),this.hidePopover())},this.handleSearchInputSubmit=function(t,e){var i;this.isCorrectSource(e.source)&&(this.searchData=e,twttr.txt.isValidList(e.query)?(i=e.query.split("/"),TD.ui.openColumn.showList(i[0].substr(1),i[1]),this.hidePopover()):(this.trigger("uiTypeaheadInputSubmit",e),TD.controller.stats.searchboxPerformSearch(e.query)))},this.handleTypeaheadNoItemSelected=function(){this.searchData&&this.performSearch(this.searchData)},this.handleTypeaheadSubmitQuery=function(t,e){var i;return twttr.txt.isValidList(e.query)?(i=e.query.split("/"),TD.ui.openColumn.showList(i[0].substr(1),i[1]),this.hidePopover(),void 0):void 0},this.performSearch=function(t){t.query&&(this.trigger("uiNewSearchQuery",{query:t.query}),this.defaultHeight="max",this.$typeaheadContainer.addClass("is-hidden"),this.$searchResultsContainer.removeClass("is-hidden"),this.trigger("uiSearch",t),this.showPopover(),this.showPopoverOverlay(),this.searchData=null)},this.handleTypeaheadItemSelect=function(t,e){var i;switch(e.searchType){case"user":this.hidePopover(),this.trigger("uiShowProfile",{id:e.query});break;case"topic":case"saved-search":case"recent-search":this.performSearch(e);break;case"recent-search-clear":this.trigger("uiRecentSearchClearAction");break;case"list":i=e.query.split("/"),TD.ui.openColumn.showList(i[0],i[1])}this.searchData=null},this.handleTypeaheadItemComplete=function(t,e){this.$input.trigger("uiAppSearchItemComplete",e)},this.handleTypeaheadNoSuggestions=function(t,e){this.hasTypeaheadResults=!1,this.isPopoverEmpty()&&this.hidePopover(!1),this.trigger("uiAppSearchSetPreventDefault",{preventDefault:!1,key:9})},this.handleTypeaheadSuggestions=function(t,e){this.trigger("uiAppSearchSetPreventDefault",{preventDefault:!0,key:9})},this.handleTypeaheadRenderResults=function(){this.hasTypeaheadResults=!0,this.showPopover()},this.isPopoverEmpty=function(){return!this.hasTypeaheadResults&&!$.contains(this.$popover[0],this.$input[0])}}return t(i,e)}),define("ui/with_click_trap",[],function(){var t=function(){var t=[],e=[],i=!1;this.onReceiveClick=function(e){t.push(e)},this.onLoseClick=function(t){e.push(t)},this.runReceiveHandlers=function(){t.forEach(function(t){t.call(this)},this)},this.runLoseHandlers=function(t){this.targetWithinComponent(t.target)||e.forEach(function(t){t.call(this)},this)},this.targetWithinComponent=function(t){return $(t).closest(this.$clickTrapTarget||this.$node).length>0},this.setClickTrapTarget=function(t){this.$clickTrapTarget=t},this.enableClickTrap=function(){i||(_.defer(function(){$("body").on("click.clicktrap","*",this.runLoseHandlers.bind(this)),this.$node.on("click.clicktrap","*",this.runReceiveHandlers.bind(this))}.bind(this)),i=!0)},this.disableClickTrap=function(){i&&($("body").off("click.clicktrap"),this.$node.off("click.clicktrap"),i=!1)}};return t}),define("ui/typeahead/with_users",[],function(){return function(){this.attributes({usersListSelector:".js-typeahead-user-list",usersItemSelector:".js-typeahead-user-item",usersTemplate:"typeahead/typeahead_users"}),this.renderUsers=function(t,e){this.$usersList.find(this.attr.usersItemSelector).remove();var i=e.suggestions.users||[];if(!i.length)return void this.clearUsers();var n=this.toHtml(this.attr.usersTemplate,{users:i});this.$usersList.toggleClass("has-results",i.length>0).toggleClass("is-hidden",0===i.length).html(n)},this.getAvatar=function(t){return t.profile_image_url_https.replace(/_normal(\..*)?$/i,"_mini$1")},this.clearUsers=function(){this.$usersList.removeClass("has-results"),this.$usersList.addClass("is-hidden")},this.after("initialize",function(){this.$usersList=this.select("usersListSelector"),this.on("uiTypeaheadRenderResults",this.renderUsers)})}}),define("ui/typeahead/with_saved_searches",["flight/lib/compose","ui/with_text_utils"],function(t,e){return function(){t.mixin(this,[e]),this.attributes({savedSearchesListSelector:".js-typeahead-saved-search-list",savedSearchesItemSelector:".js-typeahead-saved-search-item",savedSearchesTemplate:"typeahead/typeahead_saved_searches"}),this.renderSavedSearches=function(t,e){var i,n=[];this.$savedSearchesList.empty(),e.suggestions&&e.suggestions.savedSearches&&(e.suggestions.savedSearches.forEach(function(t){n.push({query:t.query,name:this.highlightSubstring(t.name,e.query)})},this),i=this.toHtml(this.attr.savedSearchesTemplate,{savedSearches:n}),this.$savedSearchesList.toggleClass("has-results",n.length>0).toggleClass("is-hidden",0===n.length).html(i))},this.after("initialize",function(){this.$savedSearchesList=this.select("savedSearchesListSelector"),this.on("uiTypeaheadRenderResults",this.renderSavedSearches)})}}),define("ui/typeahead/with_recent_searches",["flight/lib/compose","ui/with_text_utils"],function(t,e){var i=function(){t.mixin(this,[e]),this.attributes({recentSearchesListSelector:".js-typeahead-recent-search-list",recentSearchesItemSelector:".js-typeahead-recent-search-item",recentSearchesClearSelector:".js-typeahead-recent-search-clear",recentSearchesTemplate:"typeahead/typeahead_recent_searches",recentSearchesPlaceholderTemplate:"typeahead/recent_searches_placeholder",recentSearchesFixedClass:"recent-searches-fixed-list"}),this.renderRecentSearches=function(t,e){this.currentData=e;var i=e.datasources&&e.datasources.some(function(t){return"recentSearches"===t});if(!i)return this.$recentSearchesList.removeClass("has-results").addClass("is-hidden").empty(),void this.$clearRecentSearches.addClass("is-hidden").removeClass("is-invisible");var n,s=i&&1===e.datasources.length,r=e.suggestions&&e.suggestions.recentSearches&&e.suggestions.recentSearches.length,o=r||s,a=s&&!r;if(r){var c=[];e.suggestions.recentSearches.forEach(function(t){c.push({query:t,name:this.highlightSubstring(t,e.query)})},this),n=this.toHtml(this.attr.recentSearchesTemplate,{recentSearches:c})}else n=s?this.toHtml(this.attr.recentSearchesPlaceholderTemplate):"";this.$recentSearchesList.toggleClass(this.attr.recentSearchesFixedClass,s),this.$recentSearchesList.toggleClass("has-results",r).toggleClass("is-hidden",!o).html(n),this.$clearRecentSearches.toggleClass("is-hidden",!s).toggleClass("is-invisible",a)},this.clearRecentSearches=function(t){delete this.currentData.suggestions.recentSearches,this.renderRecentSearches(null,this.currentData)},this.after("initialize",function(){this.$recentSearchesList=this.select("recentSearchesListSelector"),this.$clearRecentSearches=this.select("recentSearchesClearSelector"),this.on("uiRecentSearchClearAction",this.clearRecentSearches),this.on("uiTypeaheadRenderResults",this.renderRecentSearches)})};return i}),define("ui/typeahead/with_topics",["flight/lib/compose","ui/with_text_utils"],function(t,e){return function(){t.mixin(this,[e]),this.attributes({topicsListSelector:".js-typeahead-topic-list",topicsItemSelector:".js-typeahead-topic-item",topicsTemplate:"typeahead/typeahead_topics"}),this.renderTopics=function(t,e){this.$topicsList.empty();var i=e.suggestions.topics||[];if(!i.length)return void this.clearTopics();var n=i.map(function(t){return{topic:t.topic,name:this.highlightSubstring(t.topic,e.query)}},this),s=this.toHtml(this.attr.topicsTemplate,{topics:n});this.$topicsList.toggleClass("has-results",i.length>0).toggleClass("is-hidden",0===i.length).html(s)},this.clearTopics=function(t){this.$topicsList.removeClass("has-results"),this.$topicsList.addClass("is-hidden")},this.resetTopics=function(){this.clearTopics(),this.$topicsList.find(this.attr.topicsItemSelector).remove()},this.after("initialize",function(){this.$topicsList=this.select("topicsListSelector"),this.on("uiTypeaheadRenderResults",this.renderTopics)})}}),define("ui/typeahead/with_lists",["flight/lib/compose","ui/with_text_utils"],function(t,e){var i=function(){t.mixin(this,[e]),this.attributes({listsListSelector:".js-typeahead-lists-list",listItemSelector:".js-typeahead-list-item",listTemplate:"typeahead/typeahead_lists"}),this.renderLists=function(t,e){this.currentData=e;var i=e.datasources&&e.datasources.some(function(t){return"lists"===t});if(!i)return void this.$listsList.removeClass("has-results").addClass("is-hidden").empty();var n,s=e.suggestions&&e.suggestions.lists&&e.suggestions.lists.length;if(s){var r=[];e.suggestions.lists.forEach(function(t){r.push({query:t.fullName,fullName:this.highlightSubstring(t.fullName,e.query),name:t.name,screenName:t.user.screenName})},this),n=this.toHtml(this.attr.listTemplate,{lists:r})}else n="";this.$listsList.toggleClass("has-results",s).toggleClass("is-hidden",!s).html(n)},this.after("initialize",function(){this.$listsList=this.select("listsListSelector"),this.on("uiTypeaheadRenderResults",this.renderLists)})};return i}),define("ui/typeahead/with_conversations",[],function(){"use strict";return function(){this.attributes({conversationListSelector:".js-typeahead-conversation-list",conversationItemSelector:".js-typeahead-conversation-item",conversationTemplate:"typeahead/typeahead_conversations"}),this.after("initialize",function(){this.$conversationList=this.select("conversationListSelector"),this.on("uiTypeaheadRenderResults",this.renderConversations)}),this.renderConversations=function(t,e){this.$conversationList.find(this.attr.conversationItemSelector).remove();var i=e.suggestions.conversations||[];if(!i.length)return void this.clearConversations();var n=i.map(function(t){return t.render({templateName:this.attr.conversationTemplate})},this).join("");this.$conversationList.toggleClass("has-results",i.length>0).toggleClass("is-hidden",0===i.length).html(n)},this.clearConversations=function(){this.$conversationList.removeClass("has-results"),this.$conversationList.addClass("is-hidden")}}}),define("ui/typeahead/typeahead_dropdown",["require","flight/lib/component","ui/with_click_trap","ui/typeahead/with_users","ui/typeahead/with_saved_searches","ui/typeahead/with_recent_searches","ui/typeahead/with_topics","ui/typeahead/with_lists","ui/typeahead/with_conversations","ui/with_template"],function(t){function e(){this.attributes({inputSelector:".js-app-search-input",dropdownSelector:".js-typeahead-dropdown",itemsSelector:".js-typeahead-item",itemSelectedClass:"is-selected",itemSelectedSelector:".js-typeahead-item.is-selected",deciders:{showDebugInfo:!1},datasources:["topics","savedSearches","recentSearches","users","lists","conversations"],limits:{users:5,topics:5,lists:2,conversations:3},datasourcesRecentOnly:["recentSearches"],queryTypes:["topic","saved-search","recent-search","user","conversation"],minHeight:300,hideAfterSelect:!1,autoSelect:!1,withClickTrap:!1}),this.after("initialize",function(){if(this.query=null,this.on(document,"dataTypeaheadSuggestions",this.handleDataTypeaheadSuggestions),this.on("uiTypeaheadInputFocus",this.handleTypeaheadInputFocus),this.on("uiTypeaheadInputBlur",this.handleTypeaheadInputBlur),this.on("uiTypeaheadInputSubmit",this.handleTypeaheadInputSubmit),this.on("uiTypeaheadInputChanged",this.handleTypeaheadInputChanged),this.on("uiTypeaheadInputMoveUp",this.handleTypeaheadInputMoveUp),this.on("uiTypeaheadInputMoveDown",this.handleTypeaheadInputMoveDown),this.on("uiTypeaheadInputRight",this.handleTypeaheadInputMoveRight),this.on("uiTypeaheadInputTab uiTypeaheadInputLeft",this.completeSelection),this.on("uiTypeaheadInputEscaped",this.handleTypeaheadInputEscaped),this.on("mouseover",{itemsSelector:this.handleItemMouseover}),this.on("click",{itemsSelector:this.handleItemClick}),this.attr.withClickTrap){var t=this.select("dropdownSelector").add(this.select("inputSelector"));this.setClickTrapTarget(t),this.onReceiveClick(this.handleClickTrapClick)}}),this.handleClickTrapClick=function(){this.hideDropdown(),this.trigger(this.select("inputSelector"),"uiTypeaheadNoItemSelected")},this.handleTypeaheadInputEscaped=function(){this.hideDropdown()},this.handleTypeaheadInputFocus=function(t,e){this.hasFocus=!0,e.query!==this.query&&this.handleTypeaheadInputChanged(t,e)},this.handleTypeaheadInputBlur=function(){this.hasFocus=!1,this.trigger("dataTypeaheadQueryReset")},this.handleItemMouseover=function(t,e){this.select("itemsSelector").removeClass(this.attr.itemSelectedClass),$(e.el).addClass(this.attr.itemSelectedClass)},this.moveSelection=function(t){var e,i=this.select("itemsSelector").filter(":visible"),n=i.filter(this.attr.itemSelectedSelector);n.removeClass(this.attr.itemSelectedClass),e=n.length?i.index(n)+t:-1+t,0>e?e=i.length-1:e>=i.length&&(e=0),i.eq(e).addClass(this.attr.itemSelectedClass)},this.getSelectedItemIndex=function(){var t=this.select("itemsSelector").filter(":visible"),e=t.filter(this.attr.itemSelectedSelector);return t.index(e)},this.handleTypeaheadInputMoveUp=function(t){this.moveSelection(-1)},this.handleTypeaheadInputMoveDown=function(t){this.moveSelection(1)},this.handleTypeaheadInputMoveRight=function(t,e){-1===this.getSelectedItemIndex()?this.moveSelection(1):this.completeSelection(t,e)},this.handleTypeaheadInputChanged=function(t,e){var i=e.query,n=this.attr.datasources;0===i.trim().length&&(n=this.attr.datasourcesRecentOnly),this.query=i,this.select("itemsSelector").removeClass(this.attr.itemSelectedClass),this.trigger("uiNeedsTypeaheadSuggestions",{query:i,datasources:n,dropdownId:this.getDropdownId(),type:"search",limits:this.attr.limits})},this.getDropdownId=function(){return this.dropdownId||(this.dropdownId="swift_typeahead_dropdown_"+Date.now()),this.dropdownId;

},this.generateItemFromSelectedElement=function(t){var e,i=t.attr("data-search-type");switch(i){case"user":e={id:t.attr("data-user-id"),name:t.attr("data-user-name"),screenName:t.attr("data-screen-name"),profileImageURL:t.attr("data-profile-image-url"),verified:"true"===t.attr("data-verified")};break;case"conversation":e={conversationId:t.attr("data-conversation-id"),accountKey:t.attr("data-account-key")};break;default:e={}}return e},this.triggerSelectionEvent=function(t){var e=this.select("itemsSelector"),i=e.index(t),n=this.query,s=t.data("search-query");(n||s)&&(this.trigger(t,"uiTypeaheadItemSelected",{index:i,searchType:t.data("search-type"),query:s,input:n,item:this.generateItemFromSelectedElement(t)}),this.attr.hideAfterSelect&&this.hideDropdown())},this.handleItemClick=function(t,e){var i=$(e.el);this.triggerSelectionEvent(i)},this.handleTypeaheadInputSubmit=function(t){var e=this.select("itemsSelector").filter(this.attr.itemSelectedSelector).filter(":visible").first();e.length?this.triggerSelectionEvent(e):this.trigger(this.select("inputSelector"),"uiTypeaheadNoItemSelected")},this.completeSelection=function(t,e){var i=e&&"rtl"===e.dir?"rtl":"ltr";if(!("rtl"===i&&"uiTypeaheadInputRight"===t.type||-1!==["ltr",void 0,""].indexOf(i)&&"uiTypeaheadInputLeft"===t.type)){var n=this.select("itemsSelector").filter(this.attr.itemSelectedSelector).first();if(!n.length){n=this.select("itemsSelector").first();var s=n.data("search-query")!==this.query;if(!s)return void("uiTypeaheadInputTab"===t.type&&(this.hasFocus=!1))}var r=n.data("search-type"),o=this.attr.queryTypes.some(function(t){return t===r});if(!o)return void("uiTypeaheadInputTab"===t.type&&(this.hasFocus=!1));var a=n.data("search-query"),c=this.select("itemsSelector"),u=c.index(n);this.trigger("uiTypeaheadItemComplete",{value:a,searchType:n.data("search-type"),index:u,query:a,item:this.generateItemFromSelectedElement(n)}),this.hideDropdown()}},this.hideDropdown=function(){this.attr.withClickTrap&&this.disableClickTrap(),this.attr.hideAfterSelect&&this.select("dropdownSelector").addClass("is-hidden")},this.showDropdown=function(){this.attr.hideAfterSelect&&this.select("dropdownSelector").removeClass("is-hidden"),this.attr.withClickTrap&&this.enableClickTrap()},this.handleDataTypeaheadSuggestions=function(t,e){var i=this.select("itemsSelector").filter(this.attr.itemSelectedSelector);if(e.dropdownId===this.getDropdownId()&&e.query===this.query&&this.hasFocus&&!i.length){this.trigger("uiTypeaheadRenderResults",e);var n=this.attr.datasources.some(function(t){return e.suggestions[t]&&e.suggestions[t].length});n?(this.trigger("uiTypeaheadSuggestions"),this.showDropdown(),this.attr.autoSelect&&0===this.select("itemSelectedSelector").length&&this.select("itemsSelector").first().addClass("is-selected"),this.select("itemsSelector").removeClass("list-item-first").removeClass("list-item-last").filter(":visible").first().addClass("list-item-first").end().last().addClass("list-item-last")):this.trigger("uiTypeaheadNoSuggestions")}}}var i=t("flight/lib/component"),n=t("ui/with_click_trap"),s=t("ui/typeahead/with_users"),r=t("ui/typeahead/with_saved_searches"),o=t("ui/typeahead/with_recent_searches"),a=t("ui/typeahead/with_topics"),c=t("ui/typeahead/with_lists"),u=t("ui/typeahead/with_conversations"),h=t("ui/with_template");return i(e,n,h,r,s,a,c,o,u)}),define("ui/toggle_button",["require","flight/lib/component","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({template:"menus/toggle_button",buttonSelector:".js-toggle-button",buttons:null}),this.after("initialize",function(){this.buttons=this.attr.buttons;var t={buttons:[this.buttons.left,this.buttons.right]},e=n.render(this.attr.template,t);this.$node.html(e),this.$buttons=this.select("buttonSelector"),this.on(this.$buttons,"click",this.handleButtonClick),this.on("uiToggleSelectItem",this.handleSelectItem),this.on("uiToggleButtonDestroy",this.teardown)}),this.handleButtonClick=function(t){var e=$(t.currentTarget),i=e.data("clickevent");i&&(this.trigger(i),this.$buttons.removeClass("is-selected"),e.addClass("is-selected"))},this.handleSelectItem=function(t,e){this.$node.find("."+e["class"]).click()}}var i=t("flight/lib/component"),n=t("scripts/UI/template");return i(e)}),define("ui/user_search_results",["require","flight/lib/component","ui/with_template"],function(t){function e(){this.after("initialize",function(){this.query=null,this.on(document,"uiSearch",this.handleSearch),this.on(document,"dataUserSearch",this.handleResults),this.on("uiUserResultsDestroy",this.teardown)}),this.handleSearch=function(t,e){this.query=e.query,this.$node.empty(),this.trigger(document,"uiNeedsUserSearch",{query:this.query})},this.handleResults=function(t,e){if(e.request.query===this.query){var i=e.result;0===i.length?this.render("search_no_users_placeholder"):this.render("menus/user_results",{users:i,withUserMenu:!0,userMenuPositon:"pos-r"})}}}var i=t("flight/lib/component"),n=t("ui/with_template");return i(e,n)}),define("ui/with_fixed_header_and_footer",["flight/lib/compose","ui/with_template"],function(t,e){var i=function(){t.mixin(this,[e]),this.attributes({headerSelector:".js-fhf-header",bodySelector:".js-fhf-body",footerSelector:".js-fhf-footer"}),this.after("initialize",function(){this.$headerContainer=this.select("headerSelector"),this.$bodyContainer=this.select("bodySelector"),this.$footerContainer=this.select("footerSelector"),this.on("uiFixedHeaderChangedPosition",this.resizeBody)}),this.resizeBody=function(){var t=0,e=0,i=0;this.$headerContainer.hasClass("is-hidden")?(this.$headerContainer.removeClass("is-hidden"),i=this.$headerContainer.position().top,this.$headerContainer.addClass("is-hidden")):(t=this.$headerContainer.outerHeight(),i=this.$headerContainer.position().top),this.$footerContainer.hasClass("is-hidden")||(e=this.$footerContainer.outerHeight()),this.$bodyContainer.css({top:t+i,bottom:e})},this.hideHeader=function(){this.$headerContainer.addClass("is-hidden")},this.showHeader=function(){this.$headerContainer.removeClass("is-hidden")},this.hideFooter=function(){this.$footerContainer.addClass("is-hidden")},this.showFooter=function(){this.$footerContainer.removeClass("is-hidden")}};return i}),define("ui/search/search_results",["flight/lib/component","ui/toggle_button","ui/user_search_results","ui/with_accordion","ui/with_template","ui/with_search_filter","ui/with_focus","ui/asynchronous_form","ui/with_fixed_header_and_footer","ui/with_transitions"],function(t,e,i,n,s,r,o,a,c,u){function h(){this.attributes({scribeSection:"search_results",accordionSelector:".js-accordion",columnScrollerIsAnimatingClass:"is-column-scroller-animating",tweetResultsSelector:".js-tweet-results",userResultsSelector:".js-user-results",searchResultsHeaderSelector:".js-search-results-header",searchResultsFooterSelector:".js-search-results-footer",toggleSelector:".js-toggle",toggleTweetsClass:"js-toggle-tweets",columnType:"search",isTouchColumnOptionsClass:"is-touch-column-options"}),this.after("initialize",function(){this.on(document,"uiSearch",this.handleSearch),this.on("uiColumnUpdateSearchFilter",this.handleUpdateSearchFilter),TD.util.isTouchDevice()&&TD.decider.get("touchdeck_column_options_v2")?this.select("searchResultsHeaderSelector").addClass(this.attr.isTouchColumnOptionsClass):this.select("searchResultsHeaderSelector").removeClass(this.attr.isTouchColumnOptionsClass),this.$tweetResults=this.select("tweetResultsSelector"),this.$userResults=this.select("userResultsSelector"),this.$header=this.select("searchResultsHeaderSelector"),this.$footer=this.select("searchResultsFooterSelector"),this.$accordion=this.select("accordionSelector"),i.attachTo(this.$userResults),this.$toggle=this.select("toggleSelector"),e.attachTo(this.$toggle,{buttons:{left:{label:TD.i("Tweets"),"class":"js-toggle-tweets",clickEvent:"uiToggleTweetsClick",selected:!0},right:{label:TD.i("Users"),"class":"js-toggle-users",clickEvent:"uiToggleUsersClick"}}}),this.on(this.$header,"uiToggleTweetsClick",this.showTweets),this.on(this.$header,"uiToggleUsersClick",this.showUsers),this.on(this.$footer.find(".js-add-column"),"click",this.handleAddColumnClick),TD.util.isTouchDevice()&&window.navigator.standalone&&this.on(this.$userResults,"touchmove",function(t){t.stopPropagation()}),this.on("uiTransitionExpandStart",this.handleColumnOptionsTransitionStart),this.on("uiAccordionTotalHeightChanged",this.resizeBody),this.on("uiSearchResultsHidden",this.handleSearchResultsHidden)}),this.handleUpdateSearchFilter=function(t,e){this.temporaryColumn&&(this.temporaryColumn.column.updateSearchFilter(e),this.temporaryColumn.populate())},this.handleSearchResultsHidden=function(){this.focusRelease(),this.temporaryColumn&&(this.temporaryColumn.destroy(),this.temporaryColumn=null)},this.handleSearch=function(t,e){var i=TD.storage.accountController.getPreferredAccount("twitter"),n=new TD.vo.SearchFilter;this.query=e.query,this.temporaryColumn&&(this.temporaryColumn.destroy(),this.temporaryColumn=null),this.temporaryColumn=new TD.components.TemporaryColumn,this.temporaryColumn.search(this.query,i.getKey()),this.$tweetResults.empty(),this.$tweetResults.append(this.temporaryColumn.$node),this.trigger(this.$toggle,"uiToggleSelectItem",{"class":this.attr.toggleTweetsClass}),this.trigger(this.$header,"uiDestroyAsynchronousForm"),this.select("accordionSelector").html(""),this.renderSearchFilters(n,{withContentType:!0,withMatching:!1,withExcluding:{isControl:!0,searchInputClassName:this.attr.excludingClass,searchInputPlaceholder:TD.i("Enter words to exclude"),searchInputTitle:"excluding"},withLanguage:!0,withRetweetsToggle:!0,withFromList:!0,withActionFilter:!1,withEngagementFilter:TD.decider.get("engagement_filter")}),a.attachTo(this.$header),this.resizeBody(),this.temporaryColumn.populate(),this.showTweets()},this.handleAddColumnClick=function(){this.temporaryColumn.makePermanent(),this.trigger("uiSearchResultsColumnAdded")},this.showTweets=function(){this.focusRequest(),this.$accordion.removeClass("is-hidden"),this.$tweetResults.removeClass("is-hidden"),this.$userResults.addClass("is-hidden"),this.showHeader(),this.showFooter(),this.resizeBody(),this.trigger("uiSearchResultsFocus")},this.showUsers=function(){this.focusRequest(),this.showHeader(),this.$accordion.addClass("is-hidden"),this.$tweetResults.addClass("is-hidden"),this.$userResults.removeClass("is-hidden"),this.hideFooter(),this.resizeBody()},this.handleUpdatingColumn=function(){this.trigger(this.$header,"uiWaitingForAsyncResponse")},this.handleColumnUpdated=function(){this.trigger(this.$header,"uiReceivedAsyncResponse")},this.handleColumnOptionsTransitionStart=function(t,e){var i=this.$bodyContainer,n=parseInt(i.css("top"),10),s=function(){i.data("isAnimating",!1)};i.data("isAnimating")===!0?this.columnScrollerTargetTop=this.columnScrollerTargetTop+e.delta:(i.data("isAnimating",!0),this.columnScrollerTargetTop=n+e.delta),this.transitionTop(i,this.attr.columnScrollerIsAnimatingClass,this.columnScrollerTargetTop,s)},this.before("teardown",function(){this.trigger(this.$searchFilter,"uiDestroyAsynchronousForm"),this.trigger(this.$userResults,"uiUserResultsDestroy"),this.trigger(this.$header,"uiToggleButtonDestroy")})}return t(h,n,s,o,r,c,u)}),define("ui/search/search_router",["require","flight/lib/component"],function(t){"use strict";function e(){this.attributes({appSearchSelector:".js-search",appSearchInputSelector:".js-search-form .js-app-search-input",isTouchSearchClass:"is-touch-search",searchPopoverInputSelector:".js-search-in-popover .js-app-search-input"}),this.after("initialize",function(){TD.util.isTouchDevice()&&TD.decider.get("touchdeck_search_v2")?this.select("appSearchSelector").addClass(this.attr.isTouchSearchClass):this.select("appSearchSelector").removeClass(this.attr.isTouchSearchClass),this.on(document,"uiPerformSearch",this.handlePerformSearch),this.on(document,"uiAppSearchFocus uiShowSearchButtonClick",this.focusSearchInput),this.on(document,"dataSettings",this.handleDataSettings),this.trigger("uiNeedsSettings")}),this.handleDataSettings=function(t,e){this.$input=this.select("condensed"===e.navbarWidth?"searchPopoverInputSelector":"appSearchInputSelector")},this.focusSearchInput=function(){this.$input.triggerHandler("focus"),this.$input.is(":focus")||this.$input.focus()},this.handlePerformSearch=function(t,e){t.target===document&&_.defer(function(){this.trigger(this.$input,"uiAppSearchSubmit",e)}.bind(this))}}var i=t("flight/lib/component");return i(e)}),define("ui/with_drawer_tabs",[],function(){return function(){this.attributes({showDrawerButtonSelector:".js-show-drawer",hideDrawerButtonSelector:".js-hide-drawer"}),this.after("initialize",function(){this.on("click",{showDrawerButtonSelector:this.handleShowDrawerClick,hideDrawerButtonSelector:this.handleHideDrawerClick}),this.on(document,"uiDockedComposeTweet",this.handleDockedComposeTweet),this.on(document,"uiDrawerActive",this.handleDrawerActive)}),this.handleDockedComposeTweet=function(t,e){var i=e.type||"tweet";this.select("hideDrawerButtonSelector").filter(".tweet-button").find("i").addClass("is-hidden").filter('[data-tweet-type~="'+i+'"]').removeClass("is-hidden")},this.handleShowDrawerClick=function(t,e){var i=$(e.el).attr("data-drawer");switch(i){case"compose":this.trigger("uiComposeTweet"),TD.controller.stats.navbarComposeClick();break;case"accountSettings":this.trigger("uiShowAccountSettings")}},this.handleHideDrawerClick=function(t,e){var i=$(e.el).attr("data-drawer");this.trigger("uiDrawerHideDrawer"),"compose"===i&&TD.controller.stats.navbarComposeClick()},this.handleDrawerActive=function(t,e){if(this.select("hideDrawerButtonSelector").addClass("is-hidden"),this.select("showDrawerButtonSelector").removeClass("is-hidden"),e.activeDrawer){var i=function(){return $(this).attr("data-drawer")===e.activeDrawer};this.select("showDrawerButtonSelector").filter(i).addClass("is-hidden"),this.select("hideDrawerButtonSelector").filter(i).removeClass("is-hidden")}}}}),define("ui/app_header",["require","flight/lib/component","ui/with_drawer_tabs","ui/with_nav_flyover","ui/with_dropdown"],function(t){function e(){this.attributes({headerActionSelector:".js-header-action",settingsButtonSelector:'[data-action="settings-menu"]',inviteCountSelector:".js-invite-count"}),this.after("initialize",function(){this.on("click",this.handleClick),this.on(document,"uiToggleNavbarWidth",this.toggleNavbarWidth),this.on(document,"dataSettings",this.handleDataSettings),this.on(document,"uiInvitedContributeeAccounts",this.handleInvitedContributeeAccounts),this.select("headerActionSelector").on("mouseover",this.handleListItemMouseover.bind(this)).on("mouseout",this.handleListItemMouseout.bind(this)),this.trigger("uiNeedsSettings")}),this.handleClick=function(t,e){var i=$(t.target).closest("[data-action]"),n=i.attr("data-action");if(i.length){switch("url"!==n&&t.preventDefault(),n){case"account-settings":this.trigger("uiShowAccountSettings");break;case"add-column":TD.ui.openColumn.showOpenColumn(),TD.controller.stats.navbarAddColumnClick();break;case"settings-menu":t.stopPropagation(),this.toggleSettingsDropdown(i),TD.controller.stats.navbarSettingsClick();break;case"show-lists":TD.ui.openColumn.showLists(),TD.controller.stats.navbarListsClick();break;case"show-customtimelines":TD.ui.openColumn.showCustomTimelines();break;case"change-sidebar-width":this.toggleNavbarWidth();break;case"show-search":this.trigger("uiShowSearchButtonClick"),i.tooltip("hide");break;case"signOut":TD.controller.init.signOut();break;case"globalSettings":$(document).trigger("uiShowGlobalSettings");break;case"do_debug":TD.sync.ui.dispatch_ui_event(i.attr("data-type"));break;case"fileabug":this.sendBugReport();break;case"keyboardShortcutList":$(document).trigger("uiShowKeyboardShortcutList");break;case"migrate":$(document).trigger("uiMigrateStart"),TD.controller.stats.navbarMigrate("click")}this.destroyFlyover()}},this.toggleSettingsDropdown=function(t){var e="tweetdeck"===TD.storage.store.getCurrentAuthType(),i=TD.util.isMacApp()?"account_migration_for_mac":"account_migration",n=TD.config.force_enable_migration||TD.decider.get(i),s=e&&n;this.renderDropdown(t,"menus/topbar_menu",{debug:Boolean(TD.config.debug_menu),account:TD.storage.accountController.getUserIdentifier(),isTwoginUser:"twitter"===TD.storage.store.getCurrentAuthType(),withStartMigrate:s},{position:this.attr.dropdownPositions.verticalRight,toggle:!0}),s&&this.dropdownIsOpen()&&TD.controller.stats.navbarMigrate("impression")},this.toggleNavbarWidth=function(){var t;t=this.isCollapsed?"full-size":"condensed",this.trigger("uiNavbarWidthChangeAction",{navbarWidth:t})},this.handleDataSettings=function(t,e){this.isCollapsed=Boolean("condensed"===e.navbarWidth)},this.handleListItemMouseover=function(t){if(this.isCollapsed&&!TD.util.isTouchDevice()){var e=$(t.currentTarget);this.renderFlyover(e)}},this.handleListItemMouseout=function(t){this.destroyFlyover()},this.sendBugReport=function(){var t=TD.config.fileabug;if(t){var e={tdAccount:TD.storage.store.getTweetdeckAccount(),userAgent:navigator.userAgent,version:TD.version,buildID:TD.gitrevshort},i=TD.ui.template.render("emails/fileabug",e);TD.util.openEmail(t,"",i)}},this.handleInvitedContributeeAccounts=function(t,e){this.select("inviteCountSelector").text(e.count>20?"20+":e.count).toggleClass("is-visible",e.count>0)}}var i=t("flight/lib/component"),n=t("ui/with_drawer_tabs"),s=t("ui/with_nav_flyover"),r=t("ui/with_dropdown");return i(e,n,s,r)}),define("ui/default_page_layout",["flight/lib/component"],function(t){function e(){this.attributes({jsAppSelector:".js-app",jsAppHeaderSelector:".js-app-header",jsAppHeaderInnerSelector:".js-app-header-inner",jsSearchSelector:".js-search",jsAppContentSelector:".js-app-content",isCondensingClass:"is-condensing",isCondensedClass:"is-condensed",scrollNoneClass:"scroll-none",navbarWidthChangeDuration:250,maxColumnsForAnimation:5});var t,e;this.setTheme=function(t){var e=$("link");_.each(e,function(e){var i=_.contains(e.getAttribute("rel"),"stylesheet"),n=e.getAttribute("title");i&&n&&(e.disabled=!0,n===t&&(e.disabled=!1))}),$("meta[http-equiv=Default-Style]")[0].content=t},this.setNavbarWidth=function(i){var n,s=this.select("jsAppHeaderInnerSelector"),r=this.select("jsAppHeaderSelector"),o="condensed"===i,a=TD.storage.clientController.client.getColumnOrder().length,c=function(){o&&r.removeClass(this.attr.isCondensingClass),t.toggleClass(this.attr.isCondensedClass,o),r.toggleClass(this.attr.isCondensedClass,o)}.bind(this);if(!this.isNavbarWidthSet||a>this.attr.maxColumnsForAnimation)c(),this.isNavbarWidthSet=!0,this.trigger("uiToggleNavBarWidth");else{if(!o&&!t.hasClass(this.attr.isCondensedClass)||o&&t.hasClass(this.attr.isCondensedClass))return;o?(n=parseInt(s.css("min-width"),10),r.addClass(this.attr.isCondensingClass)):(r.removeClass(this.attr.isCondensedClass),n=s.outerWidth()),r.addClass(this.attr.scrollNoneClass),r.animate({width:n},{duration:this.attr.navbarWidthChangeDuration,complete:function(){c(),r.removeClass(this.attr.scrollNoneClass),this.trigger("uiToggleNavBarWidth")}.bind(this),step:function(t){e.css("left",t)},easing:"easeOutQuad"})}},this.handleDataSettings=function(t,e){this.setTheme(e.theme),this.setNavbarWidth(e.navbarWidth)},this.after("initialize",function(){t=this.select("jsAppSelector"),e=this.select("jsAppContentSelector"),this.isNavbarWidthSet=!1,this.on(document,"dataSettings",this.handleDataSettings)})}return t(e)}),define("util/keypress",[],function(){var t={};return t.eventIsKey=function(t){return t.which>3},t.isEnter=function(t){return t.which===TD.constants.keyCodes.enter},t.isSpacebar=function(t){return t.which===TD.constants.keyCodes.spacebar},t}),define("ui/compose/send_button",["require","flight/lib/component","util/keypress","ui/compose/with_character_limit","ui/with_spinner_button","with-resources","util/with_observe_state"],function(t){function e(){this.attributes({stateSource:null,canSendSource:null,sendButtonSelector:".js-send-button",composeSuccess:".js-compose-sending-success",buttonText:{tweet:TD.i("Tweet"),reply:TD.i("Tweet"),message:TD.i("Send message")},tooltipText:{ready:TD.i("Tweet"),tooLong:TD.i("Your Tweet is too long"),noAccount:TD.i("You have to select at least one account to tweet from"),noRecipients:TD.i("You have to select a recipient for your message"),scheduledDatePassed:TD.i("Scheduled time has passed")}}),this.after("initialize",function(){this.$sendButton=this.select("sendButtonSelector"),this.on(this.$sendButton,"click keydown",this.handleClick),this.stateStream=this.requestResource(this.attr.stateSource),this.observeState(this.stateStream,["tweetType","scheduledDate"]).map(this.getButtonText,this).subscribeOnNext(this.renderButtonText,this),this.observeState(this.stateStream,["characterCount","selectedAccountKeys","messageRecipients","messageConversation","tweetType","scheduledDate"]).map(this.getTooltipText,this).subscribeOnNext(this.renderTooltip,this),this.observeState(this.stateStream,["sendingStatus"]).subscribeOnNext(this.renderSendingStatus,this),this.observe(this.requestResource(this.attr.canSendSource)).subscribeOnNext(this.toggleEnabled,this)}),this.renderButtonText=function(t){this.$sendButton.text(t)},this.renderTooltip=function(t){var e=$("<div/>").html(t).text();this.$sendButton.attr("data-original-title",e)},this.renderSendingStatus=function(t){this.spinnerButtonToggle("sending"===t.sendingStatus),this.select("composeSuccess").toggleClass("is-hidden","success"!==t.sendingStatus),this.$sendButton.toggleClass("text-hidden","ready"!==t.sendingStatus),"sending"===t.sendingStatus&&this.$sendButton.tooltip("hide")},this.toggleEnabled=function(t){this.$sendButton.toggleClass("is-disabled",!t)},this.handleClick=function(t){(!n.eventIsKey(t)||n.isEnter(t)||n.isSpacebar(t))&&this.trigger("uiComposeSendTweet",{})},this.getButtonText=function(t){return t.scheduledDate?TD.i("Tweet at {{time}}",{time:TD.util.prettyTimeOfDayOrDateString(t.scheduledDate)}):this.attr.buttonText[t.tweetType]},this.getDefaultTooltipText=function(){var t=this.attr.tooltipText.ready,e="osx"===TD.util.getOSName()?"&#8984;"+TD.i("Return"):TD.i("Ctrl+Enter");return[t," (",e,")"].join("")},this.isMessageWithNoRecipient=function(t){return"message"===t.tweetType&&t.messageRecipients.length<1&&null===t.messageConversation},this.getTooltipText=function(t){var e;return e=0===t.selectedAccountKeys.length?this.attr.tooltipText.noAccount:this.isOverCharLimit(t.characterCount)?this.attr.tooltipText.tooLong:this.isMessageWithNoRecipient(t)?this.attr.tooltipText.noRecipients:t.scheduledDate&&t.scheduledDate.getTime()<Date.now()?this.attr.tooltipText.scheduledDatePassed:this.getDefaultTooltipText()}}var i=t("flight/lib/component"),n=t("util/keypress"),s=t("ui/compose/with_character_limit"),r=t("ui/with_spinner_button"),o=t("with-resources"),a=t("util/with_observe_state");return i(a,e,s,r,o)}),define("data/with_bitly",["require"],function(t){return function(){this.maybeShortenTextLinks=function(t,e){"bitly"===TD.settings.getLinkShortener()?this.bitlyShortenTextLinks(t,e):e(t)},this.bitlyShortenTextLinks=function(t,e){var i=TD.services.bitly.shortenTextLinks(t);i.addCallback(e)}}}),define("ui/compose/with_send_tweet",["require","flight/lib/compose","data/with_bitly","data/with_client","ui/with_api_errors"],function(t){function e(t,e){if(t.scheduledDate)this.trigger("uiSendScheduledTweets",{requestId:t.requestId,requests:e,scheduledDate:t.scheduledDate,tokenToDelete:t.scheduledId,metadata:t.metadata});else{var i="message"===t.type?"uiSendDm":"uiSendTweet";e.forEach(function(t){this.trigger(i,t)},this),this.trigger("uiSendScheduledTweets",{requestId:t.requestId,requests:[],scheduledDate:t.scheduledDate,tokenToDelete:t.scheduledId,metadata:t.metadata})}}var i=t("flight/lib/compose"),n=t("data/with_bitly"),s=t("data/with_client"),r=t("ui/with_api_errors");return function(){i.mixin(this,[n,s,r]);var t=[],o=null,a=[];this.after("initialize",function(){this.on(document,"dataTweetSent",this.forCurrentRequest(this.handleDataTweetSent)),this.on(document,"dataTweetError",this.forCurrentRequest(this.handleDataTweetError)),this.on(document,"dataDmSent",this.forCurrentRequest(this.handleDataDmSent)),this.on(document,"dataDmError",this.forCurrentRequest(this.handleDataDmError)),this.on(document,"dataScheduledTweetsSent",this.forCurrentRequest(this.handleDataScheduledTweetsSent)),this.on(document,"dataScheduledTweetsError",this.forCurrentRequest(this.handleDataScheduledTweetsError))}),this.forCurrentRequest=function(t){return function(e,i){var n=o&&i.request&&i.request.requestId===o.requestId;n&&t.call(this,e,i)}},this.resetSendTweet=function(){t=[],a=[],o=null},this.sendTweet=function(t){this.trigger("uiComposeTweetSending"),this.resetSendTweet(),o=t,this.maybeShortenTextLinks(t.text,function(e){t.text=e,this.actuallySendTweet(t)}.bind(this))},this.actuallySendTweet=function(t){var i=[],n=t.from.map(function(e){var n={accountKey:e};return t.accountsMediaIds&&(n.mediaIds=t.accountsMediaIds[e],i.push(n.mediaIds)),$.extend({},t,n)});if(i.length){var s=new TD.core.defer.DeferredList(i);s.addCallback(e.bind(this,t,n))}else e.call(this,t,n)},this.handleTweetResponse=function(e){a.push(e.request),a.length===o.from.length&&(0===t.length?this.triggerTweetSuccess():this.triggerTweetError())},this.handleDataTweetSent=function(t,e){this.handleTweetResponse(e)},this.handleDataDmSent=function(t,e){this.handleTweetResponse(e)},this.handleDataScheduledTweetsSent=function(t,e){this.triggerTweetSuccess()},this.handleDataTweetError=function(e,i){t.push(i),this.handleTweetResponse(i)},this.handleDataDmError=function(t,e){this.handleDataTweetError(t,e)},this.handleDataScheduledTweetsError=function(t,e){var i,n,s;if(e.response.humanReadableMessage)i=e.response.humanReadableMessage;else{try{n=JSON.parse(e.response.req.responseText)}catch(r){}s=n&&n.error?n.error:e.response.req.status,i=TD.i("Scheduling failed. Please try again. ({{message}})",{message:s})}TD.controller.progressIndicator.addMessage(i),this.triggerTweetError()},this.showTweetErrors=function(t){if(0!==t.length){var e=t.map(function(t){var e={};try{e=JSON.parse(t.response.responseText).errors[0]}catch(i){t&&t.response&&TD.util.isNetworkFailure(t.response)&&(e.code="0")}var n=this.getApiErrorMessage(e);t.response&&t.response.message&&(n=t.response.message);var s=this.getAccountData(t.request.accountKey),r=s?s.screenName:"unknown account";switch(o.type){case"message":return TD.i("Message from @{{screenName}} failed: "+n,{screenName:r});default:return TD.i("Tweet from @{{screenName}} failed: "+n,{screenName:r})}},this);TD.controller.progressIndicator.addMessage(e.join("\n"))}},this.triggerTweetSuccess=function(){this.trigger("uiComposeTweetSent")},this.triggerTweetError=function(){this.showTweetErrors(t),this.trigger("uiComposeTweetError",{errors:o.scheduledDate?null:t})}}}),define("ui/compose/inline_compose",["require","flight/lib/component","ui/compose/character_count","ui/compose/send_button","with-child-components","data/with_client","ui/with_column_selectors","ui/compose/with_compose_text","ui/with_focus","ui/compose/with_send_tweet","util/with_observable_state","util/with_observe_state","ui/with_template","with-resources","ui/compose/with_character_limit","util/tweet_utils"],function(t){function e(){var t,e,i;this.attributes({panelCloseDelay:500,inlineReplySelector:".js-inline-reply",closeSelector:".js-inline-compose-close",popSelector:".js-inline-compose-pop",characterCountSelector:".js-character-count",addImageSelector:".js-inline-compose-add-image",accountSelector:".js-inline-reply .js-account-item",tweetSelector:".js-tweet",tweetActionsSelector:".js-tweet-actions",replyActionSelector:".js-reply-action",detailViewInlineSelector:".js-detail-view-inline",sendButtonContainerSelector:".js-send-button-container",pagingEasingFunction:"easeOutQuad",draftCacheSize:50}),this.initialState({characterCount:0,sendingStatus:"ready",tweetText:"",selectedAccountKeys:function(){return[]}}),this.after("initialize",function(){this.on(document,"uiInlineComposeTweet",this.handleUiInlineComposeTweet),this.on(document,"uiDockedComposeTweet",this.closeInlineCompose),this.on(document,"uiComposeClose",this.closeInlineComposeIfFocused),this.on(document,"uiPopInlineComposeState",this.handlePopClick),this.on("uiComposeSendTweet",this.handleUiComposeSendTweet),this.on("uiComposeTweetSending",this.enterSendingState),this.on("uiComposeTweetSent",this.enterSuccessState),this.on("uiComposeTweetError",this.enterErrorState),this.on("uiComposeTextChanged",this.handleTextChanged),this.observableCanSend=this.observeState(this.observableState,["characterCount","sendingStatus","tweetText"]).map(this.canSend,this).distinctUntilChanged(),this.provideResource("inlineCompose.state",this.getObservableState),this.provideResource("inlineCompose.canSend",this.observableCanSend),this.on(TD.ui.main.TRANSITION_END_EVENTS,{inlineReplySelector:this.handleAnimationEnd}),this.draftCache=new TD.cache.LRUQueue(this.attr.draftCacheSize)}),this.canSend=function(t){return"sending"===t.sendingStatus?!1:this.isWithinCharLimit(t.characterCount)?t.tweetText.trim().length<1?!1:!0:!1},this.setupDOM=function(){i&&(this.attachChild(n,this.select("characterCountSelector"),{stateSource:"inlineCompose.state",charCountSelector:this.attr.charCountSelector,teardownOn:"inlineInstanceTearDown"}),this.attachChild(s,this.select("sendButtonContainerSelector"),{stateSource:"inlineCompose.state",canSendSource:"inlineCompose.canSend",teardownOn:"inlineInstanceTearDown"}),this.select("closeSelector").on("click",this.handleCloseClick.bind(this)),this.select("popSelector").on("click",this.handlePopClick.bind(this)),this.select("addImageSelector").on("click",this.handleAddImageClick.bind(this)),this.select("accountSelector").on("click",this.handlePopClick.bind(this)))},this.handleUiInlineComposeTweet=function(i,n){return t=n||{},t.singleFrom=[n.from[0]],$(n.element).find(this.attr.inlineReplySelector).length>0?void this.closeInlineCompose():(e&&this.closeInlineCompose(),this.focusRequest(),this.setupInlineCompose(t),void 0)},this.setupInlineCompose=function(t){this.trigger(document,"scribeEvent",{terms:{page:"compose",component:"inline_compose",action:"impression"}}),e=t.element,e.find(".js-tweet-actions").addClass("is-visible"),e.find(".js-detail-view-inline").addClass("is-hidden"),e.find(".js-reply-action").addClass("is-selected");var n=this.getAccountData(t.from);i=this.renderTemplate("compose/compose_inline_reply",{account:n,isMac:"osx"===TD.util.getOSName()}),e.find(this.attr.tweetSelector).after(i),this.setupDOM();var s,r=this.composeTextComputeRepliesAndMentions([t.inReplyTo.user.screenName],t.mentions,n.screenName),o=this.getDraftText();o&&o!==r.totalString?(s=o,this.composeTextSetCaretToEnd()):(s=r.totalString,this.composeTextSetSelection(r.startIndex,r.endIndex)),this.composeTextSetText(s),this.mergeState({selectedAccountKeys:t.from,tweetText:s,characterCount:f.getTweetLength(s)}),_.defer(function(){i.removeClass("is-inline-inactive"),Modernizr.csstransitions||this.handleAnimationEnd({target:i.get(0)})}.bind(this)),i.on("click",function(t){t.stopPropagation()});var a=i.parents(".js-column");a.hasClass("js-column-state-detail-view")||TD.ui.columns.lockColumnToElement(a.attr("data-column"),e)},this.closeInlineCompose=function(){e&&(this.saveDraftText(this.composeTextGetText()),this.closeAndRemovePanels(),this.focusRelease(),Modernizr.csstransitions||this.handleAnimationEnd({target:i.get(0)}),this.trigger(document,"scribeEvent",{terms:{page:"compose",component:"inline_compose",action:"close"}}),this.trigger(i,"inlineInstanceTearDown"))},this.closeInlineComposeIfFocused=function(t,e){e&&e.keyboardShortcut&&!this.hasFocus||this.closeInlineCompose()},this.closeAndRemovePanels=function(t){i&&this.select("inlineReplySelector").removeClass("is-inline-active").css({overflow:"hidden"}).addClass("is-inline-inactive")},this.tearDownInlineCompose=function(){this.closeAndRemovePanels(),
this.deleteDraftText(),this.focusRelease(),e=null,this.mergeState({sendingStatus:"ready",characterCount:0,tweetText:"",selectedAccountKeys:[]})},this.handleAnimationEnd=function(t){var e=$(t.target);if(e.hasClass("is-inline-inactive")){var n=e.parents(".js-column").attr("data-column"),s=e.parents(".js-stream-item-content");TD.ui.columns.unlockColumnFromElement(n),s.find(this.attr.tweetActionsSelector).removeClass("is-visible"),s.find(this.attr.replyActionSelector).removeClass("is-selected"),s.find(this.attr.detailViewInlineSelector).removeClass("is-hidden"),e.remove()}else this.scrollColumnIfRequired(),i.css({overflow:"visible"})},this.scrollColumnIfRequired=function(){var t,e=i.parents(".js-column").attr("data-column"),n=this.getColumnScrollContainerByKey(e),s=i.offset().top+i.height()-n.height();if(s>0){t=n.scrollTop();var r=TD.ui.columns.calculateScrollDuration(s,50,750);n.stop().animate({scrollTop:t+s},r,this.attr.pagingEasingFunction)}},this.handleUiComposeSendTweet=function(e,i){if(e.stopPropagation(),(!e.keyboardShortcut||this.hasFocus)&&this.canSend(this.state)){var n={requestId:_.uniqueId("sendTweet"),text:this.composeTextGetText(),inReplyToStatusId:t.inReplyTo.id,from:this.state.selectedAccountKeys,type:"reply",inline:!0};this.sendTweet(n)}},this.enterSendingState=function(t){t.stopPropagation(),this.mergeState({sendingStatus:"sending"})},this.enterSuccessState=function(t){t.stopPropagation(),this.mergeState({sendingStatus:"success"}),this.deleteDraftText(),setTimeout(this.tearDownInlineCompose.bind(this),this.attr.panelCloseDelay)},this.enterErrorState=function(t,e){t.stopPropagation(),this.enablePanelInputs(),this.mergeState({sendingStatus:"ready"})},this.enablePanelInputs=function(){this.composeTextSetDisabled(!1)},this.disablePanelInputs=function(){this.composeTextSetDisabled(!0)},this.getDraftText=function(){return this.draftCache.get(e.attr("data-key"))},this.saveDraftText=function(t){if(e&&e.length){var i=e.attr("data-key");i&&this.draftCache.enqueue(i,t)}},this.deleteDraftText=function(){this.draftCache.dequeue(e.attr("data-key"))},this.handleTextChanged=function(t,e){t.stopPropagation(),this.saveDraftText(e.value),this.mergeState({tweetText:e.value,characterCount:f.getTweetLength(e.value)})},this.handleCloseClick=function(){this.closeInlineCompose()},this.handlePopClick=function(){var e=this.composeTextGetText();this.deleteDraftText(),this.trigger("uiDockedComposeTweet",{type:"reply",text:e,from:t.from,mentions:t.mentions,inReplyTo:t.inReplyTo,popFromInline:!0})},this.handleAddImageClick=function(){this.handlePopClick(),this.trigger("uiComposeAddImageClick")}}var i=t("flight/lib/component"),n=t("ui/compose/character_count"),s=t("ui/compose/send_button"),r=t("with-child-components"),o=t("data/with_client"),a=t("ui/with_column_selectors"),c=t("ui/compose/with_compose_text"),u=t("ui/with_focus"),h=t("ui/compose/with_send_tweet"),l=t("util/with_observable_state"),d=t("util/with_observe_state"),m=t("ui/with_template"),g=t("with-resources"),p=t("ui/compose/with_character_limit"),f=t("util/tweet_utils");return i(l,d,e,r,o,a,c,u,h,m,g,p)}),define("ui/compose/compose_controller",["require","flight/lib/component","ui/compose/inline_compose"],function(t){function e(){var t;this.attributes({composeDrawerOpenClass:"hide-detail-view-inline",inlineOpenClass:".js-inline-reply.is-inline-active"}),this.after("initialize",function(){this.on(document,"uiDrawerActive",this.handleDrawerActive),this.on(document,"uiComposeTweet",this.handleUiComposeTweet),this.on(document,"uiFilesAdded",this.handleFilesAdded)}),this.handleDrawerActive=function(t,e){var i="compose"===e.activeDrawer;this.$node.toggleClass(this.attr.composeDrawerOpenClass,i)},this.handleFilesAdded=function(t,e){this.select("inlineOpenClass").length&&this.trigger("uiPopInlineComposeState"),this.trigger("uiComposeFilesAdded",e)},this.handleUiComposeTweet=function(e,i){i=i||{};var s=function(t){return this.select("inlineOpenClass").length&&"tweet"===t.type&&!t.text&&!t.replyTo}.bind(this);this.$node.hasClass(this.attr.composeDrawerOpenClass)?this.trigger("uiDockedComposeTweet",i):"reply"===i.type&&i.element&&i.element.closest(".js-column").length>0?(t||(n.attachTo(this.$node,{composeTextSelector:".is-inline-active .js-compose-text",accountListSelector:".is-inline-active .js-account-list",accountItemSelector:".is-inline-active .js-account-item",selectedItemSelector:".is-inline-active .js-account-item.is-selected",sendButtonContainerSelector:".is-inline-active .js-send-button-container",composeSuccess:".is-inline-active .js-compose-sending-success",characterCountSelector:".is-inline-active .js-character-count"}),t=!0),this.trigger("uiInlineComposeTweet",i)):s(i)?this.trigger("uiPopInlineComposeState"):this.trigger("uiDockedComposeTweet",i)}}var i=t("flight/lib/component"),n=t("ui/compose/inline_compose");return i(e)}),define("ui/drag_drop/drag_drop_controller",["require","flight/lib/component","ui/drag_drop/with_drag_drop"],function(t){function e(){this.after("initialize",function(){this.on("dragstart",function(t){this.trigger(document,"uiDragStart",this.extractDataFromEvent(t))}),this.on("dragend",function(t){this.trigger(document,"uiDragEnd",this.extractDataFromEvent(t))})})}var i=t("flight/lib/component"),n=t("ui/drag_drop/with_drag_drop");return i(e,n)}),define("ui/with_drag_handle",["require","scripts/sync/util"],function(t){"use strict";function e(){this.setupDragHandle=function(t){["boundary","draggable","handle"].forEach(function(e){i.assert(t[e],"Required parameter "+e+" omitted")}),t.draggable.draggable({boundary:t.boundary,handle:t.handle}).on("start.draggable",function(){t.draggable.css({position:"absolute",top:t.draggable.offset().top,left:t.draggable.offset().left}),t.boundary.addClass("is-dragging")}).on("drop.draggable",function(){t.boundary.removeClass("is-dragging")})}}var i=t("scripts/sync/util");return e}),define("ui/modal/modal_controller",["require","flight/lib/component","ui/with_template","ui/with_drag_handle"],function(t){function e(){this.attributes({modalContextTemplate:"modal/modal_context",modalContextSelector:".js-modal-context",modalInnerSelector:".js-modal-inner",modalContentSelector:".js-modal-content",modalClickTrapSelector:".js-click-trap",modalDismissSelector:".js-dismiss",modalDragHandleSelector:".js-drag-handle",modalOptions:{withCenteredFooter:!1,withChrome:!0,withClickTrap:!0,withDismissButton:!0,withDoneButton:!1,withDraggable:!0,withDragHandle:!0,withFooter:!0,withHeader:!0,withBorder:!0,withClasses:[],withContentClasses:[],withOverlayClasses:[]}}),this.after("initialize",function(){this.on(document,"uiNeedsModalContext",this.handleCreateModalContext),this.on("uiModalShowing",{modalContextSelector:this.handleModalShowing}),this.on("uiModalHiding",{modalContextSelector:this.handleModalHiding}),this.on("click",{modalDismissSelector:this.handleModalDismiss,modalClickTrapSelector:this.handleModalContextClick})}),this.handleCreateModalContext=function(t,e){var i=_.defaults(e||{},this.attr.modalOptions),n=this.createModalContext(i),s=n.find(this.attr.modalInnerSelector),r=s.find(this.attr.modalContentSelector);n.addClass("is-hidden").addClass(i.withOverlayClasses.join(" ")),s.addClass(i.withClasses.join(" ")),r.addClass(i.withContentClasses.join(" ")),this.$node.append(n),this.trigger("uiModalContext",{id:i.id,$node:n.find(this.attr.modalContentSelector)}),i.withDraggable&&this.setupDragHandle({draggable:s,handle:s.find(this.attr.modalDragHandleSelector),boundary:n})},this.createModalContext=function(t){return this.renderTemplate(this.attr.modalContextTemplate,t)},this.handleModalShowing=function(t,e){this.select("modalContextSelector").addClass("is-hidden"),$(e.el).removeClass("is-hidden")},this.handleModalHiding=function(t,e){$(e.el).remove()},this.handleModalDismiss=function(t,e){this.closeModals()},this.closeModals=function(){this.trigger("uiCloseModal")},this.handleModalContextClick=function(t,e){var i=$(e.el),n=$(t.target);n.closest(this.attr.modalInnerSelector,i).length||this.closeModals()}}var i=t("flight/lib/component"),n=t("ui/with_template"),s=t("ui/with_drag_handle");return i(e,n,s)}),define("ui/migrate_education",["require","flight/lib/component","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({template:"login/migrate_education",migrateContinueSelector:".js-migrate-continue",migrateCancelSelector:".js-migrate-cancel",tweetDeckAccount:null}),this.after("initialize",function(){this.on("click",{migrateContinueSelector:this.handleMigrateContinue,migrateCancelSelector:this.handleMigrateCancel});var t=n.render(this.attr.template,{tweetDeckAccount:this.attr.tweetDeckAccount,withForcedMigration:TD.decider.hasAccessLevel("migration","FORCED_MIGRATION")});this.$node.html(t)}),this.handleMigrateCancel=function(){this.trigger(document,"metric",{key:"migrate:education:cancel"}),this.trigger("uiMigrateEducationCancel"),this.teardown()},this.handleMigrateContinue=function(){this.trigger("uiMigrateEducationContinue")}}var i=t("flight/lib/component"),n=t("scripts/UI/template");return i(e)}),define("ui/migrate_risk",["require","flight/lib/component","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({template:"login/migrate_risk",migrateSingleAccountSelector:".js-migrate-account-type-single",migrateMultipleAccountSelector:".js-migrate-account-type-multiple",migrateContinueSelector:".js-migrate-continue",migrateCancelSelector:".js-migrate-cancel",migrateAccountTypeInputSelector:".js-migrate-account-type-input",migrateAccountTypeInputCheckedSelector:".js-migrate-account-type-input:checked"}),this.after("initialize",function(){this.accountType=null,this.on("click",{migrateSingleAccountSelector:this.handleSingleAccountMigrate,migrateMultipleAccountSelector:this.handleMultipleAccountMigrate,migrateCancelSelector:this.handleMigrateCancel});var t=n.render(this.attr.template,{withForcedMigration:TD.decider.hasAccessLevel("migration","FORCED_MIGRATION")});this.$node.html(t),this.trigger(document,"metric",{key:"migrate:risk"})}),this.handleMigrateCancel=function(){this.trigger(document,"metric",{key:"migrate:risk:cancel"}),this.trigger("uiMigrateRiskCancel"),this.teardown()},this.handleMultipleAccountMigrate=function(){this.handleMigrateContinue("multiple")},this.handleSingleAccountMigrate=function(){this.handleMigrateContinue("single")},this.handleMigrateContinue=function(t){if(!this.select("migrateSingleAccountSelector").prop("disabled")&&!this.select("migrateMultipleAccountSelector").prop("disabled")){var e="uiMigrateRiskSingleContinue";"multiple"===t&&(e="uiMigrateRiskMultipleContinue"),this.trigger(e,{accountType:t}),this.select("migrateSingleAccountSelector").prop("disabled",!0),this.select("migrateMultipleAccountSelector").prop("disabled",!0),this.select("migrateAccountTypeInputSelector").prop("disabled",!0)}}}var i=t("flight/lib/component"),n=t("scripts/UI/template");return i(e)}),define("ui/migrate_risk_agreement",["require","flight/lib/component","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({migrateContinueSelector:".js-migrate-continue",migrateCancelSelector:".js-migrate-cancel"}),this.after("initialize",function(){this.accountType=null,this.on("click",{migrateContinueSelector:this.handleMigrateContinue,migrateCancelSelector:this.handleMigrateCancel});var t=n.render("login/migrate_risk_agreement",{withForcedMigration:TD.decider.hasAccessLevel("migration","FORCED_MIGRATION")});this.$node.html(t),this.trigger(document,"metric",{key:"migrate:risk_agreement"})}),this.handleMigrateCancel=function(){this.trigger(document,"metric",{key:"migrate:risk_agreement:cancel"}),this.trigger("uiMigrateRiskAgreementCancel"),this.teardown()},this.handleMigrateContinue=function(){this.select("migrateContinueSelector").prop("disabled")||(this.trigger("uiMigrateRiskAgreementContinue"),this.select("migrateContinueSelector").prop("disabled",!0),this.select("migrateCancelSelector").prop("disabled",!0))}}var i=t("flight/lib/component"),n=t("scripts/UI/template");return i(e)}),define("ui/migrate_progress",["require","flight/lib/component","util/wait_at_least","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({template:"login/migrate_progress",transientErrorTemplate:"login/migrate_progress_transient_error",mergeErrorTemplate:"login/migrate_progress_merge_error",successTemplate:"login/migrate_progress_success",minWaitTime:5e3,migrateProgressClass:"migrate-progress",migrateInProgressClass:"migrate-in-progress",migrateProgressSuccessClass:"migrate-progress-success",migrateProgressPreviewSelector:".js-migrate-progress-preview",migrateProgressNextSelector:".js-migrate-progress-next",migrateProgressDoneSelector:".js-dismiss",migrateProgressTeamSetupSelector:".js-team-setup",migrateProgressErrorExitSelector:".js-migrate-progress-error-exit",twitterAccountUsername:"",numAccountsAdded:0,numColumnsAdded:0,numScheduledAdded:0,numMuteItemsAdded:0,isTeamOrganiser:!1}),this.after("initialize",function(){this.on("click",{migrateProgressErrorExitSelector:this.handleMigrateProgressExit,migrateProgressNextSelector:this.migrateProgressNext,migrateProgressDoneSelector:this.handleMigrateProgressDoneClick,migrateProgressTeamSetupSelector:this.handleMigrateProgressTeamSetupClick}),this.$node.addClass(this.attr.migrateProgressClass);var t=this.attr.template;this.attr.error?t="TransientError"===this.attr.error.data.error?this.attr.transientErrorTemplate:this.attr.mergeErrorTemplate:(this.on(document,"TD.ready uiMigrateProgressAppReady",this.handleAppReady),this.initTimestamp=Date.now(),this.$node.addClass(this.attr.migrateInProgressClass));var e=s.render(t,{error:this.attr.error,twitterAccountUsername:this.attr.twitterAccountUsername,numAccountsAdded:this.attr.numAccountsAdded,numColumnsAdded:this.attr.numColumnsAdded,numScheduledAdded:this.attr.numScheduledAdded,numMuteItemsAdded:this.attr.numMuteItemsAdded});this.$node.html(e)}),this.handleAppReady=function(){n(this.attr.minWaitTime,this.initTimestamp,function(){this.$node.removeClass(this.attr.migrateInProgressClass),this.migrateProgressNext()},this)},this.handleMigrateProgressExit=function(){this.trigger("uiMigrateProgressCancel")},this.migrateProgressNext=function(){this.trigger("uiMigrateProgressNext");var t=TD.storage.accountController.getAccountFromId(TD.storage.store.getTwitterLoginAccount().getUserID()),e={id:t.getUserID(),screenName:t.getUsername(),name:t.getName(),profileImageURL:t.getProfileImageURL(),isVerified:!1},i=TD.storage.accountController.getAccountsForService("twitter").length;this.$node.addClass(this.attr.migrateProgressSuccessClass);var n=s.render(this.attr.successTemplate,{twitterProfile:e,hasMultipleAccounts:i>1,isTeamOrganiser:this.attr.isTeamOrganiser});this.$node.html(n)},this.handleMigrateProgressDoneClick=function(){this.trigger("uiMigrateProgressDone")},this.handleMigrateProgressTeamSetupClick=function(){this.trigger("uiMigrateProgressTeamSetup")}}var i=t("flight/lib/component"),n=t("util/wait_at_least"),s=t("scripts/UI/template");return i(e)}),define("ui/migrate_organise_team",["require","flight/lib/component","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({template:"login/migrate_organise_team",migrateTeamOrganiserSelector:".js-migrate-team-type-organiser",migrateTeamMemberSelector:".js-migrate-team-type-member",migrateTeamCancelSelector:".js-migrate-cancel"}),this.after("initialize",function(){this.accountType=null,this.on("click",{migrateTeamOrganiserSelector:this.handleMigrateTeamOrganiser,migrateTeamMemberSelector:this.handleMigrateTeamMember,migrateTeamCancelSelector:this.handleMigrateCancel});var t=n.render(this.attr.template,{withForcedMigration:TD.decider.hasAccessLevel("migration","FORCED_MIGRATION")});this.$node.html(t),this.trigger(document,"metric",{key:"migrate:organise_team"})}),this.handleMigrateCancel=function(){this.trigger(document,"metric",{key:"migrate:organise_team:cancel"}),this.trigger("uiMigrationTeamCancel"),this.teardown()},this.handleMigrateTeamOrganiser=function(){this.handleMigrateContinue("organiser")},this.handleMigrateTeamMember=function(){this.handleMigrateContinue("member")},this.handleMigrateContinue=function(t){if(!this.select("migrateTeamOrganiserSelector").prop("disabled")&&!this.select("migrateTeamMemberSelector").prop("disabled")){var e="uiMigrateTeamOrganiserContinue";"member"===t&&(e="uiMigrateTeamMemberContinue"),this.trigger(e,{accountType:t}),this.select("migrateTeamOrganiserSelector").prop("disabled",!0),this.select("migrateTeamMemberSelector").prop("disabled",!0)}}}var i=t("flight/lib/component"),n=t("scripts/UI/template");return i(e)}),define("ui/migrate_team_instructions",["require","flight/lib/component","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({template:"login/migrate_team_instructions",migrateTeamContinueSelector:".js-migrate-team-continue",migrateTeamCancelSelector:".js-migrate-cancel"}),this.after("initialize",function(){this.accountType=null,this.on("click",{migrateTeamContinueSelector:this.handleMigrateTeamContinue,migrateTeamCancelSelector:this.handleMigrateCancel});var t=n.render(this.attr.template,{withForcedMigration:TD.decider.hasAccessLevel("migration","FORCED_MIGRATION")});this.$node.html(t),this.trigger(document,"metric",{key:"migrate:team_instructions"})}),this.handleMigrateCancel=function(){this.trigger(document,"metric",{key:"migrate:team_instructions:cancel"}),this.trigger("uiMigrationTeamInstructionsCancel"),this.teardown()},this.handleMigrateTeamContinue=function(t){this.select("migrateTeamContinueSelector").prop("disabled")||(this.trigger("uiMigrateTeamInstructionsContinue"),this.select("migrateTeamContinueSelector").prop("disabled",!0))}}var i=t("flight/lib/component"),n=t("scripts/UI/template");return i(e)}),define("ui/migrate_team_member",["require","flight/lib/component","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({template:"login/migrate_team_member",migrateTeamMemberOkSelector:".js-migrate-team-member-ok",migrateTeamMemberLogoutSelector:".js-migrate-team-member-logout"}),this.after("initialize",function(){this.accountType=null,this.on("click",{migrateTeamMemberOkSelector:this.handleTeamMemberOkSelector,migrateTeamMemberLogoutSelector:this.handleTeamMemberLogoutSelector});var t=n.render(this.attr.template,{withForcedMigration:TD.decider.hasAccessLevel("migration","FORCED_MIGRATION")});this.$node.html(t),this.trigger(document,"metric",{key:"migrate:team_member"})}),this.handleTeamMemberOkSelector=function(){this.select("migrateTeamMemberOkSelector").prop("disabled")||(this.trigger(document,"metric",{key:"migrate:team_member:cancel"}),this.disableButtons(),this.trigger("uiMigrateTeamMemberOkContinue"),this.teardown())},this.handleTeamMemberLogoutSelector=function(){this.select("migrateTeamMemberLogoutSelector").prop("disabled")||(this.disableButtons(),this.trigger("uiMigrateTeamMemberLogoutContinue"))},this.disableButtons=function(){this.select("migrateTeamMemberOkSelector").prop("disabled",!0),this.select("migrateTeamMemberLogoutSelector").prop("disabled",!0)}}var i=t("flight/lib/component"),n=t("scripts/UI/template");return i(e)}),define("ui/migrate_controller",["require","flight/lib/component","ui/modal/with_show_modal","util/wait_at_least","ui/migrate_education","ui/migrate_risk","ui/migrate_risk_agreement","ui/migrate_progress","ui/migrate_organise_team","ui/migrate_team_instructions","ui/migrate_team_member"],function(t){"use strict";function e(){this.attributes({minProgressWaitTime:1e3,minCompleteWaitTime:3e3,modalConfig:{withHeader:!1,withFooter:!1,withDraggable:!1,withDragHandle:!1,withDismissButton:!1,withChrome:!1,withBorder:!1,withClickTrap:!1},riskAgreementModalConfig:{withOverlayClasses:["overlay-opaque"]}}),this.after("initialize",function(){this.on(document,"uiMigrateStart",this.handleUiMigrateStart),this.on(document,"uiMigrateEducationContinue",this.handleUiMigrateEducationContinue),this.on(document,"uiMigrateEducationCancel",this.handleUiMigrateEducationCancel),this.on(document,"uiMigrateRiskSingleContinue",this.handleUiRiskSingleContinue),this.on(document,"uiMigrateRiskMultipleContinue",this.handleUiRiskMultipleContinue),this.on(document,"uiMigrateRiskCancel",this.handleUiRiskCancel),this.on(document,"uiMigrateTeamOrganiserContinue",this.handleMigrateTeamOrgainserContinue),this.on(document,"uiMigrateTeamMemberContinue",this.handleMigrateTeamMemberContinue),this.on(document,"uiMigrationTeamCancel",this.handleMigrateTeamCancel),this.on(document,"uiMigrateTeamInstructionsContinue",this.handleMigrateTeamInstructionsContinue),this.on(document,"uiMigrationTeamInstructionsCancel",this.handleMigrateTeamInstructionsCancel),this.on(document,"uiMigrateTeamMemberLogoutContinue",this.handleMigrateTeamMemberLogoutContinue),this.on(document,"uiMigrateTeamMemberOkContinue",this.handleMigrateTeamMemberOkContinue),this.on(document,"uiMigrateTeamMemberCancel",this.handleMigrateTeamMemberCancel),this.on(document,"uiMigrateRiskAgreementContinue",this.handleUiRiskAgreementContinue),this.on(document,"uiMigrateRiskAgreementCancel",this.handleUiRiskAgreementCancel),this.on(document,"uiMigrateProgressNext",this.handleMigrateProgressNext),this.on(document,"uiMigrateProgressDone",this.handleMigrateProgressDone),this.on(document,"uiMigrateProgressCancel",this.handleMigrateProgressCancel),this.on(document,"uiMigrateProgressTeamSetup",this.handleMigrateProgressTeamSetup),this.on(document,"dataNeedsMigrateCompleteConfirmation",this.handleDataNeedsMigrateCompleteConfirmation),this.on(document,"uiMigrateSuccess",function(t,e){TD.controller.stats.migrateStartflow("migrate_progress","impression"),this.trigger(document,"metric",{key:"migrate:success"}),this.migrateSuccessTimestamp=Date.now(),this.showModal(c,{twitterAccountUsername:TD.storage.store.getTwitterLoginAccount().getUsername(),numAccountsAdded:e.num_accounts_added,numColumnsAdded:e.num_columns_added,numScheduledAdded:e.num_scheduled_added,numMuteItemsAdded:e.num_mute_items_added,isTeamOrganiser:e.isTeamOrganiser},this.attr.modalConfig)}),this.on(document,"uiMigrateError",function(t,e){TD.controller.stats.migrateStartflow("migrate_progress","impression",!0),this.trigger(document,"metric",{key:"migrate:error"}),this.showModal(c,{error:e},this.attr.modalConfig)})}),this.handleUiMigrateStart=function(){this.showModal(r,{tweetDeckAccount:TD.storage.store.getTweetdeckAccount()},this.attr.modalConfig),TD.controller.stats.migrateAppflow("migrate_education","impression"),this.trigger(document,"metric",{key:"migrate:start"})},this.handleUiMigrateEducationContinue=function(t,e){this.showModal(o,{},_.defaults(this.attr.riskAgreementModalConfig,this.attr.modalConfig)),TD.controller.stats.migrateAppflow("migrate_education","next"),TD.controller.stats.migrateAppflow("migrate_risk","impression")},this.handleUiMigrateEducationCancel=function(){TD.controller.stats.migrateAppflow("migrate_education","cancel")},this.handleUiRiskSingleContinue=function(){this.riskAccountType="single",TD.controller.stats.migrateAppflow("migrate_risk","next"),this.handleUiRiskAgreementContinue()},this.handleUiRiskMultipleContinue=function(){this.riskAccountType="multiple",TD.decider.hasAccessLevel("migration","NORMAL_MIGRATION")?this.showModal(u,{},_.defaults(this.attr.riskAgreementModalConfig,this.attr.modalConfig)):(this.showModal(a,{},_.defaults(this.attr.riskAgreementModalConfig,this.attr.modalConfig)),TD.controller.stats.migrateAppflow("migrate_risk","next"),TD.controller.stats.migrateAppflow("migrate_risk_agreement","impression"))},this.handleUiRiskCancel=function(){TD.controller.stats.migrateAppflow("migrate_risk","cancel")},this.handleMigrateTeamOrgainserContinue=function(){this.isTeamOrganiser=!0,this.showModal(h,{},_.defaults(this.attr.riskAgreementModalConfig,this.attr.modalConfig))},this.handleMigrateTeamMemberContinue=function(){this.isTeamOrganiser=!1,this.showModal(l,{},_.defaults(this.attr.riskAgreementModalConfig,this.attr.modalConfig))},this.handleMigrateTeamCancel=function(){TD.controller.stats.migrateAppflow("migrate_teams","cancel")},this.handleMigrateTeamInstructionsContinue=function(){this.continueMigrateActiveFlow("migrate_team_instructions")},this.handleMigrateTeamInstructionsCancel=function(){TD.controller.stats.migrateAppflow("migrate_team_instructions","cancel")},this.continueMigrateActiveFlow=function(t){this.trigger("uiMigrateActive",{accountType:this.riskAccountType,isTeamOrganiser:this.isTeamOrganiser}),TD.controller.stats.migrateAppflow(t,"next"),TD.controller.init.signOut()},this.handleMigrateTeamMemberLogoutContinue=function(){TD.controller.stats.migrateAppflow("migrate_team_member","next"),TD.controller.init.signOut()},this.handleMigrateTeamMemberOkContinue=function(){TD.controller.stats.migrateAppflow("migrate_team_member","ok")},this.handleMigrateTeamMemberCancel=function(){TD.controller.stats.migrateAppflow("migrate_team_member","cancel")},this.handleUiRiskAgreementContinue=function(){this.continueMigrateActiveFlow("migrate_risk_agreement")},this.handleUiRiskAgreementCancel=function(){TD.controller.stats.migrateAppflow("migrate_risk_agreement","cancel")},this.handleMigrateProgressNext=function(){TD.controller.stats.migrateStartflow("migrate_progress","next"),TD.controller.stats.migrateStartflow("migrate_progress_success","impression"),this.trigger(document,"metric",{key:"migrate:finish"})},this.handleMigrateProgressDone=function(){TD.controller.stats.migrateStartflow("migrate_progress_success","next")},this.handleMigrateProgressTeamSetup=function(){TD.controller.stats.migrateStartflow("migrate_progress_team_setup","next"),this.trigger("uiShowAccountSettings",{withTeamOrganiserInstructions:!0})},this.handleMigrateProgressCancel=function(){TD.controller.stats.migrateStartflow("migrate_progress","previous"),TD.storage.store.setCurrentAuthType("tweetdeck"),this.trigger("uiMigrateCancel",{clearMigrateData:!0})},this.handleDataNeedsMigrateCompleteConfirmation=function(){s(this.attr.minProgressWaitTime,this.migrateSuccessTimestamp,function(){this.trigger("uiMigrateCompleteConfirmation")},this)}}var i=t("flight/lib/component"),n=t("ui/modal/with_show_modal"),s=t("util/wait_at_least"),r=t("ui/migrate_education"),o=t("ui/migrate_risk"),a=t("ui/migrate_risk_agreement"),c=t("ui/migrate_progress"),u=t("ui/migrate_organise_team"),h=t("ui/migrate_team_instructions"),l=t("ui/migrate_team_member");return i(e,n)}),define("ui/actions_menu",["require","flight/lib/component","ui/with_dropdown"],function(t){"use strict";function e(){this.attributes({isActionsMenu:!0,profileActionsButtonSelector:".js-user-actions-menu",chirpActionsContainerSelector:".js-tweet-actions",profileMenuTemplate:"menus/actions",chirpMenuTemplate:"menus/actions",dmMenuTemplate:"menus/actions_directmessage",menuPosition:"pos-l"}),this.after("initialize",function(){this.state={},this.around("handleDocumentClick",this.maybeStopDocumentClick),this.after("renderDropdown",this.addActionsMenuClickHandler),this.before("teardownCurrentDropdown",this.removeActionsMenuClickHandler),this.before("teardownCurrentDropdown",this.removeForcedActionsMenuContainerVisibility),this.on("uiDetailViewClosing uiMediaGalleryClosing uiTwitterProfileClosing",this.teardownCurrentDropdown),this.on("click",{profileActionsButtonSelector:this.handleUserButtonClick}),this.on("uiShowActionsMenu",this.handleShowActionsMenu)}),this.addActionsMenuClickHandler=function(){this.currentDropdown&&this.on(this.currentDropdown.$el,"click",this.handleActionsMenuClick)},this.removeActionsMenuClickHandler=function(){this.currentDropdown&&this.off(this.currentDropdown.$el,"click",this.handleActionsMenuClick)},this.removeForcedActionsMenuContainerVisibility=function(){this.state.$actionsMenuContainer&&(this.state.$actionsMenuContainer.removeClass("is-visible"),this.state.$actionsMenuContainer=null)},this.maybeStopDocumentClick=function(t,e){if(this.dropdownIsOpen()){var i=$(e.target).closest(this.attr.profileActionsButtonSelector);0===i.length&&t(e)}},this.showActionsMenu=function(t,e,i){var n,s,r,o,a,c=1===TD.storage.accountController.getAccountsForService("twitter").length,u=t.data("actions-menu-position");i?(i.getRelatedTweet&&(i=i.getRelatedTweet()||i),n=!c,s=i.getMedia().some(function(t){return t.flaggedNSFW}),r=i instanceof TD.services.TwitterConversationMessageEvent,o=r?this.attr.dmMenuTemplate:this.attr.chirpMenuTemplate,e=i.getMainUser()):o=this.attr.profileMenuTemplate,a=TD.controller.filterManager.hasFilterApplied("sender",e.screenName),this.renderDropdown(t,o,{showFavorite:n,isFlagged:s,isMuted:a,user:e,chirp:i,isSingleAccount:c},{toggle:!0,position:u||this.attr.menuPosition}),this.state={user:e,chirp:i,$actionsMenuContainer:t.closest(this.attr.chirpActionsContainerSelector)},this.state.$actionsMenuContainer.addClass("is-visible")},this.handleShowActionsMenu=function(t,e){var i=$(t.target),n=i.attr("data-parent-chirp-id");if(n||(n=i.attr("data-chirp-id")),!n)return this.handleUserButtonClick(t);var s=i.attr("data-account-key"),r=TD.controller.columnManager.findChirpByAccountKey(n,s);this.showActionsMenu(i,null,r)},this.handleUserButtonClick=function(t){var e=$(t.target).closest(this.attr.profileActionsButtonSelector),i=e.data("user-id");if(i){var n=TD.cache.twitterUsers.getById(i);t.stopPropagation(),t.preventDefault(),n.addCallback(function(t){this.showActionsMenu(e,t,null)}.bind(this))}},this.handleFlagTweetSuccess=function(){var t=this.state.chirp.getMedia();t.forEach(function(t){t.flaggedNSFW=!0}),TD.controller.progressIndicator.addMessage(TD.i("Success: Media flagged"))},this.handleFlagTweetError=function(){TD.controller.progressIndicator.addMessage(TD.i("Error: Failed to flag media. Please try again."))},this.handleActionsMenuClick=function(t){var e=$(t.target);if(0!==e.closest(this.attr.isSelectedSelector).length){var i,n=e.data("action"),s=!0,r=this.state.user,o=this.state.chirp,a=[];switch(o&&a.push(o.account.getKey()),o?this.trigger("metric",{key:["chirp","ui",o.chirpType,n].join(":")}):this.trigger("metric",{key:["user","ui",n].join(":")}),n){case"mention":this.trigger("uiComposeTweet",{text:"@"+r.screenName+" ",from:a});break;case"message":this.trigger("uiComposeTweet",{type:"message",from:a,messageRecipients:[{screenName:r.screenName,avatar:r.profileImageURL}]});break;case"lists":new TD.components.AddToListsDialog(r);break;case"flag-media":TD.controller.progressIndicator.addMessage(TD.i("Flagging media")),i=TD.controller.clients.getClient(o.account.getKey()),i.flagTweet(o.id,this.handleFlagTweetSuccess.bind(this),this.handleFlagTweetError);break;case"block":this.trigger("uiBlockAction",{account:r.account,twitterUser:r});break;case"report-tweet":this.trigger("uiShowReportTweetOptions",{account:r.account,tweetId:o.id,twitterUser:r,isMessage:o instanceof TD.services.TwitterConversationMessageEvent});break;case"report-spam":this.trigger("uiReportSpamAction",{account:r.account,twitterUser:r,block:!0}),this.trigger("uiCloseModal");break;case"followOrUnfollow":this.trigger("uiShowFollowFromOptions",{userToFollow:r});break;case"favoriteOrUnfavorite":this.trigger("uiShowFavoriteFromOptions",{tweet:o});break;case"follow":r.follow(r.account,null,null,!0);break;case"unfollow":r.unfollow(r.account,null,null,!0);break;case"reference-to":o.referenceTo();break;case"message-to":o.messageTo();break;case"email":o.email();break;case"mute":TD.controller.filterManager.addFilter("sender",r.screenName),TD.controller.progressIndicator.addMessage(TD.i("@{{screenName}} muted. Unmute in Settings",{screenName:r.screenName}));break;case"destroy":o.destroy();break;case"undo-retweet":$(document).trigger("uiUndoRetweet",{tweetId:o.getMainTweet().id,from:o.account.getKey()});break;case"customtimelines":new TD.components.AddToCustomTimelineDialog(o.getMainTweet());break;case"embed":this.trigger("uiShowEmbedTweet",{tweet:o.getMainTweet()});break;case"translate":o.translate();break;default:s=!1}s&&(t.preventDefault(),t.stopPropagation()),this.teardownCurrentDropdown();

}}}var i=t("flight/lib/component"),n=t("ui/with_dropdown");return i(e,n)}),define("ui/columns/column_drag_drop",["require","flight/lib/component"],function(t){function e(){this.attributes({columnDragHandleSelector:".js-column-drag-handle",appColumnsContainerSelector:".js-app-columns-container",columnsContainerSelector:".js-app-columns",columnSelector:".js-column"}),this.after("initialize",function(){this.on("uiColumnRendered",this.handleColumnRendered),this.select("columnsContainerSelector").dragdroplist({selector:this.attr.columnSelector,contentSelector:this.attr.columnSelector,handle:this.attr.columnDragHandleSelector,$boundary:this.select("appColumnsContainerSelector"),orientation:"horizontal",tagName:"section",scroll_speed:24}).on("dropped.dragdroplist",function(){var t=[];this.select("columnSelector").each(function(){t.push($(this).attr("data-column"))}),TD.storage.clientController.client.setColumnOrder(t)}.bind(this))}),this.handleColumnRendered=function(t,e){e.$column.trigger("itemadded.dragdroplist",{itemId:e.column})}}var i=t("flight/lib/component");return i(e)}),define("ui/compose/account_selector",["require","ui/with_template","util/keypress","flight/lib/component","with-state","data/with_accounts","with-resources","util/with_observe_state"],function(t){function e(){this.attributes({accountListSelector:".js-account-list",accountItemSelector:".js-account-item",isSelectedClass:"is-selected",selectedItemSelector:".js-account-item.is-selected",singleAccountMode:!1,focusSelector:".js-account-item:focus",gridModeClass:{grid:"is-grid",minigrid:"is-minigrid",list:"is-list"},avatarSize:{grid:"48",minigrid:"32",list:"32"},avatarSizeClass:{grid:"size48",minigrid:"size32",list:"size32"},stateSource:null}),this.initialState({defaultAccountKey:function(){return this.getDefaultAccount().accountKey},selectedAccountKeys:function(){return[this.getDefaultAccount().accountKey]},accounts:function(){return this.getAccountsForService("twitter")},singleAccountMode:function(){return this.attr.singleAccountMode},gridMode:function(){return TD.settings.getAccountSelectorGridMode()}}),this.after("initialize",function(){this.around("replaceState",this.checkSingleAccountMode),this.after("replaceState",this.renderAccounts),this.after("replaceState",this.broadcastSelectedAccountKeys),this.on(document,"dataAccounts",this.handleAccounts),this.on(document,"dataSettingsValues",this.handleSettingsValues),this.observeState(this.requestResource(this.attr.stateSource),["singleAccountMode","selectedAccountKeys"]).subscribeOnNext(this.mergeState,this),this.on("click keypress",{accountItemSelector:this.handleClick}),this.initializeTooltips()}),this.checkSingleAccountMode=function(t,e){e.singleAccountMode&&e.selectedAccountKeys.length>1&&(e.selectedAccountKeys=[],TD.controller.progressIndicator.addMessage([TD.i("Messages cannot be sent from multiple accounts."),TD.i("Please choose an account.")].join(" "))),t(e)},this.initializeTooltips=function(){(!TD.util.isTouchDevice()||!TD.decider.get("touchdeck_compose_v2"))&&this.select("accountListSelector").tooltip({selector:".js-show-tip",container:"body",placement:"bottom",suppressFadeOut:!0})},this.handleSettingsValues=function(t,e){e.account_selector_grid_mode&&this.mergeState({gridMode:e.account_selector_grid_mode})},this.handleAccounts=function(t,e){var i;e.accounts.some(function(t){return t.isDefault?(i=t.accountKey,!0):void 0});var n=this.state.selectedAccountKeys.filter(function(t){return e.accounts.some(function(e){return e.accountKey===t})}),s=1===this.state.selectedAccountKeys.length&&this.state.selectedAccountKeys[0]===this.state.defaultAccountKey;(0===n.length||s)&&(n=[i]),this.mergeState({defaultAccountKey:i,accounts:e.accounts,selectedAccountKeys:n})},this.broadcastSelectedAccountKeys=function(){this.trigger("uiAccountsSelected",{accountKeys:this.state.selectedAccountKeys})},this.renderAccounts=function(){var t=this.select("focusSelector"),e=null;t.length>0&&(e=t.attr("data-account-key"));var i="list"===this.state.gridMode,n={gridModeClass:this.attr.gridModeClass[this.state.gridMode],avatarSize:this.attr.avatarSize[this.state.gridMode],avatarSizeClass:this.attr.avatarSizeClass[this.state.gridMode],isList:i};if(n.accounts=this.state.accounts.map(function(t){var e=this.state.selectedAccountKeys.indexOf(t.accountKey)>-1;return{accountKey:t.accountKey,screenName:t.screenName,name:t.name,profileImageURL:t.profileImageURL,isSelected:e}},this),!_.isEqual(n,this.lastRenderParams)){this.lastRenderParams=n;var s=this.renderTemplate("compose/account_selector",n);this.select("accountListSelector").replaceWith(s),e&&this.select("accountItemSelector").filter('[data-account-key="'+e+'"]').focus(),this.trigger("uiAccountSelectorRendered")}},this.handleClick=function(t){if(n.eventIsKey(t)&&!n.isSpacebar(t))return!1;var e,i=$(t.target).closest(this.attr.accountItemSelector),s=i.attr("data-account-key");e=t.shiftKey||this.state.singleAccountMode?[s]:this.toggleArrayElement(this.state.selectedAccountKeys,s),this.mergeState({selectedAccountKeys:e})},this.toggleArrayElement=function(t,e){return-1===t.indexOf(e)?t.concat([e]):t.filter(function(t){return t!==e})}}var i=t("ui/with_template"),n=t("util/keypress"),s=t("flight/lib/component"),r=t("with-state"),o=t("data/with_accounts"),a=t("with-resources"),c=t("util/with_observe_state");return s(r,c,e,i,o,a)}),define("ui/compose/account_selector_grid_toggle",["require","flight/lib/component","ui/with_template","with-state"],function(t){function e(){this.attributes({gridToggleSelector:"[data-grid-mode]"}),this.initialState({gridMode:function(){return TD.settings.getAccountSelectorGridMode()}}),this.after("initialize",function(){this.after("mergeState",this.renderToggle),this.on(document,"dataSettingsValues",this.handleSettingsValue),this.on("click",{gridToggleSelector:this.handleGridToggleClick}),this.renderToggle()}),this.renderToggle=function(){var t={};t[this.state.gridMode]=!0,this.state.gridMode!==this.previousGridMode&&(this.render("compose/account_selector_grid_toggle",t),this.previousGridMode=this.state.gridMode)},this.handleSettingsValue=function(t,e){e.account_selector_grid_mode&&this.mergeState({gridMode:e.account_selector_grid_mode})},this.handleGridToggleClick=function(t){var e=$(t.target).closest(this.attr.gridToggleSelector).attr("data-grid-mode");TD.settings.setAccountSelectorGridMode(e)}}var i=t("flight/lib/component"),n=t("ui/with_template"),s=t("with-state");return i(s,e,n)}),define("ui/typeahead/typeahead_input",["require","flight/lib/component"],function(t){function e(){this.attributes({inputSelector:".js-typeahead-input",KEY_CODE_MAP:{8:{name:"BACKSPACE",event:"uiTypeaheadInputBackspace",on:"keydown",preventDefault:!1},13:{name:"ENTER",event:"uiTypeaheadInputSubmit",on:"keypress",preventDefault:!0},27:{name:"ESC",event:"uiTypeaheadInputEscaped",on:"keydown"},9:{name:"TAB",event:"uiTypeaheadInputTab",on:"keydown",preventDefault:!0},37:{name:"LEFT",event:"uiTypeaheadInputLeft",on:"keydown"},39:{name:"RIGHT",event:"uiTypeaheadInputRight",on:"keydown"},38:{name:"UP",event:"uiTypeaheadInputMoveUp",on:"keydown",preventDefault:!0},40:{name:"DOWN",event:"uiTypeaheadInputMoveDown",on:"keydown",preventDefault:!0}}}),this.after("initialize",function(){this.$input=this.select("inputSelector");var t=this.domEventToComponentEventFactory.bind(this);this.on(this.$input,"input",t("uiTypeaheadInputChanged")),this.on(this.$input,"focus",t("uiTypeaheadInputFocus")),this.on(this.$input,"blur",t("uiTypeaheadInputBlur")),this.on(this.$input,"keydown keypress",this.maybeTriggerModifierEvent)}),this.domEventToComponentEventFactory=function(t){return function(e,i){this.trigger(this.$input,t,{query:this.$input.val()})}.bind(this)},this.maybeTriggerModifierEvent=function(t){var e=this.attr.KEY_CODE_MAP[t.which||t.keyCode];if(e){if(t.type!==e.on)return;var i=$(t.currentTarget),n=i.val();if("BACKSPACE"===e.name&&""!==n)return;if("TAB"===e.name&&""===n)return;e.preventDefault&&t.preventDefault(),n=""===n.trim()?"":n,this.trigger(i,e.event,{query:n})}}}var i=t("flight/lib/component");return i(e)}),define("util/scroll",["require","./easing"],function(t){function e(t,e,s){if(t.length&&e.length){s=_.defaults(s||{},{time:300,easing:"inOutQuad"});var r=t.outerHeight(),o=e.outerHeight(),a=t.scrollTop(),c=i(t,e).top,u=c+o,h=a;return u>r&&(h=a+(u-r)),0>c&&(h=a+c),n.ease({from:a,to:h,time:s.time,easing:n.easeFn(s.easing),applicator:function(e){t.scrollTop(e)}})}}function i(t,e){var i=t.offset(),n=e.offset();return{top:n.top-i.top,left:n.left-i.left}}var n=t("./easing");return{makeElementVisible:e}}),define("ui/compose/message_recipient",["require","flight/lib/component","util/with_observe_state","with-resources","with-child-components","ui/with_focusable_field","with-state","ui/typeahead/typeahead_dropdown","ui/typeahead/typeahead_input","util/scroll","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({containerSelector:".js-compose-message-recipient-container",inputSelector:".js-compose-message-account",inputContainerSelector:".js-compose-message-recipient-input-container",listContainerSelector:".js-compose-message-recipient-list",removeRecipientSelector:".js-remove-recipient",removeConversationSelector:".js-remove-conversation",recipientSelector:".js-compose-message-recipient",hideInputClass:"compose-message-account-hidden",stateSource:null,maxRecipients:null,dropdownSelector:".js-typeahead-dropdown"}),this.initialState({selectedAccountKeys:function(){return[]}}),this.after("initialize",function(){this.$container=this.select("containerSelector"),this.$input=this.select("inputSelector"),this.$inputContainer=this.select("inputContainerSelector"),this.$list=this.select("listContainerSelector"),this.on(this.$input,"focus",this.handleInputFocus),this.on(this.$input,"blur",this.handleInputBlur),this.on("click",{removeConversationSelector:this.handleRemoveConversationClick,removeRecipientSelector:this.handleRemoveRecipientClick,listContainerSelector:this.handleListContainerClick}),this.attachChild(u,this.$node,{inputSelector:this.attr.inputSelector}),this.attachChild(c,this.$node,{alwaysOpen:!1,autoSelect:!0,blockLinkActions:!0,datasources:["users","conversations"],datasourcesRecentOnly:[],hideAfterSelect:!0,inputSelector:this.attr.inputSelector,usersTemplate:"typeahead/typeahead_users_compose",withClickTrap:!0}),this.on("uiTypeaheadInputEscaped uiTypeaheadNoItemSelected",{inputSelector:this.handleTypeaheadInputEscaped}),this.on("uiTypeaheadInputBackspace",this.handleTypeaheadInputBackspace),this.on("uiTypeaheadItemComplete uiTypeaheadItemSelected",this.handleTypeaheadItemSelected),this.on("uiNeedsTypeaheadSuggestions",this.extendTypeaheadRequest),this.observeState(this.requestResource(this.attr.stateSource),["tweetType","messageRecipients","messageConversation"]).subscribeOnNext(this.render,this),this.observeState(this.requestResource(this.attr.stateSource),["selectedAccountKeys"]).subscribeOnNext(this.mergeState,this)}),this.extendTypeaheadRequest=function(t,e){e.accountKey=this.state.selectedAccountKeys[0]},this.handleRemoveConversationClick=function(){this.trigger("uiRemoveMessageConversation")},this.handleRemoveRecipientClick=function(t,e){this.trigger("uiRemoveMessageRecipient",{id:$(e.el).attr("data-user-id")})},this.handleInputFocus=function(){this.$inputContainer.addClass("is-focused")},this.handleInputBlur=function(){this.$inputContainer.removeClass("is-focused")},this.handleListContainerClick=function(t,e){t.target===e.el&&(this.$input.focus(),h.makeElementVisible(this.$inputContainer,this.$input))},this.render=function(t){var e="message"===t.tweetType;if(this.$container.toggleClass("is-hidden",!e),!e)return void this.$input.blur();(!TD.util.isTouchDevice()||!TD.decider.get("touchdeck_compose_v2"))&&this.$input.focus();var i=this.$inputContainer.scrollTop(),n=i+this.$inputContainer.height()>=this.$inputContainer.prop("scrollHeight");this.select("recipientSelector").remove(),t.messageRecipients&&t.messageRecipients.length>0?(this.renderRecipientList(t.messageRecipients),this.$inputContainer.scrollTop(i),n&&h.makeElementVisible(this.$inputContainer,this.$input),this.checkMaxRecipients(t.messageRecipients)):t.messageConversation?(this.renderConversation(t.messageConversation),this.$input.addClass(this.attr.hideInputClass)):(this.$list.addClass("is-hidden"),this.$input.removeClass(this.attr.hideInputClass),this.$input.focus(),this.trigger("uiMessageRecipientUnset"))},this.renderConversation=function(t){var e=t.render({templateName:"compose/message_conversation"});this.$list.prepend(e),this.$list.removeClass("is-hidden")},this.renderRecipientList=function(t){var e=l.render("compose/message_recipients",{users:t});this.$list.prepend(e),this.$list.removeClass("is-hidden")},this.checkMaxRecipients=function(t){var e=t.length>=this.attr.maxRecipients;this.$input.toggleClass(this.attr.hideInputClass,e).trigger(e?"blur":"focus")},this.handleTypeaheadInputBackspace=function(t,e){this.trigger("uiRemoveLastMessageRecipient")},this.handleTypeaheadItemSelected=function(t,e){this.$input.val(""),"conversation"===e.searchType?this.trigger("uiAddMessageConversation",{conversation:e.item}):"user"===e.searchType&&this.trigger("uiAddMessageRecipient",{recipient:e.item})},this.handleTypeaheadInputEscaped=function(t){var e=this.select("inputSelector");""===e.val().trim()?e.blur():e.val("")}}var i=t("flight/lib/component"),n=t("util/with_observe_state"),s=t("with-resources"),r=t("with-child-components"),o=t("ui/with_focusable_field"),a=t("with-state"),c=t("ui/typeahead/typeahead_dropdown"),u=t("ui/typeahead/typeahead_input"),h=t("util/scroll"),l=t("scripts/UI/template");return i(a,n,e,r,s,o)}),define("ui/compose/title",["require","flight/lib/component","with-resources","util/with_observe_state"],function(t){function e(){this.attributes({stateSource:null,titleSelector:".js-compose-title",headerSelector:".js-compose-header",messageHeaderSelector:".js-compose-message-header"}),this.after("initialize",function(){this.$title=this.select("titleSelector"),this.$header=this.select("headerSelector"),this.$messageHeader=this.select("messageHeaderSelector"),this.observeState(this.requestResource(this.attr.stateSource),["tweetType","scheduledDate","metadata"]).subscribeOnNext(this.render,this)}),this.render=function(t){this.$header.toggleClass("with-dm-icon","message"===t.tweetType),this.$messageHeader.text(TD.i("message"===t.tweetType?"Message":"Tweet"));var e=t.scheduledDate&&t.metadata&&t.metadata.originalUpdates;this.$title.text(TD.i(e?"Edit scheduled Tweet":"message"===t.tweetType?"New message":"New Tweet"))}}var i=t("flight/lib/component"),n=t("with-resources"),s=t("util/with_observe_state");return i(s,e,n)}),define("ui/compose/quote_tweet",["require","flight/lib/component","with-resources","util/with_observe_state"],function(t){function e(){this.attributes({quoteTweetHolderSelector:".js-quote-tweet-holder",quoteTweetRemoveSelector:".js-quote-tweet-remove",stateSource:null}),this.after("initialize",function(t){this.$quoteTweetHolder=this.select("quoteTweetHolderSelector"),this.$quoteTweetHolder.on("click",this.attr.quoteTweetRemoveSelector,function(){this.trigger(document,"uiRemoveQuotedTweet")}.bind(this)),this.observeState(this.requestResource(this.attr.stateSource),["quotedTweet"]).subscribeOnNext(this.render,this)}),this.render=function(t){if(t.quotedTweet){var e=t.quotedTweet.renderQuotedTweet({inCompose:!0});this.$quoteTweetHolder.html(e)}else this.$quoteTweetHolder.html("")}}var i=t("flight/lib/component"),n=t("with-resources"),s=t("util/with_observe_state");return i(s,e,n)}),define("ui/compose/with_add_image",[],function(){return function(){var t=null;this.attributes({addImageButtonSelector:".js-add-image-button",addImageButtonLabelSelector:".js-add-image-button-label"}),this.after("initialize",function(){this.$addImageButton=this.select("addImageButtonSelector"),this.$addImageButtonLabel=this.select("addImageButtonLabelSelector"),TD.util.hasFeature("file")||this.hideAddImageButton()}),this.addImageButtonLabelText=function(t){this.$addImageButtonLabel.text(t)},this.addImageButtonAddTooltip=function(t){this.$addImageButton.attr("data-original-title",t)},this.addImageButtonRemoveTooltip=function(){this.$addImageButton.removeAttr("data-original-title")},this.disableAddImageButton=function(){t!==!0&&(this.$addImageButton.addClass("is-disabled").attr("tabindex","-1"),this.off(this.$addImageButton,"click"),t=!0)},this.enableAddImageButton=function(){t!==!1&&(this.$addImageButton.removeClass("is-disabled").attr("tabindex","0"),this.on(this.$addImageButton,"click",this.handleAddImageButtonClick),t=!1)},this.hideAddImageButton=function(){this.$addImageButton.addClass("is-hidden")},this.handleAddImageButtonClick=function(t,e){this.trigger(document,"uiComposeAddImageClick")}}}),define("ui/compose/with_direct_message_button",[],function(){return function(){this.attributes({messageButtonSelector:".js-dm-button",tweetButtonSelector:".js-tweet-button"}),this.after("initialize",function(t){this.messageIsDisabled=!1,this.$messageButton=this.select("messageButtonSelector"),this.$tweetButton=this.select("tweetButtonSelector"),this.on(this.$messageButton,"click",function(){this.messageIsDisabled||this.trigger(document,"uiComposeTweet",{type:"message"})}),this.on(this.$tweetButton,"click",function(){this.trigger(document,"uiComposeTweet",{type:"tweet"})})}),this.disableMessageButton=function(t){this.messageIsDisabled||(this.messageIsDisabled=!0,this.$messageButton.addClass("is-disabled").attr("tabindex","-1").attr("data-original-title",t||""))},this.enableMessageButton=function(){this.messageIsDisabled&&(this.messageIsDisabled=!1,this.$messageButton.removeClass("is-disabled").attr("tabindex","0").removeAttr("data-original-title"))},this.setMessageToggleButton=function(t){"message"===t?(this.$messageButton.addClass("is-hidden"),this.$tweetButton.removeClass("is-hidden")):(this.$messageButton.removeClass("is-hidden"),this.$tweetButton.addClass("is-hidden"))}}}),define("ui/compose/with_hint",["require"],function(t){return function(){this.showHint=function(t,e){var i=e.useDangerousHTML?"html":"text";this.$node.find(e.selector)[i](t).addClass(e.animation).removeClass("is-hidden")},this.hideHint=function(t){this.$node.find(t.selector).html("").removeClass(t.animation).addClass("is-hidden")}}}),define("ui/compose/with_in_reply_to",["require","flight/lib/compose","ui/with_template"],function(t){var e=t("flight/lib/compose"),i=t("ui/with_template");return function(){e.mixin(this,[i]),this.attributes({inReplyToHolderSelector:".js-in-reply-to",inReplyToRemoveSelector:".js-in-reply-to-remove"}),this.after("initialize",function(){this.$inReplyToHolder=this.select("inReplyToHolderSelector"),this.$inReplyToHolder.on("click",this.attr.inReplyToRemoveSelector,function(){this.removeInReplyTo(),this.trigger("uiRequestComposeTextFocus")}.bind(this))}),this.addInReplyTo=function(t){this.inReplyTo=t,this.$inReplyToHolder.html(this.toHtml("compose/in_reply_to",this.inReplyTo)),this.$inReplyToHolder.removeClass("is-hidden")},this.removeInReplyTo=function(){this.inReplyTo=null,this.$inReplyToHolder.addClass("is-hidden"),this.trigger("uiRemoveInReplyTo")},this.getInReplyToId=function(){return this.inReplyTo?this.inReplyTo.id:null}}}),define("ui/compose/with_media_bar",["require","flight/lib/compose","ui/with_template","data/with_media_uploader"],function(t){function e(){this.mediaBarData={files:[],previews:[],accountsMediaIds:{},scheduling:!!(this.mediaBarData||{}).scheduling}}function i(t,e){var i=this.withMediaUploaderUpload({files:[t],accountKey:e},{ttl:this.mediaBarData.scheduling?"infinity":"ephemeral"});return i.addErrback(function(e){if(!(e instanceof TD.core.defer.CancelledError)){var i=this.mediaBarData.files.indexOf(t);if(i>-1){this.mediaBarData.files.length>1?(this.removeFileAtIndex(i),this.attachImagesPreview()):this.removeFiles();var n=TD.i("We could not upload {{name}}, please try again.",{name:t.name});setTimeout(TD.controller.progressIndicator.addMessage,0,n)}return e}}.bind(this)),i}function n(t,e){this.mediaBarData.scheduling=!!e.scheduling,Object.keys(this.mediaBarData.accountsMediaIds).forEach(function(t){this.removeMediaIdsFor(t),this.addMediaIdsFor(t)},this)}var s=t("flight/lib/compose"),r=t("ui/with_template"),o=t("data/with_media_uploader");return function(){s.mixin(this,[r,o]),this.attributes({mediaBarContainerSelector:".js-media-added",mediaBarRemoveSelector:".js-media-bar-remove",mediaBarThumb:".js-media-bar-thumb",mediaBarSelector:".compose-media-bar",maxImageHeight:310}),this.before("initialize",e),this.after("initialize",function(){this.$mediaBarContainer=this.select("mediaBarContainerSelector"),this.on("click",{mediaBarRemoveSelector:this.removeFile}),this.on(document,"uiComposeScheduleStateChange",n.bind(this))}),this.addFiles=function(t){if(this.$mediaBarContainer.removeClass("is-hidden"),TD.util.hasFeature("filereader")){var e=new TD.core.defer.DeferredList(t.map(this.loadFileData));e.addCallback(function(e){e.forEach(function(e,i){if(e[0]){var n=e[1];this.mediaBarData.previews.indexOf(n)<0&&(this.mediaBarData.files.push(t[i]),this.mediaBarData.previews.push(n),this.state.selectedAccountKeys.forEach(function(t){this.addMediaIdsFor(t)},this))}},this),this.attachImagesPreview()}.bind(this))}else this.mediaBarData.files=t,this.attachImageInfoBar()},this.loadFileData=function(t){var e=new TD.core.defer.Deferred,i=new FileReader;return i.onloadend=function(t){e.callback(t.target.result)},i.readAsDataURL(t),e},this.attachImageInfoBar=function(){var t=this.renderTemplate("compose/media_bar_infobar");this.$mediaBarContainer.html(t)},this.attachImagesPreview=function(t){var e=this.mediaBarData.previews.length,i=e>1,n=this.renderTemplate("compose/media_bar_image",{isMediaGridContent:i,mediaLength:e,mediaInfo:this.mediaBarData.previews.map(function(t,e){return{src:t,fileIndex:e}})});this.$mediaBarContainer.html(n),this.$mediaBarContainer.on("click",function(t){var e=$(event.target);(e.is("img")||e.hasClass("media-image"))&&this.trigger("uiComposeImageClicked")}.bind(this)),i?t!==!1&&this.trigger("uiComposeImageAdded",{files:this.getFiles()}):(n=this.select("mediaBarThumb"),n[0].complete?this.setImageHeight(n,t):n.load(this.setImageHeight.bind(this,n,t)))},this.setImageHeight=function(t,e){var i=this.select("mediaBarSelector");t.height()>this.attr.maxImageHeight?(t.height(this.attr.maxImageHeight),i.addClass("compose-media-compressed")):(t.height("auto"),i.removeClass("compose-media-compressed")),e!==!1&&this.trigger("uiComposeImageAdded")},this.removeFile=function(t){var e=$(t.target).closest(this.attr.mediaBarRemoveSelector),i=e.attr("data-file-index");return i&&(this.removeFileAtIndex(parseInt(i,10)),this.mediaBarData.files.length)?this.attachImagesPreview():void this.removeFiles()},this.removeFiles=function(){Object.keys(this.mediaBarData.accountsMediaIds).forEach(function(t){this.removeMediaIdsFor(t)},this),e.call(this),this.$mediaBarContainer.addClass("is-hidden"),this.$mediaBarContainer.empty(),this.trigger("uiResetImageUpload")},this.removeFileAtIndex=function(t){this.mediaBarData.files.splice(t,1),this.mediaBarData.previews.splice(t,1),Object.keys(this.mediaBarData.accountsMediaIds).forEach(function(e){this.mediaBarData.accountsMediaIds[e].splice(t,1)[0].cancel()},this)},this.removeFilesBut=function(t){for(var e=this.mediaBarData.files,i=e.length;i--;)e[i]!==t&&this.removeFileAtIndex(i)},this.addMediaIdsFor=function(t){var e=this.mediaBarData,n=e.accountsMediaIds[t];n||(n=[],e.accountsMediaIds[t]=n),e.files.forEach(function(e,s){n[s]||(n[s]=i.call(this,e,t))},this)},this.removeMediaIdsFor=function(t){var e=this.mediaBarData;e.accountsMediaIds[t]&&(e.accountsMediaIds[t].forEach(function(t){t.cancel()}),delete e.accountsMediaIds[t])},this.updateAccountsMediaIds=function(t){Object.keys(this.mediaBarData.accountsMediaIds).forEach(function(e){t.indexOf(e)<0&&this.removeMediaIdsFor(e)},this),t.forEach(function(t){this.mediaBarData.accountsMediaIds[t]||this.addMediaIdsFor(t)},this)},this.getDeferredMediaIdsFor=function(t){var e=this.mediaBarData.accountsMediaIds[t];if(!e)throw new Error("unknown list of media ids for "+t);return new TD.core.defer.DeferredList(e.slice(0))},this.getFiles=function(){return this.mediaBarData.files.concat()}}}),define("ui/compose/with_scheduler",[],function(){"use strict";return function(){this.attributes({scheduleButtonSelector:".js-schedule-button",scheduleButtonLabelSelector:".js-schedule-button-label",scheduleDatePickerHolderSelector:".js-schedule-datepicker-holder"}),this.after("initialize",function(){this.schedulerIsDisabled=null,this.schedulerPickerOpen=!1,this.$scheduleButton=this.select("scheduleButtonSelector"),this.$scheduleButtonLabel=this.select("scheduleButtonLabelSelector"),this.$scheduleDatePickerHolder=this.select("scheduleDatePickerHolderSelector"),this.scheduleButtonTitleTweet=TD.i("Schedule Tweet"),this.scheduleButtonTitleMessage=TD.i("Schedule Message")}),this.after("teardown",function(){this.scheduleDatePicker&&($.unsubscribe(this.dateChangedSubscription),$.unsubscribe(this.dateRemovedSubscription))}),this.disableScheduleButton=function(t){this.$scheduleButton.addClass("is-disabled").attr("tabindex","-1").attr("data-original-title",t||""),this.schedulerIsDisabled!==!0&&(this.off(this.$scheduleButton,"click"),this.schedulerIsDisabled=!0)},this.enableScheduleButton=function(){this.$scheduleButton.removeClass("is-disabled").attr("tabindex","0").removeAttr("data-original-title"),this.schedulerIsDisabled!==!1&&(this.on(this.$scheduleButton,"click",this.handleScheduleButtonClick),this.schedulerIsDisabled=!1)},this.handleScheduleButtonClick=function(){this.initScheduleDatePicker()},this.resetScheduler=function(){this.setScheduledDate(null)},this.openScheduleDatePicker=function(){this.schedulerPickerOpen||($("body").on("click.scheduleclicktrap",function(t){var e=$(t.target);0===e.closest(this.$scheduleDatePickerHolder).length&&0===e.closest(this.$scheduleButton).length&&this.closeScheduleDatePicker()}.bind(this)),this.scheduleDatePicker.$node.show(),this.schedulerPickerOpen=!0)},this.closeScheduleDatePicker=function(){this.schedulerPickerOpen&&($("body").off("click.scheduleclicktrap"),this.scheduleDatePicker.$node.hide(),this.schedulerPickerOpen=!1)},this.initScheduleDatePicker=function(){var t=function(t){this.closeScheduleDatePicker(),this.scheduledDate=null,this.trigger("uiComposeScheduleDate",{date:null})};this.scheduleDatePicker?(this.scheduleDatePicker.$node.is(":hidden")?this.openScheduleDatePicker():this.closeScheduleDatePicker(),this.scheduledDate||this.scheduleDatePicker.setDate(new Date)):(this.dateChangedSubscription=$.subscribe("/change/date",this.setScheduledDate.bind(this)),this.dateRemovedSubscription=$.subscribe("/removed/date",t.bind(this)),this.scheduleDatePicker=new TD.components.ScheduledDatePicker(this.$scheduleDatePickerHolder),this.openScheduleDatePicker())},this.setScheduledDate=function(t){var e,i=this.isScheduling();this.scheduledDate=t,t?(t.setSeconds(0),e=TD.util.prettyTimeString(t),this.$scheduleButtonLabel.text(e)):this.closeScheduleDatePicker(),this.trigger("uiComposeScheduleDate",{date:t}),i!==this.isScheduling()&&$(document).trigger("uiComposeScheduleStateChange",{scheduling:this.isScheduling()})},this.getScheduledDate=function(){return this.scheduledDate},this.isScheduling=function(){return!!this.getScheduledDate()},this.isScheduledImagesEnabled=function(){return TD.decider.hasAccessLevel("scheduler","WRITE_MEDIA")},this.setScheduleButtonTitle=function(t){if(!this.scheduledDate)switch(t){case"tweet":this.$scheduleButtonLabel.text(this.scheduleButtonTitleTweet);break;case"message":this.$scheduleButtonLabel.text(this.scheduleButtonTitleMessage)}}}}),define("ui/compose/with_stay_open",[],function(){return function(){var t,e;this.attributes({checkboxSelector:".js-compose-stay-open"}),this.after("initialize",function(){t=this.select("checkboxSelector"),this.on(t,"change",function(){t.prop("checked")?this.trigger("uiChangeComposeStayOpen",{composeStayOpen:!0}):this.trigger("uiChangeComposeStayOpen",{composeStayOpen:!1})}),this.on(document,"dataSettings",this.handleSettings)}),this.handleSettings=function(i,n){n.composeStayOpen?(t.prop("checked",!0),this.composeStayOpen=!0,void 0===e&&this.trigger(document,"uiDockedComposeTweet",{noAnimate:!0,noFocus:!0})):(t.prop("checked",!1),this.composeStayOpen=!1),e=!0}}}),define("ui/compose/docked_compose",["require","flight/lib/component","util/tweet_utils","ui/compose/account_selector","ui/compose/account_selector_grid_toggle","ui/compose/character_count","ui/compose/message_recipient","ui/compose/send_button","ui/compose/title","ui/compose/quote_tweet","data/with_accounts","ui/compose/with_add_image","with-child-components","ui/with_click_trap","data/with_client","ui/compose/with_compose_text","ui/compose/with_direct_message_button","ui/with_focus","ui/compose/with_hint","ui/compose/with_in_reply_to","ui/compose/with_media_bar","ui/compose/with_scheduler","ui/compose/with_send_tweet","ui/compose/with_stay_open","with-resources","util/with_observable_state","util/with_observe_state","ui/compose/with_character_limit"],function(t){function e(){this.attributes({stayOpenInputSelector:".js-compose-stay-open",characterCountSelector:".js-character-count",composeScrollerSelector:".js-compose-scroller",withTouchComposeClass:"is-touch-compose",sendButtonContainerSelector:".js-send-button-container",tcoLength:22,panelCloseDelay:500,releaseFocusDelay:300,defaultTextComposeHeight:130,increasedTextComposeHeight:160,minimumComposeHeight:180,initScrollbarsDelay:200,hintOptions:{selector:".js-compose-hint",animation:"anim anim-fade-in"},accountSelectorGridToggleSelector:".js-account-selector-grid-toggle",maxRecipients:20}),this.initialState({sendingStatus:"ready",tweetType:"tweet",tweetText:"",characterCount:0,singleAccountMode:!1,messageConversation:null,quotedTweet:null,selectedAccountKeys:function(){return[this.getDefaultAccount().accountKey]},messageRecipients:function(){return[]},files:function(){return[]},currentTime:function(){return new Date},selectedUsers:function(){return[]}}),this.after("initialize",function(){this.debouncedInitScrollbars=_.debounce(this.initScrollbars.bind(this),this.attr.initScrollbarsDelay),this.setupDOM(),this.observableCanSend=this.observeState(this.observableState).map(this.canSend.bind(this)).distinctUntilChanged(),this.provideResource("dockedCompose.state",this.getObservableState),this.provideResource("dockedCompose.canSend",this.observableCanSend),this.attachChild(o,this.select("characterCountSelector"),{stateSource:"dockedCompose.state"}),this.attachChild(a,this.$node,{stateSource:"dockedCompose.state",maxRecipients:this.attr.maxRecipients}),this.attachChild(h,this.$node,{stateSource:"dockedCompose.state"}),this.attachChild(c,this.select("sendButtonContainerSelector"),{stateSource:"dockedCompose.state",canSendSource:"dockedCompose.canSend"}),this.attachChild(u,this.$node,{stateSource:"dockedCompose.state"}),this.on("uiAccountsSelected",this.handleAccountsSelected),this.attachChild(s,this.$node,{stateSource:"dockedCompose.state"}),this.attachChild(r,this.select("accountSelectorGridToggleSelector")),this.isInBaseState=!0,this.releaseFocusTimer=null,this.composeTextIsExpanded=!1,this.on(document,"uiDrawerActive",this.handleUiDrawerActive),this.on(document,"uiDockedComposeTweet",this.handleUiComposeTweet),this.on(document,"uiComposeClose",this.handleUiComposeClose),this.on(document,"uiComposeFilesAdded",this.handleUiComposeFilesAdded),this.on(document,"uiRemoveQuotedTweet",this.handleQuotedTweetRemove),this.on("uiComposeSendTweet",this.handleUiComposeSendTweet),this.on("uiComposeTweetSending",this.enterSendingState),this.on("uiComposeTweetSent",this.enterSuccessState),this.on("uiComposeTweetError",this.enterErrorState),this.on("uiComposeScheduleDate",this.handleUiComposeScheduleDate),this.after("attachImagesPreview",function(){this.composeTextHandleChange(),
this.inferAddImageButtonState(),this.inferScheduleButtonState(),this.inferMessageButtonState(),this.debouncedInitScrollbars(),this.composeTextSetCaretToEnd()}),this.after("removeFile",function(){this.composeTextHandleChange(),this.inferAddImageButtonState(),this.inferScheduleButtonState(),this.inferMessageButtonState(),this.debouncedInitScrollbars()}),this.after("addInReplyTo",function(){this.debouncedInitScrollbars()}),this.on("uiAccountSelectorRendered",this.debouncedInitScrollbars),this.after("openScheduleDatePicker",function(){this.debouncedInitScrollbars()}),this.after("closeScheduleDatePicker",function(){this.debouncedInitScrollbars()}),this.onReceiveClick(function(){this.hasFocus||this.focusRequest()}),this.onLoseClick(function(){this.hasFocus&&this.focusRelease()}),this.on(document,"uiMainWindowResized",this.debouncedInitScrollbars),this.on("uiComposeImageAdded",this.handleComposeImageAdded),this.on("uiComposeImageClicked",this.composeTextSetFocus),this.on("uiComposeTextBlur",this.handleComposeTextBlur),this.on("uiComposeTextChanged",this.handleComposeTextChanged),this.on("uiAddMessageRecipient",this.handleUiAddMessageRecipient),this.on("uiRemoveMessageRecipient",this.handleUiRemoveMessageRecipient),this.on("uiRemoveLastMessageRecipient",this.handleUiRemoveLastMessageRecipient),this.on("uiAddMessageConversation",this.handleUiAddMessageConversation),this.on("uiRemoveMessageConversation",this.handleUiRemoveMessageConversation),this.initScrollbars({initialDisplay:!1}),this.clockTimer=setInterval(function(){this.mergeState({currentTime:new Date})}.bind(this),1e3),setTimeout(function(){this.resetComposePanelState({text:""}),this.composeTextBlur()}.bind(this),0)}),this.before("teardown",function(){clearTimeout(this.clockTimer)}),this.getConversation=function(t,e){var i,n=e.map(this.getClientByAccountKey,this);return n.some(function(e){return i=e.conversations.getConversation(t)}),i||null},this.setMessageRecipients=function(t){var e=new TD.core.defer.succeed([]);return t.length&&e.addCallbackWith(this,function(){var e=t.map(function(t){return t.screenName&&t.id&&t.profileImageURL?new TD.core.defer.succeed(t):TD.cache.twitterUsers.getByScreenName(t.screenName||t)});return TD.core.defer.gatherResults(e)}),e.addCallbackWith(this,function(t){t=_.uniq(t,function(t){return t.id}),this.mergeState({messageRecipients:t})}),e},this.handleUiAddMessageConversation=function(t,e){var i=!this.state.messageConversation&&!this.state.messageRecipients.length,n=this.state.selectedAccountKeys.indexOf(e.conversation.accountKey)>-1;i&&n&&this.mergeState({messageConversation:this.getConversation(e.conversation.conversationId,[e.conversation.accountKey])})},this.handleUiAddMessageRecipient=function(t,e){var i=this.state.messageRecipients.length>=this.attr.maxRecipients;if(e.recipient&&!this.state.messageConversation&&!i){var n=this.state.messageRecipients.concat(e.recipient);this.setMessageRecipients(n)}},this.handleUiRemoveMessageConversation=function(t){this.mergeState({messageConversation:null})},this.handleUiRemoveMessageRecipient=function(t,e){var i=this.state.messageRecipients.filter(function(t){return t.id!==e.id});this.setMessageRecipients(i)},this.handleUiRemoveLastMessageRecipient=function(t,e){this.setMessageRecipients(this.state.messageRecipients.slice(0,-1))},this.canSend=function(t){var e=this.isWithinCharLimit(t.characterCount),i=t.selectedAccountKeys.length>0,n=t.messageRecipients.length>0||t.messageConversation,s=t.files.length>0,r=!!t.quotedTweet,o=t.tweetText.trim().length<1&&!s&&!r,a=t.scheduledDate&&t.scheduledDate>t.currentTime;return"sending"===t.sendingStatus?!1:e&&!o&&i?t.scheduledDate&&!a?!1:"message"!==t.tweetType||n?!0:!1:!1},this.setupDOM=function(){this.$composeScroller=this.select("composeScrollerSelector"),TD.util.isTouchDevice()&&TD.decider.get("touchdeck_compose_v2")&&this.$node.addClass(this.attr.withTouchComposeClass)},this.handleAccountsSelected=function(t,e){this.mergeState({selectedAccountKeys:e.accountKeys}),this.updateAccountsMediaIds(e.accountKeys)},this.handleUiDrawerActive=function(t,e){null===e.activeDrawer&&this.resetAfterClose()},this.handleQuotedTweetRemove=function(){this.mergeState({quotedTweet:null}),TD.controller.stats.discardQuoteTweet(),this.composeTextHandleChange()},this.hideComposePanel=function(){this.trigger("uiDrawerHideDrawer")},this.handleUiComposeTweet=function(t,e){e=e||{},this.sharedTweetInfo=e.tweetId&&{id:e.tweetId,url:e.text},this.trigger("uiDrawerShowDrawer",{drawer:"compose",withAnimation:!e.noAnimate}),this.mergeState({tweetType:e.type||"tweet"}),this.trigger(document,"scribeEvent",{terms:{page:"compose",component:"docked_compose",element:this.state.tweetType,action:"impression"}}),e.noReset!==!0&&this.resetComposePanelState(e),e.noFocus||this.focusRequest(),this.enableClickTrap();var i=[];if(e.columnKey){var n=TD.controller.columnManager.get(e.columnKey),s=n.getFeeds();i=s.length>1?[this.getDefaultAccount().accountKey]:[s[0].getAccountKey()],this.mergeState({selectedAccountKeys:i})}this.isInBaseState=!1},this.showScheduledHint=function(){this.showHint(TD.i("Your scheduled Tweet will send even if TweetDeck is not running at the time."),this.attr.hintOptions)},this.handleUiComposeClose=function(t,e){e=e||{},e.keyboardShortcut?this.hasFocus&&(this.composeStayOpen?this.focusRelease():this.hideComposePanel()):this.hideComposePanel(),clearTimeout(this.releaseFocusTimer),this.releaseFocusTimer=null},this.handleUiComposeSendTweet=function(t,e){if(t.stopPropagation(),(!t.keyboardShortcut||this.hasFocus)&&this.canSend(this.state)){var i=_.uniqueId("sendTweet"),n=$.extend({},e);if(n.requestId=i,n.text=this.composeTextGetText(),n.inReplyToStatusId=this.getInReplyToId(),n.files=this.getFiles(),n.messageRecipientIds=this.state.messageRecipients.map(function(t){return t.id}).join(","),n.conversationId=this.state.messageConversation&&this.state.messageConversation.conversationId,n.scheduledDate=this.getScheduledDate(),n.from=this.state.selectedAccountKeys,n.type=this.state.tweetType,n.metadata=this.state.metadata,this.sharedTweetInfo){var s=new RegExp("\\b"+TD.util.quotedForRegExp(this.sharedTweetInfo.url)+"\\b");s.test(n.text)&&(n.tweetId=this.sharedTweetInfo.id,n.text=n.text.replace(s,""))}n.files.length&&(n.accountsMediaIds=n.from.reduce(function(t,e){return t[e]=this.getDeferredMediaIdsFor(e),t}.bind(this),{})),this.sendTweet(n)}},this.enterSendingState=function(t){t.stopPropagation(),this.mergeState({sendingStatus:"sending"}),this.disablePanelInputs()},this.enterSuccessState=function(t){t.stopPropagation(),this.mergeState({sendingStatus:"success"}),setTimeout(this.resetAfterSend.bind(this),this.attr.panelCloseDelay)},this.enterErrorState=function(t,e){t.stopPropagation();var i;e.errors&&(i=e.errors.map(function(t){return t.request.accountKey})),this.mergeState({sendingStatus:"ready",selectedAccountKeys:i||this.state.selectedAccountKeys}),this.enablePanelInputs()},this.resetAfterSend=function(){this.sharedTweetInfo=null,this.mergeState({tweetType:"message"===this.state.tweetType?"message":"tweet",sendingStatus:"ready",messageRecipients:[],messageConversation:null,quotedTweet:null}),this.setMessageRecipients([]),this.composeStayOpen?this.resetComposePanelState({type:this.state.tweetType,text:"",from:this.state.selectedAccountKeys}):this.hideComposePanel()},this.resetAfterClose=function(){this.sharedTweetInfo=null,this.destructivePanelReset(),this.mergeState({tweetType:"tweet",selectedAccountKeys:[this.getDefaultAccount().accountKey],files:[],sendingStatus:"ready",messageRecipients:[],messageConversation:null,quotedTweet:null}),this.setMessageRecipients([]),this.enablePanelInputs(),this.focusRelease(),this.disableClickTrap(),this.resetSendTweet(),this.isInBaseState=!0},this.destructivePanelReset=function(){this.composeTextSetText(""),this.removeFiles(),this.resetScheduler(),this.hideHint(this.attr.hintOptions)},this.resetComposePanelState=function(t){var e;t=t||{},t.type=t.type||"tweet";var i=void 0!==t.text;i&&this.destructivePanelReset(),this.enablePanelInputs();var s={};switch(t.schedule&&(this.setScheduledDate(t.schedule.time),s.selectedAccountKeys=t.from),t.type){case"tweet":this.removeInReplyTo(),void 0!==t.text?this.composeTextSetText(t.text):this.state.messageRecipients.length>0&&this.composeTextPrependText(this.state.messageRecipients.map(function(t){return n.atMentionify(t.screenName)}).join(" ")),void 0!==t.appendText&&this.composeTextAppendText(t.appendText),(this.isInBaseState&&t.from&&t.from.length>0||t.isEditAndRetweet)&&(s.selectedAccountKeys=t.from),t.noFocus||(!TD.util.isiOSDevice()||!TD.decider.get("touchdeck_compose_v2"))&&this.composeTextSetCaretToEnd(),s.messageRecipients=[],s.messageConversation=null,t.quotedTweet&&this.mergeState({quotedTweet:t.quotedTweet}),this.composeTextHandleChange();break;case"reply":(!this.getInReplyToId()||this.composeTextIsEmpty())&&(this.addInReplyTo(t.inReplyTo),this.isInBaseState&&(s.selectedAccountKeys=t.from)),this.state.selectedAccountKeys&&1===this.state.selectedAccountKeys.length&&(e=this.getAccountData(this.state.selectedAccountKeys[0]).screenName),void 0!==t.text?(this.composeTextSetText(t.text),this.composeTextSetCaretToEnd()):this.composeTextSetRepliesAndMentions([t.inReplyTo.user.screenName],t.mentions,e),s.messageRecipients=[],s.messageConversation=null;break;case"message":var r,o=[];if(TD.decider.get("disable_scheduled_messages")&&this.resetScheduler(),t.from&&t.from.length>0&&(s.selectedAccountKeys=t.from),void 0!==t.text?this.composeTextSetText(t.text):r=n.extractMentions(this.composeTextGetText()),t.conversationId)s.messageConversation=this.getConversation(t.conversationId,s.selectedAccountKeys);else if(t.messageRecipients)o=t.messageRecipients;else if(t.to&&t.to.screenName)o=[t.to.screenName];else if(this.state.messageRecipients.length>0)o=this.state.messageRecipients;else if(r&&r.length){o=r;var a=n.removeFirstMention(this.composeTextGetText());this.composeTextSetText(a)}var c=this.setMessageRecipients(o);o.length&&c.addCallbackWith(this,this.composeTextSetFocus),this.removeInReplyTo()}s.scheduledDate=this.getScheduledDate(),this.setScheduleButtonTitle(this.state.tweetType),this.setMessageToggleButton(this.state.tweetType),this.inferAddImageButtonState(),this.inferScheduleButtonState(),this.inferMessageButtonState(),this.debouncedInitScrollbars({initialDisplay:!1}),s.singleAccountMode="message"===t.type,s.metadata=t.metadata||{},this.mergeState(s)},this.handleUiComposeFilesAdded=function(t,e){this.addFiles(_.map(e.files)),this.trigger("uiDockedComposeTweet",{type:this.state.tweetType,noReset:!0})},this.handleUiComposeScheduleDate=function(t,e){this.mergeState({scheduledDate:e.date}),this.setScheduleButtonTitle(this.state.tweetType),this.inferAddImageButtonState(),e.date?this.showScheduledHint():this.hideHint(this.attr.hintOptions),this.inferMessageButtonState()},this.inferMessageButtonState=function(){var t=this.getScheduledDate(),e=this.getFiles().length;t?this.disableMessageButton(TD.i("Direct messages cannot be scheduled")):e>1?this.disableMessageButton(TD.i("Direct messages cannot contain multiple images")):this.enableMessageButton()},this.inferAddImageButtonState=function(){var t,e,i="message"===this.state.tweetType,n=this.isScheduling(),s=i&&n,r=i||n,o=TD.decider.get("tweet_up_to_four_images")&&!r?4:1,a=this.getFiles(),c=a.some(function(t){return"image/gif"===t.type}),u=a.length<o&&!c,h=TD.i(n?"You cannot add more than one image to a scheduled Tweet":"You cannot add more than one image");r&&a.length>1&&(e=n?"disallow_multi_images_schedule":"disallow_multi_images_dm",this.removeFilesBut(a[0]),this.attachImagesPreview(!1),a=this.getFiles());var l=n?this.isScheduledImagesEnabled():!0,d=!s;if(c&&4===o?(e||(e="disallow_multi_images_gif"),t=TD.i("You cannot upload a GIF with other images")):u?l?d||(t=TD.i("Scheduled direct messages cannot contain images")):t=TD.i("Scheduled Tweets cannot contain images"):t=1===o?h:TD.i("You cannot add more than {{max}} images",{max:o}),t)r&&this.addImageButtonLabelText(TD.i("Add image")),this.disableAddImageButton(),this.addImageButtonAddTooltip(t);else if(this.enableAddImageButton(),this.addImageButtonRemoveTooltip(),r)this.addImageButtonLabelText(TD.i("Add image"));else{var m;m=TD.i(1===o?"Add image":a.length>0?"Add another image":"Add images"),this.addImageButtonLabelText(m)}e&&this.trigger(document,"scribeEvent",{terms:{page:"compose",component:"docked_compose",element:e,action:"impression"}})},this.inferScheduleButtonState=function(){var t,e=!TD.decider.get("disable_scheduled_messages"),i="message"===this.state.tweetType,n=this.getFiles().length,s=!!n,r=i&&s,o=i?e:!0,a=s?this.isScheduledImagesEnabled():!0,c=!r,u=2>n;o?a?c?u||(t=TD.i("Scheduled Tweets cannot contain multiple images")):t=TD.i("Direct messages containing images cannot be scheduled"):t=TD.i("Tweets with images cannot be scheduled"):t=TD.i("Direct messages cannot be scheduled"),t?this.disableScheduleButton(t):this.enableScheduleButton()},this.initScrollbars=function(t){2===arguments.length&&(t={});var e=this.$composeScroller.data("antiscroll");e?e.refresh():this.$composeScroller.antiscroll(t)},this.handleComposeTextChanged=function(t,e){t.stopPropagation(),!this.composeTextIsExpanded&&e.value.length>this.attr.minimumComposeHeight?(this.composeTextSetHeight(this.attr.increasedTextComposeHeight),this.composeTextIsExpanded=!0):this.composeTextIsExpanded&&e.value.length<=this.attr.minimumComposeHeight&&(this.composeTextSetHeight(this.attr.defaultTextComposeHeight),this.composeTextIsExpanded=!1);var i=n.getTweetLength(e.value)+(this.getFiles().length?this.attr.tcoLength+1:0);this.state.quotedTweet&&(i+=this.attr.tcoLength+2),this.mergeState({tweetText:e.value,characterCount:i})},this.disablePanelInputs=function(){this.composeTextSetDisabled(!0)},this.enablePanelInputs=function(){this.composeTextSetDisabled(!1)},this.handleComposeTextBlur=function(t){t.stopPropagation();var e=0;this.composeStayOpen||(e=this.attr.releaseFocusDelay),this.releaseFocusTimer=setTimeout(function(){this.releaseFocusTimer=null,this.focusRelease()}.bind(this),e)},this.handleComposeImageAdded=function(t){this.debouncedInitScrollbars(),this.mergeState({files:this.getFiles()})}}var i=t("flight/lib/component"),n=t("util/tweet_utils"),s=t("ui/compose/account_selector"),r=t("ui/compose/account_selector_grid_toggle"),o=t("ui/compose/character_count"),a=t("ui/compose/message_recipient"),c=t("ui/compose/send_button"),u=t("ui/compose/title"),h=t("ui/compose/quote_tweet"),l=t("data/with_accounts"),d=t("ui/compose/with_add_image"),m=t("with-child-components"),g=t("ui/with_click_trap"),p=t("data/with_client"),f=t("ui/compose/with_compose_text"),w=t("ui/compose/with_direct_message_button"),v=t("ui/with_focus"),C=t("ui/compose/with_hint"),b=t("ui/compose/with_in_reply_to"),S=t("ui/compose/with_media_bar"),T=t("ui/compose/with_scheduler"),y=t("ui/compose/with_send_tweet"),D=t("ui/compose/with_stay_open"),A=t("with-resources"),I=t("util/with_observable_state"),k=t("util/with_observe_state"),E=t("ui/compose/with_character_limit");return i(A,I,k,e,l,d,m,g,p,f,w,v,C,b,S,T,y,D,E)}),define("util/position_sticky",[],function(){"use strict";function t(t){if(t=t||{},!(t.$target&&t.$target.length&&t.$container&&t.$container.length&&t.$offsetChild&&t.$offsetChild.length))throw new Error("positionSticky missing required parameters");var e=t.$target,i=t.$container,n=t.$offsetChild,s=parseInt(e.css("top"),10);n.css({marginTop:e.outerHeight()+"px"}),i.on("scroll",function(t){var n=Math.max(s,i.scrollTop());e.css("top",n+"px").toggleClass("position-sticky-stuck",n>s)})}return{makeElementSticky:t}}),define("ui/contributor_list",["require","flight/lib/component","data/with_accounts","ui/with_template","ui/with_transitions","util/scroll"],function(t){"use strict";function e(){this.attributes({accountKey:null,contributorRowSelector:".js-contributor-row",contributorRowClass:"js-contributor-row",contributorOpenSettingsSelector:".js-contributor-open-settings",contributorRemoveSelector:".js-contributor-remove",contributorRoleSelector:".js-contributor-role",contributorErrorMessageSelector:".js-contributor-error-message",selectedContributorRoleSelector:".js-contributor-role:checked",actionConfirmSelector:".js-contributor-action-confirm",actionCancelSelector:".js-contributor-action-cancel",genericErrorMessage:TD.i("Something went wrong. Please try again."),STATE_INITIAL:"initial",STATE_CLOSED:"closed",STATE_SETTINGS:"settings",STATE_CONFIRM_ADD:"confirmAdd",STATE_CONFIRM_DEADMIN:"confirmDeadmin",STATE_CONFIRM_REMOVE:"confirmRemove",STATE_REMOVING:"confirmRemove-removing",disallowedStateTransitions:{confirmAdd:{anotherContributorOpening:["closed"]}},notAnimatedStateTransitions:{initial:{load:["closed"]}},stateToScribeElement:{settings:"settings",confirmAdd:"confirm_add",confirmRemove:"confirm_remove",confirmDeadmin:"confirm_deadmin"},scrollWait:300,contributorsPollInterval:6e4}),this.after("initialize",function(){this.state={contributee:TD.storage.accountController.get(this.attr.accountKey),contributorIndex:{}},this.on(document,"dataContributorsError",this.handleContributorsError),this.on(document,"dataContributors",this.handleContributors),this.on(document,"dataContributor",this.handleContributor),this.on(document,"dataContributorActionSuccess",this.handleContributorActionSuccess),this.on(document,"dataContributorActionError",this.handleContributorActionError),this.on("click",{contributorOpenSettingsSelector:this.handleOpenSettings,contributorRemoveSelector:this.handleRemoveContributorClick,actionConfirmSelector:this.handleActionConfirmClick,actionCancelSelector:this.handleActionCancelClick}),this.trigger("uiNeedsContributors",{accountKey:this.attr.accountKey})}),this.sortByName=function(t,e){var i="string"==typeof t?t.toLowerCase():t.user.name.toLowerCase(),n="string"==typeof e?e.toLowerCase():e.user.name.toLowerCase();return n>i?-1:i>n?1:0},this.getElemByUserId=function(t,e){return this.select(t).filter(function(){return $(this).attr("data-user-id")===e})},this.handleContributorsError=function(t,e){e.request.accountKey===this.attr.accountKey&&this.render("contributors/contributor_list_error")},this.handleContributors=function(t,e){if(e.accountKey===this.attr.accountKey){var i=this.state.contributorIndex;this.state.contributorIndex=e.contributors.reduce(function(t,e){return t[e.user.id]=e,t},{}),Object.keys(i).forEach(function(t){var e=i[t].isUnconfirmed;this.state.contributorIndex[t]||(e?this.state.contributorIndex[t]=i[t]:this.removeContributorFromList(t))}.bind(this)),e.contributors.forEach(function(t){this.setStateOrCreateContributor(t,this.attr.STATE_CLOSED,{transition:"load"})}.bind(this)),this.scheduleContributorPoll()}},this.handleContributor=function(t,e){if(e.accountKey===this.attr.accountKey){var i,n=this.state.contributorIndex[e.contributor.user.id];if(n){var s=this.getOrCreateContributorRow(n);i=s.attr("data-state")}if(e.contributor.isUnconfirmed&&this.state.contributee.getUserID()===e.contributor.user.id)return void TD.controller.progressIndicator.addMessage(TD.i("You cannot add a user to their own team  they can already contribute to this account."));n&&e.contributor.isUnconfirmed||(n=e.contributor,this.state.contributorIndex[e.contributor.user.id]=n);var r=i||(n.isUnconfirmed?this.attr.STATE_CONFIRM_ADD:this.attr.STATE_SETTINGS);this.setStateOrCreateContributor(e.contributor,r,{transition:"load-single"}),e.contributor.isUnconfirmed&&this.scrollToContributor(e.contributor.user.id)}},this.handleOpenSettings=function(t,e){t.preventDefault();var i=$(e.el),n=i.attr("data-user-id"),s=this.state.contributorIndex[n],r=this.getOrCreateContributorRow(s),a=this.getContributorRole(s);r.find(this.attr.contributorRoleSelector).filter(function(){return $(this).attr("data-contributor-role")===a}).prop("selected",!0),this.select("contributorRowSelector").each(function(t,e){var i=$(e).attr("data-user-id");if(i!==n){var s=this.state.contributorIndex[i];this.setStateOrCreateContributor(s,this.attr.STATE_CLOSED,{transition:"anotherContributorOpening"})}}.bind(this)),this.setStateOrCreateContributor(s,this.attr.STATE_SETTINGS),this.scribeContributorAction("open_settings","click");var c=this.$node.closest(".scroll-v");setTimeout(function(){o.makeElementVisible(c,r)},this.attr.scrollWait)},this.handleRemoveContributorClick=function(t,e){var i=$(e.el),n=i.attr("data-user-id"),s=this.state.contributorIndex[n];this.setStateOrCreateContributor(s,this.attr.STATE_CONFIRM_REMOVE),this.scribeContributorAction("remove","click")},this.setRole=function(t,e){var i=this.state.contributorIndex[e],n=this.getOrCreateContributorRow(i),s=n.find(this.attr.selectedContributorRoleSelector),r=s.attr("data-contributor-role"),o="admin"===r;if(o===i.isAdmin)return this.setStateOrCreateContributor(i,this.attr.STATE_CLOSED);var a=this.getTwitterLoginAccount(),c=a&&a.userId===e;c&&!o?this.setStateOrCreateContributor(i,this.attr.STATE_CONFIRM_DEADMIN):(this.setStateOrCreateContributor(i,this.attr.STATE_CLOSED),this.trigger("uiContributorAction",{accountKey:this.attr.accountKey,action:"update",userId:e,isAdmin:o}))},this.handleActionConfirmClick=function(t,e){var i=$(e.el),n=i.attr("data-user-id"),s=this.state.contributorIndex[n],r=this.getOrCreateContributorRow(s).attr("data-state"),o={accountKey:this.attr.accountKey,userId:n,action:null};switch(r){case this.attr.STATE_SETTINGS:this.setRole(i,n);break;case this.attr.STATE_CONFIRM_ADD:o.action="add",this.setStateOrCreateContributor(s,this.attr.STATE_CLOSED);break;case this.attr.STATE_CONFIRM_DEADMIN:o.action="update",o.isAdmin=!1,this.setStateOrCreateContributor(s,this.attr.STATE_CLOSED);break;case this.attr.STATE_CONFIRM_REMOVE:o.action="remove",this.setStateOrCreateContributor(s,this.attr.STATE_REMOVING)}o.action&&this.trigger("uiContributorAction",o),this.scribeContributorAction(this.attr.stateToScribeElement[r],"confirm")},this.handleActionCancelClick=function(t,e){var i=$(e.el).attr("data-user-id"),n=this.state.contributorIndex[i],s=this.getOrCreateContributorRow(n),r=s.attr("data-state");switch(r){case this.attr.STATE_SETTINGS:this.setStateOrCreateContributor(n,this.attr.STATE_CLOSED);break;case this.attr.STATE_CONFIRM_ADD:this.removeContributorFromList(i);break;case this.attr.STATE_CONFIRM_DEADMIN:this.setStateOrCreateContributor(n,this.attr.STATE_SETTINGS);break;case this.attr.STATE_CONFIRM_REMOVE:this.setStateOrCreateContributor(n,this.attr.STATE_SETTINGS)}this.scribeContributorAction(this.attr.stateToScribeElement[r],"cancel")},this.handleContributorActionSuccess=function(t,e){if(e.request.accountKey===this.attr.accountKey){var i=this.state.contributorIndex[e.request.userId];switch(e.request.action){case"remove":this.removeContributorFromList(e.request.userId);break;case"add":this.setStateOrCreateContributor(i,this.attr.STATE_CLOSED);break;case"update":this.setStateOrCreateContributor(i,this.attr.STATE_CLOSED),this.scribeContributorAction("admin",e.request.isAdmin?"on":"off")}}},this.handleContributorActionError=function(t,e){if(e.request.accountKey===this.attr.accountKey){var i=this.state.contributorIndex[e.request.userId];if(i){var n;try{n=e.response.req.errors[0]}catch(s){}return"add"===e.request.action&&i.isUnconfirmed?this.setStateOrCreateContributor(i,this.attr.STATE_CONFIRM_ADD,{error:this.makeErrorState(this.attr.STATE_CONFIRM_ADD),errorData:n}):(n&&TD.controller.progressIndicator.addMessage(n.message),void this.revertContributorState(i))}}},this.setStateOrCreateContributor=function(t,e,i){i=_.defaults(i||{},{error:"",errorData:{},transition:""});var n=this.getOrCreateContributorRow(t),s=n.attr("data-state"),r=n.attr("data-error"),o=n.attr("data-error-code"),a=""+i.errorData.twitterErrorCode,c=this.getContributorRole(t),u=n.attr("data-contributor-role");if(e!==s||c!==u||i.error!==r||a!==o){var h=this.stateRuleMatch(this.attr.disallowedStateTransitions,{from:s,transition:i.transition,to:e});if(!h){var l=this.doStateChange(n,{from:s,to:e,error:i.error,errorData:i.errorData,transition:i.transition,role:this.getContributorRole(t)});return l.addCallbackWith(this,function(){this.scrollFix(),this.scribeContributorAction(this.attr.stateToScribeElement[e],"impression")}),l}}},this.doStateChange=function(t,e){function i(){t.attr({"data-previous-state":e.from,"data-state":e.to,"data-state-error":e.error,"data-state-error-code":e.errorData.twitterErrorCode,"data-contributor-role":e.role}),t.find(n.attr.contributorErrorMessageSelector).text(e.errorData.message||n.attr.genericErrorMessage)}e=e||{};var n=this,s=!this.stateRuleMatch(this.attr.notAnimatedStateTransitions,e);return s?this.deferredAnimateElementHeightChange(t,i):TD.core.defer.maybeDeferred(i)},this.stateRuleMatch=function(t,e){return e=e||{},e.transition&&e.from&&e.to&&t[e.from]&&t[e.from][e.transition]&&t[e.from][e.transition].indexOf(e.to)>-1},this.revertContributorState=function(t){var e=this.getOrCreateContributorRow(t).attr("data-previous-state");this.setStateOrCreateContributor(t,e,{error:this.makeErrorState(e)})},this.scrollToContributor=function(t){var e=this.getElemByUserId("contributorRowSelector",t),i=this.$node.closest(".scroll-v");setTimeout(function(){o.makeElementVisible(i,e)},this.attr.scrollWait)},this.scrollFix=function(){this.$node.closest(".scroll-v").trigger("scroll")},this.removeContributorFromList=function(t){var e=this.getElemByUserId("contributorRowSelector",t);e.remove(),delete this.state.contributorIndex[t]},this.removeMessages=function(){this.$node.contents().filter(function(t,e){return!$(e).hasClass(this.attr.contributorRowClass)}.bind(this)).remove()},this.getOrCreateContributorRow=function(t){this.removeMessages();var e=this.select("contributorRowSelector").filter(function(){return $(this).attr("data-user-id")===t.user.id});if(e.length>0)return e;var i=!1;return e=this.renderContributorRow(t),t.isUnconfirmed||this.select("contributorRowSelector").each(function(n,s){var r=$(s),o=this.state.contributorIndex[r.attr("data-user-id")],a=1===this.sortByName(r.attr("data-name"),t),c=o.isUnconfirmed;!i&&(a||c)&&(e.insertBefore(r),i=!0)}.bind(this)),i||this.$node.append(e),e},this.renderContributorRow=function(t){var e=this.getTwitterLoginAccount(),i={initialState:this.attr.STATE_INITIAL,contributor:t,contributee:this.state.contributee,isSigninAccount:e&&t.user.id===e.userId};return this.renderTemplate("contributors/contributor_list_row",i)},this.scribeContributorAction=function(t,e){t&&(this.trigger(document,"scribeEvent",{terms:{page:"settings",section:"contributor_manager",component:"contributor",element:t,action:e}}),this.trigger("metric",{key:["contributors:ui",t,e].join(":")}))},this.scheduleContributorPoll=function(){return this.isPolling?void 0:(this.isPolling=!0,setTimeout(this.trigger.bind(this,"uiNeedsContributors",{accountKey:this.attr.accountKey}),this.attr.contributorsPollInterval))},this.getContributorRole=function(t){return t.isAdmin?"admin":"contributor"},this.makeErrorState=function(t){return t+"-error"}}var i=t("flight/lib/component"),n=t("data/with_accounts"),s=t("ui/with_template"),r=t("ui/with_transitions"),o=t("util/scroll");return i(e,n,s,r)}),define("ui/contributor_manager",["require","flight/lib/component","data/with_accounts","with-child-components","util/position_sticky","ui/user_selector","ui/contributor_list","scripts/UI/template"],function(t){"use strict";function e(){this.attributes({accountKey:null,fixedPosSelector:".js-position-sticky",contributorAdderSelector:".js-contributor-adder",contributorListSelector:".js-contributor-list",readMoreLinkSelector:".js-read-more"}),this.after("initialize",function(){this.renderContributorManager(),this.attachChild(o,this.attr.contributorAdderSelector,{placeholder:TD.i("Add team member")}),this.attachChild(a,this.attr.contributorListSelector,{accountKey:this.attr.accountKey}),this.on("uiUserSelected",{contributorAdderSelector:this.handleUserSelection}),this.on("click",{readMoreLinkSelector:this.trackReadMoreClick}),r.makeElementSticky({$target:this.select("fixedPosSelector"),$container:this.$node,$offsetChild:this.select("contributorListSelector")}),this.trigger(document,"scribeEvent",{terms:{page:"settings",section:"contributor_manager",action:"impression"}})}),this.renderContributorManager=function(){var t=this.getAccount(this.attr.accountKey);t.getProfileURL="https://twitter.com/"+t.screenName,t.profileImageURL=t.profileImageURL;var e=c.render("contributors/contributor_manager",{account:t,withUserBio:!1,withUserMenu:!1});this.$node.html(e)},this.handleUserSelection=function(t,e){this.trigger("dataContributor",{accountKey:this.attr.accountKey,contributor:{user:e.user,isAdmin:!1,isUnconfirmed:!0}}),this.trigger(document,"scribeEvent",{terms:{page:"settings",section:"contributor_manager",component:"user_search",action:"select"}})},this.trackReadMoreClick=function(){this.trigger(document,"scribeEvent",{terms:{page:"settings",section:"contributor_manager",element:"read_more",action:"click"}})}}var i=t("flight/lib/component"),n=t("data/with_accounts"),s=t("with-child-components"),r=t("util/position_sticky"),o=t("ui/user_selector"),a=t("ui/contributor_list"),c=t("scripts/UI/template");return i(e,n,s)}),define("ui/teams_upsell",["require","flight/lib/component","scripts/UI/template","ui/with_transitions"],function(t){function e(){this.attributes({template:"teams_upsell",upsellElementSelector:".js-teams-upsell",closeButtonSelector:".js-teams-upsell-close",okButtonSelector:".js-teams-upsell-ok",animateInClass:"anim-fade-in-left",animateOutClass:"anim-fade-out-right"}),this.after("initialize",function(t){this.on("click",{closeButtonSelector:this.handleClose,okButtonSelector:this.handleClose}),this.render(),this.before("teardown",this.removeHtml)}),this.render=function(){var t=n.render(this.attr.template);this.$node.append(t);var e=this.select("upsellElementSelector");this.stopAnimation(e,this.attr.animateInClass),this.addAnimateClass(e,this.attr.animateInClass,function(){e.removeClass(this.attr.animateInClass)}.bind(this))},this.handleClose=function(){var t=this.select("upsellElementSelector");this.stopAnimation(t,this.attr.animateOutClass),this.addAnimateClass(t,this.attr.animateOutClass,this.teardown.bind(this))},this.removeHtml=function(){this.select("upsellElementSelector").remove()}}var i=t("flight/lib/component"),n=t("scripts/UI/template"),s=t("ui/with_transitions");return i(e,s)}),define("ui/account_settings",["require","flight/lib/component","ui/with_accordion","data/with_accounts","with-child-components","with-state","ui/contributor_manager","ui/teams_upsell","util/scroll","scripts/UI/template"],function(t){function e(t){return{page:"settings",section:"accounts",component:{remove:"account",removeCheck:"account",removeCancel:"account",manageContributors:"account"}[t],element:{remove:"remove",removeCheck:"remove_check",removeCancel:"remove_cancel",add:"add_twitter_account",passwordReset:"reset_password",manageContributors:"show_contributor_manager",setDefault:"default"}[t],action:"setDefault"===t?"select":"click"}}function i(t,e){var i=parseInt(t.attr("data-max-digits"),10)||4,n=TD.util.truncateNumber(e,i);t.text(n),Math.pow(10,i)<=e&&t.attr("title",TD.util.prettyNumber(e))}function n(){this.initialState({hasOpenedDefaultAccount:!1}),this.attributes({accountManagerContainerSelector:".js-account-manager-container",contributorManagerContainerSelector:".js-contributor-manager-container",drawerContentSelector:".drawer-content",contributorManagerSelector:".js-contributor-manager",contributorManagerBackSelector:".js-contributor-manager-back",actionButtonSelector:".js-account-action",accountRowSelector:".js-account-settings-row",accountDetailSelector:".js-account-settings-detail",accountSummarySelector:".js-account-settings-summary",accountsContainerSelector:".js-account-settings-accounts",accountsRemoveCheckSelector:".js-account-remove-check",accountRemoveCheckClass:"account-remove-check-open",openAccountRowSelector:".js-account-settings-row.is-expanded",accountsInvitedContainerSelector:".js-account-invited-accounts",
accountInvitedRowSelector:".js-account-settings-invited-row",accountTweetsCountSelector:".js-account-tweets-count",accountFollowingCountSelector:".js-account-following-count",accountFollowersCountSelector:".js-account-followers-count",passwordResetLinkSelector:".js-password-reset-link",profileLinkSelector:'a[rel="user"]',firstExpandDelay:0,shiftedColumnClass:"is-shifted-1",accountUserProfileUrl:".js-account-profile-url",accountUserFriendUrl:".js-account-friend-url",accountUserFollowerUrl:".js-account-follower-url"}),this.after("initialize",function(){this.state={accounts:[],userData:{},contributorManagerAccountKey:null},this.on(document,"dataAccounts",this.handleAccounts),this.on(document,"dataCachedTwitterUser",this.handleCacheTwitterUser),this.on(document,"uiDrawerActive",this.handleActiveDrawer),this.on(document,"dataForgotPasswordSuccess",this.handleForgotPasswordSuccess),this.on(document,"dataForgotPasswordError",this.handleForgotPasswordError),this.on(document,"dataContributors",this.handleContributors),this.on(document,"dataContributorsError",this.handleContributorsError),this.on(document,"dataContributeeNotManaged",this.handleContributeeNotManaged),this.on("click",{passwordResetLinkSelector:this.handlePasswordResetClick,actionButtonSelector:this.handleActionButtonClick,contributorManagerBackSelector:this.hideContributorManager,profileLinkSelector:this.handleProfileLinkClick}),this.on("uiAccordionExpandAction",this.handleAccordionItemExpanded),this.on("uiAccordionWillExpand",this.handleAccordionItemWillExpand);var t=this.getAccountsForService("twitter"),e=d.render("settings/account_settings",{withPasswordReset:!this.isTwogin(),tweetDeckAccountEmail:this.getTweetdeckLoginEmail()});this.$node.html(e),this.renderAccounts(t),this.on(document,"uiShowAccountSettings",this.handleAccountSettingsShown)}),this.handleAccountSettingsShown=function(t,e){var i=this.select("accountsInvitedContainerSelector");if(i.children().length)return l.makeElementVisible(this.select("drawerContentSelector"),i);if(!this.select("openAccountRowSelector").length){var n=this.select("accordionToggleSelector").eq(0);n.hasClass("is-expanded")||this.state.hasOpenedDefaultAccount||setTimeout(function(){e&&e.withTeamOrganiserInstructions?this.attachChild(h,this.$node):(n.click(),this.mergeState({hasOpenedDefaultAccount:!0}))}.bind(this),this.attr.firstExpandDelay)}},this.recalculateAccordion=function(){this.trigger("uiAccordionUpdatePanelHeights")},this.handleAccounts=function(t,e){var i=this.renderAccounts(e.accounts);if(this.state.contributorManagerAccountKey){var n=i.filter(function(t){return t.accountKey===this.state.contributorManagerAccountKey},this)[0];(!n||n.isAdmin===!1)&&this.hideContributorManager()}},this.handleCacheTwitterUser=function(t,e){this.updateManagedUserCounts(e)},this.updateAccountFromUserCache=function(t){var e,i=this.state.userData[t.userId];e=i?TD.core.defer.succeed(i):TD.cache.twitterUsers.getById(t.userId),e.addCallback(this.updateManagedUserCounts.bind(this))},this.updateManagedUserCounts=function(t){var e=this.getAccountFromId(t.id);e&&(this.state.userData[t.id]=t,this.updateUserCounts(t))},this.updateUserCounts=function(t){var e=this.$node.find('.account-settings-row[data-user-id="'+t.id+'"]');e.length&&(e.find(this.attr.accountUserProfileUrl).attr("href",t.profileURL),e.find(this.attr.accountUserFriendUrl).attr("href",t.getFriendURL()),e.find(this.attr.accountUserFollowerUrl).attr("href",t.getFollowerURL()),i(e.find(this.attr.accountTweetsCountSelector),t.statusesCount),i(e.find(this.attr.accountFollowingCountSelector),t.friendsCount),i(e.find(this.attr.accountFollowersCountSelector),t.followersCount))},this.updateAccountContributorsUi=function(t){t.isAdmin&&this.trigger("uiNeedsContributors",{accountKey:t.accountKey})},this.handleContributors=function(t,e){this.toggleContributorsUiForAccount(e.accountKey,!0)},this.handleContributorsError=function(t,e){this.toggleContributorsUiForAccount(e.request.accountKey,!1)},this.toggleContributorsUiForAccount=function(t,e){var i=this.getAccountSettingsRow(t);i.find(this.attr.actionButtonSelector+"[data-action=manageContributors]").toggleClass("is-hidden",!e),this.recalculateAccordion()},this.handleContributeeNotManaged=function(t,e){var i=TD.cache.twitterUsers.getById(e.id);i.addCallback(function(t){this.renderInvitedAccount(e,t),this.updateUserCounts(t),this.updateInvitedNotification()}.bind(this))},this.handlePasswordResetClick=function(t,i){t.preventDefault();var n=this.select("passwordResetLinkSelector");n.blur(),n.hasClass("is-waiting")||(n.addClass("is-waiting"),this.trigger("uiTweetDeckForgotPasswordRequest",{email:this.getTweetdeckLoginEmail()}),this.trigger(document,"scribeEvent",{terms:e("passwordReset")}))},this.handleForgotPasswordSuccess=function(t,e){this.select("passwordResetLinkSelector").removeClass("is-waiting"),TD.controller.progressIndicator.addMessage(TD.i("We have sent an email to {{email}} with instructions to reset your password.",{email:this.getTweetdeckLoginEmail()}))},this.handleForgotPasswordError=function(t,e){this.select("passwordResetLinkSelector").removeClass("is-waiting"),TD.controller.progressIndicator.addMessage(TD.i("We could not find a TweetDeck account associated with {{email}}.",{email:this.getTweetdeckLoginEmail()}))},this.renderInvitedAccount=function(t,e){var i=this.select("accountsInvitedContainerSelector");if(!i.find("[data-user-id="+e.id+"]").length){var n=_.extend({},e,{accountKey:"invited:"+t.id,userId:e.id,withoutLinks:!0,isInvited:!0,isAdmin:!!t.isAdmin}),s=$(d.render("settings/account_settings_invited_row",n));i.append(s),this.updateAccountFromUserCache({userId:e.id}),this.trigger("metric",{key:"contributors:ui:invite:impression"})}},this.renderAccounts=function(t){var e,i=this.select("accountRowSelector"),n=this.select("accountsContainerSelector");t=t.filter(function(t){return TD.controller.clients.getClient(t.accountKey)},this);var s=t.map(function(t){return t.accountKey});return i.each(function(t,e){var i=$(e),n=i.attr("data-account-key");-1===s.indexOf(n)&&i.remove()}),t.map(function(t,s){var r=i.filter('[data-account-key="'+t.accountKey+'"]'),o=r.hasClass(this.attr.accordionIsExpandedClass),a=r.hasClass(this.attr.accordionIsActiveClass),c=$.extend({},t,{getProfileURL:"#",isExpanded:o,isActive:a,notRemovable:t.isDefault||t.isTwoginAccount,notRemovableMessage:TD.i(t.isTwoginAccount?"You cannot remove your login account.":"You cannot remove your default account.")}),u=$(d.render("settings/account_settings_row",c));if(r.length>0){r.replaceWith(u);var h=r.find(this.attr.actionButtonSelector+"[data-action=manageContributors]").hasClass("is-hidden");u.find(this.attr.actionButtonSelector+"[data-action=manageContributors]").toggleClass("is-hidden",h)}return this.updateAccountContributorsUi(t),e?e.after(u):n.prepend(u),this.updateAccountFromUserCache(t),e=u,t},this)},this.handleDefaultAccountSelected=function(t,e){var i=$(e.el).val();this.trigger("uiAccountAction",{action:"setDefault",accountKey:i}),this.trigger(document,"scribeEvent",{terms:{page:"settings",section:"accounts",element:"default",action:"select"}})},this.handleActionButtonClick=function(t,i){var n=$(i.el);if(!i.el.disabled&&!n.hasClass("is-disabled")){var s,r=n.attr("data-action"),o=n.attr("data-account-key"),a=e(r);switch(r){case"setDefault":this.trigger("uiAccountAction",{action:r,accountKey:o});break;case"removeCheck":this.toggleAccountRemoveCheck(o,!0);break;case"removeCancel":this.toggleAccountRemoveCheck(o,!1);break;case"remove":this.trigger("uiAccountAction",{action:r,accountKey:o});break;case"add":this.trigger("uiAccountAction",{action:r});break;case"manageContributors":this.showContributorManager(o);break;case"showLists":TD.ui.openColumn.showLists();break;case"showCustomTimelines":TD.ui.openColumn.showCustomTimelines();break;case"inviteAccept":s=this.getInvitedAccount(i.el),$(document).trigger("uiContributeeInviteAccept",{id:s.attr("data-user-id"),isAdmin:void 0!==s.attr("data-user-is-admin")}),s.remove(),this.updateInvitedNotification(),this.trigger("metric",{key:"contributors:ui:invite:click:accept"});break;case"inviteCancel":s=this.getInvitedAccount(i.el),$(document).trigger("uiRemoveContributee",{accountKey:TD.storage.store.getTwitterLoginAccount().getKey(),userId:s.attr("data-user-id")}),s.remove(),this.updateInvitedNotification(),this.trigger("metric",{key:"contributors:ui:invite:click:reject"})}this.trigger(document,"scribeEvent",{terms:a})}},this.getInvitedAccount=function(t){var e=$(t).attr("data-account-key");return this.select("accountsInvitedContainerSelector").find(this.attr.accountInvitedRowSelector+'[data-account-key="'+e+'"]')},this.handleActiveDrawer=function(t,e){e.activeDrawer||this.hideContributorManager()},this.toggleAccountRemoveCheck=function(t,e){var i=this.select("accountRowSelector").filter(function(e,i){return $(i).attr("data-account-key")===t}).toggleClass(this.attr.accountRemoveCheckClass,e).trigger("uiAccordionUpdatePanelHeights");e&&l.makeElementVisible(this.select("drawerContentSelector"),i.find(this.attr.accountsRemoveCheckSelector))},this.showContributorManager=function(t){var e=this.select("contributorManagerSelector");this.trigger(document,this.childTeardownEvent),e.empty(),this.$node.addClass(this.attr.shiftedColumnClass),this.state.contributorManagerAccountKey=t,this.attachChild(u,e,{accountKey:t})},this.hideContributorManager=function(){this.trigger(document,this.childTeardownEvent),this.state.contributorManagerAccountKey=null,this.$node.removeClass(this.attr.shiftedColumnClass),this.recalculateAccordion(),this.trigger(document,"scribeEvent",{terms:{page:"settings",section:"contributor_manager",element:"back",action:"click"}})},this.handleAccordionItemWillExpand=function(t){this.toggleAccountRemoveCheck(t.target.getAttribute("data-account-key"),!1)},this.handleAccordionItemExpanded=function(t){this.trigger(document,"scribeEvent",{terms:{page:"settings",section:"accounts",component:"account",action:"impression"}})},this.handleProfileLinkClick=function(){this.trigger(document,"scribeEvent",{terms:{page:"settings",section:"accounts",component:"account",element:"show_profile",action:"click"}})},this.getAccountSettingsRow=function(t){return this.select("accountsContainerSelector").find(this.attr.accountRowSelector+'[data-account-key="'+t+'"]')},this.updateInvitedNotification=function(){this.trigger("uiInvitedContributeeAccounts",{count:this.select("accountInvitedRowSelector").length})}}var s=t("flight/lib/component"),r=t("ui/with_accordion"),o=t("data/with_accounts"),a=t("with-child-components"),c=t("with-state"),u=t("ui/contributor_manager"),h=t("ui/teams_upsell"),l=t("util/scroll"),d=t("scripts/UI/template");return s(c,n,o,r,a)}),define("ui/drawer",["require","flight/lib/component","ui/compose/docked_compose","ui/account_settings","with-child-components"],function(t){function e(){var t="compose",e="accountSettings",i={};i[e]="accounts",this.attributes({contentSelector:".js-app-content",drawerSelector:".js-drawer",closeDrawerSelector:".js-drawer-close",composeSelector:".js-drawer-compose",accountSettingsSelector:".js-drawer-account-settings",drawerWidth:270,transitionDuration:200,accountSettingsExpandDelay:200}),this.after("initialize",function(){this.state={activeDrawer:null},this.$content=this.select("contentSelector"),this.on(document,"uiDrawerHideDrawer",this.handleDrawerHide),this.on(document,"uiDrawerShowDrawer",this.handleDrawerShow),this.on(document,"uiShowAccountSettings",this.handleShowAccountSettings),this.on("click",{closeDrawerSelector:this.handleDrawerHide}),this.attachChild(n,this.getDrawerContainer(t)),this.attachChild(s,this.getDrawerContainer(e),{firstExpandDelay:this.attr.transitionDuration+this.attr.accountSettingsExpandDelay})}),this.handleDrawerShow=function(t,e){this.showDrawer({drawer:e.drawer,withAnimation:e.withAnimation})},this.handleDrawerHide=function(){this.hideDrawer({withAnimation:!0})},this.getDrawerContainer=function(t){return this.select("drawerSelector").filter(function(){return $(this).attr("data-drawer")===t})},this.handleShowAccountSettings=function(){this.showDrawer({drawer:e,withAnimation:!0})},this.applyContentTransition=function(t){TD.ui.main.TRANSITION_END_EVENTS&&this.$content.one(TD.ui.main.TRANSITION_END_EVENTS,this.handleTransitionEnd.bind(this)),this.$content.css(t),TD.ui.main.TRANSITION_END_EVENTS||this.handleTransitionEnd()},this.hideDrawer=function(t){this.state.activeDrawer&&(this.select("contentSelector").removeClass("is-open"),this.setTransitionDuration(t.withAnimation),this.state.activeDrawer=null,this.applyContentTransition({transform:"translateX(0px)","margin-right":"0"}),this.trigger("uiDrawerActive",{activeDrawer:this.state.activeDrawer}))},this.showDrawer=function(t){t.drawer!==this.state.activeDrawer&&(this.select("contentSelector").addClass("is-open"),this.setVisibleDrawer(t.drawer),this.state.activeDrawer||(this.setTransitionDuration(t.withAnimation),this.applyContentTransition({transform:"translateX("+this.attr.drawerWidth+"px)"})),this.state.activeDrawer=t.drawer,this.trigger("uiDrawerActive",{activeDrawer:this.state.activeDrawer}),i[t.drawer]&&this.trigger(document,"scribeEvent",{terms:{page:"settings",section:i[t.drawer],action:"impression"}}))},this.handleTransitionEnd=function(){this.state.activeDrawer&&this.$content.css({"margin-right":this.attr.drawerWidth}),this.trigger("uiDrawerTransitionComplete")},this.setVisibleDrawer=function(t){this.trigger("uiCloseModal"),this.select("drawerSelector").addClass("is-hidden");var e=this.getDrawerContainer(t);e.removeClass("is-hidden")},this.setTransitionDuration=function(t){this.$content.css(t?{"transition-duration":this.attr.transitionDuration+"ms"}:{"transition-duration":"0"})}}var i=t("flight/lib/component"),n=t("ui/compose/docked_compose"),s=t("ui/account_settings"),r=t("with-child-components");return i(e,r)}),define("ui/dm_conversation_menu",["require","flight/lib/component","ui/with_dropdown"],function(t){"use strict";function e(t){var e=TD.controller.clients.getClient(t.accountKey);return e.conversations.getConversation(t.conversationId)}function i(){this.after("initialize",function(){this.conversationData={},this.accountKey=null,this.columnKey=null,this.on("uiShowConversationMenu",this.handleShowConversationMenu),this.after("renderDropdown",this.addConversationMenuClickHandler),this.before("teardownCurrentDropdown",this.handleRemoveConversationMenu)}),this.addConversationMenuClickHandler=function(){this.currentDropdown&&this.on(this.currentDropdown.$el,"click",this.handleConversationMenuClick)},this.handleConversationMenuClick=function(t){var i=$(t.target);if(0!==i.closest(this.attr.isSelectedSelector).length){var n=i.data("action");switch(n){case"rename-conversation":i.closest(".js-detail-header").trigger("uiRenameConversation",this.conversationData);break;case"leave-conversation":this.trigger("uiDeleteConversation",this.conversationData);break;case"notify-conversation":var s=e(this.conversationData),r=s.notificationsDisabled?"uiConversationsEnableNotifications":"uiConversationsDisableNotifications";s.notificationsDisabled=!s.notificationsDisabled,this.trigger(r,this.conversationData);break;case"view-people":this.trigger("metric",{key:"dm:ui:conversation:view-participiants"}),this.trigger(document,"uiShowDmParticipants",this.conversationData)}}},this.handleShowConversationMenu=function(t,i){var n=i.$targetElement.find(".js-menu-target"),s=e(i);this.conversationData={columnKey:i.columnKey,accountKey:i.accountKey,conversationId:i.conversationId,notificationsDisabled:s.notificationsDisabled,name:s.name,showAddUser:!0},this.renderDropdown(n,"menus/dm_conversations_menu",this.conversationData,{toggle:!0,position:"pos-l conversation-menu-position"})},this.handleRemoveConversationMenu=function(t,e){this.currentDropdown&&(this.conversationData={})}}var n=t("flight/lib/component"),s=t("ui/with_dropdown");return n(i,s)}),define("ui/features/custom_timelines",["flight/lib/component"],function(t){function e(){this.attributes({disabledCSS:'<style type="text/css">.feature-customtimelines { display: none !important; }.prf .lst-profile li { width: 20% !important; }</style> '}),this.after("initialize",function(){this.enabled=void 0,this.defaultAccount=null,this.whitelist={},this.$disabledCSS=$(this.attr.disabledCSS),this.on(document,"uiNeedsFeatureCustomTimelines",this.triggerState),this.on(document,"dataDefaultAccount",this.handleDefaultAccount),this.on(document,"dataCustomTimelineWhitelistItem",this.handleWhitelistValue),this.on(document,"dataDeciderUpdated",this.updateState),this.trigger("uiNeedsDefaultAccount"),this.on(document,"uiFeatureCustomTimelines",this.onFeatureChange)}),this.after("teardown",function(){this.$disabledCSS.remove()}),this.handleDefaultAccount=function(t,e){this.defaultAccount=e.accountKey,this.updateState()},this.handleWhitelistValue=function(t,e){this.whitelist[e.accountKey]=e.whitelisted,this.updateState()},this.getEnabledState=function(){return Boolean(!TD.decider.get("disable_custom_timelines")&&this.defaultAccount&&this.whitelist[this.defaultAccount])},this.updateState=function(){var t=this.getEnabledState();t!==this.enabled&&(this.enabled=t,this.enabled?this.$disabledCSS.remove():$("body").append(this.$disabledCSS),this.triggerState())},this.triggerState=function(){this.trigger("uiFeatureCustomTimelines",{enabled:this.enabled})},this.onFeatureChange=function(t,e){TD.sync.util.stateLog("Collection state changed to "+(e.enabled?"enabled":"disabled"))}}return t(e)}),define("ui/features/forced_migration",["require","flight/lib/component","data/with_accounts","util/with_watch_decider"],function(t){function e(){this.attributes({}),this.after("initialize",function(){"tweetdeck"===this.getCurrentAuthType()&&(TD.decider.hasAccessLevel("migration","FORCED_MIGRATION")&&this.trigger("uiMigrateStart"),this.watchAccessLevel("migration","FORCED_MIGRATION",this.maybeStartMigration))}),this.maybeStartMigration=function(t,e){!e&&t&&this.trigger("uiMigrateStart")}}var i=t("flight/lib/component"),n=t("data/with_accounts"),s=t("util/with_watch_decider");return i(e,n,s)}),define("page/default",["require","flight/lib/component","flight/lib/registry","flight/lib/compose","flight/lib/advice","flight/lib/debug","es6-promise","array.prototype.find","util/data_setup","ui/keyboard_shortcuts","ui/message_banner","ui/app_search","ui/column_controller","ui/grid","ui/grid_scroll","ui/focus_controller","ui/confirmation_dialog_controller","ui/with_dialog_manager","ui/message_banner_container","ui/image_upload","ui/login/startflow","ui/login/sole_user_dialog","ui/column_navigation","ui/columns/column_order","ui/search/search_in_popover","ui/typeahead/typeahead_dropdown","ui/search/search_results","ui/search/search_router","ui/app_header","ui/default_page_layout","ui/compose/compose_controller","ui/drag_drop/drag_drop_controller","ui/modal/modal_controller","ui/migrate_controller","ui/actions_menu","ui/columns/column_drag_drop","ui/drawer","ui/dm_conversation_menu","ui/features/custom_timelines","ui/features/forced_migration"],function(t){function e(){this.attributes({modal:"#open-modal",appHeader:".js-app-header",searchResults:".js-search-form",message:".js-message-banner",appSearchSourceId:"appSearch",searchPopoverSourceId:"searchPopover",isHiddenClass:"is-hidden",gridFocusId:"grid_focus",modalsContainerSelector:".js-modals-container",columnScrollContainerSelector:".js-app-columns-container"}),this.initSearchInPopover=function(){y.attachTo(".js-search-in-popover",{popoverPosition:"rt",closeModals:!0,appSearchSourceId:this.attr.appSearchSourceId,searchPopoverSourceId:this.attr.searchPopoverSourceId,isHiddenClass:this.attr.isHiddenClass}),h.attachTo(".js-search-in-popover",{sourceId:this.attr.searchPopoverSourceId}),_.attachTo(".js-search-in-popover"),D.attachTo(".js-search-in-popover")},this.initUI=function(){this.$node.find(".js-app").removeClass(this.attr.isHiddenClass),$("body","html").removeClass("scroll-v"),L.attachTo(this.$node),N.attachTo(this.$node),k.attachTo(this.$node),g.attachTo(this.$node),R.attachTo(this.$node),w.attachTo(this.$node),u.attachTo(this.select("message")),p.attachTo(this.$node),x.attachTo(this.$node),O.attachTo(this.$node),l.attachTo(this.$node,{focusId:this.attr.gridFocusId}),T.attachTo(this.select("columnScrollContainerSelector")),d.attachTo(this.$node,{focusId:this.attr.gridFocusId}),m.attachTo(this.$node),v.attachTo("#compose-modal"),I.attachTo(".js-app-header"),E.attachTo(".js-app"),P.attachTo(this.$node),S.attachTo("#column-navigator"),h.attachTo(".js-search-form",{sourceId:this.attr.appSearchSourceId}),this.initSearchInPopover(),A.attachTo(this.$node),c.attachTo(this.$node),U.attachTo(this.$node)},this.after("initialize",function(){function t(t,e){b.attachTo(".js-app-loading",e)}TD.config.flight_debug&&(console.info("Flight debug mode enabled."),o.enable(!0),s.mixin(n,[r.withAdvice])),a.attachTo(this.$node),F.attachTo(this.attr.modalsContainerSelector),M.attachTo(this.$node),C.attachTo(".js-app-loading",{teardownOn:"TD.ready"}),this.on(document,"TD.ready",function(){this.initUI(),this.off(document,"uiLoginShowSoleUserDialog",t)}.bind(this)),this.on(document,"uiLoginShowSoleUserDialog",t)})}var i=t("flight/lib/component"),n=t("flight/lib/registry"),s=t("flight/lib/compose"),r=t("flight/lib/advice"),o=t("flight/lib/debug");t("es6-promise").polyfill(),t("array.prototype.find");var a=t("util/data_setup"),c=t("ui/keyboard_shortcuts"),u=t("ui/message_banner"),h=t("ui/app_search"),l=t("ui/column_controller"),d=t("ui/grid"),m=t("ui/grid_scroll"),g=t("ui/focus_controller"),p=t("ui/confirmation_dialog_controller"),f=t("ui/with_dialog_manager"),w=t("ui/message_banner_container"),v=t("ui/image_upload"),C=t("ui/login/startflow"),b=t("ui/login/sole_user_dialog"),S=t("ui/column_navigation"),T=t("ui/columns/column_order"),y=t("ui/search/search_in_popover"),_=t("ui/typeahead/typeahead_dropdown"),D=t("ui/search/search_results"),A=t("ui/search/search_router"),I=t("ui/app_header"),k=t("ui/default_page_layout"),E=t("ui/compose/compose_controller"),R=t("ui/drag_drop/drag_drop_controller"),F=t("ui/modal/modal_controller"),M=t("ui/migrate_controller"),x=t("ui/actions_menu"),O=t("ui/columns/column_drag_drop"),P=t("ui/drawer"),U=t("ui/dm_conversation_menu"),L=t("ui/features/custom_timelines"),N=t("ui/features/forced_migration");return i(e,f)}),define("td/lib/require-domready",[],function(){"use strict";function t(t){var e;for(e=0;e<t.length;e+=1)t[e](u)}function e(){var e=h;c&&e.length&&(h=[],t(e))}function i(){c||(c=!0,o&&clearInterval(o),e())}function n(t){return c?t(u):h.push(t),n}var s,r,o,a="undefined"!=typeof window&&window.document,c=!a,u=a?document:null,h=[];if(a){if(document.addEventListener)document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1);else if(window.attachEvent){window.attachEvent("onload",i),r=document.createElement("div");try{s=null===window.frameElement}catch(l){}r.doScroll&&s&&window.external&&(o=setInterval(function(){try{r.doScroll(),i()}catch(t){}},30))}"complete"===document.readyState&&i()}return n.version="2.0.1",n.load=function(t,e,i,s){s.isBuild?i(null):n(i)},n}),require(["page/default","td/lib/require-domready!"],function(t,e){TD.util.checkAPIRoot(),t.attachTo(e),TD.controller.init.start()}),$(document).ready(function(){TD.controller.init.preload()}),define("scripts/swift/app/main",function(){});